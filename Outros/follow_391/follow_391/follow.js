//~ Revision: 391, Copyright (C) 2016-2020: Willem Vree, contributions Stéphane David, Pedro Martínez.
//~ This program is free software; you can redistribute it and/or modify it under the terms of the
//~ GNU General Public License as published by the Free Software Foundation; either version 2 of
//~ the License, or (at your option) any later version.
//~ This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
//~ without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
//~ See the GNU General Public License for more details. <http://www.gnu.org/licenses/gpl.html>.
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(g){var n=0;return function(){return n<g.length?{done:!1,value:g[n++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.makeIterator=function(g){var n="undefined"!=typeof Symbol&&Symbol.iterator&&g[Symbol.iterator];return n?n.call(g):$jscomp.arrayIterator(g)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,n,p){g!=Array.prototype&&g!=Object.prototype&&(g[n]=p.value)};$jscomp.getGlobal=function(g){g=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,g];for(var n=0;n<g.length;++n){var p=g[n];if(p&&p.Math==Math)return p}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(g,n){this.$jscomp$symbol$id_=g;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:n})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function g(p){if(this instanceof g)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(p||"")+"_"+n++,p)}var n=0;return g}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var g=$jscomp.global.Symbol.iterator;g||(g=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[g]&&$jscomp.defineProperty(Array.prototype,g,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var g=$jscomp.global.Symbol.asyncIterator;g||(g=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(g){$jscomp.initSymbolIterator();g={next:g};g[$jscomp.global.Symbol.iterator]=function(){return this};return g};
$jscomp.iteratorFromArray=function(g,n){$jscomp.initSymbolIterator();g instanceof String&&(g+="");var p=0,z={next:function(){if(p<g.length){var C=p++;return{value:n(C,g[C]),done:!1}}z.next=function(){return{done:!0,value:void 0}};return z.next()}};z[Symbol.iterator]=function(){return z};return z};
$jscomp.polyfill=function(g,n,p,z){if(n){p=$jscomp.global;g=g.split(".");for(z=0;z<g.length-1;z++){var C=g[z];C in p||(p[C]={});p=p[C]}g=g[g.length-1];z=p[g];n=n(z);n!=z&&null!=n&&$jscomp.defineProperty(p,g,{configurable:!0,writable:!0,value:n})}};$jscomp.polyfill("Array.prototype.keys",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(g){return g})}},"es6","es3");
$jscomp.checkStringArgs=function(g,n,p){if(null==g)throw new TypeError("The 'this' value for String.prototype."+p+" must not be null or undefined");if(n instanceof RegExp)throw new TypeError("First argument to String.prototype."+p+" must not be a regular expression");return g+""};
$jscomp.polyfill("String.prototype.endsWith",function(g){return g?g:function(g,p){var n=$jscomp.checkStringArgs(this,g,"endsWith");g+="";void 0===p&&(p=n.length);p=Math.max(0,Math.min(p|0,n.length));for(var C=g.length;0<C&&0<p;)if(n[--p]!=g[--C])return!1;return 0>=C}},"es6","es3");
$jscomp.polyfill("Array.from",function(g){return g?g:function(g,p,z){p=null!=p?p:function(g){return g};var n=[],G="undefined"!=typeof Symbol&&Symbol.iterator&&g[Symbol.iterator];if("function"==typeof G){g=G.call(g);for(var fa=0;!(G=g.next()).done;)n.push(p.call(z,G.value,fa++))}else for(G=g.length,fa=0;fa<G;fa++)n.push(p.call(z,g[fa],fa));return n}},"es6","es3");
$jscomp.findInternal=function(g,n,p){g instanceof String&&(g=String(g));for(var z=g.length,C=0;C<z;C++){var G=g[C];if(n.call(p,G,C,g))return{i:C,v:G}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(g){return g?g:function(g,p){return $jscomp.findInternal(this,g,p).v}},"es6","es3");$jscomp.polyfill("Math.log10",function(g){return g?g:function(g){return Math.log(g)/Math.LN10}},"es6","es3");
var follow_VERSION=391,pre_opt={},abc_arr,demoDlg,media_file,abc_enc,offset_js,times_arr,opt,lpRec,maat_duren;
(function(){function g(a,c,b){var d=E.createBufferSource();d.buffer=Wc[a];var e=E.createGain();e.gain.setValueAtTime(1E-5,b);c=ac*c/150;0==c&&(c=1E-5);e.gain.exponentialRampToValueAtTime(c,b+.003);d.connect(e);e.connect(E.destination);d.start(b,.025);bc[a]=[d,e,c];delete ub[a]}function n(a,c){var b=bc[a];if(b)if(cc)ub[a]=1;else{var d=$jscomp.makeIterator(b);b=d.next().value;var e=d.next().value;d=d.next().value;e.gain.setValueAtTime(d,c);e.gain.exponentialRampToValueAtTime(1E-5,c+.1);b.stop(c+.1);
bc[a]=void 0}}function p(a){var c="C Db D Eb E F Gb G Ab A Bb B".split(" "),b=a.shift();b?(c=MIDI.Soundfont.acoustic_grand_piano[c[b%12]+(Math.floor(b/12)-1)].split(",")[1],Xc(c,function(c){Wc[b]=c;$("#comp").append(", "+b);dc.push(""+b);Yc[b]=1;p(a)})):(bb=1,u("midi nrs: "+dc.join(",")),$("#comp").toggle(!1))}function z(a){bb=0;a=Object.keys(a).filter(function(a){return!(a in Yc)});0==Y&&(a=[]);a.length?($("#comp").toggle(!0),dc=[],p(a)):bb=1}function C(a){a=a[0].link;a=a.replace("www.dropbox","dl.dropboxusercontent").split("?")[0];
pre_opt={};vb();N("#wait",1);u("link: "+a);$.get(a,"",null,"text").done(function(a,b){u("preload: "+b);G(a);N("#wait",0)}).fail(function(a,b,d){$("#wait").append("\npreload failed: "+b)})}function G(a){var c=a.slice(0,4E3);0<=c.indexOf("abc_arr = [")||0<=c.indexOf("import {")?(a=encodeURIComponent(a),wb+=1,Zc("data:text/javascript;charset=utf-8,"+a)):0<=c.indexOf("X:")?(va(a),ec()):-1==c.indexOf("<?xml ")?alert("not an xml file nor an abc file"):(a=$.parseXML(a),a=vertaal(a,{p:"f",t:1,u:0,v:3,m:2,
mnum:0}),a[1]&&u(a[1]),va(a[0]),ec())}function fa(){var a=new FileReader;a.onload=function(b){G(a.result);N("#wait",0)};var c=$("#fknp").prop("files")[0];if(c){var b=c.name.toLowerCase();N("#wait",1);b.endsWith(".ogg")||b.endsWith(".mp3")?(media_file=window.URL.createObjectURL(c),$c(),N("#wait",0)):(pre_opt={},vb(),a.readAsText(c))}}function va(a,c){function b(a){var b={diamond:1,triangle:1,square:1,normal:1},c=d,f,e="default",m={"default":[]},w={"default":[]};a=a.split("\n");for(f=0;f<a.length;++f){var h=
a[f];if(0<=h.indexOf("I:percmap")){h=h.split(" ").map(function(a){return a.trim()});var g=h[4];g in b&&(g=g+"+,"+g);h="%%map perc"+e+" "+h[1]+" print="+h[2]+" midi="+h[3]+" heads="+g;m[e].push(h)}0<=h.indexOf("%%MIDI")&&w[e].push(h);0<=h.indexOf("V:")&&(g=h.match(/V:\s*(\S+)/))&&(e=g[1],e in m||(m[e]=[],w[e]=[]))}b=Object.keys(m).sort();for(f=0;f<b.length;++f)c=c.concat(m[b[f]]);e="default";for(f=0;f<a.length;++f)h=a[f],0<=h.indexOf("I:percmap")||0<=h.indexOf("%%MIDI")||(0<=h.indexOf("V:")||0<=h.indexOf("K:")?
((g=h.match(/V:\s*(\S+)/))&&(e=g[1]),c.push(h),e in w&&w[e].length&&(c=c.concat(w[e]),delete w[e]),0<=h.indexOf("perc")&&-1==h.indexOf("map=")&&(h+=" map=perc"),0<=h.indexOf("map=perc")&&0<m[e].length&&c.push("%%voicemap perc"+e),0<=h.indexOf("map=off")&&c.push("%%voicemap")):c.push(h));return c.join("\n")}var d='%%beginsvg\n<defs>,<text id="x" x="-3" y="0">&#xe263;</text>,<text id="x-" x="-3" y="0">&#xe263;</text>,<text id="x+" x="-3" y="0">&#xe263;</text>,<text id="normal" x="-3.7" y="0">&#xe0a3;</text>,<text id="normal-" x="-3.7" y="0">&#xe0a3;</text>,<text id="normal+" x="-3.7" y="0">&#xe0a4;</text>,<g id="circle-x"><text x="-3" y="0">&#xe263;</text><circle r="4" class="stroke"></circle></g>,<g id="circle-x-"><text x="-3" y="0">&#xe263;</text><circle r="4" class="stroke"></circle></g>,<path id="triangle" d="m-4 -3.2l4 6.4 4 -6.4z" class="stroke" style="stroke-width:1.4"></path>,<path id="triangle-" d="m-4 -3.2l4 6.4 4 -6.4z" class="stroke" style="stroke-width:1.4"></path>,<path id="triangle+" d="m-4 -3.2l4 6.4 4 -6.4z" class="stroke" style="fill:#000"></path>,<path id="square" d="m-3.5 3l0 -6.2 7.2 0 0 6.2z" class="stroke" style="stroke-width:1.4"></path>,<path id="square-" d="m-3.5 3l0 -6.2 7.2 0 0 6.2z" class="stroke" style="stroke-width:1.4"></path>,<path id="square+" d="m-3.5 3l0 -6.2 7.2 0 0 6.2z" class="stroke" style="fill:#000"></path>,<path id="diamond" d="m0 -3l4.2 3.2 -4.2 3.2 -4.2 -3.2z" class="stroke" style="stroke-width:1.4"></path>,<path id="diamond-" d="m0 -3l4.2 3.2 -4.2 3.2 -4.2 -3.2z" class="stroke" style="stroke-width:1.4"></path>,<path id="diamond+" d="m0 -3l4.2 3.2 -4.2 3.2 -4.2 -3.2z" class="stroke" style="fill:#000"></path>,</defs>\n%%endsvg'.split(",");
y=a;a=a.split("\n");e.nolyr&&a.splice(1,0,"%%writefields w "+!e.nolyr);0<e.hrz?a.splice(0,0,"%%singleline 1","%%maxshrink "+e.shrnk):a.splice(0,0,"%%measurenb 0");if(e.pw||e.hrz){var m=[],f;for(f=0;f<a.length;++f){var w=a[f];0<=w.indexOf("$")&&(w=w.replace(/\$/g,""));0==w.indexOf("I:linebreak")&&(w=a[f]);0==w.indexOf("V:")&&(w=w.replace(/snm="[^"]*"/,""));0!=w.indexOf("%%page")&&0!=w.indexOf("%%left")&&0!=w.indexOf("%%right")&&(0==w.indexOf("%%scale")&&e.hrz||m.push(w))}a=m;e.hrz?a.splice(1,0,"%%scale "+
e.scl):(m=e.pw,f=(.03*m).toFixed(1),w=(.01*m).toFixed(1),a.splice(1,0,"%%pagewidth "+m+"cm","%%leftmargin "+f+"cm","%%rightmargin "+w+"cm"))}a=a.join("\n");0<=a.indexOf("percmap")&&(a=b(a));Zd(a);fc(a,c)}function Zd(a){function c(a){var b=[];a.forEach(function(a,c){b[a.st]?b[a.st].push(c):b[a.st]=[c];a.clef.clef_octave&&(zb[c]=a.clef.clef_octave);cb[a.st]=6*(a.stafflines||"|||||").length*(a.staffscale||1)});return b}var b="",d=[3,0,4,1,5,2,6],m=[0,2,4,5,7,9,11];Ja=a;ha=[];zb=[];var f=new Abc({img_out:null,
errmsg:function(a,c,d){b+=a+"\n"},read_file:function(a){return""},anno_start:null,get_abcmodel:function(a,b,f){function h(a,b){w[a]=[0,0,0,0,0,0,0];g[a]={};B[a]=b;var c=0<=b;(c?d.slice(0,b):d.slice(b)).forEach(function(b){w[a][b]+=c?1:-1})}var w={};f={"-2":-2,"-1":-1,0:0,1:1,2:2,3:0};var g={},B={},l={},k,q=b[0].meter.a_meter,wa=60,p=384;q=q.length?q[0]:{top:"4",bot:4};for(k=0;k<b.length;++k)h(k,b[k].key.k_sf),l[k]={};Ab=b.length;T=c(b);b=0;for(var t=a;t;t=t.ts_next){var n=[];switch(t.type){case 14:p=
t.tempo_notes.reduce(function(a,b){return a+b});wa=t.tempo*p/384;0==t.time&&(b=1);break;case 10:b||0!=t.time||(pre_opt.tempo&&(wa=pre_opt.tempo),pre_opt.tempo||times_arr||maat_duren||(pre_opt.tempo=wa));var v={t:t.time,nt:-1,dur:t.dur,nm:"",ntkb:-1};n.push(v);ha.push({t:t.time,ix:t.istart,v:t.v,dur:t.dur,ns:n,tmp:wa,mtr:q,met:p,st:t.st});break;case 8:b||0!=t.time||(pre_opt.tempo&&(wa=pre_opt.tempo),pre_opt.tempo||times_arr||maat_duren||(pre_opt.tempo=wa));for(a=0;a<t.notes.length;++a){var db=t.notes[a];
var u=db.pit+19;k=t.v;zb[k]&&(u+=zb[k]);v=Math.floor(u/7);var z=u%7;void 0!=db.acc&&(g[k][u]=f[db.acc]);var A=u in g[k]?g[k][u]:w[k][z];var x=[z,A];var y=12*v+m[z]+A;gc[y]=1;v={t:t.time,nt:y,dur:t.dur,nm:x,ntkb:y};u in l[k]?(l[k][u].dur+=t.dur,db.tie_ty||delete l[k][u],v.nt=-1):db.tie_ty&&(l[k][u]=v);t.ti2&&t.notes.filter(function(a){return a.tie_s&&a.tie_s.midi==y}).length&&(v.nt=-1);n.push(v)}if(0==n.length)break;ha.push({t:t.time,ix:t.istart,v:t.v,dur:t.dur,ns:n,tmp:wa,mtr:q,met:p,st:t.st});break;
case 5:h(t.v,t.k_sf);break;case 0:h(t.v,B[t.v]);ha.push({t:t.time,ix:t.istart,v:t.v,bt:t.bar_type,tx:t.text});break;case 6:q=t.a_meter[0]}}ia.forEach(function(a){var b=a.parentNode;b&&b.removeChild(a)});O=[];for(a=0;a<Ab;++a)f=1<<a&0?"0":"",l=document.createElementNS("http://www.w3.org/2000/svg","rect"),l.setAttribute("fill",e.kleur[a%e.kleur.length]+f),l.setAttribute("fill-opacity",e.mat),l.setAttribute("width","0"),ia.push(l),O.push(-1),Ka[a]=[]}});f.tosvg("play","%%play");f.tosvg("abc2svg",a);
""==b&&(b="no error");u(b)}function fc(a,c){var b="",d="",m=0;q=c||0;O[0]=-1;ja=c||0;xa={};La=[];hc={};var f={},w,h,g=1E3,k=0,xb=0;if(a){(function(){for(var b=a.split("\n"),c=0;c<b.length&&!(0<=b[c].search(/^%%score/)||0<=b[c].search(/^I:score/));++c);Z&&c==b.length&&(alert("Staff extraction only works with ABC files that have a %%score declaration"),Z=0);if(Z){Bb=b[c];ad=c;var d="("+T[x].map(function(a){return a+1}).join(" ")+")";if(2==Z&&x+1 in T){var f=T[x+1].map(function(a){return a+1});d="{"+
d+"("+f.join(" ")+")}"}b[c]="%%score"+Array(b[c].length-d.length-7+1).join(" ")+d}else Bb&&(b[ad]=Bb);a=b.join("\n")})();c={img_out:function(a){-1!=a.indexOf("<svg")&&(La[m]=Object.keys(f),f={},m+=1,w<g&&(g=w),h>k&&(k=h),xb&&(hc[xb]=1),xb=0);b+=a},errmsg:function(a,b,c){d+=a+"\n"},read_file:function(a){return""},anno_start:function(a,b,c,d,e,g,B){if("note"==a||"rest"==a)d=r.ax(d).toFixed(2),e=r.ay(e).toFixed(2),B=r.ah(B),xa[b]=[m,d,e,g,B];"bar"==a&&(e=r.ay(e),B=r.ah(B),e=Math.round(e+B),f[e]=1,h=
r.ax(d)+g,w=Math.round(r.ax(0)),b in xa||(xa[b]=[m,h.toFixed(2),e,g,B],xb=b))},get_abcmodel:null};0==e.hrz&&(c.imagesize='width="100%"');var r=new Abc(c);r.tosvg("abc2svg",a);""==d&&(d="no error");u(d);b&&($("#notation").html('<div id="leeg" style="height:500px">&nbsp;</div>'),$("#notation").append(b),$("#notation").append('<div id="leeg" style="height:500px">&nbsp;</div>'),$("#leeg").click(function(){aa?ya():J(q)}),P=$("#notation svg"),P.each(function(a,b){var c=b.querySelector(".g");ka[a]=c?c:b}),
ka=$(ka),P.children("title").remove(),bd(),cd(),P.click(function(a){var b,c;a.stopPropagation();var d=(a.clientX+F.scrollLeft)*eb;if(d<g+24||d>k)aa?ya():J(q);else{var f=$("#notation").position().top-$("#notation").scrollTop();var m=P.get().indexOf(this);var h=(a.clientY-f-ic[m])*eb;f=La[m];for(a=0;a<f.length&&!U;a++)if(f[a]>h){a!=x&&Ma(Z?x:a);la(!0);break}for(a=0;a<Ab;++a)Cb(a);var w=-1,B=-1;for(c=a=0;a<l.length;++a)if(b=l[a].xy)if(f=b[0],h=1*b[1],b=b[3],!(f<m&&0==c)){c=1;if(f>m||a==l.length-1){c=
a-1;break}if(f==m&&d<h+b){c=a;break}if(h<B&&f<=w){c=a-1;break}w=f;B=h}e.lus&&U?(d=c,m=null,U==za&&(q==L&&(q=d),L=d,m=za,e.atagTijd=l[d].t,d>=ma&&(q=d,e.atagTijd=-1)),U==Na&&(ma=d,m=Na,e.btagTijd=l[d].t,d<=L&&(q=d,e.atagTijd=-1)),null!=m&&(m.classList.remove("tagselect"),U=null,jc())):J(c);Oa()}}),Ma(x))}}function dd(a){a.stopPropagation();a=a.currentTarget;if(U&&(U.classList.remove("tagselect"),a==U)){U=null;return}U=a;a.classList.add("tagselect")}function kc(a){e.lus&&(a<L||a>ma)&&(a=L);q=ja=a;for(Pa=
0;Pa<=q;++Pa)Db(l[Pa],0);la(!0)}function jc(a){function c(){var a=Object.keys(Qa).sort(function(a,b){return a-b}).map(function(a){return 1*a});a.unshift(0);for(var b=0,c=0;b<a.length&&a[b]<=l[q].t;)b+=1;for(;c<l.length&&l[c].t<a[b];)c+=1;return[l[q].t,l[c-1].t]}function b(a){for(var b=0;b<l.length&&l[b].t!=a;++b)if(l[b].t>a)return b-1;return b}function d(a,b){var c=$("#chkmod").val(),d=$jscomp.makeIterator(l[b].xy);b=d.next().value;var f=d.next().value;d.next();var e=d.next().value;d.next();d=La[b];
var m=Z||4==c?0:x,g=m,w=d.length-1;3==c&&(g=Math.min(g+1,w));4==c&&(g=w);f=a==za?f-12:1*f+e;a.setAttribute("x",f);a.setAttribute("y",d[m]-cb[m]);a.setAttribute("width",12);a.setAttribute("height",d[g]-d[m]+cb[m]);a.style.display="initial";ka.eq(b).append(a);a.removeEventListener("click",dd);a.addEventListener("click",dd)}a=void 0===a?1:a;if(!(0==l.length||q>l.length)){if(e.lus){if(0>e.atagTijd){var m=$jscomp.makeIterator(c());e.atagTijd=m.next().value;e.btagTijd=m.next().value}L=b(e.atagTijd);ma=
b(e.btagTijd);d(za,L);d(Na,ma);ed(L,ma+1);a&&Q(0)}else za.remove(),Na.remove(),ed(0,l.length-1);Oa(1)}}function $d(){times_arr&&(maat_duren=times_arr.reduce(function(a,b){return a.concat(b.slice(1))}).map(function(a,b,c){return 0==b?0:Math.round(100*(a-c[b-1]))/100}));var a=Object.keys(Qa).sort(function(a,b){return a-b}).map(function(a){return 1*a});a.unshift(0);var c,b=0;for(c=1;c<maat_duren.length;++c){var d=a[c]-a[c-1];d=d/384*60/maat_duren[c];for(d=Math.round(100*d)/100;l[b].t<a[c]&&b<l.length;)l[b].tmp=
d,b+=1}}function ae(a){function c(a){Qa[r.t+n]=1;(r.ix in hc||"r"==a||"v"==a)&&M.push({t:r.t+n,xy:xa[r.ix],bt:a})}var b=0<q&&q<l.length?l[q].t:0;l=[];Qa={};M=[];na=0;var d=$("#chkmod").val(),m=ha.filter(function(b){return!b.bt&&b.v in a}),f=ha.filter(function(b){return b.bt&&b.v in a}),g=m.map(function(a){return a.t});g.push(f[f.length-1].t+1);var h=g.shift(),B=[];m=[];var k=[],p=[];for(f=0;f<ha.length;++f){var r=ha[f];if(r.t==h){for(;r.t==h;)h=g.shift();k.push(p);p=[]}r.t<h&&p.push(r)}k.push(p);
h=1;var n=0,u=1,v=0,yb=0,z=0,y={};for(f=0;f<k.length;++f)for(p=k[f],m=B,B=[],g=0;g<p.length;++g){r=p[g];if(r.bt&&0==r.v){":"==r.bt[0]&&1==y[r.t]&&(h=1,y[r.t]=2);if(":"==r.bt[0]&&!y[r.t]){c("r");y[r.t]=1;f=u-1;h=2;n+=r.t-v;B=m;break}":"==r.bt[r.bt.length-1]&&(u=f,v=r.t);yb&&(r.tx||"|"!=r.bt)&&(yb=0,n-=r.t-z);2==h&&"1"==r.tx&&(c("v"),yb=1,z=r.t)}if(yb){B=m;break}if(r.bt)c("l");else if(r.v in a||4==d){var t={};var A={};r.ns.sort(function(a,b){return b.nt-a.nt});if(1==d){B=B.concat(r.ns.slice(1));var x=
r.ns[0];t[x.nt]=x.nm;A[x.ntkb]=x.nm;x=x.dur}else r.ns.forEach(function(a){t[a.nt]=a.nm;A[a.ntkb]=a.nm}),x=Math.max.apply(Math,r.ns.map(function(a){return a.dur}));1<Object.keys(t).length&&delete t[-1];l.push({t:r.t+n,xy:xa[r.ix],ptc:t,dur:x,ptckb:A,rst:m,tmp:r.tmp,vce:r.v,mtr:r.mtr,met:r.met,st:r.st});m=B}else r.ns.forEach(function(a){B.push({t:a.t+n,nt:a.nt,dur:a.dur})})}be(B);f=e.lat/1E3;e.syncon&&(times_arr||maat_duren)&&($d(f),f+=offset_js);fb=[];d=f;k=l[0].t;p=l[0].tmp;for(f=1;f<l.length;++f)fb.push(d),
m=l[f].t,d+=60/p*(m-k)/384,k=m,p=l[f].tmp;for(q=0;q<l.length&&!(l[q].t>=b);++q);q==l.length&&--q;ja=q;Q(0);Aa()}function ed(a,c){for(gb=0;a<c;++a){var b=l[a];-1 in b.ptc||(gb+=Object.keys(b.ptc).length)}}function be(a){var c,b=[];lc={};for(c=0;c<l.length;++c){var d=l[c];var e=Object.keys(d.ptc);var f=Object.keys(d.ptckb);e=e.filter(function(a){return-1!=a});f=f.filter(function(a){return-1!=a});var g=e.map(function(a){return{mn:a,dur:d.dur,st:d.st,nm:d.ptc[a]}});if(h&&h.t==d.t)e.forEach(function(a){-1 in
h.ptc&&delete h.ptc[-1];h.ptc[a]=d.ptc[a]}),f.forEach(function(a){-1 in h.ptckb&&delete h.ptckb[-1];h.ptckb[a]=d.ptckb[a]}),h.vxy[d.vce]=d.xy,h.xy||(h.xy=d.xy),d.xy&&1*d.xy[1]<1*h.xy[1]&&(h.xy=d.xy),h.pbk=h.pbk.concat(g),g.forEach(function(a){return h.durs[a.mn]=a.dur}),e.forEach(function(a){h.vcs[a]=d.vce}),h.vms[d.vce]=e,h.vmskb[d.vce]=f,h.nns=Object.keys(h.vcs).length;else{d.pbk=g;d.durs={};g.forEach(function(a){return d.durs[a.mn]=a.dur});d.vxy={};d.vxy[d.vce]=d.xy;d.vcs={};e.forEach(function(a){d.vcs[a]=
d.vce});d.vms={};d.vms[d.vce]=e;d.vmskb={};d.vmskb[d.vce]=f;d.nns=Object.keys(d.vcs).length;var h=d;b.push(d);lc[d.t]=b.length-1}}l=b;c=l[l.length-1];l.push({t:c.t+c.dur,xy:c.xy,ptc:c.ptc,dur:c.dur,rst:a,tmp:c.tmp});ia.forEach(function(a){a.setAttribute("width",0);a.setAttribute("height",0)});if(0<Ra)for(a=0;a<Ab;++a)Cb(a);(function(){for(var a=[],b=0,c=0;b<l.length&&c<M.length;)l[b].t<M[c].t?(a.push({t:l[b].t,xy:l[b].xy,bt:""}),b+=1):(a.push(M[c]),c+=1);M=a})();l.forEach(function(a,b){return a.iseq=
b})}function bd(){if(0!=P.length){var a=$("#notation").position().top-$("#notation").scrollTop();ic=P.map(function(c,b){return $(b).position().top-a}).get()}}function cd(){if(0!=P.length){var a=P.length-1,c=P.get(a);var b=c.getBoundingClientRect().width;try{var d=c.viewBox.baseVal.width}catch(m){d=b}0==d&&(d=b);a=ka.get(a).transform.baseVal;a=a.numberOfItems?a.getItem(0).matrix.a:1;eb=d/a/b}}function la(a){if(!(0==O.length||0>O[Eb])){var c=$("#rollijn").offset().top+30-$("#notation").offset().top,
b=Z?0:x;c=Math.round(ic[O[Eb]]+(La[O[Eb]][b]-cb[b])/eb-c);c!=F.scrollTop&&(0<e.hrz?(hb&&(F.style["scroll-behavior"]="auto"),F.scrollTop=c):(hb&&(F.style["scroll-behavior"]=a?"smooth":"auto"),hb||!a?F.scrollTop=c:$(F).animate({scrollTop:c})))}}function ce(a){var c=a.split(",");a=parseInt(c[0]);a=lc[a];if(0<=a){H=c=c[1];var b=156.25/c,d=l[a];Db(d);(e.lncur||e.hrz)&&ba(d.t+.1,b);if(0<Y){var m=oa();Object.keys(d.ptc).forEach(function(a){ib(m,a,d.dur*b)});l[a+1].rst.forEach(function(a){ib(m+(a.t-d.t)*
b,a.nt,a.dur*b)})}}}function Db(a,c){c=void 0===c?!0:c;var b,d,m,f;Eb=a.vce;for(f in a.vxy){var g=ia[f];if(b=a.vxy[f]){var h=b[0];var k=b[1];var l=b[2];var q=b[3];b=b[4];var r=O[f];h!=r&&((r=g.parentNode)&&r.removeChild(g),ka.eq(h).prepend(g),O[f]=h,c&&la(!0));Fb=1;ca[f]||(ca[f]=e.kleur[f%e.kleur.length]);g.setAttribute("x",k);g.setAttribute("y",l);g.setAttribute("width",q);g.setAttribute("height",b);g.setAttribute("fill",ca[f])}else g.setAttribute("width",0),g.setAttribute("height",0)}mc.value=Math.round(a.tmp*
pa/(a.met/384));if(0<Ra){for(f in a.vmskb)Cb(f);for(f in a.vmskb)a.vmskb[f].forEach(function(b){d=document.getElementById(fd[b]);m=document.getElementById(gd[b]);Ka[f].push([d,m,b]);d.style.fill=e.kleur[f%e.kleur.length];var c=$jscomp.makeIterator(a.ptckb[b]);b=c.next().value;c=c.next().value;m.innerHTML=nc[b]+hd[c+2]})}}function oc(a,c){a.t!=pc&&R.send(a.t+","+c);pc=a.t}function oa(){return 1==Y?1E3*E.currentTime:(new Date).getTime()-performance.timing.navigationStart}function Gb(a,c){if(0!=Y){if(1==
Y&&bb){var b=a[0]&240,d=a[2],e=a[1];c/=1E3;128==b&&n(e,c);144==b&&(0<d?g(e,d,c):n(e,c));176==b&&64==e&&(64<=d?cc=1:(cc=0,Object.keys(ub).forEach(function(a){n(a,c)}),ub={}))}2==Y&&Hb&&Hb.send(a,c)}}function ib(a,c,b){-1!=c&&(c=[144,c,70],Gb(c,a),c[2]=0,Gb(c,a+b))}function id(){if(0>qa&&(J(-1),!e.nocnt))return;var a=S,c=156.25/H,b=oa();if(a.pbk){a.pbk.forEach(function(a){if(-1!=a.mn){var d=[144,a.mn,110];Ba({data:d});d[2]=0;Gb(d,b+a.dur*c-1)}});for(var d in a.vcs)if(-1!=d){var m=a.vcs[d];ca[m]=e.ntGoed;
ia[m].setAttribute("fill",e.ntGoed)}}}function Oa(a,c){if(a){Ca=[];qc=Ib=Jb=rc=0;Aa();for(var b in da)da[b].remove();da={};Sa={};jd()}c||(qa=-1)}function de(a){a=Ca.map(function(a,b){return[b,a.laat]});var c=Ca.map(function(a,b){return[b+.2,a.duur[0]]}),b=Ca.map(function(a,b){return[b+.4,a.duur[1]||null]}),d=Ca.map(function(a,b){return[b+.6,a.duur[2]||null]});Ta.style.display="block";$.plot("#flot",[{label:"timing",color:"rgba(0,128,0,0.5)",data:a,bars:{show:!0,barWidth:.5,align:"left"},yaxis:1},
{label:"duration",color:"#a0522d",data:c,bars:{show:!0,barWidth:.1,align:"left"},yaxis:2},{label:"",color:"#a0522d",data:b,bars:{show:!0,barWidth:.1,align:"left"},yaxis:2},{label:"",color:"#a0522d",data:d,bars:{show:!0,barWidth:.1,align:"left"},yaxis:2}],{yaxes:[{position:"left",font:{color:"rgba(0,128,0,1)"},min:-500,max:500},{position:"right",font:{color:"#602010"},min:-100,max:100}]})}function ba(a,c,b){function d(a,b){var c=M[na];a<c.t&&(na=0,c=M[0]);for(;a>=c.t;)na+=1,c=M[na];if(b>=c.t){g=1;
if(c.t>l[q].t)return b=ba(l[q].t+.1,0,1);if(M[na+1]&&M[na+1].xy[1]<1*c.xy[1])return b=ba(c.t+.1,0,1)}b=M[na-1];var d=(a-b.t)/(c.t-b.t);b=b.xy;a=b[0];var m=1*b[1];var h=1*c.xy[1];h<m&&(h=m+b[3],c.xy[1]=h);b=m+(h-m)*d;d=f;c=b;e.lncur||e.hrz?(a!=d&&((k=I.parentNode)&&k.removeChild(I),ka.eq(a).prepend(I)),m=La[a],d=m[0]-cb[0],m=m[m.length-1]-d,h=e.oneclr?e.ntWacht:ca[0],I.setAttribute("x",c),I.setAttribute("y",d-6),I.setAttribute("width",2),I.setAttribute("height",m+12),h&&I.setAttribute("fill",h),I.setAttribute("fill-opacity",
e.lncur?e.mat:0),e.hide2cur&&e.nocur&&I.setAttribute("fill-opacity",0)):((k=I.parentNode)&&k.removeChild(I),cancelAnimationFrame(Ua));f=a;0<e.hrz&&(a=b/eb-F.scrollLeft,F.scrollLeft+=a-F.clientWidth/3)}function m(b){0==p&&(p=b);a+=(b-p)/c;h=a+25/c;d(a,h);p=b;g&&6!=e.volgmod?cancelAnimationFrame(Ua):Ua=requestAnimationFrame(m)}var f=-1,g=0,h,k;cancelAnimationFrame(Ua);var p=0;b?d(a):Ua=requestAnimationFrame(m)}function Q(a,c,b){q+=a;0>q&&(q=0);D=0<q&&!b?l[q-1]:l[q];var d=l[q],m=oa(),f=H;sc=H;b=(m-tc)/
uc;a&&!vc&&Va&&b<jb&&b>wc&&(f=Math.round(f/(1<=b?1+.5*(b-1):1-.5*(1-b))),H=f=kb>f?kb:f,pa=f/D.tmp,Kb());var g=156.25/f,h=kd=g,p=D.t,n=(d.t-p)*g;D.tmp!=d.tmp&&(H=d.tmp*pa,h=156.25/H);var u=d.dur*h;b=1;var r=n;if(a&&V&&!A.ended){A.paused&&Lb(-1);var v=A.currentTime-fb[q-1];k.lat&&$("#deb").html((1E3*v).toFixed(0)+" msec");!Va&&e.syncon&&(n-=1E3*v,0>n&&(n=0),b=n/r,.3>b&&(b=.3));clearTimeout(ld);ld=setTimeout(function(){A.pause()},n+e.tmo)}var x=-1;!a&&!c||e.rstmute||d.rst.forEach(function(a){var b=(a.t-
p)*g;ib(m+b,a.nt,a.dur*g);Wa&&b!=x&&(x=b,setTimeout(function(){oc(a,f)},b))});if(q==l.length-1)md=setTimeout(function(){for(var a in K)xc(S,a,K[a]);J(-1)},n),(e.lncur||e.hrz)&&ba(p,g*b);else{if(e.lus&&(q>ma||q<L)){if(e.lusstop&&a){setTimeout(function(){J(-1)},n);return}L<l.length&&(q=ja=L,d=l[q],setTimeout(function(){Oa(1,1);V&&lb&&Lb()},n))}vc=1==a&&-1 in d.ptc;mb||vc?(e.mute||d.pbk.forEach(function(a){ib(m+n,a.mn,a.dur*h)}),clearTimeout(nb),nb=setTimeout(function(){Q(1)},n)):Mb&&a&&(c=(d.t-p)*ee,
clearTimeout(nb),nb=setTimeout(function(){Q(1)},c));c=n>u?.5*u:.5*n;e.exact&&Nb&&(c=0);c=n-c;var y=nd?n-c:0;0==a?(ra={},K={},S=d,ca={},ob||(ea={}),kc(q),V&&(A.currentTime=fb[q]),D=d,(e.lncur||e.hrz)&&ba(d.t+.1,g,1),Wa&&(oc(d,f),pc=-1)):((e.lncur||e.hrz)&&ba(p,g*b),od=setTimeout(function(){if(mb)for(var a in S.vcs)a in ra||-1==a||(K[S.vcs[a]]=1);for(var b in K)xc(S,b,K[b]);K={};ra={};S=d;ca={};Fb=0;qa=m+n;clearTimeout(yc);yc=setTimeout(function(){Db(d);for(var a in ea)zc(a,1);ea={}},y)},c),Wa&&(pd=
setTimeout(function(){oc(d,f)},n)));tc=m;uc=n;Da&&(p in Qa||0==p)&&Ac(1)}}function qd(){clearTimeout(nb);clearTimeout(od);clearTimeout(yc);clearTimeout(pd);clearTimeout(md);cancelAnimationFrame(Ua)}function Lb(a){A.currentTime=fb[q+(void 0===a?0:a)];return A.play()}function fe(a,c){function b(a,b){a.stopPropagation();if(" "==b||"Enter"==b||"Escape"==b)c(),d.close()}var d=document.getElementById("errDlg"),e=document.createElement("button");d.innerHTML=a;d.append(e);e.append("Ok");e.addEventListener("keydown",
function(a){return b(a,a.key)});e.addEventListener("click",function(a){return b(a,"Enter")});d.showModal()}function J(a,c){function b(a){N("#unlkDlg",0);V=0;fe("<p>Audio file could not be loaded.</p>",function(a){Ob=0;$("#btrk").toggle(!1);$("#spkr").toggle(!1);media_file="";sa.value="start"})}c=void 0===c?!0:c;l.length&&("stop"==sa.value||0<=a?(sa.value="start",lb=0,rd(),mb=0,qd(),qa=-1,ja=q=0<=a?a:ja,Q(0,0,1),e.ftyp&&sd(),0>a&&window.parent.postMessage(td.innerHTML,"*")):(sa.value="stop",sc=H=D.tmp*
pa,"running"!=E.state&&E.resume().then(function(){u("audio context now running")}),Ob&&0==V?(qa=0,N("#unlkDlg",1),Lb().then(function(a){N("#unlkDlg",0);V=1;ud(c)}).catch(function(a){b(a)})):ud(c)))}function vd(a){for(var c=l[q].t,b=q;b<l.length&&0<=b;b+=a){var d=l[b].t;if(d!=c&&(d in Qa||0==d)){kc(b);e.lncur&&ba(l[b].t+.1,0,1);break}}}function wd(a){var c,b=Infinity;for(c=q;c<l.length&&0<=c;c+=a)if(l[c].xy)if(f){var d=$jscomp.makeIterator(l[c].xy);var g=d.next().value;d=d.next().value;g==k+a&&Math.abs(f-
d)<b&&(b=Math.abs(f-d),q=c);if(1==a&&g>k+a)break;if(-1==a&&g<k+a)break}else{var f=$jscomp.makeIterator(l[c].xy);var k=f.next().value;f=f.next().value}kc(q);e.lncur&&ba(l[q].t+.1,0,1)}function ge(a){var c=a.key;"Escape"==c&&("block"==Ta.style.display?Ta.style.display="none":ya());if(!(aa&&"m"!=c||a.altKey||a.ctrlKey)&&("m"==c&&$("#mbar").click(),y)){var b=1;switch(c){case "ArrowLeft":case "Left":a.shiftKey?Q(-1):vd(-1);break;case "ArrowUp":case "Up":a.shiftKey?xd(-1):wd(-1);break;case "ArrowRight":case "Right":a.shiftKey?
id():vd(1);break;case "ArrowDown":case "Down":a.shiftKey?xd(1):wd(1);break;case "c":case " ":a.shiftKey?id():J(-1);break;default:b=0}b&&a.preventDefault()}}function he(a){var c=a.key;if(" "==c||"Enter"==c)a.stopPropagation(),a={mbar:1,mbar2:2,mbar3:3,mbar4:4},c=document.activeElement.id,c in a&&pb(a[c])}function ie(){function a(a){if("#"!=a[0])return a;var b=parseInt(a[1]+a[1],16),c=parseInt(a[2]+a[2],16);a=parseInt(a[3]+a[3],16);return"rgba("+b+","+c+","+a+","+e.mat+")"}Ea={};e.ntKleur.forEach(function(a,
b){Ea[b+1]=a});Bc=document.getElementById("sgd");Cc=document.getElementById("se1");Dc=document.getElementById("se2");Ec=document.getElementById("se3");Fc=document.getElementById("pct");yd=document.getElementById("stot");Cc.style.background=a(Ea[1]);Dc.style.background=a(Ea[2]);Ec.style.background=a(Ea[4]);Aa()}function Aa(){if(gb&&Bc){var a=qc*e.pnlerr,c=Jb*e.pnltim,b=rc*e.pnlkrt,d=100*(Ib-a-(e.tmng?c:0)-(e.tmng2?b:0))/gb;0>d&&(d=0);var g=$jscomp.makeIterator(["rgba(255,0,0,0.3)","rgba(0,191,255,0.5)",
"rgba(0,255,0,0.5)"]),f=g.next().value,k=g.next().value;g=g.next().value;var h=d.toFixed(0);e.scal&&(Bc.innerHTML=Ib,Cc.innerHTML=a,Dc.innerHTML=c,Ec.innerHTML=b,yd.innerHTML=gb);Fc.innerHTML=h;Fc.style.background=50>d?f:85>d?k:g;e.lus?localStorage.setItem("loopscore",h):localStorage.setItem("score",h)}}function je(a){var c=Gc[a]-qa,b=Math.abs(c);e.tmng&&b>e.late1&&(Jb+=1,b>e.late2&&(Jb+=1),a=S.vcs[a],K[a]=(K[a]||0)|2);Ca[S.iseq]={laat:c,duur:[]}}function zc(a,c){var b=S;if(b){c||(Gc[a]=oa());Object.keys(b.ptc);
if(0>qa&&(60==a||a in b.ptc)){if(1==W){ea[a]=1;return}J(-1,60==a);if(!e.nocnt&&60==a||-1 in b.ptc)return}if(lb)if(a==e.stopat)J(-1);else if(Object.keys(ra).length==b.nns||-1 in b.ptc)ea[a]=1;else{if(a in b.vcs)ra[a]=1,Pb[a]=b,c=b.vcs[a],b.vms[c].every(function(a){return a in ra})&&(ca[c]=e.ntGoed,Fb&&ia[c].setAttribute("fill",e.ntGoed),je(a));else{qc+=1;Aa();for(var d in b.vcs)d in ra||-1==d||(c=b.vcs[d],ca[c]=e.ntFout,K[c]=(K[c]||0)|1,Fb&&ia[c].setAttribute("fill",e.ntFout))}Object.keys(ra).length==
b.nns&&(Ib+=b.pbk.length,Aa(),mb||Q(1))}}}function zd(a){if(e.tmng2&&Pb[a]){var c=Pb[a],b=c.durs[a]*kd,d=Gc[a]+b-oa();b=100*d/b;delete Pb[a];if((0>b?-b:b)>e.kort&&(0>d?-d:d)>e.minkort)if(rc+=1,Aa(),a=c.vcs[a],c.iseq==S.iseq)K[a]=(K[a]||0)|4;else{d=c.iseq+","+a;var g=da[d];g?(Sa[d]|=4,g.setAttribute("fill",Ea[Sa[d]])):xc(c,a,4)}(c=Ca[c.iseq])&&c.duur.push(b)}}function xc(a,c,b){if(-1 in a.ptc)console.log("rust fout",a.iseq,c,b);else{var d=a.iseq+","+c,g=a.vxy[c];if(g){a=g[0];c=g[1];var f=g[2],k=g[3];
g=g[4];var h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttribute("x",c);h.setAttribute("y",f);h.setAttribute("width",k);h.setAttribute("height",g);h.setAttribute("fill",Ea[b]);h.setAttribute("fill-opacity",e.metmrk?e.mat:0);ka.eq(a).prepend(h);da[d]=h;Sa[d]=b}}}function sd(){for(var a in da){var c=Sa[a],b=da[a],d=$jscomp.makeIterator(a.split(",")),e=d.next().value;d=d.next().value;var f=$jscomp.makeIterator(l[e].vxy[d].map(function(a){return 1*a}));f.next();e=f.next().value;
d=f.next().value;var g=f.next().value,h=f.next().value;f=document.createElementNS("http://www.w3.org/2000/svg","text");f.setAttribute("x",e+g);f.setAttribute("y",d+h);f.setAttribute("font-size","12");f.setAttribute("class","tfout");c=document.createTextNode(c);f.appendChild(c);b.parentElement.append(f)}}function jd(){var a=document.getElementsByClassName("tfout");Array.from(a).forEach(function(a){return a.remove()})}function Ad(){for(var a=oa(),c=0;3>c;++c)ib(a,60+2*c,300),a+=310}function Ba(a){var c=
a.data[0],b=a.data[1],d=a.data[2];254!=c&&(c&=240,128==c&&(delete ea[b],zd(b)),144==c&&(0<d?zc(b):(delete ea[b],zd(b))),e.echo&&Gb(a.data,oa()))}function ke(a){u("MIDI ready! Listening to following input ports:");var c=0;a.inputs.forEach(function(a){a.onmidimessage=Ba;u(c+": "+a.name+', "'+a.manufacturer+'"');c++});u("The following output ports are present:");var b=$("#portsel");a=a.outputs;c=0;a.forEach(function(a){u(c+": "+a.name+', "'+a.manufacturer+'"');b.append('<option value="'+c+'">'+a.name+
"</option>");Bd.push(a);Hb=a;c++})}function le(a){u("Failed to get MIDI access - "+a)}function me(a){var c=$("#portsel").val();"synth"==c?(Y=1,a&&z(gc)):"nosound"==c?Y=0:(Y=2,a=parseInt(c),Hb=Bd[a]);Ad()}function Ma(a){a in T||(a=0);qd();var c={};T[a].forEach(function(a){c[a]=1});if(3==$("#chkmod").val()){var b=a;a+1 in T?b=a+1:a-1 in T&&(a=b=a-1);T[b].forEach(function(a){c[a]=1})}O.forEach(function(a,b,c){c[b]=-1});e.lus&&(L=0,ma=Infinity);Ja&&ae(c);x=a;jc(0)}function xd(a){x+=a;0>x&&(x=0);x>=T.length&&
(x=0);Ma(x)}function ya(){aa=0;$(".hfd").toggle(!1);$(".down").toggleClass("down",!1)}function pb(a){aa==a?ya():(ya(),aa=a,$(".hfd").eq(a-1).toggle(!0),$(".mknop").eq(a-1).toggleClass("down",!0))}function Cd(){Hc.style.fill="none";if(Da||W)Qb=setTimeout(Ac,Ic)}function rd(){W=0;ob=Da=!1;clearTimeout(Qb);$("#countin").toggle(!1);Cd();V&&A.pause()}function ud(a){var c={"2/2":2,"3/2":3,"4/2":4,"2/4":2,"3/4":3,"4/4":4,"5/4":5,"6/8":2,"7/8":3,"9/8":3,"11/8":4,"12/8":4};$("#start").blur();if(Da||W)rd();
else{Oa(1);Kb();var b=D.mtr.top+"/"+D.mtr.bot;W=a&&!e.nocnt?c[b]+1:1;ob=6==e.volgmod;$("#countin").html("<b>"+W+"</b>").toggle(!0);Ac()}}function Ac(a){Hc.style.fill="red";var c=E.createBufferSource();c.buffer=Dd;var b=E.createGain();b.gain.setValueAtTime(a?3:1,0);c.connect(b);b.connect(E.destination);c.start(0,.06,.16);Ic=3E4/sc*(D.met/384);clearTimeout(Qb);Qb=setTimeout(Cd,Ic);if(0<W&&(--W,$("#countin").html("<b>"+W+"</b>"),0==W)){$("#countin").toggle(!1);lb=1;Da=e.metro;tc=qa=oa();ob?(mb=1,V&&
Lb(),Q(0,0,1),ob=0):e.eenvoor?Q(0,1):(uc=0,-1 in l[q].ptc&&Q(1));for(var d in ea)zc(d,1);ea={}}}function Xc(a,c){a=atob(a);for(var b=new ArrayBuffer(a.length),d=new Uint8Array(b),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);E.decodeAudioData(b,function(a){c(a)},function(a){console.log("decode error: "+a);bb=0})}function Ed(){e.syncon=Jc.checked;lb&&J(-1);y&&Ma(x);D&&(H=pa*D.tmp)}function Rb(a){$("#spkron").toggle(!a);$("#spkrof").toggle(a);$("#spkron2").toggle(!a);$("#spkrof2").toggle(a);a?(Fd=e.vol1,
e.vol1=0):e.vol1=Fd||100;ta.value=e.vol1;A.volume=e.vol1/100;A.muted=a}function ne(){var a="",c="",b,d,e="";var f=window.location.href.replace("?dl=0","").split("?");if(b=f[0].match(/:\/\/([^/:]+)/))var g=b[1];if(1<f.length){var h=f[1].split("&");for(d=0;d<h.length;d++)f=h[d].replace(/d:(\w{15}\/[^.]+\.)/,"https://dl.dropboxusercontent.com/s/$1"),(b=f.match(/tmp=([\d.]*)/))?k.tempo=parseFloat(b[1]):(b=f.match(/stf=(\d+)/))?k.staff=parseInt(b[1]):(b=f.match(/mod=(\d+)/))?k.chkmod=parseInt(b[1]):(b=
f.match(/fmd=(\d+)/))?k.volgmod=parseInt(b[1]):(b=f.match(/opa=(\d)/))?k.kbopa=parseInt(b[1]):(b=f.match(/line=(\d+)/))?k.line=parseInt(b[1]):(b=f.match(/pw=(\d+)/))?k.pw=parseInt(b[1]):(b=f.match(/scl=([\d.]*)/))?k.scl=parseFloat(b[1]):(b=f.match(/hrz=(\d+)/))?k.hrz=parseInt(b[1]):(b=f.match(/tb=([\d.]*)/))?k.btime=parseFloat(b[1]):(b=f.match(/te=([\d.]*)/))?k.etime=parseFloat(b[1]):(b=f.match(/begin=([\d]+)/))?k.begin=parseInt(b[1]):(b=f.match(/shrnk=([\d.]*)/))?k.shrnk=parseFloat(b[1]):(b=f.match(/lat=([+-]?[\d]+)/))?
k.lat=parseInt(b[1]):(b=f.match(/vol=([\d]*)/))?k.vol=parseInt(b[1]):(b=f.match(/pnlerr=([\d.]*)/))?k.pnlerr=parseFloat(b[1]):(b=f.match(/pnltim=([\d.]*)/))?k.pnltim=parseFloat(b[1]):(b=f.match(/pnlkrt=([\d.]*)/))?k.pnlkrt=parseFloat(b[1]):(b=f.match(/late1=([\d]*)/))?k.late1=parseInt(b[1]):(b=f.match(/late2=([\d]*)/))?k.late2=parseInt(b[1]):(b=f.match(/kort=([\d]*)/))?k.kort=parseInt(b[1]):(b=f.match(/minkort=([\d]*)/))?k.minkort=parseInt(b[1]):(b=f.match(/stopat=([\d]*)/))?k.stopat=parseInt(b[1]):
(b=f.match(/hinfo=(\d+)/))?k.hinfo=parseInt(b[1]):(b=f.match(/mat=([\d.]+)/))?k.mat=parseFloat(b[1]):(b=f.match(/kleur=([#\dabcdef,]+)/))?k.kleur=b[1].split(","):(b=f.match(/tmo=(\d+)/))?k.tmo=parseInt(b[1]):(b=f.match(/dbx=([\w/.]+)/))?c="https://dl.dropboxusercontent.com/"+b[1]:(b=f.match(/key=(\w+)/))?c+="?rlkey="+b[1]:"ip"==f&&g?k.ipadr=g:"ipm"==f&&g?(k.ipadr=g,k.mstr=1):"metro"==f?k.metro=1:"nocnt"==f?k.nocnt=1:"nodel"==f?k.delay=0:"keyb"==f?k.keys=1:"ksh"==f?k.mark=1:"nosnd"==f?k.portsel="nosound":
"nobar"==f?k.nobar=1:"nomenu"==f?k.nomenu=1:"extr"==f?k.extract=2:"extrg"==f?k.extract=3:"nocur"==f?k.nocur=1:"mute"==f?k.mute=1:"rstmute"==f?k.rstmute=1:"nosm"==f?hb=!1:"tmng"==f?k.tmng=1:"tmng2"==f?k.tmng2=1:"lncur"==f?k.lncur=1:"oneclr"==f?k.oneclr=1:"nolyr"==f?k.nolyr=1:"hide2cur"==f?k.hide2cur=1:"metmrk"==f?k.metmrk=1:"ftyp"==f?k.ftyp=1:"scal"==f?k.scal=1:"noecho"==f?k.echo=0:c=f,/(\.xml$)|(\.abc$)/.test(c)&&(a=c,c=""),/(\.mp3$)|(\.mp4$)|(\.ogg$)|(\.webm$)/.test(c)&&(e=c,c="");e&&(media_file=
decodeURIComponent(e).replace("www.dropbox","dl.dropboxusercontent"));(c||a)&&N("#wait",1);a?$.get(a,"",null,"text").done(function(a,b){u("preload: "+b);G(a);N("#wait",0)}).fail(function(a,b,c){$("#wait").append("\npreload failed: "+b)}):c&&Zc(c)}return c||a}function Zc(a){0<=a.indexOf("dropbox.com")&&(a+="?dl=1");0!=a.indexOf("data:text")&&-1==a.indexOf("http")&&(a="./"+a);import(a).then(function(a){u("preload loaded");if(a.pre_opt){media_file=a.media_file;pre_opt=a.pre_opt;abc_arr=a.abc_arr;for(var b in a.defaults)b in
pre_opt||(pre_opt[b]=a.defaults[b])}vb();G(abc_arr.join("\n"));N("#wait",0,!R||k.mstr)}).catch(function(a){$("#wait,#err").append("\npreload failed:\n"+a)})}function Sb(a,c){var b=document.getElementById(a),d=b?b.type:void 0;void 0!=c&&(e[a]=c);"checkbox"==d&&(b.checked=e[a]);if("number"==d||"select-one"==d)b.value=e[a];void 0!=c&&Fa(a)}function ec(){for(var a in pre_opt)e[a]=pre_opt[a];for(a in k)e[a]=k[a];for(a in Tb)Sb(a);for(a in e)Fa(a,0);Ob=V=0;$c();Xa.addEventListener("input",function(){e.vol=
Xa.value;ac=e.vol/25});Xa.addEventListener("change",function(){Xa.blur()});ta.addEventListener("input",function(){e.vol1=ta.value;A.volume=e.vol1/100;0==e.vol1?Rb(!0):A.muted&&Rb(!1)});ta.addEventListener("change",function(){ta.blur();A.muted||A.volume==e.vol1/100||alert("iOS forbids changing the volume with javascript (Apple policy)")});Xa.value=e.vol;ta.value=e.vol1;A.volume=ta.value/100;ac=e.vol/25;z(gc);Ja&&(e.pw||e.hrz||e.nolyr?va(y,q):fc(Ja,q),Fa("begin",1));k.ipadr&&(oe(k.ipadr),k.mstr||P.off());
demoDlg&&($("#demoDlg span").html(demoDlg),$("#demoDlg").toggle(!0),$("#demoDlg button").on("mouseup touchend keydown blur",function(a){a.stopPropagation();$("#demoDlg").toggle(!1);$("#demoDlg button").off("mouseup touchend keydown blur")}).focus());ie()}function $c(){media_file&&(A.src=media_file,Ob=1,$("#btrk").toggle(!0),$("#spkr").toggle(!0));Gd=media_file||""}function pe(){if(y){var a='media_file = "'+(Gd||"")+'";\n',c="",b="",d=[];if(maat_duren){for(c="offset_js = "+offset_js.toFixed(2)+";\n";maat_duren.length;)d.push(maat_duren.splice(0,
10).toString());b="maat_duren = ["+d.join(",\n")+"];\n"}d=y.split("\n").map(function(a){return JSON.stringify(a)});d="abc_arr = ["+d.join(",\n")+"];\n";e.staff=x+1;e.line=Math.round(100*$("#rollijn").position().top/$("body").height());e.begin=ja;for(var g=("pre_opt = "+JSON.stringify(e)+";").split(","),f=[],k="";g.length;){for(;80>k.length&&g.length;)k+=g.splice(0,1)+",";f.push(k);k=""}f=f.join("\n").replace(/,$/,"\n");a=a+c+f+b+d;c="data:text/plain;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(a)));
$("#saveDlg pre").text(a);$("#saveDlg").toggle(!0);$("#div3 a").attr("href",c);$("#saveok").focus()}}function qe(a){Mb=!1;kb=0;$("#mtplab").toggle(!1);Va=1;jb=Mb?10:3;wc=1/jb;e.volgmod=$("#volgmod").val();switch(e.volgmod){case "5":$("#mtplab").toggle(!0);kb=e.mtpo;break;case "6":Va=0;break;case "7":Va=0}a&&Sb("delay",!Va);Oa()}function Kb(){V&&(A.playbackRate=pa)}function re(a){a.stopPropagation();a.preventDefault();a.target.style.fill="red";a=Kc[a.target.id];Lc[a]=1;Ba({data:[144,a,110]})}function Hd(a){a.stopPropagation();
a.preventDefault();var c=Kc[a.target.id];c in Lc&&(delete Lc[c],Ba({data:[144,c,0]}),a.target.style.fill=Mc(c))}function Mc(a){return a%12 in Id?"black":60==a?"#9cc":"white"}function se(){Id={1:1,3:1,6:1,8:1,10:1};for(var a=[0,2,4,5,7,9,11,1,3,6,8,10],c=[],b=0;8>b;++b)for(var d=0;12>d;++d)c.push(12*b+a[d]+12);a=$("#toetsen rect");for(d=0;d<a.length;++d)b=$(a[d]),Kc[a[d].id]=c[d],fd[c[d]]=a[d].id,b.on("mousedown touchstart",re),b.on("mouseup touchend",Hd),b.on("mouseleave",Hd),a[d].style.fill=Mc(c[d]);
a=$("#toetsen text");for(d=0;d<a.length;++d)gd[c[d]]=a[d].id}function Jd(){var a=$("#toetsen")[0].scrollWidth-$("body").width();$("#keyb").scrollLeft(a/2)}function Ga(){var a=X&&0==Nc?$("#keyb").height():$("#err").height(),c=$("body").height(),b=$("#info").height();b=Math.round(100*b/c);a=Math.round(100*a/c);$("#notation").css("height",100-b-a+"%")}function Kd(a){var c=$("#toetsen svg"),b=c.width();b=100*b/$("body").width();c.css("width",b+a+"%");Jd()}function te(){for(var a=$("#octaaf"),c=0;8>c;++c){var b=
a.clone();b.find("rect").each(function(a,b){b.id+="-"+c});b.find("text").each(function(a,b){b.id+="-"+c});$("#toetsen").append(b)}se()}function ue(a){if(X&&"zoom"==a.target.id){a.stopPropagation();a.preventDefault();var c="touchstart"==a.type,b=$("#zoom"),d=c?a.originalEvent.touches[0].clientX:a.pageX,e=c?a.originalEvent.touches[0].clientY:a.pageY,f=$("#keyb").height(),g=$("#keyb").scrollLeft();b.css("cursor","row-resize").toggleClass("spel",!0);b.on("mousemove touchmove",function(a){a.stopPropagation();
a.preventDefault();var b=c?a.originalEvent.touches[0].clientX:a.clientX;a=c?a.originalEvent.touches[0].clientY:a.clientY;Math.abs(a-e)>Math.abs(b-d)?(b=f+e-a,a=$("body").height(),b=Math.floor(100*b/a),$("#keyb").css("height",b+"%"),$("#zoom").css("bottom",b+"%"),$("#kblft").css("bottom",b+"%"),$("#kbrgt").css("bottom",b+"%")):$("#keyb").scrollLeft(g+d-b)});b.on("mouseup touchend mouseleave",function(a){a.stopPropagation();a.preventDefault();b.css("cursor","initial").toggleClass("spel",!1);b.off("mousemove touchmove mouseup touchend mouseleave");
Ga()})}}function ve(a){if("info"==a.target.id||"error"==a.target.id||""==a.target.id){a.stopPropagation();a.preventDefault();var c="touchstart"==a.type,b=$("#info"),d=c?a.originalEvent.touches[0].clientY:a.pageY,g=b.height();$("#notation").height();b.css("cursor","row-resize").toggleClass("spel",!0);b.on("mousemove touchmove",function(a){a.stopPropagation();a.preventDefault();var f=$("body").height();a=g+(c?a.originalEvent.touches[0].clientY:a.clientY)-d;b.css("height",Math.floor(100*a/f)+"%");e.hinfo=
a;Ga()});b.on("mouseup touchend mouseleave",function(a){a.stopPropagation();a.preventDefault();b.css("cursor","initial").toggleClass("spel",!1);b.off("mousemove touchmove mouseup touchend mouseleave");Ga();la()})}}function we(a){hd=["&#9837;&#9837;","&#9837;","","&#9839;","&#9839;&#9839;"].map(function(a){return'<tspan dy="-5">x</tspan>'.replace("x",a)});for(var c=document.querySelectorAll("#toetsen text"),b=0;b<c.length;++b)c[b].setAttribute("dx",2==a?-3:0);1==Ra?nc="CDEFGAB".split(""):2==Ra&&(nc=
"Do Re Mi Fa So La Ti".split(" "))}function Cb(a){Ka[a]&&(Ka[a].forEach(function(a){var b=$jscomp.makeIterator(a);a=b.next().value;var c=b.next().value;b=b.next().value;a.style.fill=Mc(b);c.innerHTML=""}),Ka[a]=[])}function Ld(a){function c(){d&&(Kd(b?-1:1),setTimeout(c,200))}var b=0,d=0;a=$(a);a.on("mousedown touchstart",function(a){a.stopPropagation();a.preventDefault();a.currentTarget.children[1].style.fill="red";b="kblft"==a.currentTarget.id;d=1;c()});a.on("mouseup touchend mouseleave",function(a){a.stopPropagation();
a.preventDefault();d&&(a.currentTarget.children[1].style.fill="rgba(0,255,0,0.3)",d=0)})}function xe(a){a.preventDefault();var c="touchstart"==a.type,b=$("#rollijn");b.css("cursor","row-resize").toggleClass("spel",!0);b.on("mousemove touchmove",function(a){$("#notation").offset();a=c?a.originalEvent.touches[0].clientY:a.clientY;$("#rollijn").css("top",a-15+"px");la()});b.on("mouseup touchend mouseleave",function(a){b.off("mousemove touchmove mouseup touchend mouseleave");b.css("cursor","initial").toggleClass("spel",
!1)})}function u(a,c){c||(a+="\n");$("#err").append(a)}function oe(a){R?u("websocket already open"):(R=new WebSocket("ws://"+a+":8091/"),R.onmessage=function(a){a=a.data;"master"==a?($("#mbar").css("background","rgba(255,0,0,0.2)"),Wa=1):Wa||ce(a)},R.onerror=function(a){u("socket error (server inaccessible?)");R=null},R.onopen=function(a){$("#mbar").css("background","rgba(0,255,0,0.2)");k.mstr&&R.send("master");u("connection opened")},R.onclose=function(a){$("#mbar").css("background","");u("connection closed: "+
a.code);R=null;Wa=0})}function vb(){e={};Ja="";for(var a in Tb)e[a]=Tb[a];for(a in Md)e[a]=Md[a];for(a in Tb)Sb(a);for(a in e)Fa(a,0)}function Fa(a,c,b){switch(a){case "tempo":H=e.tempo||(D?D.tmp:60);pa=D?H/D.tmp:1;Kb();break;case "mtpo":kb=e.mtpo;break;case "chkmod":y&&c&&Ma(x);break;case "delay":nd=e[a];break;case "exact":Nb=6!=e.volgmod;if(a=document.getElementById("exact"))a.disabled=!Nb;if(a=document.getElementById("delay"))a.disabled=e.exact&&Nb;break;case "volgmod":qe(b);Fa("exact");break;
case "portsel":me(b);break;case "keys":X=$("#keys").prop("checked");$("#marklbl").toggle(X);$("#keyb").toggle(X);$("#zoom").toggle(X);$("#kblft").toggle(X);$("#kbrgt").toggle(X);$("#rek").toggle(X);X?Kd(0):Jd();Ga();break;case "mark":Ra=e[a];we(Ra);for(var d in Ka)Cb(d);l.length&&Db(l[q]);break;case "kbopa":Nc=e[a]/10;$("#keyb").css("opacity",1-Nc);Ga();break;case "hinfo":a=$("body").height();a=Math.floor(100*e.hinfo/a);$("#info").css("height",a+"%");Ga();break;case "pw":e.pw=parseFloat(e[a]);5>e.pw&&
(delete e.pw,$("#pw").val(""));y&&c&&va(y);break;case "scl":e.scl=parseFloat(e[a]);if(.1>e.scl||2<e.scl)delete e.scl,$("#scl").val("");y&&c&&va(y);break;case "nolyr":y&&c&&va(y,q);break;case "lus":c&&jc();$("#stoplbl").toggle(!!e.lus);break;case "metro":Da&&(Da=!1);break;case "extract":Z=e.extract-1;0==Z&&(Bb="");y&&c&&fc(Ja);break;case "micuse":e.micuse?ye():Oc();break;case "syncon":Ed();case "gain":Nd();break;case "drempel":ze();break;case "minlev":Od();case "bass":Ya=$("#bass").prop("checked")?
1024:512;Ha&&Pd();break;case "staff":x=e.staff-1;y&&c&&Ma(x);break;case "line":$("#rollijn").css("top",e.line+"%");la();break;case "begin":q=ja=e.begin;y&&c&&Q(0);break;case "lncur":y&&e.lncur&&ba(l[q].t+.1,0,1);e.lncur||I.setAttribute("fill-opacity",0);break;case "nocur":ia.forEach(function(a){return a.setAttribute("fill-opacity",e.nocur?0:e.mat)});e.hide2cur&&I.setAttribute("fill-opacity",e.nocur?0:e.lncur?e.mat:0);break;case "metmrk":for(var g in da)da[g].setAttribute("fill-opacity",e.metmrk?e.mat:
0);break;case "drpuse":Ae();break;case "nobar":$("#info").toggle(!1);$("#err").toggle(!1);$("#notation").css("height","100%");la();break;case "nomenu":$("#menu").toggle(!1);break;case "hrz":c&&(e.hrz=e.hrz?50:0);$("#pwlbl").toggle(0==e.hrz);$("#scllbl").toggle(0<e.hrz);y&&c&&va(y);break;case "tmng":case "tmng2":case "scal":$("#sgd").parent().toggle(!!e.scal);$("#se2").parent().toggle(!(!e.tmng||!e.scal));$("#se3").parent().toggle(!(!e.tmng2||!e.scal));$("#stot").parent().toggle(!!e.scal);Aa();break;
case "ftyp":e.ftyp?sd():jd()}}function Pc(a){a=$(this).attr("type")||this.type;var c=$(this).attr("id");"checkbox"==a&&(e[c]=$(this).prop("checked"));if("number"==a||"select-one"==a||"range"==a)e[c]=$(this).val();Fa(c,1,1)}function Ae(){function a(a){$("#drpuse").prop("checked",!a);$("#drpuse").attr("disabled",a);$("#drplbl").css("color",a?"#aaa":"#000")}function c(){var a=$("#drpuse").prop("checked");$(".dropbox-dropin-btn").css("display",a?"inline-block":"none");$("#fknp").css("display",a?"none":
"inline-block")}if("undefined"==typeof Dropbox){a(!0);var b;$.ajax({url:"https://www.dropbox.com/static/api/2/dropins.js",dataType:"script",cache:!0}).done(function(){a(!1);Dropbox.init({appKey:"ckknarypgq10318"});b=Dropbox.createChooseButton({success:C,extensions:[".xml",".abc",".js"],cancel:function(){},linkType:"preview",multiselect:!1});$("#flbl").append(b);c()})}else c()}function Qd(a){var c,b,d=0,e=-1,f=Math.floor(a.length/2),g=0,h=Infinity;Ia=Array(f);var k=f/2;for(b=3;b<f;b++){var l=0;var n=
Math.floor(k-b/2);a[n]>g&&(g=a[n]);for(c=n;c<n+f;c++){var p=a[c]-a[c+b];l+=p*p}d+=l;l*=(b-2)/d;Ia[b]=l;if(l<h)h=l,e=b;else if(.1>h)break}b=Ia[e+1];c=Ia[e];a=Ia[e-1];return{period:e+((a-b)/(b-2*c+a)/2||0),diff:h,max:g}}function Rd(a){Ha.getFloatTimeDomainData(Za);var c=Qd(Za),b=c.period/a;b=1.06>b&&.94<b;if(c.diff<qb&&0<c.diff&&c.max>Qc||.65>c.diff&&b){var d=E.sampleRate/c.period;b||ua||(ua=Math.round(69+12*Math.log(d/440)/Math.log(2)),d=[144,ua,110],Ba({data:d}),console.log("micNote on:",ua,c.max.toFixed(2),
c.diff.toFixed(2),b));a=c.period}else ua&&(d=[144,ua,0],Ba({data:d}),console.log("micNote off",ua,c.max.toFixed(2),c.diff.toFixed(2),b),ua=0),a=1;Ub=setTimeout(function(){Rd(a)},0)}function Od(){var a=parseInt(e.minlev),c=2.5*(40+a),b=$("#mxlvl").width();$("#levmrk").css("width",b*c/100+"px");Qc=Math.pow(10,a/20);$("#mval").html(a)}function ze(){var a=parseFloat(e.drempel);qb=a/10;$("#dval").html(a);Sd()}function Nd(){var a=parseFloat(e.gain);rb&&(rb.gain.value=Math.pow(10,(a+1)/2-3));$("#gval").html(a)}
function Pd(){Ha.fftSize=4*Ya;Za=new Float32Array(Ha.frequencyBinCount)}function Oc(){sb&&(sb.getAudioTracks().forEach(function(a){a.stop()}),Rc.disconnect(),sb=null,cancelAnimationFrame(Vb),clearTimeout(Ub));$("#micuse").prop("checked",!1);$("#micon").prop("checked",!1);$("#micKnop").css("background","")}function ye(){function a(a){sb=a;Rc=E.createMediaStreamSource(a);rb=E.createGain();Ha=E.createAnalyser();Pd();Rc.connect(rb);rb.connect(Ha);Nd();Td();$("#micKnop").css("background","orange");$("#micon").prop("checked",
!0);$("#micuse").prop("checked",!0);Sb("delay",!1)}function c(a){alert("Can not access the microphone!\n"+a.name+": "+a.message);Oc()}if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia({audio:!0}).then(a).catch(c);else{navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;try{navigator.getUserMedia({audio:!0},a,c)}catch(b){alert("getUserMedia() not supported by your browser -> no microphone\n"+b.name+
": "+b.message),Oc()}}}function Be(){var a=document.getElementById("micon");e.micuse=a.checked;Fa("micuse",0)}function Td(){sb&&(cancelAnimationFrame(Vb),clearTimeout(Ub),Ud?Vb=requestAnimationFrame(function(){Vd(1)}):Ub=setTimeout(function(){Rd(1)},0))}function Wd(a){$("#tuner").toggle(a);a&&($("#micuse").focus(),Od());aa&&ya();Ud=a;Td()}function Vd(a){var c=performance.now();Ha.getFloatTimeDomainData(Za);var b=Qd(Za),d=b.period/a;a=1.06>d&&.94<d;d=69+12*Math.log(E.sampleRate/b.period/440)/Math.log(2);
c=(performance.now()-c).toFixed(2);if(b.diff<qb&&0<b.diff&&b.max>Qc||.65>b.diff&&a){a=b.period;a=Math.round(d);var e=Ce[a%12]+Math.floor(a/12);Wb.innerHTML=e;d=Math.round(100*(d-a));Sc.push(d);$a+=(d-Sc.shift())/30;tb.innerHTML=Math.round($a);0<=$a?(tb.style.width="50%",Xb.style.width=$a+"%"):(tb.style.width=50+$a+"%",Xb.style.width=-$a+"%");ab.style.background="#cc0";Wb.style.background="#cc0"}else e="---",a=1,ab.style.background="orange",Wb.style.background="none";Sd();v.strokeStyle="green";v.beginPath();
v.moveTo(0,256-128*Ia[0]);d=Ya/512;for(a=1;a<Ya;a+=d)v.lineTo(a/d,256-128*Ia[a]);v.stroke();v.beginPath();v.moveTo(b.period/d,256);v.strokeStyle="red";v.lineTo(b.period/d,245);v.stroke();b=20*Math.log10(b.max);Tc=2.5*(40+b);Tc>Yb?(Yb=Tc,ab.innerHTML=b.toFixed(0),Zb=Za.slice()):--Yb;ab.style.width=Yb+"%";c>Uc&&(Uc=c);20==Xd++&&($b.style.width=Math.min(10*c,100)+"%",$b.innerHTML=c,Xd=Uc=0);if(Zb){v.strokeStyle="grey";v.beginPath();v.moveTo(0,128-32*Zb[0]);d=Ya/512;for(a=1;a<Ya;a+=d)v.lineTo(a/d,128-
32*Zb[a]);v.stroke()}Vb=requestAnimationFrame(function(){Vd(1)})}function Sd(){v.clearRect(0,0,512,256);v.beginPath();v.moveTo(0,256-128*qb);v.strokeStyle="blue";v.setLineDash([5,3]);v.lineTo(512,256-128*qb);v.stroke();v.setLineDash([])}function De(){var a=document.body,c=a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen,b=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen;c&&b&&($("#fscr").prop("checked")?c.call(a):b.call(document))}function Ee(){var a;
navigator.bluetooth.requestDevice({filters:[{services:["03b80e5a-ede8-4b33-a751-6ce34ec4c700"]}]}).then(function(a){var b=a.gatt.connect();u("BLE Connected: "+a.name+", "+a.id.substring(0,5)+"...");return b}).then(function(a){return a.getPrimaryService("03b80e5a-ede8-4b33-a751-6ce34ec4c700")}).then(function(a){return a.getCharacteristic("7772e5db-3868-4112-a1a9-f2669d106bf3")}).then(function(c){a=c;return a.startNotifications()}).then(function(c){u("Midi notifications started");a.addEventListener("characteristicvaluechanged",
Fe)}).catch(function(a){u(a.toString())})}function Fe(a){var c=a.target.value.getUint8(2),b=a.target.value.getUint8(3);a=a.target.value.getUint8(4);Ba({data:[c,b,a]})}function N(a,c,b){b=void 0===b?1:b;c?($(a).toggle(!0),wb+=1,sa.disabled=!0):($(a).toggle(!1),--wb,0==wb&&b&&(sa.disabled=!1))}var xa={},l=[],q=0,O=-1,ic,eb,Hb,Bd=[],ra={},Ja,Y=0,mb=0,tc,uc,Ab=0,aa,T,ja=0,Ca,nd=1,X=0,F,hb,nb,od,yc,ld,pd,md,Ua,Vc,sa,lb,ea={},Gc={},ia=[],da={},Sa={};O=[];var Eb,Yd=$(document.createElementNS("http://www.w3.org/2000/svg",
"rect"));Yd.attr({id:"loper",fill:"#0dd","fill-opacity":.5,width:"0"});var I=Yd.get(0),za,Na,U=null,L,ma,E,Wc=[],bc=[],cc=0,ub={},dc,Yc={},gc={};xa={};var hc={},M=[],na,zb=[],La=[],cb=[];var ha=[];var qc,Va=0,Ib,Jb,K={},Bc,Cc,Dc,Ec,Fc,yd,Ta,td,mc,Hc,H,D,sc,kd,rc,Dd,W=0,S,qa=0,Fb,ca={},gb,Pb={},Mb=0,kb=0,ee,jb,wc,Nc=0,Kc={},fd={},Lc={},P=[],ka=[],Ra=0,Id,gd={},Z=0,Bb,ad=0,x=0,vc,R,Wa=0,lc={},pc,ob=0,y,Qa,e,Ud=0,Qc,ua=0,sb,Rc,Ha,Za,rb,Ia,$b,Uc=0,Xd=0,qb,v;var Ya=512;for(var ab,Tc=0,Yb=-100,Wb,Xb,tb,
$a=0,Zb,Ub,Vb,Ce="C ;C#;D ;D#;E ;F ;F#;G ;G#;A ;A#;B ".split(";"),nc,hd,Sc=[],Pa=0;30>Pa;Pa++)Sc.push(0);var k={},Tb={delay:1,eenvoor:0,metro:0,keys:0,mark:0,mute:0,volgmod:6,chkmod:2,extract:1,portsel:"synth",tempo:"",kbopa:0,pw:0,scl:1,gain:5,drempel:1,minlev:-18,bass:0,mtpo:20,hrz:0,vol:50,vol1:100,nocur:0,rstmute:0,exact:0,nolyr:0,lus:0,lusstop:1,lncur:0,tmng:0,tmng2:0,metmrk:0,ftyp:0,nocnt:0,scal:0,echo:1},Md={staff:1,line:30,begin:0,btime:0,etime:0,shrnk:0,lat:0,pnlerr:.5,pnltim:.5,oneclr:0,
late1:150,late2:1E3,pnlkrt:.5,kort:30,minkort:200,atagTijd:-1,btagTijd:-1,syncon:!0,hide2cur:0,stopat:-1,hinfo:36,mat:.5,tmo:200,kleur:"#f9f #3cf #c99 #f66 #fc0 #cc0 #ccc".split(" "),ntGoed:"#080",ntFout:"#f00",ntWacht:"#0dd",ntKleur:"#f00 #ff0 #f00 #0bb #f00 #aaa #f00".split(" ")},ac=2,bb,wb=0,Fd,A,Xa,ta,Gd,fb,Jc,pa,V,Ob,Ka={},Nb=1,Ea,Ic,Qb=0,Da;$(document).ready(function(){A=document.getElementById("aud");Xa=document.getElementById("vol")||{addEventListener:function(){}};ta=document.getElementById("vol1")||
{addEventListener:function(){}};Jc=document.getElementById("syncon")||{addEventListener:function(){},checked:!0};Ta=document.getElementById("perf");F=document.getElementById("notation");hb=CSS.supports("scroll-behavior","smooth");sa=document.getElementById("start");$("#verlab").html("Version: "+follow_VERSION);$("body").keydown(ge).click(function(){aa&&ya()});$(".mknop").keydown(he);$("#perfbtn").click(function(a){a.stopPropagation();Ta.style.display="none"});Ta.addEventListener("click",function(a){a.stopPropagation()});
$("#kwart").click(function(){e.metro=1;$("#metro").prop("checked",1);J(-1)});$("#kwart").append($("#mtrsvg"));$("#tempo").change(function(){H=D.met/384*mc.value;e.tempo=H;pa=D?H/D.tmp:1;Kb()});$("#micon").change(Be);$("#start").click(function(){J(-2)});$("#spkr").append($("#spkron"));$("#spkr").append($("#spkrof").toggle(!1));$("#spkr").toggle(!1).click(function(a){a.stopPropagation();Rb(!A.muted);Jc.checked=!A.muted;Ed()});var a=document.getElementById("spkron").cloneNode(!0),c=document.getElementById("spkrof").cloneNode(!0);
a.id="spkron2";c.id="spkrof2";$("#spkr2").append($(a));$("#spkr2").append($(c).toggle(!1));$("#spkr2").click(function(a){a.stopPropagation();Rb(!A.muted)});$("#btrk").toggle(!1);$(".hfd").toggle(!1);aa=0;$(".hfd").click(function(a){a.stopPropagation()});$("#mbar").click(function(a){a.stopPropagation();pb(1)});$("#mbar2").click(function(a){a.stopPropagation();pb(2)});$("#mbar3").click(function(a){a.stopPropagation();pb(3)});$("#mbar4").click(function(a){a.stopPropagation();pb(4)});$(".hfd select").change(Pc);
$(".hfd input").change(Pc);$("#tuner input").change(Pc);$("#zoom").on("mousedown touchstart",ue);$("#rollijn").on("mousedown touchstart",xe);$("#info").on("mousedown touchstart",ve);$(window).resize(function(){bd();cd();Ga();la()});$("#fknp").change(fa);$("#testport").on("mousedown",Ad);$("#stats").click(function(){de(0)});$("#save").click(pe);$("#saveok").click(function(){$("#saveDlg").toggle()});$("#micKnop").click(function(){Wd(!0)});$("#ble").click(Ee);$("#micOk").click(function(){Wd(!1)});ab=
document.querySelector("#mxlvl > div");ab.innerHTML="0";Xb=document.querySelector("#cents > div");Xb.innerHTML="&nbsp;";tb=document.querySelector("#cents > span");tb.style.width="50%";Wb=document.getElementById("noot");$b=document.querySelector("#anatijd > div");$b.innerHTML="0";v=document.getElementById("graaf").getContext("2d");Ld("#kblft");Ld("#kbrgt");td=$("#error")[0];mc=$("#tempo")[0];Hc=$("#path9868")[0];za=document.getElementById("atag");za.style.display="none";Na=document.getElementById("btag");
Na.style.display="none";Oa(1);a=window.AudioContext||window.webkitAudioContext;(E=void 0!=a?new a:null)||alert("Your browser does not support the Web Audio API");Xc("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yE2S0tyZVivRopSXQGhTEhUhrKy7MrjXjaFIEjX//ppWN6hxW8rShnYym/ytlBCipejyoBI5S6sunmXcqS0CsGFKxqM5dAJ1IWRStJ30SS6VsMi1wsgexC7hVLmpVeu9iV0q2osru+oamEzp//PEZHUOIQ0hHz0iLhvZ7jl2YMsmXYCpYRlkySmBaQj0+Hk4LS3zlx2Werj37ZkxWrUwlPNdbe6sPUhxMpeTKURFUf63LMdjAKKm/apXob0KyG9TfmeVlDrWU+e//LNf//HNNCqQKKmRjTIsSNCyB7DAVImRZIxpoc00KpAoqZGVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUNrmJJJLQwNA8o//PEZAoFmAb2fwwjARIh1dGeMMSeWFU1inUzqFtbUf+sU/xfrb/9Yp/+tv/7P/xUW/+sUb/8VFgCV5cdsFABhJlxbOUVcJ48oIFUMmWUGEFkZNZ2UjWWzI+hgYME4g+wHY5DlMqIrfgjjOVP//ymVUXMFDKLB40FRRtQsK///8UVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",
function(a){Dd=a;console.log("E3 decoded")});jb=Mb?10:3;wc=1/jb;$("#err").text("");vb();"requestMIDIAccess"in navigator?navigator.requestMIDIAccess().then(ke,le):($("#notation").append('<br>Web MIDI API is not supported in this browser: try Chrome or Opera (on iOS you can try the <a href="https://apps.apple.com/us/app/web-midi-browser/id953846217">Web Midi Browser</a>)'),u('Web MIDI API is not supported in this browser: try Chrome or Opera (on iOS you can try the <a href="https://apps.apple.com/us/app/web-midi-browser/id953846217">Web Midi Browser</a>)'));
$("#ble").prop("disabled",!("bluetooth"in navigator));ne()||ec();te();$("#kwart").attr("title","Click here to start and keep the metronome on.\nFlashes and clicks on each beat. First beat extra loud");$("#tempo").attr("title","Tempo of the metronome in beats per minute (bpm)");$("#start").attr("title","Start/stop playing.");$("#micon").attr("title","Switches the microphone on/off.");$("#vol").attr("title","The volume of the internal synthesizer");$("#error").attr("title","Shows how correct you have played.\nReaches 100% at the end of a correctly played score.");
$("#l0").attr("title","Playback: plays the score and checks notes if you play them.\nConstant tempo: plays the score, but waits until you play the correct notes.\nAdaptive: Adapts the tempo to your playing. It can speed up or slow down (until the given minimum tempo).");$("#l1").attr("title","Select which staves you want to play (and checked while playing).");$("#flbl").attr("title","Load a score file from your local file system. (Or an audio file or a preload file.)");$("#drplbl").attr("title","Load the score file from your Dropbox.");
$("#l2").attr("title","Use internal synthesizer or MIDI interface or no sound at all.");$("#l3").attr("title","Also display a line cursor that\nmoves continuously. (with score time)");$("#l4").attr("title","Hide the normal note cursors.");$("#l5").attr("title","Restrict the play area with two loop marks.\nTo move a mark: first select then click new position");$("#stoplbl").attr("title","When end of loop is reached, stop playing\nand jump to loop begin.");$("#l6").attr("title","Display the score in one long line.\nThe line scrolls horizontally when playing.");
$("#pwlbl").attr("title","Sets the score page width in centimeters.\nZero resets to default.\nUseful to enlarge the score.");$("#scllbl").attr("title","Scale factor for side scrolling score.");$("#l7").attr("title","Keep the metronome ticking after the count-in.");$("#l8").attr("title","When the score has lyrics, hide it");$("#l9").attr("title","Do not synthesize the staff(s) you are playing yourself");$("#lA").attr("title","Only synthesize the staff(s) you are\nplaying yourself (and mute all others)");
$("#lB").attr("title","Show the on-screen keyboard.");$("#marklbl").attr("title","Show names of the notes highlighted by the cursors");$("#lC").attr("title","Only show the selected staff (part) from a concert score");$("#lD").attr("title","Connect to a MIDI device via Bluetooth LE.");$("#lE").attr("title","Show the advanced menu");$("#lF").attr("title","Show a graph of the performance\nThe timing errors of all played notes and a runnung average of 10 notes");$("#lG").attr("title","Check if notes are held down for the right duration.\nMark notes (orange) played too short (or long)");
$("#lH").attr("title","Check if notes are played at the right time.\nMark notes (gold) played too late.");$("#lI").attr("title","Show permanent error marks and timing marks");$("#lJ").attr("title","Start without count-in");$("#").attr("title","");$("#adv, .ext").toggle($("#advanced").prop("checked"));$("#advanced").on("change",function(){return $("#adv, .ext").toggle($("#advanced").prop("checked"))});$("#fscr").on("change",De);$("body").on("fullscreenchange webkitfullscreenchange mozfullscreenchange",
function(){var a=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement;$("#fscr").prop("checked",null!=a)});F.addEventListener("touchstart",function(a){Vc=a.touches[0].clientX});F.addEventListener("touchmove",function(a){"stop"==sa.value&&J(q);e.hrz&&(a.stopPropagation(),a.preventDefault(),F.scrollLeft-=a.touches[0].clientX-Vc,Vc=a.touches[0].clientX)})})})();
