// abc2svg - ABC to SVG translator
// @source: https://chiselapp.com/user/moinejf/repository/abc2svg
// Copyright (C) 2014-2024 Jean-Francois Moine - LGPL3+
// commit [0cb477e642]
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(q){var z=0;return function(){return z<q.length?{done:!1,value:q[z++]}:{done:!0}}};$jscomp.arrayIterator=function(q){return{next:$jscomp.arrayIteratorImpl(q)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(q,z,B){q!=Array.prototype&&q!=Object.prototype&&(q[z]=B.value)};$jscomp.getGlobal=function(q){q=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,q];for(var z=0;z<q.length;++z){var B=q[z];if(B&&B.Math==Math)return B}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(q,z){this.$jscomp$symbol$id_=q;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:z})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function q(B){if(this instanceof q)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(B||"")+"_"+z++,B)}var z=0;return q}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var q=$jscomp.global.Symbol.iterator;q||(q=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[q]&&$jscomp.defineProperty(Array.prototype,q,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var q=$jscomp.global.Symbol.asyncIterator;q||(q=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(q){$jscomp.initSymbolIterator();q={next:q};q[$jscomp.global.Symbol.iterator]=function(){return this};return q};
$jscomp.iteratorFromArray=function(q,z){$jscomp.initSymbolIterator();q instanceof String&&(q+="");var B=0,x={next:function(){if(B<q.length){var H=B++;return{value:z(H,q[H]),done:!1}}x.next=function(){return{done:!0,value:void 0}};return x.next()}};x[Symbol.iterator]=function(){return x};return x};
$jscomp.polyfill=function(q,z,B,x){if(z){B=$jscomp.global;q=q.split(".");for(x=0;x<q.length-1;x++){var H=q[x];H in B||(B[H]={});B=B[H]}q=q[q.length-1];x=B[q];z=z(x);z!=x&&null!=z&&$jscomp.defineProperty(B,q,{configurable:!0,writable:!0,value:z})}};$jscomp.polyfill("Array.prototype.keys",function(q){return q?q:function(){return $jscomp.iteratorFromArray(this,function(q){return q})}},"es6","es3");if("undefined"==typeof abc2svg)var abc2svg={};
abc2svg.C={BLEN:1536,BAR:0,CLEF:1,CUSTOS:2,SM:3,GRACE:4,KEY:5,METER:6,MREST:7,NOTE:8,PART:9,REST:10,SPACE:11,STAVES:12,STBRK:13,TEMPO:14,BLOCK:16,REMARK:17,FULL:0,EMPTY:1,OVAL:2,OVALBARS:3,SQUARE:4,SL_ABOVE:1,SL_BELOW:2,SL_AUTO:3,SL_HIDDEN:4,SL_DOTTED:8,SL_ALI_MSK:112,SL_ALIGN:16,SL_CENTER:32,SL_CLOSE:64};abc2svg.sym_name="bar clef custos smark grace key meter Zrest note part rest yspace staves Break tempo  block remark".split(" ");
abc2svg.keys=[new Int8Array([-1,-1,-1,-1,-1,-1,-1]),new Int8Array([-1,-1,-1,0,-1,-1,-1]),new Int8Array([0,-1,-1,0,-1,-1,-1]),new Int8Array([0,-1,-1,0,0,-1,-1]),new Int8Array([0,0,-1,0,0,-1,-1]),new Int8Array([0,0,-1,0,0,0,-1]),new Int8Array([0,0,0,0,0,0,-1]),new Int8Array([0,0,0,0,0,0,0]),new Int8Array([0,0,0,1,0,0,0]),new Int8Array([1,0,0,1,0,0,0]),new Int8Array([1,0,0,1,1,0,0]),new Int8Array([1,1,0,1,1,0,0]),new Int8Array([1,1,0,1,1,1,0]),new Int8Array([1,1,1,1,1,1,0]),new Int8Array([1,1,1,1,1,
1,1])];abc2svg.p_b40=new Int8Array([2,8,14,19,25,31,37]);abc2svg.b40_p=new Int8Array([0,0,0,0,0,0,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6]);abc2svg.b40_a=new Int8Array([-2,-1,0,1,2,-3,-2,-1,0,1,2,-3,-2,-1,0,1,2,-2,-1,0,1,2,-3,-2,-1,0,1,2,-3,-2,-1,0,1,2,-3,-2,-1,0,1,2]);abc2svg.b40_m=new Int8Array([-2,-1,0,1,2,0,0,1,2,3,4,0,2,3,4,5,6,3,4,5,6,7,0,5,6,7,8,9,0,7,8,9,10,11,0,9,10,11,12,13]);
abc2svg.b40l5=new Int8Array([-14,-7,0,7,14,0,-12,-5,2,9,16,0,-10,-3,4,11,18,-15,-8,-1,6,13,0,-13,-6,1,8,15,0,-11,-4,3,10,17,0,-9,-2,5,12,19]);abc2svg.isb40=new Int8Array([0,1,6,7,12,17,18,23,24,29,30,35]);abc2svg.pab40=function(q,z){q+=19;q=40*(q/7|0)+abc2svg.p_b40[q%7];z&&3!=z&&(q+=z);return q};abc2svg.b40p=function(q){return 7*(q/40|0)+abc2svg.b40_p[q%40]-19};abc2svg.b40a=function(q){return abc2svg.b40_a[q%40]};abc2svg.b40m=function(q){return 12*(q/40|0)+abc2svg.b40_m[q%40]};
abc2svg.ch_alias={maj:"",min:"m","-":"m","\u00b0":"dim","+":"aug","+5":"aug",maj7:"M7","\u03947":"M7","\u0394":"M7",min7:"m7","-7":"m7","\u00f87":"m7b5","\u00b07":"dim7","min+7":"m+7",aug7:"+7","7+5":"+7","7#5":"+7",sus:"sus4","7sus":"7sus4"};abc2svg.font_tb=[];abc2svg.font_st={};abc2svg.ft_w={thin:100,extralight:200,light:300,regular:400,medium:500,semi:600,demi:600,semibold:600,demibold:600,bold:700,extrabold:800,ultrabold:800,black:900,heavy:900};abc2svg.ft_re=/-?Thin|-?Extra Light|-?Light|-?Regular|-?Medium|-?[DS]emi|-?[DS]emi[ -]?Bold|-?Bold|-?Extra[ -]?Bold|-?Ultra[ -]?Bold|-?Black|-?Heavy\//i;
abc2svg.rat=function(q,z){for(var B,x,H=0,y=0,Oa=1,aa=1;0!=z;)x=z,B=q/z|0,z=q%z,q=x,x=H+B*Oa,H=Oa,Oa=x,x=aa+B*y,aa=y,y=x;return[Oa,y]};abc2svg.pitcmp=function(q,z){return q.pit-z.pit};
abc2svg.Abc=function(q){function z(a,c){if(!a)return a;var d=new a.constructor,e;for(e in a)a.hasOwnProperty(e)&&(d[e]=c&&"object"==typeof a[e]?z(a[e],c-1):a[e]);return d}function B(a,c,d,e){var f,g;if(q.errbld){switch(a){case 0:a="warn";break;case 1:a="error";break;default:a="fatal"}q.errbld(a,c,d,e)}else{if(void 0!=e&&0<=e){for(f=g=0;;){var h=v.file.indexOf("\n",f);if(0>h||h>e)break;g++;f=h+1}f=e-f}e="";d&&(e=d,g&&(e+=":"+(g+1)+":"+(f+1)),e+=" ");switch(a){case 0:e+="Warning: ";break;case 1:e+=
"Error: ";break;default:e+="Internal bug: "}q.errmsg(e+c,g,f)}}function x(a,c,d,e,f,g,h){var n;if(!(a<t.quiet)){if(c){if(c.err)return;c.err=!0}q.textrans&&(n=q.textrans[d])&&(d=n);3<arguments.length&&(d=d.replace(/\$./g,function(a){switch(a){case "$1":return e;case "$2":return f;case "$3":return g;default:return h}}));c&&c.fname?B(a,d,c.fname,c.istart):B(a,d)}}function H(){this.index=0;H.prototype.char=function(){return this.buffer[this.index]};H.prototype.next_char=function(){return this.buffer[++this.index]};
H.prototype.get_int=function(){for(var a=0,c=this.buffer[this.index];"0"<=c&&"9">=c;)a=10*a+Number(c),c=this.next_char();return a}}function y(a,c,d,e,f,g){x(a,{fname:v.fname,istart:v.istart+v.line.index},c,d,e,f,g)}function Oa(a){eval('"use strict";\n'+a)}function aa(a,c,d,e){a=w[a];var f=d/2|0;d=(d+e)/2|0;0>f&&(f=0);d>=Ca&&(d=Ca-1,f>d&&(f=d));if(c)for(c=a.top[f++];f<=d;)c<a.top[f]&&(c=a.top[f]),f++;else for(c=a.bot[f++];f<=d;)c>a.bot[f]&&(c=a.bot[f]),f++;return c}function ba(a,c,d,e,f){a=w[a];var g=
d/2|0;d=(d+e)/2|0;0>g&&(g=0);d>=Ca&&(d=Ca-1,g>d&&(g=d));if(c)for(;g<=d;)a.top[g]<f&&(a.top[g]=f),g++;else for(;g<=d;)a.bot[g]>f&&(a.bot[g]=f),g++}function Ee(a){function c(){for(var c,d=a.ix;0<--d&&(c=O[d],c&&c.s==g););for(;;){d++;c=O[d];if(!c||c.s!=g)break;if(c!=a&&!(f^c.up)&&6==c.dd.func){m-=c.dd.wl;break}}}if(!a.ldst){var d=a.dd,e=a.prev,f=a.start.up,g=a.s,h=g.st,n=a.start.s,k=n.x;e&&(k=e.s.x+a.dd.wl+2,e.val-=e.dd.wr,8>e.val&&(e.val=8));a.st=h;a.up=f;(function(){for(var c,d=a.start,e=d.s,g=d.ix;0<=
--g&&(c=O[g],c&&c.s==e););for(;;){g++;c=O[g];if(!c||c.s!=e)break;if(c!=d&&!(f^c.up||"trill"!=c.dd.name&&6!=c.dd.func)){k+=c.dd.wr+2;break}}})();if(a.defl.noen){var m=a.x-k;20>m&&(k=a.x-20-3,m=20)}else m=g.x-k-4,c(a),20>m&&(m=20);var p=aa(h,f,k-d.wl,m);if(f){var r=w[n.st].topbar+2;p<r&&(p=r)}else r=w[n.st].botbar-2,p>r&&(p=r),p-=d.h;if(e)if(f)p<e.y&&(p=e.y);else if(p>=e.y)p=e.y;else{do e.y=p,e=e.prev;while(e)}a.lden=!1;a.has_val=!0;a.val=m;a.x=k;a.y=p;p=f?p+d.h:p-d.hd;ba(h,f,k,m,p);f?n.ymx=g.ymx=p:
n.ymn=g.ymn=p}}function xb(a){if(!a.ldst)if(a.start)Ee(a);else{var c=a.up,d=a.s,e=a.dd,f=a.x,g=e.wl+e.wr;switch(e.glyph){case "lphr":case "mphr":case "sphr":case "short":case "tick":d.type==m.BAR&&(d.invis=1);case "brth":case "caes":var h=w[d.st].topbar+2+e.hd;if(!d.invis){"brth"==e.glyph&&h<d.ymx&&(h=d.ymx);for(d=d.ts_next;d&&!d.seqst;d=d.ts_next);f+=.45*((d?d.x:ia)-f)}a.x=f;a.y=h;return}d.nhd&&(f+=d.notes[0<=d.stem?0:d.nhd].shhd);switch(e.ty){case "@":case "<":case ">":h=a.y}if(void 0==h)if(c)h=
aa(d.st,!0,f-e.wl,g)+e.hd,a.y>h&&(h=a.y),d.ymx=h+e.h;else{h=aa(d.st,!1,f-e.wl,g)-e.h;a.y<h&&(h=a.y);if("fermata"==e.name||"accent"==e.glyph||"roll"==e.glyph)a.inv=1;d.ymn=h-e.hd}5<e.wr&&f>ia-e.wr&&(a.x=f=ia-e.wr);c?ba(d.st,1,f-e.wl,g,h+e.h):ba(d.st,0,f-e.wl,g,h-e.hd);a.y=h}}function yc(a,c){c||(c=a);var d;var e=Lb[c];!e&&/\d[()]$/.test(c)&&(e=Lb[c.replace(/\d/,"")]);if(e)if(d=e.match(/(\d+)\s+(.+?)\s+([0-9.,]+)\s+([0-9.]+)\s+([0-9.]+)/)){var f=Number(d[1]),g=d[3],h=parseFloat(d[4]),n=parseFloat(d[5]);
if(isNaN(f))x(1,null,"%%deco: bad C function value '$1'",d[1]);else if(10<f&&(32>f||45<f))x(1,null,"%%deco: bad C function index '$1'",f);else{if(0<g.indexOf(",")){g=g.split(",");var k=g[1];g=g[0]}else k=0;if(50<g||80<h||80<n)x(1,null,"%%deco: abnormal h/wl/wr value '$1'",e);else{c=Pa[a];c||(c={name:a},Pa[a]=c);c.func=0==a.indexOf("head-")?9:f;c.glyph=d[2];c.h=Number(g);c.hd=Number(k);c.wl=h;c.wr=n;if(d=e.replace(d[0],"").trim()){'"'==d[0]&&(d=d.slice(1,-1));if("@"==d[0]){e=d.match(/^@([0-9.-]+),([0-9.-]+);?/);
if(!e){x(1,null,"%%deco: bad position '$1'",d);return}c.dx=+e[1];c.dy=+e[2];d=d.replace(e[0],"")}c.str=d}6==c.func&&void 0==c.str&&(c.str=a);e=a.slice(-1);if("("==e||")"==e&&0>a.indexOf("("))if(c.str=null,a=a.slice(0,-1)+("("==e?")":"("),a=Pa[a])"("==e?(c.dd_en=a,a.dd_st=c):(c.dd_st=a,a.dd_en=c);return c}}}else x(1,null,"Invalid decoration '$1'",a);else t.decoerr&&x(1,null,"Unknown decoration '$1'",a)}function fd(a,c,d){var e=Mb[a],f=a.slice(0,-1)+("("==a.slice(-1)?")":"(");e?x(1,c,"Conflict on !$1!",
a):(d.s=c,(e=Mb[f])?(")"==a.slice(-1)&&(e=d,d=Mb[f]),Mb[f]=null,d.midi!=e.midi||d.s.time+d.s.dur!=e.s.time?x(1,c,"Bad tie"):(d.tie_ty=m.SL_AUTO,d.tie_e=e,e.tie_s=d,d.s.ti1=e.s.ti2=!0)):Mb[a]=d)}function gd(a){var c,d=Pa[a];if(d)return d;if(0<="<>^_@".indexOf(a[0])&&!/^([>^]|[<>]\d?[()])$/.test(a)){var e=a[0];"@"==e&&(e=(c=a.match(/@([-\d]+),([-\d]+)/))?c[0]:"");d=yc(a,a.replace(e,""))}else d=yc(a);if(d)return e&&("@"==e[0]&&(d.x=Number(c[1]),d.y=Number(c[2]),e="@"),d.ty=e),d}function yb(a,c){function d(){var d,
e=c;if(a.type!=m.NOTE)return 1;for(;e&&e.type!=m.NOTE;)e=e.prev;if(!e)return 1;for(d=0;d<e.a_dd.length;d++)if(e.a_dd[d].name==g.name)return a.fg||(a.fg=[]),a.fg.push({ty:1,s:e,nm:g.name}),e.fg||(e.fg=[]),e.fg.push({ty:0,s:a,nm:g.name}),0;return 1}for(var e,f,g,h,n,k;;){h=ja.shift();if(!h)break;if(g=gd(h)){switch(g.func){case 0:if(a.type==m.BAR&&"dot"==h){a.bar_dotted=!0;continue}case 1:case 2:if(!a.notes){x(1,a,I.must_note_rest,h);continue}break;case 3:if(k&&"fng"==g.glyph)for(e=0;5>=e;e++)Lb[e.toString()]=
"5 fng 5,5 3 3 "+e,Pa[e.toString()]&&(Pa[e.toString()].func=5);break;case 4:case 5:if(e=h.match(/1?[85]([vm])([ab])([()])/))f="v"==e[1]?1:2,"b"==e[2]&&(f=-f),a.ottava||(a.ottava=[]),a.ottava["("==e[3]?0:1]=f,fa.ottava=1;break;case 8:if(a.type!=m.NOTE){x(1,a,I.must_note,h);continue}e=a.notes[a.nhd];e.a_dd||(e.a_dd=[]);e.a_dd.push(g);continue;case 9:if(!a.notes){x(1,a,I.must_note_rest,h);continue}for(f=0;f<=a.nhd;f++)e=a.notes[f],e.invis=!0,e.a_dd||(e.a_dd=[]),e.a_dd.push(g);continue;case 10:if(a.notes)for(f=
0;f<=a.nhd;f++)a.notes[f].color=h;else a.color=h;break;case 32:a.invis=!0;break;case 33:if(a.type!=m.BAR){x(1,a,"!beamon! must be on a bar");continue}a.beam_on=!0;break;case 34:if(a.type!=m.NOTE||!c||c.type!=m.NOTE||a.dur!=c.dur){x(1,a,"!$1! must be on the last of a couple of notes",h);continue}a.trem2=!0;a.beam_end=!0;a.beam_st=!1;c.beam_st=!0;c.beam_end=!1;a.ntrem=c.ntrem=Number(h[4]);for(f=0;f<=a.nhd;f++)a.notes[f].dur*=2;for(f=0;f<=c.nhd;f++)c.notes[f].dur*=2;break;case 35:if(a.type!=m.NOTE){x(1,
a,I.must_note,h);continue}a.xstem=!0;break;case 36:if(a.type!=m.NOTE){x(1,a,I.must_note,h);continue}"1"==h[6]?a.beam_br1=!0:a.beam_br2=!0;break;case 37:a.rbstop=1;break;case 38:if(a.type!=m.NOTE){x(1,a,I.must_note,h);continue}a.trem1=!0;a.ntrem=h.length;break;case 39:if(a.type!=m.NOTE){x(1,a,I.must_note,h);continue}a.feathered_beam="a"==h[5]?1:-1;break;case 40:a.stemless=!0;break;case 41:a.rbstop=2;break;case 42:if(a.type!=m.NOTE){x(1,a,I.must_note,h);continue}if(!a.notes[0].acc)continue;h="sacc"+
a.notes[0].acc.toString();g=Pa[h];if(!g&&(g=yc(h),!g)){x(1,a,I.bad_val,"!editorial!");continue}delete a.notes[0].acc;l.acc[a.notes[0].pit+19]=0;break;case 43:if(a.type!=m.NOTE){x(1,a,I.must_note,h);continue}f=l.acc[a.notes[0].pit+19];if(a.notes[0].acc||!f)continue;n=1;break;case 44:if(a.type!=m.NOTE){x(1,a,I.must_note,h);continue}fd(h,a,a.notes[0]);continue;case 45:k=1;continue}if(k&&"fng"==g.glyph&&(k=0,d())){x(1,a,"!$1! must be on the last of a couple of notes",h);continue}a.a_dd||(a.a_dd=[]);a.a_dd.push(g)}}n&&
(ja.push("cacc"+f),zc(a,a.notes[0]))}function zc(a,c){for(var d,e;;){d=ja.shift();if(!d)break;if(e=gd(d)){switch(e.func){case 0:case 1:case 3:case 4:case 8:break;default:x(1,a,"Cannot have !$1! on a head",d);continue;case 9:c.invis=!0;break;case 32:c.invis=!0;continue;case 10:c.color=d;continue;case 40:a.stemless=!0;continue;case 44:fd(d,a,c);continue}c.a_dd||(c.a_dd=[]);c.a_dd.push(e)}}}function Ac(a,c){var d,e=c,f=a.wr,g=a.a_dd,h=g.length;for(d=0;d<h;d++){var n=g[d];switch(n.func){case 1:case 2:12>
e&&(e=12);break;case 3:switch(n.glyph){case "brth":case "lphr":case "mphr":case "sphr":20>a.wr&&(a.wr=20);break;default:var k=n.wl+2;e<k&&(e=k)}default:switch(n.ty){case "<":k=c+n.wl+n.wr+6;e<k&&(e=k);break;case ">":k=f+n.wl+n.wr+6,a.wr<k&&(a.wr=k)}}}return e}function Fe(){function a(a){var c=a.x-a.wl,d=O.length;for(a=0;a<d;a++){var e=O[a];e.ix=a;e.s.x=e.x=c;e.defl.nost=!0}}function c(a){if(!a.invis||!a.play){if(a.a_dd){var c,d=a.a_dd.length;void 0==a.y&&(a.y=0);for(c=0;c<d;c++){var e=a.a_dd[c];var f=
a.x;var A=a.y;switch(e.func){default:if(10<=e.func)continue;var p=0;break;case 3:case 4:case 5:p=a.pos.orn;break;case 6:p=a.pos.dyn}switch(e.ty){case "^":p=p&-8|m.SL_ABOVE;break;case "_":p=p&-8|m.SL_BELOW;break;case "<":case ">":p=p&7|m.SL_CLOSE;"<"==e.ty?(f-=e.wr+8,a.notes[0].acc&&(f-=8)):f+=e.wl+8;A=3*(a.notes[0].pit-18)-(e.h-e.hd)/2;break;case "@":f+=e.x,A+=e.y}if((p&7)!=m.SL_HIDDEN){f={s:a,dd:e,st:a.st,ix:O.length,defl:{},x:f,y:A};p&&(f.pos=p);A=0;if("^"==e.ty)A=1;else if("_"!=e.ty)switch(e.func){case 0:A=
a.multi?0<a.multi:0>a.stem;break;case 3:case 5:a:{switch(p&7){case m.SL_ABOVE:A=1;break a;case m.SL_BELOW:A=0;break a}A=!a.second}break;case 6:case 7:a:{switch(p&7){case m.SL_ABOVE:A=!0;break a;case m.SL_BELOW:A=!1;break a}A=a.multi?0<a.multi:a.p_v.have_ly?(a.pos.voc&7)!=m.SL_ABOVE:!1}}f.up=A;0<=e.name.indexOf("inverted")&&(f.inv=1);a.type!=m.BAR||e.ty||(f.x-=a.wl/2-2);O.push(f);e.dd_en?f.ldst=!0:e.dd_st&&(f.lden=!0,f.defl.nost=!0);if(hd[e.func])hd[e.func](f)}}}if(a.notes)for(e=0;e<a.notes.length;e++)if(a.notes[e].a_dd){f=
a;A=e;var r=f.notes[A],D=r.a_dd.length,l=f.x;for(p=0;p<D;p++)c=r.a_dd[p],d={s:f,dd:c,st:f.st,m:A,ix:0,defl:{},x:l,y:3*(r.pit-18)-(c.h-c.hd)/2},c.ty&&("@"==c.ty?(d.x+=c.x,d.y+=c.y):(d.y-=(c.h-c.hd)/2,"<"==c.ty?(d.x-=c.wr+8,f.notes[A].acc&&(l-=8)):">"==c.ty&&(d.x+=c.wl+8))),O.push(d),c.dd_en?d.ldst=!0:c.dd_st&&(d.lden=!0,d.defl.nost=!0)}}}var d,e;for(d=M;d;d=d.ts_next){switch(d.type){case m.CLEF:case m.KEY:case m.METER:continue}break}for(O.length&&a(d);d;d=d.ts_next){switch(d.type){case m.BAR:case m.MREST:case m.NOTE:case m.REST:case m.SPACE:break;
case m.GRACE:for(e=d.extra;e;e=e.next)c(e);break;default:continue}c(d)}(function(){var a,c=O.length;for(a=0;a<c;a++){var d=O[a];if(d.ldst){var e=d.dd;var k=e.dd_en;var m=d.s;var p=m.v;for(e=a+1;e<c;e++){var r=O[e];if(!r.start&&r.dd==k&&r.s.v==p)break}if(e==c)for(p=m.st,e=a+1;e<c&&(r=O[e],r.start||r.dd!=k||r.s.st!=p);e++);e==c&&(r={s:m,st:d.st,dd:k,ix:O.length-1,x:ia-6,y:m.y,cont:!0,lden:!0,defl:{noen:!0}},r.x<m.x+10&&(r.x=m.x+10),void 0!=d.m&&(r.m=d.m),O.push(r));r.start=d;r.defl.nost=d.defl.nost;
for(e=a;0<=--e;)if(d=O[e],d.start){if(d.s.time<m.time)break;if(d.dd.name==r.dd.name){r.prev=d;break}}}}for(a=0;a<c;a++)r=O[a],r.lden&&!r.start&&(m=r.s,d={s:id(m),st:r.st,dd:r.dd.dd_st,ix:O.length-1,y:m.y,ldst:!0},d.x=d.s.x+d.s.wr,void 0!=r.m&&(d.m=r.m),O.push(d),r.start=d)})()}function Ge(){var a,c=O.length;for(a=0;a<c;a++){var d=O[a];var e=d.dd;e=e.func;if(jd[e]&&void 0==d.m)jd[e](d)}}function He(){var a,c;var d=Array(R+1);var e=O.length;for(a=0;a<=R;a++)d[a]={ymin:0,ymax:0};for(a=0;a<e;a++){var f=
O[a];(c=f.dd)&&Bc[c.func]&&void 0==f.m&&"<"!=c.ty&&">"!=c.ty&&"@"!=c.ty&&(Bc[c.func](f),6==c.func&&!c.dd_en&&((f.pos&m.SL_ALI_MSK)==m.SL_ALIGN||0==(f.pos&m.SL_ALI_MSK)&&0<f.s.fmt.dynalign)&&(f.up?f.y>d[f.st].ymax&&(d[f.st].ymax=f.y):f.y<d[f.st].ymin&&(d[f.st].ymin=f.y)))}for(a=0;a<e;a++)if(f=O[a],c=f.dd)if("@"==c.ty){var g=f.y;0<g?(g=g+c.h+2,g>w[f.st].ann_top&&(w[f.st].ann_top=g)):(g=g-c.hd-2,g<w[f.st].ann_bot&&(w[f.st].ann_bot=g))}else if(6==c.func&&"<"!=c.ty&&">"!=c.ty&&!c.dd_en){var h=f.val||c.wl+
c.wr;(f.pos&m.SL_ALI_MSK)==m.SL_ALIGN||0==(f.pos&m.SL_ALI_MSK)&&0<f.s.fmt.dynalign?(g=f.up?d[f.st].ymax:d[f.st].ymin,f.y=g):g=f.y;g=f.up?g+c.h:g-c.hd;ba(f.st,f.up,f.x,h,g)}for(a=0;a<e;a++)f=O[a],(c=f.dd)&&!c.dd_en&&"ped"==c.name.slice(0,3)&&(h=f.val||10,f.y=aa(f.st,0,f.x,h)-(c.dd_st&&t.pedline?10:c.h),ba(f.st,0,f.x,h,f.y));Ie();for(a=0;a<E.length;a++)if(d=E[a],!d.second&&d.sym&&!d.ignore){f=void 0;var n;c=d;d=w[c.st].topbar+15;for(g=c.sym;g;g=g.next)if(g.type==m.BAR&&g.rbstart&&!g.norepbra){if(!g.next)break;
f||(f=g,ea("repeat"));for(n=g;g.next&&(g=g.next,!g.rbstop););e=n.x;n.xsh&&(e+=n.xsh);h=aa(c.st,!0,e,g.x-e)+2;d<h&&(d=h);2==n.rbstart&&(h=aa(c.st,!0,e,3)+10,d<h&&(d=h));2==g.rbstop&&(h=aa(c.st,!0,g.x-3,3)+10,d<h&&(d=h));n.text&&(h=qa(n.text),h=aa(c.st,!0,e+4,h[0])+h[1],d<h&&(d=h));g.rbstart&&(g=g.prev)}if(g=f)for(Da(c.st,!0),h=d*w[c.st].staffscale;g;g=g.next)if(g.rbstart&&!g.norepbra){for(n=g;g.next&&(g=g.next,!g.rbstop););if(n==g)break;e=n.x;n.xsh&&(e+=n.xsh);0<t.measurenb&g.bar_num&&g.bar_num%t.measurenb&&
(e+=6);f=g.type!=m.BAR?g.rbstop?0:g.x-ia+4:1<g.bar_type.length&&"[]"!=g.bar_type||"]"==g.bar_type?0<n.st&&!(L.staves[n.st-1].flags&64)?g.wl:":"==g.bar_type.slice(-1)?12:":"!=g.bar_type[0]?0:8:g.rbstop&&!g.rbstart?0:8;f=g.x-e-f;g.next||g.rbstop||c.bar_start||(c.bar_start=Cc(g),c.bar_start.bar_type="",c.bar_start.rbstart=1);n.text&&T(e+4,h-C.curfont.size,n.text);Za(e,h);2==n.rbstart&&(F+="m0 10v-10");F+="h"+f.toFixed(1);2==g.rbstop&&(F+="v10");F+='"/>\n';ba(n.st,!0,e,f,d+2);g.rbstart&&(g=g.prev)}}}
function Je(){var a;var c=L;for(a=0;a<=R&&!c.st_print[a];a++);if(!(a>R)){Da(a);if(1!=w[a].staffscale){var d=la("measure").size;zb("measurefont","* "+(d/w[a].staffscale).toString())}ea("measure");var e=nb("0")*C.curfont.swfac;var f=M;var g=C.nbar;if(1<g)if(0==t.measurenb){var h=!0;var n=aa(a,!0,0,20);n<w[a].topbar+14&&(n=w[a].topbar+14);T(0,n-.2*C.curfont.size,g.toString());ba(a,!0,0,20,n+C.curfont.size+2)}else if(0==g%t.measurenb){for(;;f=f.ts_next){switch(f.type){case m.CLEF:case m.KEY:case m.METER:case m.STBRK:continue}break}if(f.type!=
m.BAR||!f.bar_num){h=!0;var k=e;10<=g&&(k*=100<=g?3:2);C.curfont.pad&&(k+=2*C.curfont.pad);c=(f.prev?f.prev.x+f.prev.wr/2:f.x-f.wl)-k;n=aa(a,!0,c,k)+5;n<w[a].topbar+6&&(n=w[a].topbar+6);n+=C.curfont.pad;T(c,n-.2*C.curfont.size,g.toString());n+=C.curfont.size+C.curfont.pad;ba(a,!0,c,k,n)}}for(;f;f=f.ts_next){switch(f.type){case m.STAVES:c=f.sy;for(a=0;a<R&&!c.st_print[a];a++);Da(a);continue;default:continue;case m.BAR:if(!f.bar_num||1>=f.bar_num)continue}g=f.bar_num;0!=t.measurenb&&0==g%t.measurenb&&
f.next&&!f.bar_mrep&&(h||(h=!0),k=e,10<=g&&(k*=100<=g?3:2),C.curfont.pad&&(k+=2*C.curfont.pad),c=f.x,n=aa(a,!0,c,k),n<w[a].topbar+6&&(n=w[a].topbar+6),f.next.type==m.NOTE&&(0<f.next.stem?n<f.next.ys-C.curfont.size&&(n=f.next.ys-C.curfont.size):n<f.next.y&&(n=f.next.y)),n+=2+C.curfont.pad,T(c,n-.2*C.curfont.size,g.toString()),n+=C.curfont.size+C.curfont.pad,ba(a,!0,c,k,n))}C.nbar=g;d&&zb("measurefont","* "+d.toString())}}function Ke(){var a,c,d;var e=L;for(d=0;d<=R&&!e.st_print[d];d++);if(!(d>R)){Da(d,
1);var f=w[d].topbar+2,g=0,h=1,n=-100,k=0;for(e=M;e;e=e.ts_next)if((a=e.part)&&!a.invis){if(!A){var A=e;ea("parts");var p=C.curfont.size+2+2*C.curfont.pad}void 0==a.x&&(a.x=e.x-10);var r=qa(a.text)[0];a=aa(d,!0,a.x,r+3);f<a&&(f=a)}if(A)for(Ea(-1),f*=w[d].staffscale,e=A;e;e=e.ts_next)if((a=e.part)&&!a.invis){r=qa(a.text)[0];if(q.anno_start||q.anno_stop)a.wl=0,a.wr=r,a.ymn=f,a.ymx=a.ymn+p,wa(a);T(a.x,f+2+C.curfont.pad+.22*C.curfont.size,a.text);ba(d,1,a.x,r+3,(f+2+p)/w[d].staffscale);0>a.x&&(k=f+2+
p);Ab(a)}f=w[d].topbar+6;for(e=M;e;e=e.ts_next)e.type!=m.TEMPO||e.invis||(c||(c=e),r=e.tempo_wh[0],a=aa(d,!0,e.x-16,r),0>e.x-16&&(a=k),a>f&&(f=a),n>=e.x-16&&!(g&h>>1)&&(g|=h),h<<=1,n=e.x-16+r);if(c)for(Ea(-1),ea("tempo"),p=C.curfont.size,f=(f+2)*w[d].staffscale,e=c;e;e=e.ts_next)if(e.type==m.TEMPO&&!e.invis){r=e.tempo_wh[0];a=f;g&1&&(a+=p);if(q.anno_start||q.anno_stop)e.wl=16,e.wr=r-16,e.ymn=a,e.ymx=e.ymn+14,wa(e);kd(e,e.x-16,a);Ab(e);ba(d,1,e.x-16,r,(a+p+2)/w[d].staffscale);g>>=1}}}function Le(a,
c,d,e){function f(a){return 6*Math.round((a+12)/6)-12-a}var g=a?3.5:5;a=a?1.8:3.2;if(0<c){c=e-(d-1)*g-a;if(26<c)return 0;d=e}else{d=e+(d-1)*g+a;if(-2>d)return 0;c=e}e=f(d-.25);c=f(c+.25);return e*e>c*c?c:e}function ld(a){var c;a=z(a);a.invis=!0;delete a.extra;delete a.text;delete a.a_gch;delete a.a_ly;delete a.a_dd;delete a.tp;a.notes=z(a.notes);for(c=0;c<=a.nhd;c++){var d=a.notes[c]=z(a.notes[c]);delete d.a_dd}return a}function md(a){function c(a,c,d,e,f,g){var h=f.s1,k=h.nflags;h.ntrem&&(k-=h.ntrem);
h.trem2&&g>k&&(h.dur>=m.BLEN/2?(a=h.x+6,c=f.s2.x-6):h.dur<m.BLEN/4&&(g=c-a,16>g?(a+=g/4,c-=g/4):(a+=5,c-=6)));d=f.a*a+f.b-d;c=(c-a)/G.scale;f=f.a*c*G.scale;Za(a,d,!0);F+="l"+c.toFixed(1)+" "+(-f).toFixed(1)+"v"+e.toFixed(1)+"l"+(-c).toFixed(1)+" "+f.toFixed(1)+'z"/>\n'}var d,e,f,g,h=0,n=a.s1,k=a.s2;wa(n,"beam");if(n.grace){var A=3.5;var p=3.2;var r=.29;var D=1.8}else A=5,p=7,r=.34,D=3.2;D/=G.scale;var l=n.stem;n.stem!=k.stem&&n.nflags>k.nflags&&(l=k.stem);0>l&&(D=-D);c(n.xs-r,k.xs+r,0,D,a,1);var u=
0;for(d=n;d.type==m.NOTE&&d.stem!=l&&(d.ys=a.a*d.xs+a.b-w[d.st].y+A*(d.nflags-1)*d.stem-D),d!=k;d=d.next);n.feathered_beam&&(u=A/(k.xs-n.xs),0<n.feathered_beam?(u=-u,A=u*n.xs):A=u*k.xs,u*=l);r=0;for(e=2;e<=a.nflags;e++)for(r+=A,0!=u&&(a.a+=u),d=n;;d=d.next){if(!(d.type!=m.NOTE||d.nflags<e))if(d.trem1&&e>d.nflags-d.ntrem){var t=d.dur>=m.BLEN/2?d.x:d.xs;c(t-5,t+5,(r+2.5)*l,D,a,e)}else{for(f=d;d!=k;){var v=d.next;if(v.type==m.NOTE||v.type==m.REST)if(v.trem1){if(v.nflags-v.ntrem<e)break}else if(v.nflags<
e)break;if(v.beam_br1||v.beam_br2&&2<e)break;d=v}for(g=d;g.type!=m.NOTE;)g=g.prev;t=f.xs;var q=r*l;if(f==g){if(f==n)t+=p;else if(f==k)t-=p;else if(f.beam_br1||f.beam_br2&&2<e)t+=p;else{for(v=f.next;v.type!=m.NOTE;)v=v.next;if(v.beam_br1||v.beam_br2&&2<e)t-=p;else{for(f=f.prev;f.type!=m.NOTE;)f=f.prev;t=f.nflags<v.nflags||f.nflags==v.nflags&&f.dots<v.dots?t+p:t-p}}f.stem!=l&&(h-=A,q=h*l,f.ys=a.a*f.xs+a.b-w[f.st].y-D)}else if(f.stem==g.stem&&f.stem!=l)for(h-=A,q=h*l,d=f;d.type==m.NOTE&&(d.ys=a.a*d.xs+
a.b-w[d.st].y-D),d!=g;d=d.next);c(t,g.xs,q,D,a,e)}if(d==k)break}n.tmp?gb(n):k.tmp&&gb(k);Ab(n,"beam")}function od(a){function c(a,c,d){for(var e,f;!L.st_print[c];){if(L.staves[c].flags&d)return;c++}for(e=f=c;;){L.st_print[e]&&(f=e);if(L.staves[e].flags&d)break;e++}c=w[c].y+w[c].topbar*w[c].staffscale;f=w[f].y+w[f].botbar*w[f].staffscale;d&514?(a+=Wb-6,d=ra-f,c=(c-f)/24,F+='<text transform="translate('+a.toFixed(1)+","+d.toFixed(1)+") scale(2.5,"+c.toFixed(2)+')">'+Nb.brace.c+"</text>\n"):(a+=Wb-5,
d=ra-c-3,c=c-f+2,F+='<path d="m'+a.toFixed(1)+" "+d.toFixed(1)+"\n\tc10.5 1 12 -4.5 12 -3.5c0 1 -3.5 5.5 -8.5 5.5\n\tv"+c.toFixed(1)+'\n\tc5 0 8.5 4.5 8.5 5.5c0 1 -1.5 -4.5 -12 -3.5"/>\n')}var d,e,f=L.nstaff;for(d=e=0;;d++){var g=L.staves[d].flags;g&5&&e++;if(L.st_print[d])break;g&10&&e--;if(d==f)break}for(g=f;g>d&&!L.st_print[g];g--);if(d!=g||0!=e)for(e=w[g].y+w[g].botbar*w[g].staffscale,d=w[d].y+w[d].topbar*w[d].staffscale-e,Za(a,e),F+="v"+(-d).toFixed(1)+'"/>\n',d=0;d<=f;d++)g=L.staves[d].flags,
g&1&&c(a,d,2),g&4&&c(a,d,8),g&256&&c(a-6,d,512),g&1024&&c(a-6,d,2048)}function pd(a){if(a.a_meter){var c=w[a.st];var d=c.y;"|||||"!=c.stafflines&&(d+=(c.topbar+c.botbar)/2-12);for(c=0;c<a.a_meter.length;c++){var e=a.a_meter[c];var f=a.x+a.x_meter[c];e.bot?P('<g transform="translate(X,Y)" text-anchor="middle">\n\t<text y="-12">A</text>\n\t<text>B</text>\n</g>\n',f,d+6,Bb(e.top),Bb(e.bot)):P('<text x="X" y="Y" text-anchor="middle">A</text>\n',f,d+12,Bb(e.top))}}}function Dc(a,c,d){if("object"==typeof d){var e=
d[0],f=d[1];var g=e+"_"+f;d=qd[g];d||(d=abc2svg.rat(Math.abs(e),f),f=d[1],d=(0>e?-d[0]:d[0]).toString(),1!=f&&(d+="_"+f),qd[g]=d)}U(a,c,"acc"+d)}function hb(a,c,d,e,f){var g;0<=c?(g=a.hlu[c])||(g=a.hlu[c]=[]):(g=a.hld[-c])||(g=a.hld[-c]=[]);for(a=0;a<g.length&&!(d>=g[a][0]);a++);a==g.length?g.push([d,e,f]):d>g[a][0]?g.splice(++a,0,[d,e,f]):(e<g[a][1]&&(g[a][1]=e),f>g[a][2]&&(g[a][2]=f))}function rd(a,c,d){c-=3;10>d?U(a-4,c,"mtr"+d):(U(a-10,c,"mtr"+(d/10|0)),U(a-2,c,"mtr"+d%10))}function Me(a){var c;
a.nflags=a.dur<2*m.BLEN?-2:a.dur<4*m.BLEN?-3:-4;a.dots=0;for(c=a.ts_next;c.time!=a.time+a.dur&&c.ts_next;)c=c.ts_next;var d=c.x-c.wl;for(c=a;!c.seqst;)c=c.ts_prev;c=c.ts_prev;d=(d+c.x+c.wr)/2;if(a.a_dd){c=d-a.x;var e,f=O.length;for(e=0;e<f;e++){var g=O[e];g.s==a&&(g.x+=c)}}a.x=d}function Ne(a){var c,d,e=a;for(c=a.extra;c.next;)c=c.next;var f=c;if(d=(0<=c.stem||0>a.multi)&&28>=c.notes[0].pit||16>c.notes[0].pit){var g=127;for(c=a.extra;c;c=c.next)c.y<g&&(g=c.y,f=c);c=f.x;g=f.y-5;a.extra!=f&&(c-=4,g+=
1);a=a.next;var h=a.x-1;0>a.stem&&-2<a.nflags&&(h-=4);var n=3*(a.notes[0].pit-18)-5;var k=.4*(h-c);3<k&&(k=3);var m=k;var p=.2;var r=.8;g>n+7?(c=f.x-1,g+=.5,n+=6.5,h=a.x-5.5,k=.8*(g-n),m=.2*(g-n),p=0):n>g+4&&(n=g+4,c=f.x+2,g=f.y-4)}else{g=-127;for(c=a.extra;c;c=c.next)c.y>g&&(g=c.y,f=c);c=f.x;g=f.y+5;a.extra!=f&&(c-=4,--g);a=a.next;h=a.x-1;0<=a.stem&&-2<a.nflags&&(h-=2);n=3*(a.notes[a.nhd].pit-18)+5;k=.4*(c-h);-3>k&&(k=-3);m=k;p=.2;r=.8;g<n-7?(c=f.x-1,g-=.5,n-=6.5,h=a.x-5.5,k=.8*(g-n),m=.2*(g-n),
p=0):n<g-4&&(n=g-4,c=f.x+2,g=f.y+4)}e.slur={x0:c,y0:g,x1:p*h+(1-p)*c-c,y1:g-p*n-(1-p)*g+k,x2:r*h+(1-r)*c-c,y2:g-r*n-(1-r)*g+m,x3:h-c,y3:g-n};g-=e.slur.y1;c=e.extra;d?g<c.ymn&&(c.ymn=g):g>c.ymx&&(c.ymx=g)}function Cb(a,c){var d,e=Array(a.nhd+1);var f=a.notes[0>a.stem?a.nhd:0];var g=a.x+f.shhd*G.scale;var h=w[a.st].y+3*(f.pit-18);f=w[a.st].y;if(a.dots){for(d=0;d<=a.nhd;d++){var n=3*(a.notes[d].pit-18);0==n%6&&(n=a.dot_low?n-3:n+3);e[d]=n}for(d=0;d<a.nhd;d++)if(!(e[d+1]>e[d])){for(n=d;0<n&&!(e[n]>e[n-
1]+6);)n--;if(3*(a.notes[n].pit-18)-e[n]<e[d+1]-3*(a.notes[d+1].pit-18))for(;n<=d;)e[n++]-=6;else e[d+1]=e[d]+6}}a.stemless?a.xstem&&(n=a.ts_prev,d=(0<n.stem?n.y:n.ys)-a.y,d+=w[n.st].y-f,Ec(g,h,d)):(d=a.ys-a.y,n=a.nflags,a.ntrem&&(n-=a.ntrem),!c||0>=n?(0<a.nflags&&(d=0<=a.stem?d-1:d+1),Ec(g,h,d,a.grace)):Ec(g,h,d,a.grace,n,a.fmt.straightflags));if(c&&a.trem1){c=a.ntrem||0;d=3*(a.notes[0<a.stem?a.nhd:0].pit-18);a.head==m.FULL||a.head==m.EMPTY?(g+=(a.grace?2.3:3.5)*a.stem,d=0<a.stem?d+(6+5.4*c):d-11.4):
d=0<a.stem?d+(5+5.4*c):d-10.4;d/=a.p_v.scale;for(P('<path d="mX Y\n\t',g-4.5,f+d);;){F+="l9 -3v3l-9 3z";if(0>=--c)break;F+="m0 5.4"}F+='"/>\n'}for(f=0;f<=a.nhd;f++){var k=void 0,A=void 0;g=a;var p=f;var r=e;c=!1;h=g.notes[p];d=w[g.st].y;n=g.x;var D=3*(h.pit-18),l=n+h.shhd*G.scale,u=D+d,t=cc(g,h.dur);var v=t[0];var q=t[1];t=t[2];if(!h.invis)if(g.grace)A="ghd",l-=4.5*G.scale;else if(h.map&&h.map[0])(A=h.map[0][v])||(A=h.map[0][h.map[0].length-1]),v=A.indexOf("/"),0<=v&&(A=0<=g.stem?A.slice(0,v):A.slice(v+
1));else if(g.type==m.CUSTOS)A="custos";else switch(v){case m.OVAL:A="HD";break;case m.OVALBARS:if(g.head!=m.SQUARE){A="HDD";break}case m.SQUARE:-4<t?A="breve":(A="longa",k=0<g.stem);sa||!g.next||g.next.type!=m.BAR||g.next.next||(q=0);l+=1;break;case m.EMPTY:A="Hd";break;default:A="hd"}void 0!=h.color&&(c=Ta(h.color));A&&(k&&(Ob(l,u,0,1,-1),l=u=0),Q.psxygl(l,u,A)||U(l,u,A),k&&ib());if(q)for(k=n+(7.7+g.xmx)*G.scale,void 0==r[p]&&(r[p]=3*(g.notes[p].pit-18),0==(g.notes[p].pit&1)&&(r[p]+=3)),p=r[p]+
d,v=h.dur/12>>5-t-q;0<q--;)U(k,p,v&1<<q?"dot":"dot+"),k+=3.5;h.acc&&(n-=h.shac*G.scale,g.grace?(Ob(n,D+d,0,.75),Dc(0,0,h.acc),ib()):Dc(n,D+d,h.acc));0!=c&&Ta(c)}}function id(a){for(;a.prev;)if(a=a.prev,a.rbstart)return a;for(a=a.p_v.sym;a.type!=m.CLEF;)a=a.ts_prev;a.next&&a.next.type==m.KEY&&(a=a.next);return a.next&&a.next.type==m.METER?a.next:a}function Oe(a,c){var d;if(a.grace&&0<a.stem)return-1;var e=a.multi?a.multi:c.multi?c.multi:0;if(e)return e;for(;;a=a.next){if(a.type==m.NOTE){if(!a.stemless){if(0>
a.stem)return 1;var f=!0}22>a.notes[0].pit&&(d=!0)}if(a.time==c.time)break}return f||d?-1:1}function sd(a,c,d,e,f,g,h){var n=.3;var k=e-c;0>k&&(k=-k);var m=d-a;40<m&&.7>k/m&&(n=.3+.002*(m-40),.7<n&&(n=.7));var p=.5*(a+d);k=.5*(c+e);var r=a+.45*(p+n*(a-p)-a);var D=c+.45*(k+n*(c-k)+g-c);p=d+.45*(p+n*(d-p)-d);n=e+.45*(k+n*(e-k)+g-e);k=2*f;g=.2+.001*m;.6<g&&(g=.6);g*=f;m*=.03;F=h?F+'<path class="stroke" stroke-dasharray="5,5" d="M':F+'<path d="M';Qa(a," ",c);F+="c"+((r-a)/G.scale).toFixed(1)+" "+(c-D).toFixed(1)+
" "+((p-a)/G.scale).toFixed(1)+" "+(c-n).toFixed(1)+" "+((d-a)/G.scale).toFixed(1)+" "+(c-e).toFixed(1);h||(F+="\n\tv"+(-g).toFixed(1)+"c"+((p-m-d)/G.scale).toFixed(1)+" "+(e+g-n-k).toFixed(1)+" "+((r+m-d)/G.scale).toFixed(1)+" "+(e+g-D-k).toFixed(1)+" "+((a-d)/G.scale).toFixed(1)+" "+(e-c).toFixed(1));F+='"/>\n'}function Fc(a,c,d){var e,f,g,h=c.ty,n=(h&7)==m.SL_ABOVE?1:-1;var k=a.length;var A=k-1;var p=c.nts;var r=a[0];var D=a[A];var l=1;Da(r.st);for(e=1;e<k;e++){var u=a[e];if(u.type==m.NOTE||u.type==
m.REST)l++,u.st==r.st||f||(f=u)}if(f&&!d){C.a_sl||(C.a_sl=[]);var t=24+r.fmt.sysstaffsep;f.st>r.st&&(t=-t);for(e=0;e<k;e++)if(u=a[e],u.st==r.st)u.dur&&(g=u);else if(u=z(u),a[e]==f&&(f=u),a[e]=u,u.dur)if(u.notes=z(u.notes),u.notes[0]=z(u.notes[0]),c.ty&m.SL_CENTER){if(u.st!=g.st){c.ty=c.ty&-8|(g.st<u.st?m.SL_BELOW:m.SL_ABOVE);var v=r.ymn;t=D.ymx;if(u.st<g.st){for(h=1;h<e;h++)g=a[h],g.ymn<v&&(v=g.ymn);for(h=e;h<A;h++)g=a[h],g.ymx>t&&(t=g.ymx)}else{for(h=1;h<e;h++)g=a[h],g.ymx>t&&(t=g.ymx);for(h=e;h<
A;h++)g=a[h],g.ymn<v&&(v=g.ymn)}t+=v;g=u}u.y=t-u.y;u.notes[0].pit=(u.y/3|0)+18;u.ys=t-u.ys;p=u.ymx;u.ymx=t-u.ymn;u.ymn=t-p;u.stem=-u.stem}else u.notes[0].pit+=t/3|0,u.ys+=t,u.y+=t,u.ymx+=t,u.ymn+=t;h=r.st>f.st?"/":"\\";h=c.ty&m.SL_CENTER?h+h:r.st==D.st?"/"==h?"/\\":"\\/":h+(0<n?"+":"-");n=F;F="";Fc(a,c,1);C.a_sl.push([r,f,h,F]);F=n}else{f=r.x;r.notes&&r.notes[0].shhd&&(f+=r.notes[0].shhd);k=D.x;D.notes&&(k+=D.notes[0].shhd);if(p){var q=3*(p.pit-18)+2*n;f+=3}else q=0<n?r.ymx+2:r.ymn-2,r.type==m.NOTE&&
(0<n?0<r.stem?(f+=5,r.beam_end&&-1<=r.nflags&&!r.in_tuplet?0<r.nflags?(f+=2,q=r.ys-3):q=r.ys-6:q=r.ys+3):q=r.y+8:0>r.stem?(--f,D.grace?q=r.y-8:r.beam_end&&-1<=r.nflags&&(!r.in_tuplet||r.ys<q+3)?0<r.nflags?(f+=2,q=r.ys+3):q=r.ys+6:q=r.ys-3):q=r.y-8);if(c.nte){var y=3*(c.nte.pit-18)+2*n;k-=3}else y=0<n?D.ymx+2:D.ymn-2,D.type==m.NOTE&&(0<n?0<D.stem?(k+=1,y=D.beam_st&&-1<=D.nflags&&!D.in_tuplet?D.ys-6:D.ys+3):y=D.y+8:0>D.stem?(k-=5,y=D.beam_st&&-1<=D.nflags&&!D.in_tuplet?D.ys+6:D.ys-3):y=D.y-8);r.type!=
m.NOTE&&(q=y+1.2*n,f=r.x+.5*r.wr,f>k-12&&(f=k-12));D.type!=m.NOTE&&(y=r.type==m.NOTE?q+1.2*n:q,r!=D&&(k=D.x-.3*D.wl));3<=l&&(u=a[1],u.type!=m.BAR&&u.x<f+48&&(0<n?(p=u.ymx-2,q<p&&(q=p)):(p=u.ymn+2,q>p&&(q=p))),u=a[A-1],u.type!=m.BAR&&u.x>k-48&&(0<n?(p=u.ymx-2,y<p&&(y=p)):(p=u.ymn+2,y>p&&(y=p))));g=(y-q)/(k-f);if(.5<g||-.5>g)g=.5<g?.5:-.5,0<g*n?q=y-g*(k-f):y=q+g*(k-f);p=y-q;8<p?p=8:-8>p&&(p=-8);v=p;0>v&&(v=-v);t=.5*v;e=.3*p;0<p*n?(k-=t,y-=e):(f+=t,q+=e);r.grace&&(f=r.x-1.15);D.grace&&(k=D.x+2.3*1.5);
t=0;g=(y-q)/(k-f);if(r!=D&&r.v==D.v){D=q-g*f;for(e=1;e<A;e++)switch(u=a[e],u.type){case m.NOTE:case m.REST:0<n?(p=3*(u.notes[u.nhd].pit-18)+6,p<u.ymx&&(p=u.ymx),p-=g*u.x+D,p>t&&(t=p)):(p=3*(u.notes[0].pit-18)-6,p>u.ymn&&(p=u.ymn),p-=g*u.x+D,p<t&&(t=p));break;case m.GRACE:for(u=u.extra;u;u=u.next)0<n?(p=3*(u.notes[u.nhd].pit-18)+6,p<u.ymx&&(p=u.ymx),p-=g*u.x+D,p>t&&(t=p)):(p=3*(u.notes[0].pit-18)-6,p>u.ymn&&(p=u.ymn),p-=g*u.x+D,p<t&&(t=p))}q+=.45*t;y+=.45*t;t*=.65}l=3<l?(.08*(k-f)+12)*n:(.03*(k-f)+
8)*n;0<n?(l<3*t&&(l=3*t),40<l&&(l=40)):(l>3*t&&(l=3*t),-40>l&&(l=-40));p=y-q;0>p&&(p=-p);0<n?l<.8*p&&(l=.8*p):l>-.8*p&&(l=-.8*p);l*=r.fmt.slurheight;sd(f,q,k,y,n,l,h&m.SL_DOTTED);g=(y-q)/(k-f);D=q-g*f;D=0<l?D+(4*Math.sqrt(l)-2):D-(4*Math.sqrt(-l)-2);for(e=0;e<A;e++)u=a[e],u.st==r.st&&u.type!=m.BAR&&(p=g*u.x+D,u.ymx<p?u.ymx=p:u.ymn>p&&(u.ymn=p),d||(e==A-1?(t=k,c.nte&&(t-=5)):t=u.x+u.wr,0!=e&&(f=u.x),e&&e!=A||(p-=l/3),t-=f-u.wl,ba(r.st,0<n,f-u.wl,t,p)))}}function Pb(a,c){for(var d,e,f,g;;){if(!a||a==
c){if(!d||!(a=d.next)||a==c)break;d=null}if(a.type==m.GRACE)d=a,a=a.extra;else{if(a.sls){f=a.sls;a.sls=null;g=[];for(e=0;e<f.length;e++){var h,n;var k=a;var A=f[e],p=[];var r=A.se;if(c&&r.time>c.time)k=void 0;else{switch(A.loc){case "i":k=id(k);break;case "o":for(h=k;h.ts_next;h=h.ts_next);for(r=h;h;h=h.ts_prev){if(h.v==k.v){r=h;break}h.st==k.st&&(r=h);if(h.ts_prev.time!=r.time)break}}if(k.p_v.s_next&&r.time>=sa.time){if(r.time==sa.time)if(r.grace)for(h=sa;h&&h.time==r.time;h=h.ts_next){if(h.type==
m.GRACE){h=null;break}}else for(h=sa;h.time==r.time;h=h.ts_next){if(h==r){h=null;break}}else h=null;if(!h){k.p_v.sls.push(A);for(r=k.p_v.s_next.prev;r.next;)r=r.next;A=Object.create(A)}}switch(A.ty&7){case m.SL_ABOVE:h=1;break;case m.SL_BELOW:h=-1;break;default:h=k.v!=r.v?1:Oe(k,r),A.ty&=-8,A.ty|=0<h?m.SL_ABOVE:m.SL_BELOW}h=L.voices[k.v]&&L.voices[r.v]?0<h*(L.voices[k.v].range<=L.voices[r.v].range?1:-1)?k.v:r.v:k.v>r.v?k.v:r.v;if(!d||r.grace&&k.v==r.v&&k.time==r.time)p.push(k),k=k.grace?k.next:k.ts_next;
else{do p.push(k),k=k.next;while(k);k=d.next}if(r.grace){if(!k.grace){for(n=r;n.prev;)n=n.prev;for(;;){k.v==h&&p.push(k);if(k.extra==n)break;k=k.ts_next}k=n}for(;;){p.push(k);if(k==r)break;k=k.next}}else for(;k;){k.v==h&&p.push(k);if(k==r)break;k=k.ts_next}for(r=1;r<p.length-1;r++)k=p[r],k.sls&&Pb(k,c),k.tp&&Gc(k);Fc(p,A);k=1}k||g.push(f[e])}g.length&&(a.sls=g)}a=a.next}}}function Gc(a){var c,d,e,f,g=a.tp.shift();a.tp.length||delete a.tp;var h=f=a.st;for(c=a;c;c=c.next){switch(c.type){case m.GRACE:if(!c.sl1)continue;
for(e=c.extra;e;e=e.next)e.sls&&Pb(e);default:continue;case m.NOTE:case m.REST:}c.sls&&Pb(c);c.st<h?(f=h,h=c.st):c.st>f&&(f=c.st);c.tp&&Gc(c);if(c.tpe)break}c&&c.tpe--;if(1!=g.f[0])if(c){e=g.f[3];if(!e){for(d=a;d&&!d.stem;)d=d.next;e=d&&0>d.stem?m.SL_BELOW:m.SL_ABOVE}Da(e==m.SL_ABOVE?h:f);if(a==c||2==g.f[1])var n=!0;else if(1==g.f[1])n=!0,Fc([a,c],{ty:e});else if(2!=g.f[0]&&a.type==m.NOTE&&c.type==m.NOTE){n=!0;for(d=a;;d=d.next){if(d.type!=m.NOTE&&d.type!=m.REST){if(d.type==m.GRACE||d.type==m.SPACE)continue;
n=!1;break}if(d==c)break;if(d.beam_end){n=!1;break}}if(n&&!a.beam_st&&!a.beam_br1&&!a.beam_br2)for(d=a.prev;d;d=d.prev)if(d.type==m.NOTE||d.type==m.REST){d.nflags>=a.nflags&&(n=!1);break}if(n&&!c.beam_end)for(d=c.next;d;d=d.next)if(d.type==m.NOTE||d.type==m.REST){!d.beam_br1&&!d.beam_br2&&d.nflags>=c.nflags&&(n=!1);break}}if(n){if(1!=g.f[2]){ea("tuplet");n=(c.x+a.x)/2;var k=e==m.SL_ABOVE?aa(h,1,n-4,8):aa(f,0,n-4,8)-C.curfont.size;0<a.stem*c.stem&&(n=0<a.stem?n+4:n-4);var A=k+.22*C.curfont.size;0==
g.f[2]?T(n,A,g.p.toString(),"c"):T(n,A,g.p+":"+g.q,"c");for(d=a;!(d.x>=n);d=d.next);e==m.SL_ABOVE?(k+=C.curfont.size,d.ymx<k&&(d.ymx=k),ba(h,1,n-3,6,k)):(d.ymn>k&&(d.ymn=k),ba(f,0,n-3,6,k))}}else{var p=a.x-4;if(c.dur>c.prev.dur){d=c.next;if(!d||d.time!=c.time+c.dur)for(d=c.ts_next;d&&!(d.seqst&&d.time>=c.time+c.dur);d=d.ts_next);var r=d?d.x-d.wl-5:ia-6}else r=c.x+4,n=0<=c.stem?0:c.nhd,0<c.notes[n].shhd&&(r+=c.notes[n].shhd),c.st==h&&0<c.stem&&(r+=3.5);if(e==m.SL_ABOVE){if(a.st>=c.st){0<a.stem&&(p+=
3);k=aa(a.st,1,p-4,8);var l=k>w[a.st].topbar+2?k:w[a.st].topbar+2}else l=w[a.st].topbar+2;if(c.st>=a.st){k=aa(c.st,1,r-4,8);var Y=k>w[c.st].topbar+2?k:w[c.st].topbar+2}else Y=w[c.st].topbar+2;n=.5*(p+r);k=.5*(l+Y);var u=(Y-l)/(r-p);l=3*(c.notes[c.nhd].pit-a.notes[a.nhd].pit)/(r-p);0<l?0>u?u=0:u>l&&(u=l):0<u?u=0:u<l&&(u=l);u=a.fmt.beamslope*u/(a.fmt.beamslope+Math.abs(u));u*u<.1*.1&&(u=0);Y=0;for(d=a;d.dur&&d.st==h&&(A=k+(d.x-n)*u,l=aa(h,1,d.x-4,8)+2,l-A>Y&&(Y=l-A)),d!=c;d=d.next);k+=Y;l=k+u*(p-n);
Y=k+u*(r-n);k+=6;for(d=a;d.st==h&&(A=k+(d.x-n)*u,d.ymx<A&&(d.ymx=A),ba(h,1,d.x-3,6,A)),d!=c;d=d.next);}else{a.st<=c.st?(k=aa(a.st,0,p-4,8),l=-2>k?k:-2):l=-2;c.st<=a.st?(0>c.stem&&(r-=3),k=aa(c.st,0,r-4,8),Y=-2>k?k:-2):Y=-2;n=.5*(p+r);k=.5*(l+Y);u=(Y-l)/(r-p);l=3*(c.notes[0].pit-a.notes[0].pit)/(r-p);0<l?(0>u?u=0:u>l&&(u=l),.35<u&&(u=.35)):(0<u?u=0:u<l&&(u=l),-.35>u&&(u=-.35));u*u<.1*.1&&(u=0);Y=0;for(d=a;d.dur&&d.st==f&&(A=k+(d.x-n)*u,l=aa(f,0,d.x-4,8),l-A<Y&&(Y=l-A)),d!=c;d=d.next);k+=Y-8;l=k+u*
(p-n);Y=k+u*(r-n);k-=2;for(d=a;d.st==f&&(A=k+(d.x-n)*u,d.ymn>A&&(d.ymn=A),ba(f,0,d.x-3,6,A)),d!=c;d=d.next);}1==g.f[2]?(h=Y-l,f=e==m.SL_ABOVE?-3:3,A=(r-p)/G.scale,F+='<path class="stroke" d="m',Qa(p," ",l+4+f),F+="v"+f.toFixed(1)+"l"+A.toFixed(1)+" "+(-h).toFixed(1)+"v"+(-f).toFixed(1)+'"/>\n'):(a=p,c=l,p=r-p,r=Y-l,l=e==m.SL_ABOVE,Y=0==g.f[2]?g.p.toString():g.p+":"+g.q,g=10*Y.length,d=l?-3:3,ea("tuplet"),T(a+p/2,c+r/2-.1*C.curfont.size,Y,"c"),p/=G.scale,l||(c+=6),F+='<path class="stroke" d="m',Qa(a,
" ",c),l=p-g+1,g=0<r?g+r/8:g-r/8,F+="v"+d.toFixed(1)+"m"+p.toFixed(1)+" "+(-r).toFixed(1)+"v"+(-d).toFixed(1)+'"/>\n<path class="stroke" stroke-dasharray="'+(l/2).toFixed(1)+" "+g.toFixed(1)+'" d="m',Qa(a," ",c-d),F+="l"+p.toFixed(1)+" "+(-r).toFixed(1)+'"/>\n',e==m.SL_ABOVE?ba(h,1,n-3,6,A+2):ba(f,0,n-3,6,A))}}else x(1,a,"No end of tuplet in this music line")}function Xb(a,c,d){var e,f=2==d?a.pit:c.pit,g=(a.tie_ty&7)==m.SL_ABOVE?1:-1,h=a.s,n=h.st,k=c.s,A=k.x,p=a.shhd;for(e=0;e<h.nhd&&h.notes[e]!=
a;e++);0<g?e<h.nhd&&f+1==h.notes[e+1].pit&&h.notes[e+1].shhd>p&&(p=h.notes[e+1].shhd):0<e&&f==h.notes[e-1].pit+1&&h.notes[e-1].shhd>p&&(p=h.notes[e-1].shhd);var r=h.x+p;if(2!=d){for(e=0;e<k.nhd&&k.notes[e]!=c;e++);p=k.notes[e].shhd;0<g?e<k.nhd&&f+1==k.notes[e+1].pit&&k.notes[e+1].shhd<p&&(p=k.notes[e+1].shhd):0<e&&f==k.notes[e-1].pit+1&&k.notes[e-1].shhd<p&&(p=k.notes[e-1].shhd);A+=p}switch(d){default:if(f<c.pit||0>g)f=a.pit;break;case 3:g=-g;case 1:r=k.prev?k.prev.x+k.wr:h.x;h.st!=k.st&&(n=k.st);
r+=.4*(A-r);r>A-20&&(r=A-20);break;case 2:A=h.next?h.next.x:ia,A!=ia&&(A-=.4*(A-r)),A<r+16&&(A=r+16)}20<A-r?(r+=3.5,A-=3.5):(r+=1.5,A-=1.5);!h.dots||a.pit&1||!(0<g&&!h.dot_low||0>g&&h.dot_low)||(r+=5);c=w[n].y+3*(f-18)+g;sd(r,c,A,c,g,(.03*(A-r)+16)*g*h.fmt.tieheight,a.tie_ty&m.SL_DOTTED)}function Pe(){function a(a,c){var d=ia/Ca,e=a.x/d|0,f=c.x/d|0,g=(a.ys-c.ys)/(a.xs-c.xs);c=a.ys-a.xs*g;var h=w[a.st];d*=g;if(0<a.stem)for(;e<=f;)a=d*e+c,h.top[e]<a&&(h.top[e]=a),e++;else for(;e<=f;)a=d*e+c,h.bot[e]>
a&&(h.bot[e]=a),e++}var c,d,e,f=F;F="";Ca=Math.ceil(ia/2);for(c=0;c<=R;c++){var g=w[c];g.top=new Float32Array(Ca);g.bot=new Float32Array(Ca);for(d=0;d<Ca;d++)g.top[d]=0,g.bot[d]=24}for(d=0;d<E.length;d++){var h={};var n=!0;c=E[d];for(g=c.sym;g;g=g.next)switch(g.type){case m.GRACE:for(e=g.extra;e;e=e.next)e.beam_st&&!e.beam_end&&(Q.calculate_beam(h,e),h.s2&&a(e,h.s2));g.p_v.ckey.k_bagpipe||!g.fmt.graceslurs||g.gr_shift||g.sl1||g.ti1||!g.next||g.next.type!=m.NOTE||Ne(g)}for(g=c.sym;g;g=g.next)switch(g.type){case m.NOTE:if(g.beam_st&&
!g.beam_end||n&&!g.beam_st)n=!1,Q.calculate_beam(h,g),h.s2&&a(g,h.s2)}}Qe();Fe();for(g=M;g;g=g.ts_next)if(!g.invis){switch(g.type){case m.GRACE:for(e=g.extra;e;e=e.next)ba(g.st,!0,e.x-2,4,e.ymx+1),ba(g.st,!1,e.x-2,4,e.ymn-5);continue;case m.MREST:ba(g.st,!0,g.x+16,32,g.ymx+2);continue;default:ba(g.st,!0,g.x-g.wl,g.wl+g.wr,g.ymx+2);ba(g.st,!1,g.x-g.wl,g.wl+g.wr,g.ymn-2);continue;case m.NOTE:}0<g.stem?(g.stemless?(c=-5,d=10):g.beam_st?(c=3,d=g.beam_end?4:10):(c=-8,d=g.beam_end?11:16),ba(g.st,!0,g.x+
c,d,g.ymx),d=g.ymn,g.notes[0].acc&&d>3*(g.notes[0].pit-18)-9&&(d=3*(g.notes[0].pit-18)-9),ba(g.st,!1,g.x-g.wl,g.wl+g.wr,d)):(ba(g.st,!0,g.x-g.wl,g.wl+g.wr,g.ymx),g.stemless?(c=-5,d=10):g.beam_st?(c=-6,d=g.beam_end?4:10):(c=-8,d=g.beam_end?5:16),c+=g.notes[0].shhd,ba(g.st,!1,g.x+c,d,g.ymn));g.notes[g.nhd].acc&&(d=3*(g.notes[g.nhd].pit-18)+(-1==g.notes[g.nhd].acc?11:10),ba(g.st,!0,g.x-10,10,d));g.notes[0].acc&&(d=3*(g.notes[0].pit-18)-(-1==g.notes[0].acc?5:10),ba(g.st,!1,g.x-10,10,d))}Ge();for(d=0;d<
E.length;d++)if(c=E[d],g=c.sym)for(Ta(g.color),c=c.st;g;g=g.next)g.play||(g.tp&&Gc(g),(g.sls||g.sl1)&&Pb(g));Ta();for(c=0;c<=R;c++)for(g=w[c],e=g.topbar+2,h=g.botbar-2,d=0;d<Ca;d++)e>g.top[d]&&(g.top[d]=e),h<g.bot[d]&&(g.bot[d]=h);0<=t.measurenb&&Je();Da(-1);for(d=0;d<E.length;d++)if(c=E[d],c.have_ly){Re();break}He();Ke();Da(-1);F=f}function Se(a,c){var d,e,f,g=[];if(C.vnt){for(d=c.length;0<=--d&&!c[d];);if(!(0>d)){for(e=0;e<E.length;e++){var h=E[e];L.voices[e]&&(d=L.voices[e].st,c[d]&&C.vnt&&(f=
2==C.vnt?h.nm:h.snm))&&(delete h.new_name,g[d]=g[d]?g[d]+("\n"+f):f)}if(g.length){ea("voice");var n=C.curfont.size;var k=n/2;a=.5*-a;for(d=0;d<g.length;d++)if(g[d])for(h=g[d].split("\n"),e=w[d].y+.5*w[d].topbar*w[d].staffscale+k*(h.length-2),L.staves[d].flags&1&&d+1<w.length&&L.staves[d+1].flags&2&&!g[d+1]&&(e-=.5*(w[d].y-w[d+1].y)),c=0;c<h.length;c++)f=h[c],T(a,e,f,"c"),e-=n}}}}function Te(){var a,c;var d=L;var e=sa?sa.fmt:t;for(c=0;c<E.length;c++){var f=E[c];1!=f.scale&&(f.scale_str='transform="scale('+
f.scale.toFixed(2)+')"')}for(c=0;c<=R&&!C.st_print[c];c++);var g=0;if(c>R)return g;var h=w[c];for(a=0;a<Ca;a++){var n=h.top[a];g<n&&(g=n)}g*=h.staffscale;var k=M.fmt.staffsep/2+h.topbar*h.staffscale;g<k&&(g=k);g<h.ann_top&&(g=h.ann_top);h.y=-g;for(f=0;f<c;f++)w[f].y=-g;if(!C.st_print[c])return g;a=d.staves[f];for(c++;c<=R;c++)if(C.st_print[c]){h=w[c];k=a.sep||e.sysstaffsep;var m=a.maxsep||e.maxsysstaffsep;var p=0;if(h.staffscale==w[f].staffscale){for(a=0;a<Ca;a++)n=h.top[a]-w[f].bot[a],p<n&&(p=n);
p*=h.staffscale}else for(a=0;a<Ca;a++)n=h.top[a]*h.staffscale-w[f].bot[a]*w[f].staffscale,p<n&&(p=n);k+=h.topbar*h.staffscale;p<k&&(p=k);m+=h.topbar*h.staffscale;p>m&&(p=m);g+=p;for(h.y=-g;!C.st_print[++f];)w[f].y=-g;for(;!(a=d.staves[f]);)d=d.next}for(a=d=0;a<Ca;a++)n=w[f].bot[a],d>n&&(d=n);d>h.ann_bot&&(d=h.ann_bot);d*=w[f].staffscale;for(c=0;c<=R;c++)h=w[c],p=h.y,1!=h.staffscale&&(h.scale_str='transform="translate(0,'+(ra-p).toFixed(1)+") scale("+h.staffscale.toFixed(2)+')"');if(0==d){for(c=R;0<=
c&&!C.st_print[c];c--);if(0>c)return g}p=-d;k=.5*e.staffsep;p<k&&(p=k);m=.5*e.maxstaffsep;p>m&&(p=m);return g+p}function Ue(a){function c(){var a,c=0;for(a=0;a<=L.nstaff;a++)if(0>n[a])A[a]=p[a]=0;else{var d=w[a].staffscale;var e=w[a].topbar*d;d*=w[a].botbar;0==c&&(c=w[a].y+e);A[a]=w[a].y+d;p[a]=c-A[a];c=L.staves[a].flags&64?0:A[a]}}function d(a,c,d){var e,f,g=0,h="",k=w[a].stafflines,n=k.length,m=6*w[a].staffscale;if(/[\[|]/.test(k))if(d-=c,Ea(-1),Db&&Db.st_l==k&&1==w[a].staffscale&&Db.st_w==(d|0))U(c,
w[a].y,"stdef"+t.fullsvg);else{for(e=0;e<n;e++,g-=m)if("."!=k[e]){for(f=0;e<n;e++,g-=m,f-=m){switch(k[e]){case ".":case "-":continue;case p:h+="m-"+d.toFixed(1)+" "+f+"h"+d.toFixed(1);f=0;continue}void 0!=p&&(h+='"/>\n');var p=k[e];h+='<path class="'+("["==p?"slthW":"slW")+'" d="m0 '+g+"h"+d.toFixed(1);f=0}h+='"/>'}g=w[a].y;!Db&&d>Eb()-10&&1==w[a].staffscale?(Db={st_l:k,st_w:d|0},e="stdef"+t.fullsvg,0>h.indexOf("<path",1)?Fb[e]=h.replace("path",'path id="'+e+'"'):Fb[e]='<g id="'+e+'">\n'+h+"\n</g>",
U(c,g,e)):P('<g transform="translate(X, Y)">\n'+h+"\n</g>\n",c,g)}}function e(a){var c=w[a.st],d=5-a.nflags,e=a.x;a=a.y;if(!(6>d)){7==d&&12==a&&2>=c.stafflines.length&&(a-=6);a/=6;switch(d){default:switch(c.stafflines[a+1]){case "|":case "[":break;default:hb(c,a+1,e,-7,7)}9==d&&a--;break;case 7:a++;case 6:}switch(c.stafflines[a]){case "|":case "[":break;default:hb(c,a,e,-7,7)}}}function f(a,c){var d=c.time;do c=c.ts_next;while(c.st!=a);for(;c.prev&&c.prev.time>=d;)c=c.prev;return c.bar_type?c.x:c.x-
c.wl}var g,h,n=[],k=[],A=[],p=[],r=[],l="",Y="";for(h=0;h<=R;h++)k[h]=L.st_print[h],n[h]=k[h]?0:-1;c();od(0);for(g=M;g;g=g.ts_next)switch(g.type){case m.STAVES:var u=g.sy;for(h=0;h<=R;h++){var v=n[h];if(0>v)u.st_print[h]&&(n[h]=f(h,g),k[h]=!0);else if(!u.st_print[h]||!L.staves[h]||u.staves[h].stafflines!=L.staves[h].stafflines){if(g.ts_prev.bar_type)var q=g.ts_prev.x;else q=(g.ts_prev.x+g.x)/2,n[h]=-1;d(h,v,q);n[h]=u.st_print[h]?q:-1}}L=u;c();continue;case m.BAR:if(g.invis||!g.bar_type||!L.st_print[g.st])break;
if(g.second&&(!g.ts_prev||g.ts_prev.type==m.BAR&&g.ts_prev.st==g.st))break;r.push([g,A[g.st],p[g.st]]);break;case m.STBRK:if(L.voices[g.v]&&0==L.voices[g.v].range&&14<g.xmx&&g.next&&g.next.type==m.CLEF){for(v=h=0;v<E.length;v++)L.voices[v]&&0<L.voices[v].range&&h++;for(q=g.ts_next;q&&q.type==m.STBRK;q=q.ts_next)h--;0==h&&od(g.x)}h=g.st;v=n[h];0<=v&&(q=g.prev)&&(q=q.type==m.BAR?q.x:g.x-g.xmx,v>=q||(d(h,v,q),n[h]=g.x));break;case m.GRACE:for(q=g.extra;q;q=q.next)Q.draw_hl(q);break;case m.NOTE:g.invis||
Q.draw_hl(g);break;case m.REST:(g.fmr||g.rep_nb&&0<=g.rep_nb)&&Me(g),g.invis||e(g)}for(h=0;h<=R;h++)v=n[h],0>v||v>=ia||d(h,v,ia);Ve();(function(){var a,c,d=r.length;ea("annotation");if(c=C.curfont.box)C.curfont.box=0;for(a=0;a<d;a++){var e=r[a];var f,g,h=e[0],k=e[1],n=e[2],p=h.bar_type,A=h.st,u=w[A],D=h.x;0!=A&&h.ts_prev&&h.ts_prev.type!=m.BAR&&(n=u.topbar*u.staffscale);h.ymx=h.ymn+n;Ea(-1);wa(h);h.color&&Ta(h.color);e=u.y+12;"|||||"!=u.stafflines&&(e+=(u.topbar+u.botbar)/2-12);if(h.bar_mrep){Ea(A);
if(1==h.bar_mrep){for(f=h.prev;f.type!=m.REST;f=f.prev);U(f.x,e,"mrep")}else U(D,e,"mrep2"),h.v==L.top_voice&&rd(D,e+u.topbar,h.bar_mrep);Ea(-1)}"||:"==p&&(p="[|:");for(g=p.length;0<=--g;){switch(p[g]){case "|":h.bar_dotted?(f=(5*u.staffscale).toFixed(1),P('<path class="bW" stroke-dasharray="A,A" d="MX Yv-G"/>\n',D,k,f,n)):h.color?P('<path class="bW" d="MX Yv-F"/>\n',D,k,n):l+="M"+Ua(D).toFixed(1)+" "+Q.sy(k).toFixed(1)+"v-"+n.toFixed(1);break;default:D-=3;h.color?P('<path class="bthW" d="MX Yv-F"/>\n',
D+1.5,k,n):Y+="M"+Ua(D+1.5).toFixed(1)+" "+Q.sy(k).toFixed(1)+"v-"+n.toFixed(1);break;case ":":D-=2,Ea(A),U(D+1,e-12,"rdots"),Ea(-1)}D-=3}Ta();Ab(h)}c&&(C.curfont.box=c);Ea(-1);l&&(F+='<path class="bW" d="'+l+'"/>\n');Y&&(F+='<path class="bthW" d="'+Y+'"/>\n')})();Se(a,k)}function Qe(){var a,c,d,e;for(a=0;a<E.length;a++){var f=E[a];if(f=f.sym)if(f=f.next){var g=void 0;for(e=f;e;e=e.next)if(e.ti1){var h=c=0;var n=128;for(d=0;d<=e.nhd;d++)e.notes[d].tie_ty&&(c++,128>n&&e.notes[d].pit<=n+1&&h++,n=e.notes[d].pit,
g=e.notes[d].tie_e);n=g&&0>e.stem*g.stem?22<=n?m.SL_ABOVE:m.SL_BELOW:e.multi?0<e.multi?m.SL_ABOVE:m.SL_BELOW:0>e.stem?m.SL_ABOVE:m.SL_BELOW;if(e.multi)for(d=0;d<=e.nhd;d++)h=e.notes[d].tie_ty,(h&7)==m.SL_AUTO&&(e.notes[d].tie_ty=h&m.SL_DOTTED|n);else if(1>=c)for(d=0;d<=e.nhd;d++){if(h=e.notes[d].tie_ty){(h&7)==m.SL_AUTO&&(e.notes[d].tie_ty=h&m.SL_DOTTED|n);break}}else if(h){n=128;for(d=0;d<=e.nhd;d++)if(e.notes[d].tie_ty){if(128>n&&e.notes[d].pit<=n+1){c=d;break}n=e.notes[d].pit}n=m.SL_BELOW;for(d=
0;d<=e.nhd;d++)if(h=e.notes[d].tie_ty)c==d&&(n=m.SL_ABOVE),(h&7)==m.SL_AUTO&&(e.notes[d].tie_ty=h&m.SL_DOTTED|n)}else if(c&1)for(c=(c-1)/2,n=m.SL_BELOW,d=0;d<=e.nhd;d++){if(h=e.notes[d].tie_ty)0==c&&22<=e.notes[d].pit&&(n=m.SL_ABOVE),(h&7)==m.SL_AUTO&&(e.notes[d].tie_ty=h&m.SL_DOTTED|n),0==c--&&(n=m.SL_ABOVE)}else for(c/=2,n=m.SL_BELOW,d=0;d<=e.nhd;d++)if(h=e.notes[d].tie_ty)(h&7)==m.SL_AUTO&&(e.notes[d].tie_ty=h&m.SL_DOTTED|n),0==--c&&(n=m.SL_ABOVE)}for(;f;f=f.next)if(f.ti1&&(20>f.notes[0].pit&&
f.notes[0].tie_ty&&(f.notes[0].tie_ty&7)==m.SL_BELOW||24<f.notes[f.nhd].pit&&f.notes[f.nhd].tie_ty&&(f.notes[f.nhd].tie_ty&7)==m.SL_ABOVE)){for(g=f.next;g&&g.type!=m.NOTE;)g=g.next;if(g){if(g.st!=f.st)continue;c=g.x-f.x-10}else c=ia-f.x-10;e=100>c?9:300>c?12:16;24<f.notes[f.nhd].pit&&(d=3*(f.notes[f.nhd].pit-18)+e,f.ymx<d&&(f.ymx=d),g&&g.ymx<d&&(g.ymx=d),ba(f.st,!0,f.x+5,c,d));20>f.notes[0].pit&&(d=3*(f.notes[0].pit-18)-e,f.ymn>d&&(f.ymn=d),g&&g.ymn>d&&(g.ymn=d),ba(f.st,!1,f.x+5,c,d))}}}}function Va(a){return!a||
!/^(0|n|f)/i.test(a)}function Hc(a){var c=td[a.fname||a.name];c||(c=1.1);a.swfac=a.size*c}function zb(a,c){var d;if("-"==a[a.length-2]){var e=a[a.length-1];if("1">e||"9"<e)return;a="u"+e+"font"}var f={};if(e=c.match(/\s+(no)?box(\s|$)/))e[1]?(f.box=!1,f.pad=0):(f.box=!0,f.pad=2.5),c=c.replace(e[0],e[2]);if(e=c.match(/\s+padding=([\d.]+)(\s|$)/))f.pad=e[1]?+e[1]:0,c=c.replace(e[0],e[2]);if(e=c.match(/\s+class=(.*?)(\s|$)/))f.class=e[1],c=c.replace(e[0],e[2]);if(e=c.match(/\s+wadj=(.*?)(\s|$)/)){if("undefined"==
typeof document)switch(e[1]){case "none":f.wadj="";break;case "space":f.wadj="spacing";break;case "glyph":f.wadj="spacingAndGlyphs";break;default:y(1,I.bad_val,"%%"+a)}c=c.replace(e[0],e[2])}if(e=c.match(/\s+([0-9.]+|\*)$/))"*"!=e[1]&&(f.size=+e[1]),c=c.replace(e[0],"");if("u"==c[0]&&"url("==c.slice(0,4)||"l"==c[0]&&"local("==c.slice(0,6)){e=c.indexOf(")",1);if(0>e){y(1,"No end of url in font family");return}f.src=c.slice(0,e+1);f.fid=abc2svg.font_tb.length;abc2svg.font_tb.push(f);f.name="ft"+f.fid;
c=c.replace(f.src,"")}if(e=c.match(/[- ]?[nN]ormal/))f.normal=!0,c=c.replace(e[0],"");if(e=c.match(abc2svg.ft_re))f.weight=abc2svg.ft_w[e[0].replace(/[ -]/,"").toLowerCase()],c=c.replace(e[0],"");if(e=c.match(/[- ]?[iI]talic/))f.style="italic",c=c.replace(e[0],"");if(e=c.match(/[- ]?[oO]blique/))f.style="oblique",c=c.replace(e[0],"");if(!f.src){if('"'==c[0]){e=c.indexOf('"',1);if(0>e){y(1,"No end of string in font family");return}c=c.slice(1,e)}c=c.trim();switch(c){case "":case "*":c="";break;case "Times-Roman":case "Times":c=
"serif";break;case "Helvetica":c="sans-serif";break;case "Courier":c="monospace";break;case "music":c=t.musicfont.name;break;default:0<c.indexOf("Fig")&&(f.figb=!0)}}c&&!f.name&&(f.name=c);f.size&&Hc(f);if(!f.name||!f.size){c=t[a];for(d in c)if(c.hasOwnProperty(d)&&void 0==f[d])switch(d){case "fid":case "used":case "src":break;case "style":case "weight":if(f.normal)break;default:f[d]=c[d]}f.swfac||Hc(f)}void 0==f.pad&&(f.pad=0);f.fname=f.name;700<=f.weight&&(f.fname+="Bold");t[a]=f}function Ra(a){a=
a.toLowerCase().match(/(-?[\d.]+)(.*)/);if(!a)return NaN;a[1]=+a[1];switch(a[2]){case "cm":return 37.8*a[1];case "in":return 96*a[1];case "pt":return a[1]/.75;case "px":case "":return a[1]}return NaN}function ud(a){var c=a.indexOf(" ");0<c&&(a=a.slice(0,c));return We[a]}function vd(a,c){a=a.slice(0,3);"ste"==a&&(a="stm");Yb("pos",'"'+a+" "+c+'"')}function Yb(a,c){a=[a+"=",c];3>v.state?Qb(l?l.id:"*",a):l?wd(a):Qb("*",a)}function Wa(){W.chg&&(W.chg=!1,W.lm=t.leftmargin-t.printmargin,0>W.lm&&(W.lm=0),
W.rm=t.rightmargin-t.printmargin,0>W.rm&&(W.rm=0),W.width=t.pagewidth-2*t.printmargin,100>W.width-W.lm-W.rm&&(x(0,void 0,"Bad staff width"),W.width=W.lm+W.rm+150),Wb=W.lm/t.scale)}function xd(a){var c=a.name,d="";a.weight&&(d+=a.weight+" ");a.style&&(d+=a.style+" ");0>c.indexOf('"')&&0<c.indexOf(" ")&&(c='"'+c+'"');return d+a.size.toFixed(1)+"px "+c}function Ic(a){return"font:"+xd(a)}function ob(a){var c="f"+a.fid+t.fullsvg;a.class&&(c+=" "+a.class);a.box&&(c+=" box");return c}function pb(a){a.used||
(a.used=!0,void 0==a.fid&&(a.fid=abc2svg.font_tb.length,abc2svg.font_tb.push(a),a.swfac||Hc(a),a.pad||(a.pad=0),a.cw_tb=a.name?0<a.name.indexOf("ans")?yd:0<a.name.indexOf("ono")?Xe:Ye:yd),Jc(".f"+a.fid+(t.fullsvg||"")+"{"+Ic(a)+"}"),a.src&&Jc("@font-face{\n font-family:"+a.name+";\n src:"+a.src+"}"),a==t.musicfont&&Jc(".f"+a.fid+(t.fullsvg||"")+" text,tspan{white-space:pre}"))}function la(a){a+="font";var c=t[a];if(!c)return y(1,"Unknown font $1",a),C.curfont;if(!c.name||!c.size){a=Object.create(C.deffont);
c.name&&(a.name=c.name);c.normal?(a.weight&&(a.weight=null),a.style&&(a.style=null)):(c.weight&&(a.weight=c.weight),c.style&&(a.style=c.style));c.src&&(a.src=c.src);c.size&&(a.size=c.size);var d=xd(a);c.class&&(a.class=c.class,d+=" "+c.class);c=abc2svg.font_st[d];if(void 0!=c)return abc2svg.font_tb[c];abc2svg.font_st[d]=abc2svg.font_tb.length;a.fid=a.used=void 0;c=a}pb(c);return c}function Rb(a,c){var d,e,f="";for(d=0;;){var g=a.indexOf("\\",d);if(0>g)break;f+=a.slice(d,g);d=a[++g];if(!d)return f+
"\\";switch(d){case "0":case "2":if("0"!=a[g+1])break;if(e=Ze[a[g+2]]){f+=e;d=g+3;continue}break;case "u":d=Number("0x"+a.slice(g+1,g+5));if(isNaN(d)||32>d){f+=a[++g]+"\u0306";d=g+1;continue}d=String.fromCharCode(d);if("\\"==d){g+=4;break}f+=d;d=g+5;continue;case "t":f+="\t";d=g+1;continue;case "n":f+="\n";d=g+1;continue;default:if(e=$e[a.slice(g,g+2)]){f+=e;d=g+2;continue}if((e=a[g+1])&&/[A-Za-z]/.test(e))switch(d){case "`":f+=e+"\u0300";d=g+2;continue;case "'":f+=e+"\u0301";d=g+2;continue;case "^":f+=
e+"\u0302";d=g+2;continue;case "~":f+=e+"\u0303";d=g+2;continue;case "=":f+=e+"\u0304";d=g+2;continue;case "_":f+=e+"\u0305";d=g+2;continue;case ".":f+=e+"\u0307";d=g+2;continue;case '"':f+=e+"\u0308";d=g+2;continue;case "o":f+=e+"\u030a";d=g+2;continue;case "H":f+=e+"\u030b";d=g+2;continue;case "v":f+=e+"\u030c";d=g+2;continue;case "c":f+=e+"\u0327";d=g+2;continue;case ";":f+=e+"\u0328";d=g+2;continue}}"w"==c&&(f+="\\");f+=d;d=g+1}return f+a.slice(d)}function af(a){var c;if(q.read_file)if(2<qb)y(1,
"Too many include levels");else if(c=q.read_file(a)){qb++;var d=z(v);Kc(a,c);d.state=v.state;v=d;qb--}else y(1,"Cannot read file '$1'",a);else y(1,"No read_file support")}function Kc(a,c,d,e){function f(){var a=c.indexOf("K:",d);if(0>a)return!1;a=c.indexOf("\n",a);if(v.select.test(c.slice(v.bol,a)))return!0;var f=/\n\w*\n/;f.lastIndex=a;r=f.exec(c)?f.lastIndex:e;return!1}function g(a,c){if(!a)return a;var d=a.indexOf("%");if(0==d)return"";0<d&&(a=a.replace(/([^\\])%.*/,"$1").replace(/\\%/g,"%"));
a=a.replace(/\s+$/,"");return c&&0<=a.indexOf("\\")?Rb(a,c):a}function h(){var a;ja.length&&(y(1,"Decoration(s) without symbol: $1",ja),ja=[]);v.tp&&(y(1,"No end of tuplet"),(a=v.tps)&&delete a.tp,delete v.tp);oa&&(y(1,"No end of voice overlay"),Zb(oa.bar?"|":")"));Q.voice_adj();a:{var c,d;a=E.length;var e=[],f=[];var g=L;for(d=0;d<a;d++){var h=E[d].sym;e[d]=h;if(g.voices[d]&&(f[g.voices[d].range]=d,!p&&h)){var k=h.fmt;var n=E[d];var p={type:m.STAVES,fname:v.fname,dur:0,v:d,p_v:n,time:0,st:0,sy:g,
next:h,fmt:k,seqst:!0}}}if(p){n.sym=M=h=p;h.next?h.next.prev=h:n.last_sym=h;if(h=fa.tempo)h.v=d=n.v,h.p_v=n,h.st=0,h.time=0,h.prev=p,h.next=p.next,h.next?h.next.prev=h:n.last_sym=h,h.prev.next=h,h.fmt=k,fa.tempo=null,e[d]=h;if(1==a)for(h=M,h.ts_next=h.next;;){h=h.next;if(!h)break a;if(h.time!=h.prev.time||Ha[h.prev.type]||h.type==m.GRACE&&h.prev.type==m.GRACE)h.seqst=1;if(h.type==m.PART){if(h.prev.next=h.prev.ts_next=h.next)h.next.part=h,h.next.prev=h.prev,h.soln&&(h.next.soln=1),h.seqst&&(h.next.seqst=
1)}else h.ts_prev=h.prev,h.ts_next=h.next}for(;;){if(l){g=l;var l=null;for(d=f.length=0;d<a;d++)g.voices[d]&&(f[g.voices[d].range]=d)}n=k=1E7;for(c=0;;){d=f[c++];if(void 0==d)break;!(h=e[d])||h.time>k||(g=Ha[h.type],h.type==m.GRACE&&h.next&&h.next.type==m.GRACE&&g--,h.time<k?(k=h.time,n=g):g<n&&(n=g))}if(127<n)break;if(6==n){c=void 0;d=h=void 0;for(g=0;;){var r=f[g++];if(void 0==r)break;if((h=e[r])&&h.bar_type&&!h.invis&&h.time==k)if(d){if(h.bar_type!=d)break;if(h.text&&!c&&"|"==d){c=h.text;break}}else d=
h.bar_type,h.text&&"|"==d&&(c=h.text)}if(!A)for(;p.type==m.GRACE&&e[p.v]&&!e[p.v].bar_type;){e[p.v]=p;p=p.ts_prev;var A=1}if(void 0!=r)if("::"==d||":|"==d||c)for(g=0,d=c?"|":"::";;){r=f[g++];if(void 0==r)break;!(h=e[r])||h.invis||h.bar_type!=d||"|"==d&&!h.text||(c=z(h),"::"==d?(h.bar_type=":|",c.bar_type="|:"):(delete h.text,delete h.rbstart,c.bar_type="[",c.invis=1,c.xsh=0),c.next=h.next,c.next&&(c.next.prev=c),c.prev=h,h.next=c)}else x(1,h,"Different bars $1 and $2",d+(c||""),h.bar_type+(h.text||
""))}for(c=0;;){d=f[c++];if(void 0==d)break;if((h=e[d])&&h.time==k&&(g=Ha[h.type],!g&&h.type==m.GRACE&&h.next&&h.next.type==m.GRACE&&g--,g==n))if(g||h.type!=m.PART)h.type==m.STAVES&&(l=h.sy),A&&(A=0,h.seqst=!0),h.ts_prev=p,p=p.ts_next=h,e[d]=h.next;else if(h.prev?h.prev.next=h.next:h.p_v.sym=h.next,e[d]=h.next)h.next.part=h,h.next.prev=h.prev,h.soln&&(h.next.soln=1)}n&&(A=1)}}}if(M){for(p=0;p<E.length;p++)E[p].key||(E[p].key=v.ckey);q.anno_start&&(wa=bf);q.anno_stop&&(Ab=cf);Q.set_bar_num();N.P&&
(M.parts=N.P);q.get_abcmodel&&q.get_abcmodel(M,E,abc2svg.sym_name,N);q.img_out&&Q.output_music()}Wa();N.W&&df(N.W);A=t.infoname.split("\n");l=A.length;for(p=0;p<l;p++)if(a=A[p][0],!(0>t.writefields.indexOf(a))&&(a=N[a])){if(!u){var u=!0;ea("history");ma(t.textspace);var D=C.curfont.size*t.lineskipfac}f=A[p].slice(2);'"'==f[0]&&(f=f.slice(1,-1));ma(D);e=qa(f);T(0,.22*e[1],f,null,null,e);k=e[0];a=a.split("\n");T(k,.22*e[1],a[0]);for(f=1;f<a.length;f++)a[f]?(ma(D),T(k,.22*e[1],a[f])):ma(C.curfont.size*
t.parskipfac);ma(D*t.parskipfac);pb(C.curfont)}v.state=0;Xa();M&&(Lc.push([M,E,N,t]),M=null);t=Fa.cfmt;N=Fa.info;Ja=Fa.char_tb;fa=Fa.glovar;rb=Fa.maps;Ya=Fa.mac;$b=Fa.maci;v.tune_v_opts=null;v.scores=null;v.ufmt=!1;delete v.pq;zd();W.chg=!0;Wa()}function n(a,d){if("end"!=a){d?(v.tune_v_opts||(v.tune_v_opts={}),d=v.tune_v_opts):(v.voice_opts||(v.voice_opts={}),d=v.voice_opts);for(d[a]=[];;){var e=++r;if("%"!=c[e])break;r=c.indexOf("\n",r);if(c[e+1]==Y){e+=2;w=0>r?c.slice(e):c.slice(e,r);A=w.match(/\S+/);
switch(A[0]){default:d[a].push(g(w,!0));continue;case "score":case "staves":case "tune":case "voice":e-=2}break}}r=v.eol=e-1}}function k(){var a,e=c.indexOf("K:",d);e=c.indexOf("\n",e);var f=c.slice(v.bol,e);for(e in v.tune_opts)if(v.tune_opts.hasOwnProperty(e)&&(new RegExp(e)).test(f)){var g=v.tune_opts[e];for(a=0;a<g.t_opts.length;a++){var h=g.t_opts[a];switch(h.match(/\S+/)[0]){case "score":case "staves":v.scores||(v.scores=[]);v.scores.push(h);break;default:Q.do_pscom(h)}}if(g=g.v_opts)for(a in g)g.hasOwnProperty(a)&&
(v.tune_v_opts||(v.tune_v_opts={}),v.tune_v_opts[a]=v.tune_v_opts[a]?v.tune_v_opts[a].concat(g[a]):g[a])}}var A,p="\n";if(abc2svg.mhooks)for(l in abc2svg.mhooks)Ad[l]||(Ad[l]=1,abc2svg.mhooks[l](Q));v.file=c;v.fname=a;void 0==d&&(d=0);e||(e=c.length);for("%abc-"==c.slice(d,d+5)&&(t["abc-version"]=/[1-9.]+/.exec(c.slice(d+5,d+10)));d<e;d=v.eol+1){var r=c.indexOf("\n",d);if(0>r||r>e)r=e;for(v.eol=r;;){r--;switch(c[r]){case " ":case "\t":continue}break}r++;if(r==d)1==v.state?(v.istart=d,y(1,"Empty line in tune header - ignored")):
2<=v.state&&(h(),v.state=0,v.select&&(r=c.indexOf("\nX:",v.eol),0>r&&(r=e),v.eol=r));else{v.istart=v.bol=d;v.iend=r;v.line.index=0;var l=c[d];var Y=c[d+1];if("I"==l&&":"==Y||"%"==l){if("%"==l&&0>v.prefix.indexOf(Y))continue;if("a"==c[d+2]&&"b"==c[d+3]&&"c"==c[d+4]&&" "==c[d+5])d+=6,l=c[d],Y=c[d+1];else var u=!0}if(u){u=!1;d+=2;var w=c.slice(d,r);if((A=w.match(/([^\s]+)\s*(.*)/))&&"%"!=A[1][0]){switch(A[1]){case "abcm2ps":case "ss-pref":v.prefix=A[2];continue;case "abc-include":af(g(A[2]));continue}if("begin"==
A[1].slice(0,5)){a=A[1].substr(5);var nd="\n"+l+Y+"end"+a;l=c.indexOf(nd,r);0>l?(y(1,"No $1 after %%$2",nd.slice(1),A[1]),v.eol=e):(Q.do_begin_end(a,g(A[2]),c.slice(r+1,l).replace(/\n%[^%].*$/gm,"").replace(/^%%/gm,"")),v.eol=c.indexOf("\n",l+6),0>v.eol&&(v.eol=e))}else{switch(A[1]){case "select":if(0!=v.state){y(1,I.not_in_tune,"%%select");continue}l=g(w.slice(7));'"'==l[0]&&(l=l.slice(1,-1));if(!l){delete v.select;continue}l=l.replace(/\(/g,"\\(");l=l.replace(/\)/g,"\\)");v.select=new RegExp(l,
"m");continue;case "tune":if(0!=v.state){y(1,I.not_in_tune,"%%tune");continue}l=g(A[2]);if(!l){v.tune_opts={};continue}if("end"==l)continue;v.tune_opts||(v.tune_opts={});for(v.tune_opts[l]=l={t_opts:[]};;){d=r;if("%"!=c[d+1])break;r=c.indexOf("\n",r+1);if(c[d+2]==Y){w=c.slice(d+3,0>r?void 0:r);A=w.match(/([^\s]+)\s*(.*)/);switch(A[1]){case "tune":break;case "voice":n(g(A[2],!0),!0);continue;default:l.t_opts.push(g(w,!0));continue}break}}v.tune_v_opts&&(l.v_opts=v.tune_v_opts,v.tune_v_opts=null);v.eol=
d;continue;case "voice":if(0!=v.state){y(1,I.not_in_tune,"%%voice");continue}l=g(A[2]);if(!l){v.voice_opts=null;continue}n(l);continue}Q.do_pscom(g(w,!0))}}}else if(":"==Y&&/[A-Za-z+]/.test(l)){for(d+=2;;){switch(c[d]){case " ":case "\t":d++;continue}break}if("+"==l){if(!B){y(1,"+: without previous info field");continue}p=" ";l=B}w=g(c.slice(d,r),l);switch(l){case "X":if(0!=v.state){y(1,I.ignored,l);continue}if(v.select&&!f()){r=c.indexOf("\nX:",v.eol);0>r&&(r=e);v.eol=r;continue}Fa.cfmt=z(t);Fa.info=
z(N,2);Fa.char_tb=z(Ja);Fa.glovar=z(fa);Fa.maps=z(rb,1);Fa.mac=z(Ya);Fa.maci=z($b);N.X=w;v.state=1;q.page_format&&1>xa&&(xa=1);v.tune_opts&&k();continue;case "T":switch(v.state){case 0:continue;case 1:case 2:N.T=void 0==N.T?w:N.T+("\n"+w);continue}l=$a("title");l.text=w;continue;case "K":switch(v.state){case 0:continue;case 1:N.K=w}Mc(l,w);continue;case "W":if(0==v.state||0>t.writefields.indexOf(l))break;N.W=void 0==N.W?w:N.W+(p+w);break;case "m":if(2<=v.state){y(1,I.ignored,l);continue}A=w.match(/(.*?)[= ]+(.*)/);
if(!A||!A[2]){y(1,I.bad_val,"m:");continue}Ya[A[1]]=A[2];$b[A[1][0]]=!0;break;case "s":if(3!=v.state||0>t.writefields.indexOf(l))break;ef(w," "==p);break;case "w":if(3!=v.state||0>t.writefields.indexOf(l))break;ff(w," "==p);break;case "|":if(2>v.state)continue;v.line.buffer=w;Bd();continue;default:if(0<="ABCDFGHNOSZ".indexOf(l)){if(2<=v.state){y(1,I.ignored,l);continue}N[l]=N[l]?N[l]+(p+w):w}else{Mc(l,w);continue}}p="\n";var B=l}else B=void 0,2>v.state||(v.line.buffer=g(c.slice(d,r)),v.line.buffer&&
Bd())}}qb||(1==v.state&&(y(1,"End of file in tune header"),Cd("C")),2<=v.state&&h(),v.state=0)}function cc(a,c){var d=0,e=c;0!=e%12&&x(1,a,"Invalid note duration $1",e);(e/=12)||x(1,a,"Note too short");for(c=5;e&&!(e&1);e>>=1,c--);for(e>>=1;0<e>>d;)d++;c-=d;if(0<=c)a=m.FULL;else switch(c){default:x(1,a,"Note too long"),c=-4;case -4:a=m.SQUARE;break;case -3:a=a.fmt.squarebreve?m.SQUARE:m.OVALBARS;break;case -2:a=m.OVAL;break;case -1:a=m.EMPTY}return[a,d,c]}function Dd(a){var c,d=a.stem;if(c=a.nhd){var e=
.74*Ed[a.head];a.grace&&(e*=.6);if(0<=d){var f=1;var g=c+1;c=a.notes[0].pit}else e=-e,f=c-1,g=-1,c=a.notes[c].pit;for(var h=!1,n=0;f!=g;f+=d){var k=a.notes[f].pit-c;c=a.notes[f].pit;if(!k){if(h){k=a.notes[f].shhd=a.notes[f-d].shhd+e;n<k&&(n=k);continue}if(f+d!=g&&c+d==a.notes[f+d].pit){a.notes[f].shhd=-e;n<-e&&(n=-e);continue}}0>k&&(k=-k);if(3<k||2<=k&&a.head!=m.SQUARE)h=!1;else if(h=!h)a.notes[f].shhd=e,n<e&&(n=e)}a.xmx=n}}function Fd(a,c){var d,e,f,g,h=a.length;for(d=h-1;0<=--d;)if((g=a[d].shhd)&&
!(0<g)){g=c-g;var n=a[d].pit;for(e=h;0<=--e;)if(a[e].acc){var k=a[e].pit;if(k<n-3)break;!(k>n+3)&&a[e].shac<g&&(a[e].shac=g)}}for(e=h;0<=--e;)if(a[e].acc){k=a[e].pit;var m=a[e].shac;m||(m=a[e].shhd,m=0>m?c-m:c);break}if(!(0>e)){for(f=0;f<e;f++)if(a[f].acc){n=a[f].pit;var p=a[f].shac;p||(p=a[f].shhd,p=0>p?c-p:c);break}if(e==f)a[e].shac=m;else for(k>n+4?(m>p&&(p=m),a[e].shac=a[f].shac=p):(a[e].shac=m,a[e].pit!=a[f].pit&&(m+=7),a[f].shac=p=m),p+=7,d=e;--d>f;)if(c=a[d].acc){g=a[d].shac;g<p&&(g=p);n=a[d].pit;
for(e=h;--e>d;)a[e].acc&&(k=a[e].pit,!(k>=n+4&&(k>n+4||0>c||0>a[e].acc))&&g>a[e].shac-6&&(m=a[e].shac+7,m>g&&(g=m)));a[d].shac=g}}}function Nc(a,c){a.next=c;a.prev=c.prev;a.prev?a.prev.next=a:a.p_v.sym=a;c.prev=a}function ac(a,c){(a.ts_next=c)?(a.ts_prev=c.ts_prev,a.ts_prev&&(a.ts_prev.ts_next=a),c.ts_prev=a):(x(2,a,"Bad linkage"),a.ts_prev=null);a.seqst=!a.ts_prev||a.time!=a.ts_prev.time||Ha[a.ts_prev.type]!=Ha[a.type]&&!!Ha[a.ts_prev.type];c&&!c.seqst&&(c.seqst=c.time!=a.time||Ha[a.type]!=Ha[c.type]&&
!!Ha[a.type],c.seqst&&(a=c.wl,Q.set_width(c),c.a_ly&&Oc(c),c.shrink?c.shrink+=c.wl-a:(c.shrink=c.wl,c.prev&&(c.shrink+=c.prev.wr)),c.space=0))}function gb(a){a.next&&(a.next.prev=a.prev);a.prev?a.prev.next=a.next:a.p_v.sym=a.next;a.ts_next&&(a.seqst?a.ts_next.seqst?(a.ts_next.shrink+=a.shrink,a.ts_next.space+=a.space):(a.ts_next.seqst=!0,a.ts_next.shrink=a.shrink,a.ts_next.space=a.space):a.ts_next.seqst&&a.ts_prev&&a.ts_prev.seqst&&!Ha[a.ts_prev.type]&&(a.ts_next.seqst=!1,a.shrink=a.ts_next.shrink,
a.space=a.ts_next.space),a.ts_next.ts_prev=a.ts_prev);a.ts_prev&&(a.ts_prev.ts_next=a.ts_next);M==a&&(M=a.ts_next);sa==a&&(sa=a.ts_next)}function Gd(a,c,d){var e=a.p_v,f=a.st;a.type==m.BAR&&a.prev&&a.prev.type==m.BAR&&":"!=a.prev.bar_type[0]&&(a=a.prev);e.last_sym=a.prev;e.last_sym||(e.sym=null);e.time=a.time;e=Hd(e,m.CLEF);e.next=a;a.prev=e;e.clef_type=c;e.clef_line=d;e.st=f;e.clef_small=!0;delete e.second;e.notes=[];e.notes[0]={pit:a.notes[0].pit};for(e.nhd=0;!a.seqst;)a=a.ts_prev;ac(e,a);a.soln&&
(e.soln=!0,delete a.soln);return e}function Id(a,c,d){var e,f=0;for(e=0;e<a.a_gch.length;e++){var g=a.a_gch[e];switch(g.type){case "<":g=g.text.wh[0]+c;g>d&&(d=g);break;case ">":g=g.text.wh[0]+a.wr,g>f&&(f=g)}}a.wr<f&&(a.wr=f);return d}function Jd(a,c){Pc>=m.BLEN/2?c=Pc>=m.BLEN?c/4:c/2:!a.next&&c>=m.BLEN&&(c/=2);a=c>=m.BLEN/4?c<m.BLEN/2?5:c<m.BLEN?6:c<2*m.BLEN?7:c<4*m.BLEN?8:9:c>=m.BLEN/8?4:c>=m.BLEN/16?3:c>=m.BLEN/32?2:c>=m.BLEN/64?1:0;var d=c-(m.BLEN/16/8<<a);var e=t.spatab[a];d&&(0>d?e=t.spatab[0]*
c/(m.BLEN/16/8):(9<=a&&(a=8),e+=(t.spatab[a+1]-t.spatab[a])*d/(m.BLEN/16/8<<a)));return e}function gf(a,c){var d;var e=a.time-c;if(!e){switch(a.type){case m.MREST:return a.wl}return 0}if(a.ts_prev.type==m.MREST)return 71;for(d=Jd(a,e);!a.dur;){switch(a.type){case m.BAR:return a.next||(d*=.9),.9*d-3;case m.CLEF:return d-a.wl-a.wr;case m.BLOCK:case m.REMARK:case m.STAVES:case m.TEMPO:a=a.ts_next;if(!a)return d;continue}break}if(a.dur&&e<=m.BLEN/4)for(e=a;e;){if(!e.beam_st){d*=.9;break}e=e.ts_next;if(!e||
e.seqst)break}if(a.type==m.NOTE&&-1<=a.nflags&&0<a.stem){var f=!0;for(e=a.ts_prev;e&&e.time==c;e=e.ts_prev)if(e.type==m.NOTE&&(-1>e.nflags||0<e.stem)){f=!1;break}if(f){for(e=a.ts_next;e&&e.time==a.time;e=e.ts_next)if(e.type==m.NOTE&&(-1>e.nflags||0>e.stem)){f=!1;break}f&&(d*=.9)}}return d}function Kd(a,c){for(var d=a.time,e=c.time-d,f=Jd(a,e),g=a,h=0;g=g.ts_next,g.seqst&&(h+=g.space,g.bar_type&&(h+=10)),g!=c;);for(f=(f+h)/2/e;a=a.ts_next,a.seqst&&(a.space=f*(a.time-d),d=a.time),a!=c;);}function Cc(a){return{type:m.BAR,
bar_type:"|",fname:a.fname,istart:a.istart,iend:a.iend,v:a.v,p_v:a.p_v,st:a.st,dur:0,time:a.time+(a.dur||0),nhd:0,notes:[{pit:a.notes?a.notes[0].pit:22}],seqst:!0,invis:!0,prev:a,fmt:a.fmt}}function Ld(a){for(var c,d,e,f,g=M,h=g,n=0,k=[],l=[],p=n,r=g.time;;){f=0;do!g.a_gch&&!g.a_ly||d||(d=g),Q.set_width(g),c=g.st,void 0==k[c]&&(k[c]=0),void 0==l[c]&&(l[c]=0),g.prev&&g.prev.st!=c&&(k[c]=k[g.prev.st],l[c]=l[g.prev.st]),c=k[c]+l[c]+g.wl,c>p&&(p=c),g.dur&&g.dur!=g.notes[0].dur&&a&&(f=1),g=g.ts_next;while(g&&
!g.seqst);h.shrink=p-n;h.space=h.ts_prev?gf(h,r):0;0==h.space&&h.ts_prev&&h.ts_prev.type==m.SPACE&&h.ts_prev.seqst&&(h.space=h.ts_prev.space/=2);f?e||(e=h):e&&e.v==h.v&&(Kd(e,h),e=null);h.shrink||(h.type!=m.CLEF||h.ts_prev.bar_type?h.shrink=10:(delete h.seqst,h.time=r));r=h.time;if(!g)break;g=h;do l[g.st]=0,g=g.ts_next;while(!g.seqst);n=p;do c=h.st,k[c]=n,h.wr>l[c]&&(l[c]=h.wr),h=h.ts_next;while(!h.seqst)}e&&Kd(e,h);if(a&&d){a=d;var D;g=f=0;for(ea("vocal");a;a=a.ts_next)if(a.shrink&&(f+=a.shrink,
g++),a.a_ly&&Oc(a),a.a_gch)for(e=0;e<a.a_gch.length;e++)if(d=a.a_gch[e],!("g"!=d.type||0>d.y)){if(D&&D>f+d.x)for(a.prev&&a.prev.seqst&&a.prev.type==m.BAR&&g--,D=(D-f-d.x)/g;;){var Y=Y.ts_next;Y.shrink&&(Y.shrink+=D);if(Y==a||Y.type==m.BAR)break}Y=a;D=d.text.wh[0];f=g=0;break}}}function jc(a){var c=z(a);c.prev.next=a.ts_prev=a.prev=c.ts_prev.ts_next=c;c.next=c.ts_next=a;a.seqst=!1;a.invis=a.play=!0;c.type=m.REST;delete c.in_tuplet;delete c.tp;delete c.a_dd;delete c.a_gch;delete c.sls;return c}function hf(a){var c,
d,e,f=a.repeat_n,g=a.repeat_k,h=a.st,n=a.v;a.repeat_n=0;if(0>f){var k=f=-f;for(d=a.prev;d;d=d.prev)if(!d.dur){if(d.type==m.BAR){x(1,d,"Bar in repeat sequence");return}}else if(0>=--k)break;if(d){var l=a.time-d.time;k=g*f;for(c=a;c;c=c.next)if(!c.dur){if(c.type==m.BAR){x(1,c,"Bar in repeat sequence");return}}else if(0>=--k)break;if(c&&c.next){for(c=a.prev;c!=d;c=c.prev)if(c.type==m.NOTE){c.beam_end=!0;break}for(e=g;0<=--e;){k=f;a.dur&&k--;for(c=a.ts_next;0<k;)c.st==h&&(c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&
(c.seqst=!1),c.v==n&&c.dur&&k--),c=c.ts_next;a=jc(a);a.dur=a.notes[0].dur=l;a.rep_nb=-1;a.beam_st=!0;Q.set_width(a);a.head=m.SQUARE;for(a=c;a&&(a.st!=h||a.v!=n||!a.dur);a=a.ts_next);}}else x(1,a,I.not_enough_n)}else x(1,a,I.not_enough_n)}else{k=f;for(c=a.prev.prev;c&&(c.type!=m.BAR&&c.time!=M.time||!(0>=--k));c=c.prev);if(c){l=a.time-c.time;k=1==f?g:f;for(c=a;c&&!(c.type==m.BAR&&0>=--k);c=c.next);if(c){k=g;if(2==f&&1<k){c=c.next;if(!c){x(1,a,I.not_enough_m);return}c.repeat_n=f;c.repeat_k=--k}l/=f;
if(2==f){for(c=a.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==m.BAR){if(c.v==n)break}else c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1);d=jc(a);d.dur=d.notes[0].dur=l;d.invis=!0;c.bar_mrep=2;d=c.next;for(c=d.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==m.BAR){if(c.v==n)break}else c.dur&&(c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1));d=jc(d);d.dur=d.notes[0].dur=l;d.invis=!0;Q.set_width(d)}else for(d=a,e=g;0<=--e;){for(c=d.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==m.BAR){if(c.v==
n)break}else c.dur&&(c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1));d=jc(d);d.dur=d.notes[0].dur=l;d.beam_st=!0;if(1==g){d.rep_nb=1;break}d.rep_nb=g-e+1;d=c.next}}else x(1,a,I.not_enough_m)}else x(1,a,I.not_enough_m)}}function kc(a){function c(a){if(t.custos&&1==E.length)a:{for(var c=a,d,e=c;e.type!=m.NOTE;)if(e=e.next,!e)break a;d=c.p_v;d.last_sym=c.prev;d.time=c.time;d=Hd(d,m.CUSTOS);d.next=c;c.prev=d;d.wl=0;d.wr=4;ac(d,c);d.shrink=c.shrink;12>d.shrink&&(d.shrink=12);d.space=e.space;
d.head=m.FULL;d.stem=e.stem;d.nhd=e.nhd;d.notes=[];for(c=0;c<e.notes.length;c++)d.notes[c]={pit:e.notes[c].pit,shhd:0,dur:m.BLEN/4};d.stemless=!0}a.nl=!0;a=a.ts_prev;a.type!=m.BAR&&(e=Cc(a),c=a.ts_next,e.wl=0,e.wr=0,e.ts_prev=a,e.next=a.next,e.ts_next=a.ts_next,e.shrink=a.type==m.STBRK?0:a.wr+3,a.next&&(a.next.prev=e),a.ts_next.ts_prev=e,a.next=a.ts_next=e,e.space=.9*c.space-3)}var d;a=function(a){function c(a){a=a.bar_type.match(/(:*)([^:]*)(:*)/);a[3]?a[1]?(r=a[2].length/2|0,l=a[1]+"|"+a[2].slice(0,
r),p=a[2].slice(r)+"|"+a[3]):(l="||",p="[|"+a[3]):(l=a[1]+a[2],p="[")}function d(a,c,d){var e;for(e=c.ts_prev;e.time==a.time;e=e.ts_prev)if(e.v==a.v){if(e.bar_type){if("|"!=e.bar_type)return;var f=e;break}if(!g)var g=e.next}if(!f){f=z(a);g||(g=a);f.next=g;f.prev=g.prev;f.prev&&(f.prev.next=f);g.prev=f;f.ts_prev=c.ts_prev;f.ts_prev.ts_next=f;f.ts_next=c;c.ts_prev=f;a==d&&(f.seqst=1);if(f.seqst){for(a=f.ts_next;!a.seqst;a=a.ts_next);f.shrink=a.shrink;a.shrink=f.wr+a.wl;f.space=a.space;a.space=0}delete f.part}f.bar_type=
"||"}var e,f,l,p,r;for(e=a;e&&e.time==a.time;){if(e.bar_type&&":"==e.bar_type.slice(-1)){var D=e;break}e=e.ts_next}if(D){for(e=D;d(D,a,e),D=D.ts_next,D&&!D.seqst;);return a}for(e=a;e.ts_prev&&e.ts_prev.time==a.time;)e=e.ts_prev,e.bar_type?f=e:!f&&e.type==m.GRACE&&e.seqst&&(a=e);if(!f||!f.bar_type||":"!=f.bar_type.slice(-1)&&!f.text)return a;for(a=f;a.time==f.time;a=a.ts_prev){switch(a.ts_prev.type){case m.KEY:case m.METER:case m.TEMPO:case m.STAVES:case m.STBRK:continue}break}for(e=f;;){c(f);D=z(f);
D.bar_type=l;f.bar_type=p;D.ts_prev=a.ts_prev;D.ts_prev.ts_next=D;D.ts_next=a;a.ts_prev=D;f==e&&(D.seqst=1);D.next=f;D.prev&&(D.prev.next=D);f.prev=D;f.rbstop&&(D.rbstop=f.rbstop);f.text&&(f.invis=1,delete f.xsh,delete D.text,delete D.rbstart);delete D.part;delete f.a_dd;delete f.a_gch;do f=f.ts_next;while(!f.seqst&&!f.bar_type);if(f.seqst)break}return a}(a);(function(a){var c,d,e;for(d=a;d&&d.time==a.time;d=d.ts_next){switch(d.type){case m.KEY:if(!a.fmt.keywarn||d.invis)continue;for(c=a.ts_prev;c&&
c.type==m.METER;c=c.ts_prev);case m.METER:if(d.type==m.METER){if(!a.fmt.timewarn)continue;c=a.ts_prev}case m.CLEF:if(!d.prev)continue;if(d.type==m.CLEF){if(d.invis)break;for(c=a.ts_prev;c;c=c.ts_prev){switch(c.type){case m.BAR:if(":"==c.bar_type[0])break;case m.KEY:case m.METER:continue}break}}var f=z(d);ac(f,c.ts_next);for(c=f;c=c.ts_next,c.v!=d.v;);Nc(f,c);if(f.seqst){Q.set_width(f);f.shrink=f.wl;var l=f.ts_prev;for(e=0;;){l.wr>e&&(e=l.wr);if(l.seqst)break;l=l.ts_prev}f.shrink+=e;f.space=0;for(l=
f;!l.ts_next.seqst;)l=l.ts_next;for(e=0;l.wl>e&&(e=l.wl),l=l.ts_next,!l.seqst;);l.shrink=f.wr+e}delete f.part;continue}if(Ha[d.type])break}})(a);if(a.ts_prev.type!=m.STAVES)return c(a),a;for(a=a.ts_prev;a&&(!a.seqst||a.type==m.CLEF);a=a.ts_prev);var e=0;for(d=a.type;;a=a.ts_next){if(!a)return a;if(a.type!=d){d=a.type;if(0>e)break;switch(a.type){case m.STAVES:if(!a.ts_prev)return;if(a.ts_prev.type==m.BAR)break;for(;a.ts_next&&(!Ha[a.ts_next.type]||a.ts_next.type==m.CLEF);)a=a.ts_next;if(!a.ts_next||
a.ts_next.type!=m.BAR)continue;a=a.ts_next;case m.BAR:if(e)break;e=1;continue;case m.STBRK:a.stbrk_forced?e=-1:gb(a);continue;case m.CLEF:if(e)break;continue;default:if(!e||a.prev&&a.prev.type==m.GRACE)continue}break}}c(a);return a}function Md(){var a=E[0];Q.set_width(a.clef);Q.set_width(a.ckey);Q.set_width(a.meter);return[a.clef.wl+a.clef.wr+a.ckey.wl+a.ckey.wr,a.meter.wl+a.meter.wr]}function Nd(a,c){for(var d,e,f=0,g=0,h=1-a.fmt.maxshrink;a!=c;)a.seqst&&(d=a.shrink,g+=d,f=(e=a.space)<d?f+d:f+(d*
a.fmt.maxshrink+e*h),a.x=f),a=a.ts_next;c&&(g+=c.wr);return[f,g]}function Qc(a){switch(a.type){case m.CLEF:if(a.second||a.invis){a.ymx=a.ymn=12;break}a.y=6*(a.clef_line-1);switch(a.clef_type){default:a.ymx=a.y+28;a.ymn=a.y-14;break;case "c":a.ymx=a.y+13;a.ymn=a.y-11;break;case "b":a.ymx=a.y+7,a.ymn=a.y-12}a.clef_small&&(a.ymx-=2,a.ymn+=2);26>a.ymx&&(a.ymx=26);-1<a.ymn&&(a.ymn=-1);a.clef_octave&&(0<a.clef_octave?a.ymx+=12:a.ymn-=12);break;case m.KEY:a.ymx=2<a.k_sf?34:0<a.k_sf?30:26;a.ymn=-2;break;
default:a.ymx=24,a.ymn=0}}function jf(){function a(a,c){var d,e;switch(a.type){case m.REST:if(1==E.length)break;case m.NOTE:if(!a.p_v.ckey.k_drum)for(e=a.nhd;0<=e;e--){var f=a.notes[e];f.opit||(f.opit=f.pit);f.pit+=c}break;case m.GRACE:for(d=a.extra;d;d=d.next)if(!a.p_v.ckey.k_drum)for(e=0;e<=d.nhd;e++)f=d.notes[e],f.opit||(f.opit=f.pit),f.pit+=c}}function c(a){for(var c=a.a_dd.length;0<=--c;)a.a_dd[c].name.match(/1?[85][vm][ab]/)&&a.a_dd.splice(c,1)}var d,e,f,g=new Int8Array(R+1);for(d=M;d;d=d.ts_next){var h=
d.st;if(f=d.ottava){if(f[0]){if(g[h]&&!f[1]){a(d,g[h]);c(d);continue}}else if(!g[h]){c(d);continue}for(e=d;e&&!e.seqst;)e=e.ts_prev;if(e)for(;e!=d;)e.st==h&&(f[1]&&a(e,-g[h]),f[0]&&a(e,7*-f[0])),e=e.ts_next;g[h]=f[0]?7*-f[0]:0}g[h]&&a(d,g[h])}}function Od(a,c,d){var e;var f=12;var g=20;for(e=c;e&&(e.type!=m.STAVES||e==c);e=e.ts_next)if(e.st==a)if(e.type!=m.NOTE){if(e.type==m.CLEF){if("a"!=e.clef_type)break;gb(e)}}else e.notes[0].pit<g&&(g=e.notes[0].pit),e.notes[e.nhd].pit>f&&(f=e.notes[e.nhd].pit);
if(19<=g||13<=g&&"b"!=d)return"t";if(13>=f||19>=f&&"t"!=d)return"b";"a"==d&&(d=16<=(f+g)/2?"t":"b");g=d;var h=e,n=null;for(e=c;e!=h&&(e.type!=m.STAVES||e==c);e=e.ts_next)if(e.st==a&&e.type==m.NOTE){var k=e.time;if("t"==g){if(12<e.notes[0].pit||20<e.notes[e.nhd].pit){20<e.notes[0].pit&&(n=e);continue}if((f=e.ts_prev)&&f.time==k&&f.st==a&&f.type==m.NOTE&&19<=f.notes[0].pit)continue;if((f=e.ts_next)&&f.st==a&&f.time==k&&f.type==m.NOTE&&19<=f.notes[0].pit)continue}else{if(12>=e.notes[0].pit||20>e.notes[e.nhd].pit){12>=
e.notes[e.nhd].pit&&(n=e);continue}if((f=e.ts_prev)&&f.time==k&&f.st==a&&f.type==m.NOTE&&13>=f.notes[0].pit)continue;if((f=e.ts_next)&&f.st==a&&f.time==k&&f.type==m.NOTE&&13>=f.notes[0].pit)continue}if(n){k=e;for(f=e.ts_prev;f!=n;f=f.ts_prev)if(f.st==a){if(f.type==m.BAR){k=":"!=f.bar_type[0]?f:f.next;break}f.type==m.NOTE&&f.beam_st&&!f.p_v.second&&(k=f)}k.time==n.time?n=e:(n=e,g="t"==g?"b":"t",f=Gd(k,g,"t"==g?2:4),f.clef_auto=!0)}else g=d="t"==g?"b":"t",n=e}return d}function kf(){function a(a){return 0<
a?6*Math.ceil(a/6):6*-Math.ceil(-a/6)}function c(){var c=n.dots?15:10;n.notes[0].shhd=c;n.xmx=c;k=(k+h.d)/2;k=a(k);n.y+=k;n.ymx+=k;n.ymn+=k;h.d=0}var d,e,f=[],g=L;for(d=M;d;d=d.ts_next)if(!d.invis){switch(d.type){case m.STAVES:g=d.sy;default:continue;case m.REST:if(d.invis||!d.multi)continue;var h=f[d.v];if(!h)f[d.v]=h={d:0};else if(h.d){var n=h.s;var k=a(h.d);n.y+=k;n.ymx+=k;n.ymn+=k;h.d=0}k=0<d.multi?0:24;d.prev&&d.prev.type==m.NOTE?k=d.next&&d.next.type==m.NOTE?(d.prev.y+d.next.y)/2:d.prev.y:d.next&&
d.next.type==m.NOTE?k=d.next.y:d.prev&&d.prev.type==m.REST&&(k=d.prev.y);0<d.multi?12<=k&&(h.d=k-d.y):12>=k&&(h.d=k-d.y);h.s=d;h.st=d.st;h.end_time=d.time+d.dur;d.fmr&&(h.end_time-=.3*d.p_v.wmeasure);if(d.seqst)continue;n=d.ts_prev;if(n.st!=d.st||n.invis)continue;k=n.ymn;f[n.v]&&f[n.v].d&&f[n.v]>=d.time&&(k+=f[n.v].d);if(d.ymx<=k)continue;if(n.type==m.NOTE){h.d=k-d.ymx;break}n.type==m.REST&&18>n.y&&6<=d.y&&(h.d=(k-d.ymx)/2);break;case m.NOTE:if(d.invis||!d.multi)continue}for(e=0;e<f.length;e++)if((h=
f[e])&&h.st==d.st&&e!=d.v&&!(h.end_time<=d.time)){n=h.s;if(g.voices[e].range>g.voices[d.v].range){if(n.ymx+h.d<=d.ymn)continue;k=d.ymn-n.ymx;d.type==m.REST?(f[d.v]||(f[d.v]={d:0}),6>f[d.v].d&&(f[d.v].d=6),k=-6):(k/=2,n.fmr&&(k-=6));if(h.d){if(0<h.d){c();continue}if(k>=h.d)continue}}else{if(n.ymn+h.d>=d.ymx)continue;k=d.ymx-n.ymn;d.type==m.REST&&n==d.ts_prev&&d.y==n.y?(f[d.v]||(f[d.v]={d:0}),-6<f[d.v].d&&(f[d.v].d=-6),k=6):n.time<d.time&&(k=d.ymx-n.y);if(h.d){if(0>h.d){c();continue}if(k<=h.d)continue}}h.d=
k}}for(e=0;e<f.length;e++)(h=f[e])&&h.d&&(n=h.s,k=a(h.d),n.y+=k,n.ymx+=k,n.ymn+=k)}function lc(a,c,d){a.p_v=c;a.v=c.v;a.st=c.st;a.time=d.time;c.last_sym&&(a.next=c.last_sym.next,a.next&&(a.next.prev=a),c.last_sym.next=a,a.prev=c.last_sym);c.last_sym=a;ac(a,d)}function lf(){var a,c,d=E.length,e=M.fmt;for(c=0;c<d;c++)if(L.voices[c]){var f=E[c];f.st=L.voices[c].st;f.second=L.voices[c].second;for(a=f.last_sym=f.sym;a&&a.time==M.time;a=a.next){switch(a.type){case m.CLEF:case m.KEY:case m.METER:switch(a.type){case m.CLEF:w[a.st].clef=
a;break;case m.KEY:a.p_v.ckey=a;break;case m.METER:a.p_v.meter=a,mc=0<=t.writefields.indexOf("M")&&a.a_meter.length}a.part&&(a.next.part=a.part);gb(a);case m.TEMPO:case m.BLOCK:case m.REMARK:continue}break}}var g=M;for(c=0;c<d;c++)if(f=E[c],L.voices[c]&&(!L.voices[c].second||f.bar_start)){var h=L.voices[c].st;w[h]&&w[h].clef&&(a=z(w[h].clef),a.v=c,a.p_v=f,a.st=h,a.time=M.time,a.prev=null,a.next=f.sym,a.next&&(a.next.prev=a),f.sym=f.last_sym=a,a.ts_next=g,a.ts_prev=g?g.ts_prev:null,a.ts_prev?(a.ts_prev.ts_next=
a,delete a.seqst):M=a,g&&(g.ts_prev=a),delete a.clef_small,delete a.part,a.second=L.voices[c].second,L.st_print[h]?a.clef_none||delete a.invis:a.invis=!0,a.fmt=e)}for(c=0;c<d;c++)L.voices[c]&&!L.voices[c].second&&L.st_print[L.voices[c].st]&&(f=E[c],h=f.ckey,h.k_sf||h.k_a_acc)&&(a=z(h),lc(a,f,g),delete a.invis,delete a.part,a.k_old_sf=h.k_sf,a.fmt=e);if(mc){for(c=0;c<d;c++)f=E[c],h=f.meter,L.voices[c]&&!L.voices[c].second&&L.st_print[L.voices[c].st]&&(a=z(h),lc(a,f,g),delete a.part,a.fmt=e);mc=!1}for(c=
0;c<d;c++)f=E[c],f.sls.length&&(a={type:m.BAR,fname:g.fname,bar_type:"|",dur:0,multi:0,invis:!0,sls:f.sls,fmt:e},lc(a,f,g),f.sls=[]);for(c=0;c<d;c++){f=E[c];h=f.bar_start;f.bar_start=null;for(a=g;a&&a.time==g.time;a=a.ts_next)if(a.rbstop){h=null;break}h&&L.voices[c]&&L.st_print[L.voices[c].st]&&(f.last_sym.type==m.BAR?f.last_sym.rbstop||(f.last_sym.rbstart=1):(lc(h,f,g),h.fmt=e))}Q.set_pitch(g);a=M;a.seqst=!0;for(a=g;a.ts_next&&!a.ts_next.seqst;a=a.ts_next);if(a.ts_next&&a.ts_next.type!=m.CLEF&&!a.tp&&
!a.ts_next.a_ly)for(a=a.ts_next;a.ts_next&&!a.ts_next.seqst;a=a.ts_next);h=a.ts_next;a.ts_next=null;Ld();a.ts_next=h}function mf(a){function c(a){a.prev.trem2=!0;a.prev.head=++a.head;0<--a.nflags?a.nflags+=a.ntrem:(-2>=a.nflags&&(a.stemless=!0,a.prev.stemless=!0),a.nflags=a.ntrem);a.prev.nflags=a.nflags}var d,e,f=!0,g=127;for(d=a.sym;d;d=d.next)if(d.type==m.NOTE){g=d.notes[0].pit;break}for(d=a.sym;d;d=d.next){d.a_gch&&Q.gch_build(d);switch(d.type){case m.MREST:f=!0;break;case m.BAR:if(e=d.fmt.bardef[d.bar_type])d.bar_type=
e;d.beam_on||(f=!0);d.next||!d.prev||d.invis||d.prev.head!=m.OVALBARS||(d.prev.head=m.SQUARE);break;case m.GRACE:for(a=d.extra;a;a=a.next)a.notes.sort(abc2svg.pitcmp),e=cc(a,a.dur_orig),a.head=e[0],a.dots=e[1],a.nflags=e[2],!a.trem2||a.next&&!a.next.trem2||c(a);break;case m.NOTE:case m.REST:if(e=cc(d,d.dur_orig),d.head=e[0],d.dots=e[1],d.nflags=e[2],-2>=d.nflags&&(d.stemless=!0),d.xstem&&(d.nflags=0),d.trem1&&(d.nflags=0<d.nflags?d.nflags+d.ntrem:d.ntrem),!d.next||!d.next.trem2)if(d.trem2)c(d);else{a=
d.nflags;d.ntrem&&(a-=d.ntrem);d.type==m.REST&&d.beam_end&&!d.beam_on&&(f=!0);if(f||0>=a){if(h){h.beam_end=!0;var h=null}if(0>=a)d.beam_st=d.beam_end=!0;else if(d.type==m.NOTE||d.beam_on)d.beam_st=!0,f=!1}d.beam_end&&(f=!0);if(d.type==m.NOTE||d.beam_on)h=d}}if(d.type==m.NOTE)for(d.nhd&&d.notes.sort(abc2svg.pitcmp),g=d.notes[0].pit,a=d.prev;a&&a.type==m.REST;a=a.prev)a.notes[0].pit=g;else d.notes||(d.notes=[],d.notes[0]={},d.nhd=0),d.notes[0].pit=g}h&&(h.beam_end=!0)}function nf(){function a(a,c){var d=
0;for(a+="\n";;){var e=a.indexOf("\n",d);if(0>e)break;d=qa(a.slice(d,e))[0]+12;d>c&&(c=d);if(0>e)break;d=e+1}return c}var c,d=L,e=0,f=0,g=E.length;for(c=0;c<g;c++){var h=E[c];var n=h.nm;h=h.snm;if((n||h)&&!k){ea("voice");var k=C.deffont}n&&(n=a(n,e),n>e&&(e=n));h&&(n=a(h,f),n>f&&(f=n))}for(n=0;d;){for(c=0;c<=d.nstaff;c++){if(d.staves[c].flags&1280){n=12;break}d.staves[c].flags&5&&(n=6)}if(12==n)break;d=d.next}return[e+n,f+n]}function of(a,c){var d,e,f,g=a.fmt.shiftunison||0;if(3<=g||(e=a.dur)>=m.BLEN||
(f=c.dur)>=m.BLEN||a.stemless&&c.stemless||a.dots!=c.dots&&(g&1||0!=a.dots*c.dots)||0<a.stem*c.stem)return!1;var h=d=0;if(a.notes[0].pit>c.notes[0].pit){if(0>a.stem)return!1;for(;c.notes[d].pit!=a.notes[0].pit;)if(++d>c.nhd)return!1}else if(a.notes[0].pit<c.notes[0].pit){if(0>c.stem)return!1;for(;c.notes[0].pit!=a.notes[h].pit;)if(++h>a.nhd)return!1}if(c.notes[d].acc!=a.notes[h].acc)return!1;var n=h;var k=d;var l=a.notes[h].shhd;var p=c.notes[d].shhd;do{h++;d++;if(h>a.nhd)break;if(d>c.nhd)break;if(c.notes[d].acc!=
a.notes[h].acc)return!1;l<a.notes[h].shhd&&(l=a.notes[h].shhd);p<c.notes[d].shhd&&(p=c.notes[d].shhd)}while(c.notes[d].pit==a.notes[h].pit);if(h<=a.nhd){if(d<=c.nhd||0<c.stem)return!1}else if(d<=c.nhd&&0<a.stem)return!1;var r=h;h=d;d=0;if(e!=f)if(e<f&&(e=f,f=a.dur),e<m.BLEN/2)c.dots?d=2:a.dots&&(d=1);else if(f<m.BLEN/4){if(g&2)return!1;d=c.dur>=m.BLEN/2?2:1}else return!1;d||(d=a.p_v.scale<c.p_v.scale?2:1);if(1==d){for(d=k;d<h;d++)c.notes[d].invis=!0,delete c.notes[d].acc;for(d=0;d<=c.nhd;d++)c.notes[d].shhd+=
l}else{for(h=n;h<r;h++)a.notes[h].invis=!0,delete a.notes[h].acc;for(h=0;h<=a.nhd;h++)a.notes[h].shhd+=p}return!0}function pf(a,c,d,e){var f;if(f=c.notes[e].acc){e=2*nc[a.head]+a.xmx+c.notes[e].shac+2;"object"==typeof f&&(e+=2);a.dots&&(e+=6);for(d=0;d<=c.nhd;d++)c.notes[d].shhd+=e,c.notes[d].shac-=e;c.xmx+=e}else{e=2*nc[c.head]+c.xmx+a.notes[d].shac+2;f=a.notes[d].acc;"object"==typeof f&&(e+=2);c.dots&&(e+=6);for(d=0;d<=a.nhd;d++)a.notes[d].shhd+=e,a.notes[d].shac-=e;a.xmx+=e}}function Rc(a){var c,
d=nc[a.head],e=d,f=[];for(c=0;96>c;c++)f.push(-100);if(-2<a.nflags){if(0<a.stem){e=-e;c=2*a.notes[0].pit;var g=2*(Math.ceil((a.ymx-2)/3)+18)}else c=2*(Math.ceil((a.ymn+2)/3)+18),g=2*a.notes[a.nhd].pit;0>c&&(c=0);for(96<=g&&(g=95);c<=g;)f[c++]=e}var h=a.notes[0<a.stem?0:a.nhd].shhd;for(g=0;g<=a.nhd;g++)e=-a.notes[g].shhd+d+h,c=2*a.notes[g].pit,0>c?c=0:95<=c&&(c=94),e>f[c]&&(f[c]=e),a.head!=m.SQUARE&&--e,e>f[c-1]&&(f[c-1]=e),e>f[c+1]&&(f[c+1]=e);return f}function Sc(a){var c,d=nc[a.head],e=d,f=0<a.nflags&&
a.beam_st&&a.beam_end,g=[];for(c=0;96>c;c++)g.push(-100);if(-2<a.nflags){if(0>a.stem){e=-e;c=2*(Math.ceil((a.ymn+2)/3)+18);var h=2*a.notes[a.nhd].pit;var n=c+4}else c=2*a.notes[0].pit,h=2*(Math.ceil((a.ymx-2)/3)+18);0>c&&(c=0);for(96<h&&(h=96);c<h;)g[c++]=e}if(f)if(0<a.stem)for(c=0==a.xmx?2*a.notes[a.nhd].pit:2*a.notes[0].pit,c+=4,0>c&&(c=0);96>c&&c<=h-4;c++)g[c]=11;else for(c=n,0>c&&(c=0);96>c&&c<=2*a.notes[0].pit-4;c++)g[c]=3.5;n=a.notes[0<a.stem?0:a.nhd].shhd;for(h=0;h<=a.nhd;h++)e=a.notes[h].shhd+
d-n,c=2*a.notes[h].pit,0>c?c=0:95<=c&&(c=94),e>g[c]&&(g[c]=e),a.head!=m.SQUARE&&--e,e>g[c-1]&&(g[c-1]=e),e>g[c+1]&&(g[c+1]=e);return g}function qf(){function a(){l=d;d=c;t=q;w=v;x=p;n=h}var c,d,e,f,g,h,n,k=L;for(c=M;c;c=c.ts_next)if(c.type!=m.NOTE||c.invis)c.type==m.STAVES&&(k=c.sy);else{if(c.xstem&&0>c.ts_prev.stem)for(e=0;e<=c.nhd;e++)c.notes[e].shhd-=7,c.notes[e].shac+=16;for(d=c;;){d=d.ts_next;if(!d)break;if(d.time!=c.time){d=null;break}if(d.type==m.NOTE&&!d.invis&&d.st==c.st)break}if(d){var l=
c;k.voices[l.v].range<k.voices[d.v].range?d.dot_low=!0:l.dot_low=!0;if(!(l.ymn>d.ymx||l.ymx<d.ymn||of(l,d)))if(l.dots||d.dots||!(0<l.stem&&0>d.stem&&l.notes[0].pit==d.notes[d.nhd].pit+1||0>l.stem&&0<d.stem&&l.notes[l.nhd].pit+1==d.notes[0].pit)){var p=Sc(l);var r=Rc(d);if((e=l.ts_prev)&&e.time==l.time&&e.st==l.st&&e.type==m.NOTE&&!e.invis){var D=Sc(e);for(f=0;96>f;f++)D[f]>p[f]&&(p[f]=D[f])}else e=null;var t=-10;for(f=0;96>f;f++)r[f]+p[f]>t&&(t=r[f]+p[f]);if(!(-3>t&&(d.notes[0].pit&1||!l.dots&&!d.dots||
!(l.notes[l.nhd].pit==d.notes[0].pit+2&&l.dot_low||l.notes[l.nhd].pit+2==d.notes[0].pit&&d.dot_low)))){var u=Sc(d);var v=Rc(l);if(e)for(D=Rc(e),f=0;96>f;f++)D[f]>v[f]&&(v[f]=D[f]);var q=h=n=-100;for(f=0;96>f;f++)v[f]+u[f]>q&&(q=v[f]+u[f]),u[f]>n&&(n=u[f]),p[f]>h&&(h=p[f]);f=0;D=l.nhd;for(g=d.nhd;;){var y=l.notes[D].pit-d.notes[g].pit;switch(y){case 2:l.notes[D].pit&1||(l.dot_low=!1);break;case 1:l.notes[D].pit&1?d.dot_low=!0:l.dot_low=!1;break;case 0:if(l.notes[D].acc!=d.notes[g].acc){f=-1;break}d.notes[g].acc&&
(l.notes[D].acc||(l.notes[D].acc=d.notes[g].acc),d.notes[g].acc=0);l.dots&&d.dots&&l.notes[D].pit&1&&(f=1);break;case -1:l.notes[D].pit&1?d.dot_low=!1:l.dot_low=!0;break;case -2:l.notes[D].pit&1||(d.dot_low=!1)}if(0>f)break;if(0<=y&&0>--D)break;if(0>=y&&0>--g)break}if(0>f)pf(l,d,D,g);else{g=0;l.dots?d.dots?f||(g=1):a():d.dots&&q+h<t+n&&(g=1);var w=r;var x=u;!e&&q+h<t+n&&a();t+=3;0>t&&(t=0);e=0<=l.stem?0:l.nhd;t+=l.notes[e].shhd;e=0<=d.stem?0:d.nhd;t-=d.notes[e].shhd;if(l.dots)if(e=7.7+l.xmx+3.5*l.dots-
3.5+3,!g){q=-100;for(D=0;D<=l.nhd;D++)f=l.notes[D].pit,f&1||(l.dot_low?f--:f++),f*=2,1>f?f=1:95<=f&&(f=94),w[f]>q&&(q=w[f]),w[f-1]+1>q&&(q=w[f-1]+1),w[f+1]+1>q&&(q=w[f+1]+1);e+q+2>t&&(t=e+q+2)}else if(e<t+n+d.xmx){for(D=q=0;D<=l.nhd;D++)f=l.notes[D].pit,f&1||(l.dot_low?f--:f++),f*=2,1>f?f=1:95<=f&&(f=94),x[f]>q&&(q=x[f]),x[f-1]+1>q&&(q=x[f-1]=1),x[f+1]+1>q&&(q=x[f+1]+1);4.5<q&&7.7+l.xmx+2<t+q+d.xmx&&(d.xmx=q+3-7.7)}for(e=d.nhd;0<=e;e--)d.notes[e].shhd+=t;d.xmx+=t;g&&(l.xmx=d.xmx)}}}else{0>l.stem&&
(l=d,d=c);t=l.notes[0].shhd+7;for(e=0;e<=d.nhd;e++)d.notes[e].shhd+=t;d.xmx+=t;l.xmx=d.xmx}}}}function rf(){function a(a){var c=w[a],d=g.staves[a];c||(c=w[a]={});c.y=0;c.stafflines=d.stafflines;c.staffscale=d.staffscale;c.ann_top=c.ann_bot=0}function c(){var a,c,d=g.staves.length;for(a=0;a<d;a++)if(g.staves[a].flags&257){var e=0;for(c=a;a<d;){e|=n[a]?1:2;if(g.staves[a].flags&514)break;a++}if(3==e)for(;c<=a;)n[c]=!0,f[c++]=!0}}var d,e,f=[],g=L;if(M.type==m.STAVES){var h=M;M=M.ts_next;M.ts_prev=null;
h.seqst&&(M.seqst=!0);if(h.p_v.sym=h.next)h.next.prev=null}R=g.nstaff;for(d=0;d<=R;d++)a(d);var n=new Uint8Array(R+1);for(h=M;h&&!h.nl;h=h.ts_next){switch(h.type){case m.STAVES:c();g.st_print=n;for(g=h.sy;R<g.nstaff;)a(++R);n=new Uint8Array(R+1);continue;case m.BLOCK:h.play?h.ts_next&&h.ts_next.shrink&&(h.ts_next.shrink=0):(oc.push(h),gb(h));continue}d=h.st;if(d>R){switch(h.type){case m.CLEF:w[d].clef=h;break;case m.KEY:h.p_v.ckey=h;break;case m.METER:h.p_v.meter=h}gb(h)}else if(!n[d]){switch(h.type){default:continue;
case m.BAR:if(h.bar_mrep||1<g.staves[d].staffnonote)break;continue;case m.GRACE:break;case m.NOTE:case m.REST:case m.SPACE:case m.MREST:if(!(1<g.staves[d].staffnonote)){if(h.invis)continue;if(!g.staves[d].staffnonote&&h.type!=m.NOTE)continue}}f[d]=n[d]=!0}}sa=h;c();g.st_print=n;(function(){var a,c,d;for(a=0;a<=R;a++){var e=w[a];e.hlu=[];e.hld=[];var g=e.stafflines.length;e.topbar=6*(g-1);for(c=0;c<g-1;c++){switch(e.stafflines[c]){case ".":case "-":continue}break}e.botline=e.botbar=6*c;if(c>=g-2)if("."!=
e.stafflines[c])e.botbar-=6,e.topbar+=6;else{e.botbar-=12;e.topbar+=12;continue}if(f[a])for(e.hll=17+2*c,e.hlmap=new Int8Array(2*(g-c+1)+2),d=1;c<g;c++,d+=2)switch(e.stafflines[c]){case "|":case "[":e.hlmap[d-1]=1,e.hlmap[d]=1,e.hlmap[d+1]=1}}})();if(sa){h=sa;delete h.nl;d=h.ts_prev;d.ts_next=null;var k=E.length;for(e=0;e<k;e++){var l=E[e];if(l.sym&&l.sym.time<=sa.time){for(h=d;h;h=h.ts_prev)if(h.v==e){l.s_next=h.next;h.next=null;break}if(h)continue}l.s_next=l.sym;l.sym=null}}lf();C.st_print=f}function Pd(){for(var a=
M,c=a.time;a;a=a.ts_next){if(a.time!=c){Wa();return}switch(a.type){case m.NOTE:case m.REST:case m.MREST:case m.SPACE:Wa();return;default:continue;case m.STAVES:L=a.sy;continue;case m.BLOCK:if(a.play)continue;Q.block_gen(a)}gb(a);a.p_v.s_next==a&&(a.p_v.s_next=a.next)}M=null}function sb(a){a.fname=v.fname;a.istart=v.istart;a.iend=v.iend}function Qd(a){var c={type:m.CLEF,clef_line:2,clef_type:"t",v:l.v,p_v:l,time:l.time,dur:0},d=1;sb(c);switch(a[0]){case '"':d=a.indexOf('"',1);c.clef_name=a.slice(1,
d);d++;break;case "a":if("u"==a[1]){c.clef_type="a";c.clef_auto=!0;d=4;break}d=4;case "C":c.clef_type="c";c.clef_line=3;break;case "b":d=4;case "F":c.clef_type="b";c.clef_line=4;break;case "n":d=4;c.invis=!0;c.clef_none=1;break;case "t":if("e"==a[1]){c.clef_type="c";c.clef_line=4;break}d=6;case "G":break;case "p":d=4;case "P":c.clef_type="p";c.clef_line=3;break;default:y(1,"Unknown clef '$1'",a);return}"1"<=a[d]&&"9">=a[d]&&(c.clef_line=+a[d],d++);delete l.snd_oct;if("8"!=a[d+1]&&"1"!=a[d+1])return c;
switch(a[d]){case "^":c.clef_oct_transp=!0;case "+":c.clef_octave="8"==a[d+1]?7:14;c.clef_oct_transp||(l.snd_oct=8==a[d+1]?12:24);break;case "_":c.clef_oct_transp=!0;case "-":c.clef_octave="8"==a[d+1]?-7:-14,c.clef_oct_transp||(l.snd_oct=8==a[d+1]?-12:-24)}return c}function Gb(a,c){var d;var e=new H;e.buffer=a;var f=[];for(a=0;2>a;a++)if(d=e.buffer[e.index]?ab(e):null){if("object"==typeof d.acc){y(1,I.bad_transp);return}f[a]=abc2svg.pab40(d.pit,d.acc)}else{if(1!=a||!c){y(1,I.bad_transp);return}f[a]=
242}return f[1]-f[0]}function Rd(a){var c;if(c=a.match(/(.)[=\s]*(\[I:.+\]|".+"|!.+!)$/)){a=c[1];var d=c[2];"\\"==a[0]&&("t"==a[1]?a="\t":a[1]||(a=" "));c=a.charCodeAt(0);if(128<=c)y(1,I.not_ascii);else{switch(Ja[c][0]){case "0":case "d":case "i":case " ":break;case '"':case "!":case "[":if(1<Ja[c].length)break;default:y(1,"Bad user character '$1'",a);return}switch(d){case "!beambreak!":d=" ";break;case "!ignore!":d="i";break;case "!nil!":case "!none!":d="d"}Ja[c]=d}}else y(1,'Lack of starting [, ! or " in U: / %%user')}
function sf(a){if(a){if(/^[\]\[|.-]+$/.test(a))return a.replace(/\]/g,"[");a=+a;switch(a){case 0:return"...";case 1:return"..|";case 2:return".||";case 3:return".|||"}if(!(isNaN(a)||0>a||16<a))return"||||||||||||||||".slice(0,a)}}function $a(a){a={type:m.BLOCK,subtype:a,dur:0};ha(a);return a}function wd(a){l.init||(l.init=!0,N.V&&(N.V[l.id]&&(a=N.V[l.id].concat(a)),N.V["*"]&&(a=N.V["*"].concat(a))));a.length&&Q.set_vp(a)}function Qb(a,c){c.length&&(N.V||(N.V={}),N.V[a]?Array.prototype.push.apply(N.V[a],
c):N.V[a]=c)}function tf(a){var c={type:m.METER,dur:0,a_meter:[]};var d={},e=0,f=0,g;sb(c);if(0==a.indexOf("none")){f=4;var h=1}else for(h=0;f<a.length&&"="!=a[f];){switch(a[f]){case "C":d.top=a[f++];if(!e)var n=e=4;break;case "c":case "o":d.top=a[f++];if(!e)switch(e="c"==a[f-1]?2:3,n=4,a[f]){case "|":n/=2;break;case ".":e*=3,n*=2}break;case ".":case "|":e=0;d.top=a[f++];break;case "(":if("("==a[f+1]){var k=!0;d.top=a[f++];c.a_meter.push(d);d={}}for(g=f+1;g<a.length&&")"!=a[g]&&"/"!=a[g];)g++;if(")"==
a[g]&&"/"==a[g+1]){f++;continue}case ")":k="("==a[f];d.top=a[f++];c.a_meter.push(d);d={};continue;default:if("0">=a[f]||"9"<a[f]){y(1,"Bad char '$1' in M:",a[f]);return}n=2;for(d.top=a[f++];;){for(;"0"<=a[f]&&"9">=a[f];)d.top+=a[f++];if(")"==a[f]){if("/"!=a[f+1])break;f++}if("/"==a[f]){f++;if("0">=a[f]||"9"<a[f]){y(1,"Bad char '$1' in M:",a[f]);return}for(d.bot=a[f++];"0"<=a[f]&&"9">=a[f];)d.bot+=a[f++];break}if(" "!=a[f]&&"+"!=a[f])break;if(f>=a.length||"("==a[f+1])break;d.top+=a[f++]}e=eval(d.top)}k||
(d.bot&&(n=+d.bot),h+=e*m.BLEN/n);c.a_meter.push(d);for(d={};" "==a[f];)f++;"+"==a[f]&&(d.top=a[f++],c.a_meter.push(d),d={})}if("="==a[f]){h=a.substring(++f).match(/^(\d+)\/(\d+)$/);if(!h){y(1,"Bad duration '$1' in M:",a.substring(f));return}h=m.BLEN*h[1]/h[2]}if(h)if(c.wmeasure=h,0>t.writefields.indexOf("M")&&(c.a_meter=[]),3!=v.state){if(N.M=a,fa.meter=c,v.state)for(fa.ulen||(fa.ulen=1>=h||h>=3*m.BLEN/4?m.BLEN/8:m.BLEN/16),a=0;a<E.length;a++)E[a].meter=c,E[a].wmeasure=h}else for(l.wmeasure=h,Tc()?
l.meter=c:ha(c),c=l.voice_down;c;c=c.voice_down)c.wmeasure=h;else y(1,I.bad_val,"M:")}function Sd(a,c){var d;if(l.v==J.top_voice)ha(a);else if(E[J.top_voice].time==a.time){var e=l;l=E[J.top_voice];ha(a);l=e}else if(E[J.top_voice].time>a.time)for(e=E[J.top_voice],d=e.sym;;d=d.next){if(d.time>=a.time){sb(a);a.fmt=t;a.next=d;(a.prev=d.prev)?a.prev.next=a:e.sym=a;d.prev=a;a.v=d.v;a.p_v=e;a.st=e.st;break}}else sb(a),a.fmt=t,v.pq_d||(v.pq_d=[]),v.pq_d.push(a);v.pq||(v.pq={});v.pq[c]=a.time}function uf(a){function c(a){var c;
if((c=a.match(/(\d+)\/(\d+)/))&&(a=+c[2])&&!isNaN(a)&&!(a&a-1)&&(c=+c[1],!isNaN(c)))return m.BLEN*c/a;y(1,"Invalid note duration $1",f)}var d=a,e={type:m.TEMPO,dur:0};sb(e);0>t.writefields.indexOf("Q")&&(e.invis=!0);if('"'==a[0]){var f=a.match(/"([^"]*)"/);if(!f){y(1,"Unterminated string in Q:");return}e.tempo_str1=f[1];a=a.slice(f[0].length).replace(/^\s+/,"")}if('"'==a.slice(-1)){var g=a.indexOf('"');e.tempo_str2=a.slice(g+1,-1);a=a.slice(0,g).replace(/\s+$/,"")}g=a.indexOf("=");if(0<g){var h=a.slice(0,
g).split(/\s+/);for(a=a.slice(g+1).replace(/^\s+/,"");;){f=h.shift();if(!f)break;g=c(f);if(!g)return;e.tempo_notes||(e.tempo_notes=[]);e.tempo_notes.push(g)}"ca. "==a.slice(0,4)&&(e.tempo_ca="ca. ",a=a.slice(4));g=a.indexOf("/");if(0<g){g=c(a);if(!g)return;e.new_beat=g}else if(e.tempo=+a,!e.tempo||isNaN(e.tempo)){y(1,"Bad tempo value");return}}2>v.state||!l.time&&!fa.tempo?(N.Q=d,fa.tempo=e):(fa.tempo||y(0,"No previous tempo"),e.time=l.time,a="Q"+e.time,v.pq&&v.pq[a]==e.time||Sd(e,a))}function Mc(a,
c){if(l&&l.ignore)switch(a){default:return;case "P":case "Q":case "V":}switch(a){case "I":Q.do_pscom(c);break;case "L":if(a=c.match(/^1\/(\d+)(=(\d+)\/(\d+))?$/)){var d=+a[1];if(!d||0!=(d&d-1))break;d=m.BLEN/d;var e=a[2]?(e=+a[4])?+a[3]/e*m.BLEN:0:d}else"auto"==c&&(d=e=-1);if(!e){y(1,"Bad L: value");break}1>=v.state?fa.ulen=d:(l.ulen=d,l.dur_fact=e/d);break;case "M":tf(c);break;case "U":Rd(c);break;case "P":if(!v.state)break;if(1==v.state){N.P=c;break}d={type:m.PART,text:c,time:l.time};e=v.pq&&v.pq[c];
if(e==d.time)break;if(null!=e){y(1,"Misplaced P:");break}0>t.writefields.indexOf("P")&&(d.invis=1);Sd(d,c);break;case "Q":if(!v.state)break;uf(c);break;case "V":Uc(c);3==v.state&&(l.ignore=!J.voices[l.v]);break;case "K":if(!v.state)break;Cd(c);break;case "N":case "R":N[a]=N[a]?N[a]+("\n"+c):c;break;case "r":if(!q.keep_remark||3!=v.state)break;d={type:m.REMARK,text:c,dur:0};ha(d);break;default:y(0,"'$1:' line ignored",a)}}function Td(){var a,c=v.line,d={type:m.BAR,fname:v.fname,istart:v.bol+c.index,
dur:0,multi:0};oa&&oa.bar&&Zb("|");fa.new_nbar&&(d.bar_num=fa.new_nbar,fa.new_nbar=0);for(a=c.char();;){var e=c.next_char();switch(e){case "|":case "[":case "]":case ":":a+=e;continue}break}":"==a[0]&&(":"==a?(a="|",d.bar_dotted=!0):d.rbstop=2);za&&pc(d);ja.length&&yb(d);"["!=a.slice(-1)||/[0-9" ]/.test(e)||(a=a.slice(0,-1),c.index--,e="[");if("0"<e&&"9">=e)for(d.text=e;;){e=c.next_char();if(0>"0123456789,.-".indexOf(e))break;d.text+=e}else if('"'==e&&"["==a.slice(-1))for(d.text="";;){e=c.next_char();
if(!e){y(1,"No end of repeat string");return}if('"'==e){c.index++;break}d.text+=e}"]"==a[0]&&(d.rbstop=2,1!=a.length?a=a.slice(1):d.invis=!0);d.iend=v.bol+c.index;d.text&&"["==a.slice(-1)&&"["!=a&&(a=a.slice(0,-1));":"==a.slice(-1)&&(d.rbstop=1,d.text&&(y(1,"Variant ending on a left repeat bar"),delete d.text),l.tie_s_rep=null);d.text&&(d.rbstart=d.rbstop=2,"1"==d.text[0]?(l.tie_s_rep=l.tie_s,l.acc_tie?l.acc_tie_rep=l.acc_tie.slice():l.acc_tie_rep&&(l.acc_tie_rep=null)):(l.tie_s=l.tie_s_rep,l.acc_tie_rep&&
(l.acc_tie=l.acc_tie_rep.slice())),l.norepbra&&!l.second&&(d.norepbra=1));if(0>l.ulen){var f;if((e=l.last_sym)&&e.type!=m.MREST&&e.type!=m.BAR){for(;e.type!=m.BAR&&e.prev;)e=e.prev;c=e.time;var g=l.wmeasure/(l.time-c);if(1!=g){for(;e;e=e.next)if(e.time=c,e.dur&&!e.grace&&(e.dur*=g,e.dur_orig*=g,c+=e.dur,e.type==m.NOTE||e.type==m.REST))for(f=0;f<=e.nhd;f++)e.notes[f].dur*=g;l.time=d.time=c}}}if(!("["!=a&&"|:"!=a||l.eoln||d.a_gch||d.invis)&&(e=l.last_sym)&&e.type==m.BAR){if("["==a&&!e.text||d.norepbra){d.text&&
(e.text=d.text,!l.st||d.norepbra||J.staves[l.st-1].flags&64||(e.xsh=4));d.norepbra&&(e.norepbra=1);d.rbstart&&(e.rbstart=d.rbstart);d.rbstop&&(e.rbstop=d.rbstop);return}if("|:"==a)switch(e.bar_type){case ":|":e.bar_type="::";e.rbstop=2;return}}switch(a){case "[":case "[]":case "[|]":d.invis=!0;a=d.rbstart?"[":"[]";break;case ":|:":case ":||:":a="::";break;case "||":if("2.2"<=t["abc-version"])break;case "[|":case "|]":d.rbstop=2}d.bar_type=a;l.lyric_restart||(l.lyric_restart=d);l.sym_restart||(l.sym_restart=
d);ha(d);d.st=l.st;!(d.text&&0<d.st)||d.norepbra||J.staves[d.st-1].flags&64||"["==a||(d.xsh=4);d.bar_dotted||d.invis||(l.acc=[])}function tb(a){if(!a)return[];a=a.match(/[^\s"=]+=?|"[^"]*"/g);return a?a:(y(1,"Unterminated string"),[])}function qc(a){Vc.lastIndex=a.index;var c=Vc.exec(a.buffer);if(!c[0])return[1,1];var d=c[1]||1;var e=c[3]||1;c[3]||(e*=1<<c[2].length);a.index=Vc.lastIndex;return[+d,+e]}function ab(a){var c=a.char();switch(c){case "^":c=a.next_char();if("^"==c){var d=2;c=a.next_char()}else d=
1;break;case "=":d=3;c=a.next_char();break;case "_":c=a.next_char(),"_"==c?(d=-2,c=a.next_char()):d=-1}if(1==d||-1==d)if("1"<=c&&"9">=c||"/"==c){var e=qc(a);0>d&&(e[0]=-e[0]);t.nedo&&1==e[1]&&(e[0]*=12,e[1]*=t.nedo);d=e;c=a.char()}e=bb.indexOf(c)+16;c=a.next_char();if(16>e)y(1,"'$1' is not a note",a.buffer[a.index-1]);else{for(;"'"==c;)e+=7,c=a.next_char();for(;","==c;)e-=7,c=a.next_char();a={pit:e,shhd:0,shac:0};d&&(a.acc=d);return a}}function Wc(a,c,d,e){d=Ud(c.pit,d);var f=rb[a.map];if(f){if(!(f[d]||
(d="o"+d.replace(/[',]+/,""),f[d]||(d="k"+bb[(c.pit+75-11*a.ckey.k_sf)%7],f[d]||(d="all",f[d])))))return;f=f[d];if(e)f[1]&&f[1].notrp&&(c.notrp=1);else if(f[1]&&!c.map&&(c.pit=f[1].pit,c.acc=f[1].acc,f[1].notrp&&(c.notrp=1,c.noplay=1)),c.map=f,f[2]&&(c.color=f[2]),d=f[3])c.midi=Vd(d.pit+19,d.acc)}}function rc(){var a=v.line,c=0;ja.length&&"dot"==ja[ja.length-1]&&(c=m.SL_DOTTED,ja.pop());switch(a.next_char()){case "'":return a.index++,c+m.SL_ABOVE;case ",":return a.index++,c+m.SL_BELOW;case "?":return a.index++,
c+m.SL_CENTER}return c+m.SL_AUTO}function Wd(a,c){var d;for(d=l.sls.length;0<=--d;){var e=l.sls[d];if(e.ss!=a){l.sls.splice(d,1);e.se=a;c&&(e.nte=c);d=e.ss;d.sls||(d.sls=[]);d.sls.push(e);e.grace&&(e.grace.sl1=!0);return}}for(d=a.prev;d;d=d.prev)if(d.type==m.BAR&&":"==d.bar_type[0]&&d.text){d.sls||(d.sls=[]);d.sls.push({ty:m.SL_AUTO,ss:d,se:a});c&&(d.sls[d.sls.length-1].nte=c);return}a.sls||(a.sls=[]);a.sls.push({ty:m.SL_AUTO,se:a,loc:"i"});c&&(a.sls[a.sls.length-1].nte=c)}function Vd(a,c){var d=
[0,2,4,5,7,9,11][a%7],e=12*(a/7|0);l.snd_oct&&(e+=l.snd_oct);3==c&&(c=0);if(c)if("object"==typeof c){var f=c[0]/c[1];if(100==c[1])return d+e+f}else f=c;else return t.temper?t.temper[abc2svg.p_b40[a%7]]+e:d+e;if(t.nedo){if("object"!=typeof c)return a=abc2svg.p_b40[a%7]+c,t.temper[a]+e;if(c[1]==t.nedo)return a=abc2svg.p_b40[a%7],t.temper[a]+e+f}else if(!t.temper)return d+(e+f);c=t.temper[abc2svg.p_b40[a%7]];0<f?(a=t.temper[(abc2svg.p_b40[a%7]+1)%40],a<c&&(a+=12)):(a=t.temper[(abc2svg.p_b40[a%7]+39)%
40],a>c&&(a-=12),f=-f);return c+e+(a-c)*f}function Xd(){for(var a,c=v.line,d=c.index,e="";;){a=c.next_char();if(!a){c.index=d;y(1,"No end of decoration");return}if("!"==a)break;e+=a}ja.push(e)}function Bd(){function a(a){for(var c="";0>a;)a+=7,c+=",";for(;14<=a;)a-=7,c+="'";return bb[a]+c}function c(c,d){if(void 0==d)return c;var e,f="",g=c.length;for(e=0;e<g;e++){var h=c[e];f="h"<=h&&"z">=h?f+a(d+h.charCodeAt(0)-110):f+h}return f}function d(D){for(var q,u,w,x;;){q=p.char();if(!q)break;if(!D&&$b[q]){x=
void 0;for(w in Ya)if(Ya.hasOwnProperty(w)&&w[0]==q){if(0>w.indexOf("n")){if(p.buffer.indexOf(w,p.index)!=p.index)continue;p.index+=w.length}else{a:{u=void 0;var z=w;var C=1;for(x=p.index+1;C<z.length;C++,x++)if(z[C]!=p.buffer[x]){if("n"!=z[C]){x=void 0;break a}u=bb.indexOf(p.buffer[x]);if(0>u){x=void 0;break a}for(;"'"==p.buffer[x+1];)u+=7,x++;for(;","==p.buffer[x+1];)u-=7,x++}p.index=x;x=u}if(void 0==x)continue}var E=w;u=Ya[w];C=p;z=v.istart;v.line=p=new H;v.istart+=C.index;if(0>t.writefields.indexOf("m")){p.buffer=
E.replace("n",a(x));E=l.last_sym;var B=l.time;d(!0);E||(E=l.sym);for(E=E.next;E;E=E.next)E.noplay=!0;var F=l.time;var G=l;l=Yd(G.id+"-p");J.voices[l.v]||(l.second=!0,J.voices[l.v]={st:G.st,second:!0,range:l.v});l.time=B;E=l.last_sym;v.line=p=new H;v.istart+=C.index;p.buffer=c(u,x);d(!0);l.time!=F&&y(1,"Bad length of the macro sequence");E||(E=l.sym);for(;E;E=E.next)E.invis=E.play=!0;l=G}else p.buffer=c(u,x),d(!0);v.line=p=C;v.istart=z;x=1;break}if(x)continue}u=q.charCodeAt(0);if(128<=u){y(1,I.not_ascii);
p.index++;break}u=Ja[u];switch(u[0]){case " ":if(u=l.last_note)u.beam_end=!0,e&&(e.gr_shift=!0);break;case "\n":if(t.barsperstaff)break;l.eoln=!0;break;case "&":if(e){y(1,I.bad_grace);break}q=p.next_char();if(")"==q){Zb(q);break}Zb("&");continue;case "(":q=p.next_char();if("0"<q&&"9">=q){if(e){y(1,I.bad_grace);break}u=p.get_int();x=vf[u];C=u;q=p.char();if(":"==q&&(q=p.next_char(),"0"<q&&"9">=q&&(x=p.get_int(),q=p.char()),":"==q))if(q=p.next_char(),"0"<q&&"9">=q)C=p.get_int(),p.char();else{y(1,"Invalid 'r' in tuplet");
continue}if(0==x||void 0==x)x=0==l.wmeasure%9?3:2;0>k&&(k=n.length);n.push({p:u,q:x,r:C,ro:C,f:l.tup||t.tuplets});continue}if("&"==q){if(e){y(1,I.bad_grace);break}Zb("(");break}p.index--;A.push(rc());continue;case ")":if(u=l.last_sym)switch(u.type){case m.SPACE:u.notes||(u.notes=[],u.notes[0]={});case m.NOTE:case m.REST:break;case m.GRACE:for(u=u.extra;u.next;u=u.next);break;default:u=null}if(!u){y(1,I.bad_char,q);break}Wd(u);break;case "!":1<u.length?ja.push(u.slice(1,-1)):Xd();break;case '"':if(e){y(1,
I.bad_grace);break}Zd(u);break;case "[":if(1<u.length){Q.do_pscom(u.slice(3,-1));break}x=p.buffer[p.index+1];if(0<='|[]: "'.indexOf(x)||"1"<=x&&"9">=x){if(e){y(1,I.bar_grace);break}Td();continue}if(":"==p.buffer[p.index+2]){if(e){y(1,I.bad_grace);break}q=p.buffer.indexOf("]",p.index+1);if(0>q){y(1,"Lack of ']'");break}u=p.buffer.slice(p.index+3,q).trim();v.istart=v.bol+p.index;v.iend=v.bol+ ++q;p.index=0;Mc(x,u);p.index=q;continue}case "n":u=Q.new_note(e,A);if(!u)continue;if(e||!u.notes)continue;
if(0<=k)u.tp=n.slice(k),k=-1,r&&(u.tp[0].s=r),r=u;else if(!r)continue;w=n[n.length-1];if(0<--w.r)continue;for(;;){u=r;x=u.time;C=l.time-x;z=w.q/w.p*C;for(l.time=x+z;;){u.in_tuplet=!0;u.grace||(u.time=x,u.dur&&(q=Math.round(u.dur*z/C),C-=u.dur,u.dur=q,z-=u.dur,x+=u.dur));if(!u.next){u.tpe?u.tpe++:u.tpe=1;break}u=u.next}q=w.ro;w.s&&(r=w.s);n.pop();if(!n.length){r=null;break}w=n[n.length-1];w.r-=q;if(0<w.r)break}continue;case "<":if(!l.last_note){y(1,"No note before '<'");break}if(e){y(1,"Cannot have a broken rhythm in grace notes");
break}for(x="<"==q?1:-1;"<"==q||">"==q;)x*=2,q=p.next_char();l.brk_rhythm=x;continue;case "i":break;case "{":if(e){y(1,"'{' in grace note");break}f=l.last_note;l.last_note=null;g=ja;ja=[];e={type:m.GRACE,fname:v.fname,istart:v.bol+p.index,dur:0,multi:0};l.color&&(e.color=l.color);switch(l.pos.gst&7){case m.SL_ABOVE:e.stem=1;break;case m.SL_BELOW:e.stem=-1;break;case m.SL_HIDDEN:e.stem=2}ha(e);q=p.next_char();if("/"==q){e.sappo=!0;break}continue;case "|":if(e){y(1,I.bar_grace);break}Td();continue;
case "}":if(l.ignore){e=null;break}u=l.last_note;if(!e||!u){y(1,I.bad_char,q);break}ja.length&&y(1,"Decoration ignored");e.extra=e.next;e.extra.prev=null;e.next=null;l.last_sym=e;e=null;if(!u.prev&&!l.ckey.k_bagpipe){for(q=0;q<=u.nhd;q++)u.notes[q].dur*=2;u.dur*=2;u.dur_orig*=2}l.last_note=f;ja=g;break;case "\\":if(!p.buffer[p.index+1]){h=!0;break}default:y(1,I.bad_char,q)}p.index++}}var e,f,g,h,n=[],k=-1,A=[],p=v.line;if(3==v.state){if(v.tp){n=v.tp;k=v.tpn;var r=v.tps;v.tp=null}d();n.length&&(v.tp=
n,v.tps=r,v.tpn=k);A.length&&y(1,"Start of slur without note");e&&(y(1,"No end of grace note sequence"),l.last_sym=e.prev,l.last_note=f,e.prev&&(e.prev.next=null));h||t.barsperstaff||oa||"\n"!=Ja[10]||(l.eoln=!0);l.eoln&&t.breakoneoln&&l.last_note&&(l.last_note.beam_end=!0)}}function nb(a,c){a=a.charCodeAt(0);if(128<=a){if(768<=a&&880>a)return 0;a=97}return(c||C.curfont).cw_tb[a]}function Sb(a){function c(a,c){return'<tspan\n\tclass="'+(a.class&&a.name==c.name&&a.size==c.size&&a.weight==c.weight&&
a.style==c.style?a.class:ob(a))+'">'}if("object"==typeof a)return a;var d,e=C.deffont,f=C.curfont,g="";f!=e&&(g=c(f,e));g+=a.replace(/<|>|&[^&\s]*?;|&|\$./g,function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";default:if("$"==a[0]){if("0"==a[1])d=C.deffont;else if("1"<=a[1]&&"9">=a[1])d=la("u"+a[1]);else break;a="";if(d!=f&&(f!=e&&(a="</tspan>"),f=d,f!=e))return a+c(f,e)}}return a});f!=e&&(g+="</tspan>");g=new String(g);"undefined"!=typeof document?qa(g):g.wh=qa(a);
C.curfont=f;return g}function ea(a){"string"==typeof a&&(a=la(a));C.curfont=C.deffont=a}function T(a,c,d,e,f,g){g||(g=d.wh||qa(d));if(t.singleline||t.trimsvg){var h=g[0];switch(e){case "c":h=g[0]/2;break;case "j":h=f;break;case "r":h=0}W.wx<a+h&&(W.wx=a+h)}F+='<text class="'+ob(C.deffont);"j"!=e&&5<d.length&&C.deffont.wadj&&(F+='" lengthAdjust="'+C.deffont.wadj+'" textLength="'+g[0].toFixed(1));F+='" x="';Qa(a,'" y="',c);switch(e){case "c":F+='" text-anchor="middle">';break;case "j":F+='" textLength="'+
f.toFixed(1)+'">';break;case "r":F+='" text-anchor="end">';break;default:F+='">'}F+=Sb(d);F+="</text>\n"}function $d(a,c){if(t.titletrim){var d=a.lastIndexOf(", ");if(0>d||"A">a[d+2]||"Z"<a[d+2])d=0;else if(1==t.titletrim){if(d<a.length-7||0<=a.indexOf(" ",d+3))d=0}else d<a.length-t.titletrim-2&&(d=0);d&&(a=a.slice(d+2).trim()+" "+a.slice(0,d))}!c&&0<=t.writefields.indexOf("X")&&(a=N.X+".  "+a);return t.titlecaps?a.toUpperCase():a}function Eb(){W.chg&&Wa();return(W.width-W.lm-W.rm-2)/t.scale}function Xc(a,
c){if(a){Wa();a=$d(a,c);c?(ea("subtitle"),c=t.subtitlespace):(ea("title"),c=t.titlespace);var d=qa(a);d[1]+=2*C.curfont.pad;ma(d[1]+c+C.curfont.pad);c=C.curfont.pad+.22*d[1];t.titleleft?T(0,c,a,null,null,d):T(Eb()/2,c,a,"c",null,d)}}function ae(a,c,d,e,f){if(!d){if(!e)return;d=e;e=null}e?T(a,c,d+" ("+e+")",f):T(a,c,d,f)}function Yc(a,c){if("s"!=c){Wa();var d=Eb(),e=C.curfont.size,f=e*t.lineskipfac;e*=t.parskipfac;var g,h,n;switch(c){default:var k=C.curfont;switch(c){case "c":d/=2;break;case "r":d-=
k.pad;break;default:d=k.pad}for(g=0;;){var m=a.indexOf("\n",g);if(m==g){ma(e);Xa();for(pb(C.curfont);"\n"==a[m+1];)ma(f),m++;if(m==a.length)break}else{g=0>m?a.slice(g):a.slice(g,m);var l=qa(g);ma(l[1]*t.lineskipfac+2*k.pad);T(d,k.pad+.2*l[1],g,c);if(0>m)break}g=m+1}ma(e);Xa();break;case "f":case "j":for(g=0;;){m=a.indexOf("\n\n",g);var r=0>m?a.slice(g):a.slice(g,m);r=r.split(/\s+/);for(g=h=n=k=0;g<r.length;g++)l=qa(r[g]+"\u00a0"),h+=l[0],h>=d&&(ma(k*t.lineskipfac),T(0,.2*l[1],r.slice(n,g).join(" "),
c,d),n=g,h=l[0],k=0),l[1]>k&&(k=l[1]);0!=h&&(ma(k*t.lineskipfac),T(0,.2*l[1],r.slice(n).join(" ")));ma(e);Xa();if(0>m)break;for(;"\n"==a[m+2];)ma(f),m++;if(m==a.length)break;pb(C.curfont);g=m+2}}}}function df(a){function c(a,c){var d=0,e=0;"$"==a[0]&&"0"<=a[1]&&"9">=a[1]&&(C.curfont="0"==a[1]?C.deffont:la("u"+a[1]),a=a.slice(2));if("0"<=a[d]&&"9">=a[d]||"."==a[d+1]){for(;d<a.length&&(d++," "!=a[d]&&":"!=a[d-1]&&"."!=a[d-1]););for(e=d;" "==a[d];)d++}var f=.22*C.curfont.size;0!=e&&T(c,f,a.slice(0,e),
"r");d<a.length&&T(c+5,f,a.slice(d),"l")}var d,e;var f=0;var g=1;a=a.split("\n");var h=a.length;for(d=0;d<h;d++){var n=a[d];if(!n){for(;d+1<h&&!a[d+1];)d++;g++}else if(n.length>f){f=n.length;var k=d}}if(void 0!=k){ea("words");ma(t.wordsspace);ub();f=Eb()/2;var m=qa(a[k])[0];k=e=0;if(m<f){var l=g>>1;for(d=0;d<h;d++)if(n=a[d],!n){for(0>=--l&&(k=d);d+1<h&&!a[d+1];)d++;if(0>=l){e=d+1;break}}g>>=1}if(e){var r=(f-m)/2+10;l=r+f}else l=f-m/2+10;var q=!0;for(d=0;d<k||e<h;d++,e++)ma(t.lineskipfac*C.curfont.size),
d<k&&((n=a[d])?c(n,r):pb(C.curfont)),e<h&&((n=a[e])?c(n,l):0==--g&&(d<k?g++:e<h-1&&(l=f-m/2+10,ub()))),a[d+1]||a[e+1]?q=!0:q&&(ub(),q=!1)}}function Bb(a){return a.replace(/[Cco]\||[co]\.|./g,function(a){return(a=Nb["mtr"+a])?a.c:0})}function be(a){var c,d;if(!Zc[a])if(Zc[a]=!0,d=Fb[a]){for(c=0;;){a=d.indexOf('xlink:href="#',c);if(0>a)break;a+=13;c=d.indexOf('"',a);be(d.slice(a,c))}sc+="\n"+d}else x(1,null,"Unknown glyph: '$1'",a)}function ce(a){var c=0;for(a=a.replace(/\x3c!--.*?--\x3e/g,"");;){var d=
a.indexOf("<",c);if(0>d)break;var e=a.indexOf('id="',d);if(0>e)break;e+=4;c=a.indexOf('"',e);if(0>c)break;var f=a.slice(e,c);c=a.indexOf(">",c);if(0>c)break;if("/"==a[c-1])c++;else{e=a.indexOf(" ",d);if(0>e)break;e=a.slice(d+1,e);c=a.indexOf("</"+e+">",c);if(0>c)break;c+=3+e.length}"<filter"==a.substr(d,7)?$c+=a.slice(d,c)+"\n":Fb[f]=a.slice(d,c)}}function ad(){G.started&&(G.started=!1,Tb(),F+="</g>\n");if(1!=G.scale||G.color)Tb(),F+="<g ",1!=G.scale&&(F=0>G.st?F+E[G.v].scale_str:0>G.v?F+w[G.st].scale_str:
F+('transform="translate(0,'+(ra-G.dy).toFixed(1)+") scale("+G.scale.toFixed(2)+')"')),G.color&&(1!=G.scale&&(F+=" "),F+='color="'+G.color+'"'),F+=">\n",G.started=!0}function Ta(a){if(a!=G.color){var c=G.color;G.color=a;ad();return c}}function Ea(a){a!=G.st&&1!=G.scale&&(G.scale=0);var c=0<=a?w[a].staffscale:1;var d=0<=a&&1!=c?w[a].y:ra;if(c!=G.scale||d!=G.dy)G.scale=c,G.dy=d,G.st=a,G.v=-1,ad()}function Hb(a){var c=a.p_v.scale;if(1==c)Ea(a.st);else{var d=ra;1!=w[a.st].staffscale&&(c*=w[a.st].staffscale,
d=w[a.st].y);if(c!=G.scale||G.dy!=ra)G.scale=c,G.dy=d,G.st=1==w[a.st].staffscale?-1:a.st,G.v=a.v,ad()}}function Da(a,c){F&&(G.started&&(G.started=!1,Tb(),F+="</g>\n"),0>G.st?w[0].output+=F:1==G.scale?w[G.st].output+=F:w[G.st].sc_out+=F,F="");G.scale=0>a?1:c?1:w[a].staffscale;G.st=a;G.dy=0}function de(a,c,d){if(void 0!=a.istart){var e=a.type,f=a.ymx-a.ymn+4,g=a.wl||2,h=a.wr||2;a.grace&&(e=m.GRACE);d(c||abc2svg.sym_name[e],a.istart,a.iend,a.x-g-2,w[a.st].y+a.ymn+f-2,g+h+4,f,a)}}function bf(a,c){de(a,
c,q.anno_start)}function cf(a,c){de(a,c,q.anno_stop)}function tc(){}function P(a,c,d,e,f){c=Ua(c);d=cb(d);F+=a.replace(/X|Y|A|B|F|G/g,function(a){switch(a){case "X":return c.toFixed(1);case "Y":return d.toFixed(1);case "A":return e;case "B":return f;case "F":return e.toFixed(1);default:return f.toFixed(1)}})}function Ob(a,c,d,e,f){Tb();P('<g transform="translate(X,Y',a,c);d&&(F+=") rotate("+d.toFixed(2));e&&(F=f?F+(") scale("+e.toFixed(2)+", "+f.toFixed(2)):F+(") scale("+e.toFixed(2)));F+=')">\n';
G.g++}function ib(){Tb();G.g--;F+="</g>\n"}function Ua(a){return G.g?a:(a+Wb)/G.scale}function cb(a){return G.g?-a:1==G.scale?ra-a:0<=G.v?(G.dy-a)/E[G.v].scale:G.dy-a}function Qa(a,c,d){a=Ua(a);d=cb(d);F+=a.toFixed(1)+c+d.toFixed(1)}function Za(a,c,d){d?P('<path d="mX Y',a,c):P('<path class="stroke" d="mX Y',a,c)}function Ve(){function a(a,c){var e,f,n,k=a.length;if(k)for(f=0;f<k;f++)if((e=a[f])&&e.length){var m=Ua(e[0][0]);F+='<path class="stroke" stroke-width="1" d="M'+m.toFixed(1)+" "+cb(d.y+c*
f).toFixed(1);for(n=0;;){var l=e.shift();if(!l)break;var r=Ua(l[0]);F+="m"+(r-m+l[1]-n).toFixed(2)+" 0h"+(-l[1]+l[2]).toFixed(2);m=r;n=l[2]}F+='"/>\n'}}var c;for(c=0;c<=R;c++){var d=w[c];d.hlu&&(Ea(c),a(d.hlu,6),a(d.hld,-6))}}function Tb(){var a=[];if(Aa[0].length){for(;;){var c=Aa[0].shift();if(void 0==c)break;a.push(c.toFixed(1))}F+='<text x="'+a.join(",");for(a=[];;){c=Aa[1].shift();if(void 0==c)break;a.push(c.toFixed(1))}F+='"\ny="'+a.join(",");F+='"\n>'+Aa[2]+"</text>\n";Aa[2]=""}if(Aa[3].length){for(F+=
'<path class="sW" d="';;){c=Aa[3].shift();if(void 0==c)break;F+="M"+c.toFixed(1)+" "+Aa[3].shift().toFixed(1)+"v"+Aa[3].shift().toFixed(1)}F+='"/>\n'}}function U(a,c,d){if(Fb[d])be(d),P('<use x="X" y="Y" xlink:href="#A"/>\n',a,c,d);else{var e=Nb[d];e?(a+=e.x*G.scale,c-=e.y,e.sc?P('<text transform="translate(X,Y) scale(A)">B</text>\n',a,c,e.sc,e.c):(Aa[0].push(Ua(a)),Aa[1].push(cb(c)),Aa[2]+=e.c)):"nil"!=d&&x(1,null,"no definition of $1",d)}}function ee(a,c,d){var e=25+3*(d/20|0);var f=15<d?(d-15)/
e|0:0;P('<path class="stroke" stroke-width="1.2"\n\tstroke-dasharray="5,A"\n\td="mX YhB"/>\n',a+(d-e*f-5)/2,c+4,Math.round((e-5)/G.scale),e*f+5)}function Ec(a,c,d,e,f,g){var h=e?2.3:3.5,n=-d;0>d&&(h=-h);a+=h*G.scale;0<=G.v&&(n/=E[G.v].scale);Aa[3].push(Ua(a));Aa[3].push(cb(c));Aa[3].push(n);if(f){c+=d;if(0<d)if(g)if(F+='<path d="',e)for(;0<=--f;)P("MX Yl3 1.5 0 2 -3 -1.5z\n",a,c),c-=3;else for(;0<=--f;)P("MX Yl7 3.2 0 3.2 -7 -3.2z\n",a,c),c-=5.4;else if(e)if(F+='<path d="',1==f)P("MX Yc0.6 3.4 5.6 3.8 3 10\n\t1.2 -4.4 -1.4 -7 -3 -7\n",
a,c);else for(;0<=--f;)P("MX Yc1 3.2 5.6 2.8 3.2 8\n\t1.4 -4.8 -2.4 -5.4 -3.2 -5.2\n",a,c),c-=3.5;else{U(a,c,"flu"+f);return}else if(g){if(F+='<path d="',!e)for(;0<=--f;)P("MX Yl7 -3.2 0 -3.2 -7 3.2z\n",a,c),c+=5.4}else if(e)if(F+='<path d="',1==f)P("MX Yc0.6 -3.4 5.6 -3.8 3 -10\n\t1.2 4.4 -1.4 7 -3 7\n",a,c);else for(;0<=--f;)P("MX Yc1 -3.2 5.6 -2.8 3.2 -8\n\t1.4 4.8 -2.4 5.4 -3.2 5.2\n",a,c),c+=3.5;else{U(a,c,"fld"+f);return}F+='"/>\n'}}function Ub(a,c,d){P('<path class="stroke" stroke-width="0.8" d="mX YhF"/>\n',
a,c+1,d)}function fe(a,c,d){var e=d.dd.glyph;if("fng"==e)P('<text x="X" y="Y" style="font-size:14px">A</text>\n',a-2,c+1,Bb(d.dd.str));else{if("@"==e)e="at";else if(!/^[A-Za-z][A-Za-z\-_]*$/.test(e)){x(1,d.s,"No function for decoration '$1'",d.dd.name);return}var f=uc[e];f?f.style&&(vb+="\n."+e+"{"+f.style+"}",delete f.style):f=uc.crdc;a+=f.dx;c+=f.dy;P('<text x="X" y="Y" class="A"B>',a,c,e,f.anchor||"");ea("annotation");F+=Sb(d.dd.str);F+="</text>\n"}}function ge(a,c,d){Ob(a,c,270);a=0;for(d=Math.ceil(d/
6);0<=--d;)U(a,6,"ltr"),a+=6;ib()}function he(a,c,d){c+=4;for(d=Math.ceil(d/6);0<=--d;)U(a,c,"ltr"),a+=6}function bd(a,c,d,e,f){if(ie[d])ie[d](a,c,e,f);else x(1,null,"No function for decoration '$1'",d)}function je(a,c){c=cc(a,c);switch(c[0]){case m.OVAL:a="\ueca2";break;case m.EMPTY:a="\ueca3";break;default:switch(c[2]){case 2:a="\ueca9";break;case 1:a="\ueca7";break;default:a="\ueca5"}}c[1]&&(a+='<tspan dx=".1em">\uecb7</tspan>');return a}function ke(a){var c,d=0,e=[];if(!a.tempo_str){t.musicfont.used||
la("music");ea("tempo");a.tempo_str1&&(e.push(a.tempo_str1),d+=qa(a.tempo_str1)[0]);if(a.tempo_notes){var f=' dy="-1"';for(c=0;c<a.tempo_notes.length;c++){var g=je(a,a.tempo_notes[c]);e.push('<tspan\nclass="'+ob(t.musicfont)+'" style="font-size:'+(1.3*C.curfont.size).toFixed(1)+'px"'+f+">"+g+"</tspan>");g=1<g.length?2:1;d+=g*C.curfont.swfac;f=""}e.push('<tspan dy="1">=</tspan>');d+=nb("=")*C.curfont.swfac;a.tempo_ca&&(e.push(a.tempo_ca),d+=qa(a.tempo_ca)[0]);a.tempo?(e.push(a.tempo),d+=qa(a.tempo.toString())[0]):
(g=je(a,a.new_beat),e.push('<tspan\nclass="'+ob(t.musicfont)+'" style="font-size:'+(1.3*C.curfont.size).toFixed(1)+'px" dy="-1">'+g+"</tspan>"),g=1<g.length?2:1,d+=g*C.curfont.swfac,f="y")}a.tempo_str2&&(f?e.push('<tspan\n\tdy="1">'+a.tempo_str2+"</tspan>"):e.push(a.tempo_str2),d+=qa(a.tempo_str2)[0]);a.tempo_str=e.join(" ");d+=nb(" ")*C.curfont.swfac*(e.length-1);a.tempo_wh=[d,13]}}function kd(a,c,d){ea("tempo");if(C.curfont.box){C.curfont.box=!1;var e=C.curfont.size+4}F+='<text class="'+ob(C.curfont)+
'" x="';Qa(c,'" y="',d+.22*C.curfont.size);F+='">'+a.tempo_str+"</text>\n";e&&(C.curfont.box=!0,F+='<rect class="stroke" x="',Qa(c-2,'" y="',d+e-1),F+='" width="'+(a.tempo_wh[0]+4).toFixed(1)+'" height="'+e.toFixed(1)+'"/>\n');a.invis=!0}function ma(a){ra+=a}function ub(){if(!da&&q.img_out&&0!=ra){var a=sa?sa.fmt:t;var c=Math.ceil(a.trimsvg||1==a.singleline?t.leftmargin+W.wx*t.scale+t.rightmargin+2:W.width),d='<svg xmlns="http://www.w3.org/2000/svg" version="1.1"\n\txmlns:xlink="http://www.w3.org/1999/xlink"\n\tfill="currentColor" stroke-width=".7"',
e="";Tb();a=la("music");d+=' class="'+ob(a)+" tune"+Lc.length+'"\n';ra*=t.scale;d=void 0!=q.imagesize?d+q.imagesize:d+(' width="'+c+'px" height="'+ra.toFixed(0)+'px"');d+=' viewBox="0 0 '+c+" "+ra.toFixed(0)+'"';if(t.fgcolor||t.bgcolor)d+=' style="'+(t.fgcolor?"color:"+t.fgcolor+";":"")+(t.bgcolor?"background-color:"+t.bgcolor:"")+'"';d+=">\n"+$c;if(vb||wb)d+="<style>"+wb+vb+"\n</style>\n";sc&&(d+="<defs>"+sc+"\n</defs>\n");1!=t.scale&&(d+='<g class="g" transform="scale('+t.scale.toFixed(2)+')">\n',
e="</g>\n");le&&le.ps_flush(!0);if(0<xa)q.img_out(1==xa?'<div class="nobrk">':'<div class="nobrk newpage">'),xa=-1;else if(0>xa&&t.splittune){var f=1;xa=0}q.img_out(d+F+e+"</svg>");f&&q.img_out("</div>");wb=F="";if(t.fullsvg)for(Zc={},f=0;f<abc2svg.font_tb.length;f++)abc2svg.font_tb[f].used=!1;else $c=vb="";sc="";ra=0;W.wx=0}}function Xa(){ub();0>xa&&!v.state&&(q.img_out("</div>"),xa=0)}function wf(){function a(a,c){c=new RegExp(c);if(c.test(l.id)||c.test(l.nm))for(c=0;c<a.length;c++)Q.do_pscom(a[c])}
var c;if(v.voice_opts)for(c in v.voice_opts)v.voice_opts.hasOwnProperty(c)&&a(v.voice_opts[c],c);if(v.tune_v_opts)for(c in v.tune_v_opts)v.tune_v_opts.hasOwnProperty(c)&&a(v.tune_v_opts[c],c)}function ha(a){var c=l.time;a.fname||sb(a);l.ignore?a.bar_type&&(l.last_bar=a):(a.prev=l.last_sym)?l.last_sym.next=a:l.sym=a;l.last_sym=a;a.v=l.v;a.p_v=l;a.st=l.cst;a.time=c;a.dur&&!a.grace&&(l.time+=a.dur);v.ufmt=!0;a.fmt=t;a.pos=l.pos;l.second&&(a.second=!0);l.floating&&(a.floating=!0);l.eoln&&(a.soln=!0,l.eoln=
!1)}function Hd(a,c){c={type:c,dur:0};var d=l;l=a;ha(c);l=d;a=c.prev;a||(a=c.next);a&&(c.fname=a.fname,c.istart=a.istart,c.iend=a.iend);return c}function me(a){var c={voices:[],staves:[],top_voice:0};if(a)L=J=c;else{for(a=0;a<E.length;a++)if(J.voices[a]){var d=J.voices[a].st;d=J.staves[d];var e=E[a];d.staffnonote=e.staffnonote;e.staffscale&&(d.staffscale=e.staffscale)}for(d=0;d<J.staves.length;d++)c.staves[d]=z(J.staves[d]),c.staves[d].flags=0;J=J.next=c}}function Ud(a,c){var d="";if(c&&3!=c)if("object"!=
typeof c)d=["__","_","","^","^^"][c+2];else{var e=c[0];0<e?d+="^":(d+="_",e=-e);d+=e+"/"+c[1]}d+=bb[(a+75)%7];for(e=a;23<=e;e-=7)d+="'";for(e=a;16>e;e+=7)d+=",";return d}function ne(a){if("0"==a[0])return 0;if(0<="123456789-+".indexOf(a[0])){var c=parseInt(a);if(isNaN(c)||-36>c||36<c)y(1,I.bad_transp);else return c+=36,c=40*((c/12|0)-3)+abc2svg.isb40[c%12],"b"==a.slice(-1)&&(c+=4),c}}function oe(){var a=l.ckey;var c=a.time||0;if(!a.k_bagpipe&&!a.k_drum){var d=(l.score|0)+(l.shift|0)+(t.transp|0);
if((l.tr_sco|0)==d)a.k_sf=l.ckey.k_sf;else{Tc()?l.key=a:l.time!=c&&(a=z(a.orig||a),l.new||(a.k_old_sf=l.ckey.k_sf),ha(a));l.ckey=a;t.transp&&l.shift&&y(0,"Mix of old and new transposition syntaxes");l.tr_sco=d;d=abc2svg.b40l5[(d+202)%40]+a.orig.k_sf;-7>d?(d+=12,l.tr_sco-=4):7<d&&(d-=12,l.tr_sco+=4);a.k_none||(a.k_sf=d);for(c=0;40>c&&abc2svg.b40l5[c]!=d;c++);a.k_b40=c;if(a.k_a_acc){var e=c-a.orig.k_b40;var f=[];for(d=0;d<a.k_a_acc.length;d++)c=abc2svg.pab40(a.k_a_acc[d].pit,a.k_a_acc[d].acc)+e,f[d]=
{pit:abc2svg.b40p(c),acc:abc2svg.b40a(c)||3};a.k_a_acc=f}}}}function xf(a){var c,d=0;for(c=0;c<E.length;c++)if(E[c].time>d){var e=E[c];d=e.time}if(!(a.time>=d)){c=l;d-=a.time;d={type:m.MREST,stem:0,multi:0,nhd:0,xmx:0,frm:1,dur:d,dur_orig:d,nmes:d/a.wmeasure,notes:[{pit:18,dur:d}],tacet:a.tacet};var f={type:m.BAR,bar_type:"|",dur:0,multi:0};e.last_sym.bar_type&&(f.bar_type=e.last_sym.bar_type);fa.mrest_p=1;l=a;ha(d);ha(f);l=c}}function Yd(a){var c;for(c=0;c<E.length;c++){var d=E[c];if(d.id==a)return d}d=
z(l);d.v=E.length;d.id=a;d.sym=d.last_sym=null;d.key=z(l.key);d.sls=[];delete d.nm;delete d.snm;delete d.new_name;delete d.lyric_restart;delete d.lyric_cont;delete d.sym_restart;delete d.sym_cont;delete d.have_ly;delete d.tie_s;E.push(d);return d}function Zb(a){if("|"==a||")"==a)if(l.last_note)if(l.last_note.beam_end=!0,oa){l.time!=oa.p_voice.time&&(l.ignore||y(1,"Wrong duration in voice overlay"),l.time>oa.p_voice.time&&(oa.p_voice.time=l.time));l.acc=[];a=oa.p_voice;var c=l.last_sym;if(c.type==
m.SPACE&&a.last_sym.type!=m.SPACE){c.p_v=a;for(c.v=c.p_v.v;c.prev.type==m.SPACE;)c=c.prev,c.p_v=a,c.v=c.p_v.v;var d=c.prev;d.next=null;c.prev=a.last_sym;c.prev.next=c;a.last_sym=l.last_sym;l.last_sym=d}l=a;oa=null}else y(1,"Erroneous end of voice overlay");else y(1,I.nonote_vo),oa&&(l=oa.p_voice,oa=null);else if("("==a)oa?y(1,"Voice overlay already started"):oa={p_voice:l,time:l.time};else if(l.last_note){l.last_note.beam_end=!0;a=l.voice_down;if(!a){a=Yd(l.id+"o");l.voice_down=a;a.time=0;a.second=
!0;a.last_note=null;var e=a.v;if(J.voices[l.v]){J.voices[e]={st:l.st,second:!0};c=J.voices[l.v].range;for(d=0;d<J.voices.length;d++)J.voices[d]&&J.voices[d].range>c&&J.voices[d].range++;J.voices[e].range=c+1}}a.ulen=l.ulen;a.dur_fact=l.dur_fact;a.acc=[];if(oa)l!=oa.p_voice&&l.time!=oa.p_voice.time&&(y(1,"Wrong duration in voice overlay"),l.time>oa.p_voice.time&&(oa.p_voice.time=l.time));else{d=a.time;if(l.ignore)c=l.last_bar;else for(c=l.last_sym;!(c.type==m.BAR||c.time<=d);c=c.prev);oa={bar:c&&c.bar_type?
c.bar_type:"|",p_voice:l,time:c?c.time:l.time}}a.time=oa.time;l=a}else y(1,I.nonote_vo)}function Tc(){var a;if(l.time)return!1;if(!l.last_sym)return!0;for(a=l.last_sym;a;a=a.prev)if(Ha[a.type])return!1;return!0}function pe(a){if("p"==a.clef_type){var c=l.ckey;c.k_drum=1;c.k_sf=0;c.k_b40=2;c.k_map=abc2svg.keys[7];l.key||(l.key=c)}if(!l.time&&Tc())l.clef=a,a.fmt=t;else{if(a.clef_none)c=null;else for(c=l.last_sym;c&&c.time==l.time&&!Ha[c.type];c=c.prev);if(c&&c.time==l.time&&void 0!=c.k_sf){var d=c;
c=c.prev}c&&c.time==l.time&&c.bar_type&&":"!=c.bar_type[0]&&(d=c);d?(c=l.last_sym,l.last_sym=d.prev,ha(a),a.next=d,d.prev=a,l.last_sym=c,a.soln&&(delete a.soln,l.eoln=!0)):ha(a);a.prev&&(a.clef_small=1)}}function Cd(a){a:{var c="FCGDAEB".indexOf(a[0])-1;var d=0;var e={type:m.KEY,dur:0};sb(e);var f=1;if(-1>c)switch(a[0]){case "H":var g=!0;if("p"!=a[1].toLowerCase()){y(1,"Unknown bagpipe-like key");break}e.k_bagpipe=a[1];c="P"==a[1]?0:2;f++;t.temper||(t.temper=new Float32Array([11.62,12.55,1.66,2.37,
3.49,0,1.66,2.37,3.49,4.41,5.53,0,3.49,4.41,5.53,6.63,7.35,4.41,5.53,6.63,7.35,8.19,0,6.63,7.35,8.19,9.39,10.51,0,8.19,9.39,10.51,11.62,12.55,0,10.51,11.62,12.55,1.66,1.66]));break;case "P":y(1,"K:P is deprecated");c=0;g=e.k_drum=!0;break;case "n":if(0==a.indexOf("none")){c=0;e.k_none=!0;f=4;break}default:e.k_map=[];e.k_mode=0;a=[e,tb(a)];break a}if(!g){switch(a[f]){case "#":c+=7;f++;break;case "b":c-=7,f++}a=a.slice(f).trim();switch(a.slice(0,3).toLowerCase()){default:if("m"!=a[0]||" "!=a[1]&&"\t"!=
a[1]&&"\n"!=a[1]){g=!0;break}case "aeo":case "m":case "min":c-=3;d=5;break;case "dor":c-=2;d=1;break;case "ion":case "maj":break;case "loc":c-=5;d=6;break;case "lyd":c+=1;d=3;break;case "mix":--c;d=4;break;case "phr":c-=4,d=2}g||(a=a.replace(/\w+\s*/,""));0==a.indexOf("exp ")&&((a=a.replace(/\w+\s*/,""))||y(1,"No accidental after 'exp'"),e.exp=1);g=a[0];if("^"==g||"_"==g||"="==g){e.k_a_acc=[];f=new H;f.buffer=a;do{g=ab(f);if(!g)break;e.k_a_acc.push(g);for(g=a[f.index];" "==g;)g=a[++f.index]}while("^"==
g||"_"==g||"="==g);a=a.slice(f.index)}else e.exp&&0==a.indexOf("none")&&(c=0,a=a.replace(/\w+\s*/,""))}if(-7>c||7<c)y(1,"Key with double sharps/flats"),c=7<c?c-12:c+12;e.k_sf=c;e.k_map=e.k_bagpipe&&!c?abc2svg.keys[9]:abc2svg.keys[c+7];if(e.k_a_acc)for(e.k_map=new Int8Array(e.k_map),f=e.k_a_acc.length;0<=--f;)g=e.k_a_acc[f],e.k_map[(g.pit+19)%7]=g.acc;e.k_mode=d;e.k_b40=[1,24,7,30,13,36,19,2,25,8,31,14,37,20,3][c+7];a=[e,tb(a)]}c=a[0];d=void 0==c.k_sf&&!c.k_a_acc;a=a[1];d?c.invis=1:c.orig=c;if(1==
v.state){v.ckey=c;d&&(c.k_sf=0,c.k_none=!0,c.k_map=abc2svg.keys[7]);for(d=0;d<E.length;d++)e=E[d],e.ckey=z(c);a.length&&(Qb("*",a),a=[]);fa.ulen||(fa.ulen=m.BLEN/8);Wa();var h=Eb();ma(t.topspace);if(t.titleformat){var n,k;var A={};c=Object.create(yf);d={A:t.infospace,C:t.composerspace,O:t.composerspace,R:t.infospace};e={};var p="";f=t.titleformat;for(g=0;;){for(;" "==f[g];)g++;var r=f[g++];if(!r)break;if("A">r||"Z"<r)switch(r){case "+":var q="+";r=f[g++];break;case ",":p+="\n";default:continue;case "<":q=
"l";r=f[g++];break;case ">":q="r",r=f[g++]}else switch(f[g]){case "-":q="l";g++;break;case "1":q="r";g++;break;case "0":g++;default:q="c"}if(A[r])e[r]++;else{if(!N[r])continue;A[r]=N[r].split("\n");e[r]=1}p+=q+r}var w={l:t.titlespace,c:t.titlespace,r:t.titlespace};h={l:0,c:.5*h,r:h};var u={},x;f=p+"\n";for(g=0;;){u.l=u.c=u.r=k=0;for(n=g;;){q=f[n++];if("\n"==q)break;r=f[n++];if("+"!=q&&!u[q]&&(x=A[r])){(p=c[r])||(p="history");var B=la(p);var F=1.1*B.size;d[r]&&(F+=d[r]);k<F&&(k=F);u[q]=F}}w.l+=k-u.l;
w.c+=k-u.c;for(w.r+=k-u.r;;){q=f[g++];if("\n"==q)break;r=f[g++];if(A[r].length){x=A[r].shift();"+"==f[g]&&(e[r]--,g++,r=f[g++],A[r].length&&(x=x?x+(" "+A[r].shift()):" "+A[r].shift()));(p=c[r])||(p="history");B=la(p);F=1.1*B.size;d[r]&&(F+=d[r]);ea(B);n=h[q];k=w[q]+F;var G=k-.22*B.size;"Q"==r?(Q.set_width(fa.tempo),fa.tempo.invis||("l"!=q&&(ke(fa.tempo),B=fa.tempo.tempo_wh[0],"c"==q&&(B*=.5),n-=B),kd(fa.tempo,n,-k))):x&&("T"==r&&(x=$d(x,"s"==c.T[0])),T(n,-G,x,q));"T"==r&&(p=c.T="subtitle",d.T=t.subtitlespace);
if(1>=e[r])for("T"==r&&(B=la(p),F=1.1*B.size,d[r]&&(F+=d[r]),ea(B));0<A[r].length;)k+=F,x=A[r].shift(),T(n,-G,x,q);e[r]--;w[q]=k}}w.c>w.l&&(w.l=w.c);w.r>w.l&&(w.l=w.r);if(g>=f.length)break;w.c=w.r=w.l}ma(w.l);ma(t.musicspace)}else{if(N.T&&0<=t.writefields.indexOf("T"))for(c=0;;){d=N.T.indexOf("\n",c);if(0>d){Xc(N.T.substring(c),0!=c);break}Xc(N.T.slice(c,d),0!=c);c=d+1}f=g=0;v.ckey.k_bagpipe&&!t.infoline&&0<=t.writefields.indexOf("R")&&(A=N.R);A&&(ea("composer"),f=t.composerspace+C.curfont.size+2,
T(0,-f+.22*C.curfont.size,A));e=N.A;0<=t.writefields.indexOf("C")&&(r=N.C);0<=t.writefields.indexOf("O")&&(q=N.O);if(r||q||t.infoline){ea("composer");0>t.aligncomposer?(w=0,u=" "):0==t.aligncomposer?(w=.5*h,u="c"):(w=h,u="r");if(r||q)for(g=t.composerspace+2,c=0;;){g+=C.curfont.size;d=r?r.indexOf("\n",c):-1;if(0>d){ae(w,-g+.22*C.curfont.size,r?r.substring(c):null,q,u);break}T(w,-g+.22*C.curfont.size,r.slice(c,d),u);c=d+1}((A=A?null:N.R)||e)&&t.infoline&&(ea("info"),g+=t.infospace+C.curfont.size,ae(h,
-g+.22*C.curfont.size,A,e,"r"))}N.P&&0<=t.writefields.indexOf("P")?(ea("parts"),c=t.partsspace+C.curfont.size+C.curfont.pad,g=f+c>g?f+c:g+c,T(0,-g+.22*C.curfont.size,N.P),g+=C.curfont.pad):f>g&&(g=f);ma(g+t.musicspace)}Xa();fa.new_nbar?(C.nbar=fa.new_nbar,fa.new_nbar=0):C.nbar=1;v.state=3;for(r=0;r<E.length;r++)q=E[r],q.ulen=fa.ulen,v.ckey.k_bagpipe&&!q.pos.stm&&(q.pos=z(q.pos),q.pos.stm&=-8,q.pos.stm|=m.SL_BELOW);if(0>La)for(r=E.length,J.nstaff=R=r-1;0<=--r;)q=E[r],delete q.new,q.st=q.cst=r,J.voices[r]=
{st:r,range:r},J.staves[r]={stafflines:q.stafflines||"|||||",staffscale:1}}else d||(l.tr_sco&&(l.tr_sco=void 0),c.k_old_sf=l.ckey.k_sf,l.ckey=c,ha(c));if(!l)if(E.length)l=E[0>La?0:J.top_voice];else{l=vc("1");var I=1}if(e=l.clone)l.clone=null;Uc(l.id+" "+a.join(" "));e&&(l.clone=e);I&&(l.default=1)}function vc(a){var c,d=E[0],e=E.length;if(1==e&&d.default&&(delete d.default,!d.time))return d.id=a,d.init=0,d;for(c=0;c<e;c++)if(d=E[c],d.id==a)return d;d={v:c,id:a,time:0,new:!0,pos:{},scale:1,ulen:fa.ulen,
dur_fact:1,meter:z(fa.meter),wmeasure:fa.meter.wmeasure,staffnonote:1,clef:{type:m.CLEF,clef_auto:!0,clef_type:"a",time:0},acc:[],sls:[],hy_st:0};E.push(d);3==v.state&&(d.ckey=z(v.ckey),d.ckey.k_bagpipe&&!d.pos.stm&&(d.pos=z(d.pos),d.pos.stm&=-8,d.pos.stm|=m.SL_BELOW));return d}function zd(){R=-1;E=[];l=null;me(!0);La=-1;C={};O=[];Mb={}}function cd(){var a=l.clone;var c=a.vs,d=a.a,e=a.bol,f=v.eol,g=v,h=v.file;delete l.clone;"["==h[f-1]&&f--;qb++;for(a=0;a<c.length;a++)v=Object.create(g),v.line=Object.create(g.line),
Uc(c[a]+" "+d.join(" ")),Kc(v.fname,h,e,f);qb--;v=g}function Uc(a){var c=tb(a),d=c.shift();if(d)if(l&&l.clone&&cd(),a=0<d.indexOf(",")?d.split(","):[d],2>v.state)for(;;){d=a.shift();if(!d)break;c.length&&Qb(d,c);"*"!=d&&1==v.state&&(l=vc(d))}else if("*"==d)y(1,"Cannot have V:* in tune body");else{l=vc(a[0]);1<a.length&&(a.shift(),l.clone={vs:a,a:c.slice(0),bol:v.iend},"]"!=v.file[l.clone.bol-1]&&l.clone.bol++);wd(c);oe();a=l.v;if(l.new)if(delete l.new,0>La)l.st=l.cst=++R,J.nstaff=R,J.voices[a]={st:R,
range:a},J.staves[R]={stafflines:l.stafflines||"|||||",staffscale:1};else if(!J.voices[a]){l.ignore=1;return}!l.filtered&&J.voices[a]&&(v.voice_opts||v.tune_v_opts)&&(l.filtered=!0,wf())}}function ef(a,c){var d;if(!l.ignore){if(c){if(c=l.sym_cont,!c){y(1,"+: symbol line without music");return}}else if(l.sym_restart&&(l.sym_start=l.sym_restart,l.sym_restart=null),c=l.sym_start,c||(c=l.sym),!c){y(1,"s: without music");return}for(d=0;;){for(;" "==a[d]||"\t"==a[d];)d++;var e=a[d];if(!e)break;switch(e){case "|":for(;c&&
c.type!=m.BAR;)c=c.next;if(!c){y(1,"Not enough measure bars for symbol line");return}c=c.next;d++;continue;case "!":case '"':var f=++d;d=a.indexOf(e,f);if(0>d){y(1,"!"==e?"No end of decoration":"No end of chord symbol/annotation");d=a.length;continue}var g=a.slice(f-1,d+1);break;case "*":break;default:g=e.charCodeAt(0);if(128>g&&(g=Ja[g],1<g.length&&("!"==g[0]||'"'==g[0]))){e=g[0];break}y(1,I.bad_char,e)}for(;c&&c.type!=m.NOTE;)c=c.next;if(!c){y(1,"Too many elements in symbol line");return}switch(e){case "!":ja.push(g.slice(1,
-1));yb(c,c.prev);break;case '"':Zd(g),za&&pc(c)}c=c.next;d++}l.sym_cont=c}}function ff(a,c){var d;if(!l.ignore){(l.pos.voc&7)!=m.SL_HIDDEN&&(l.have_ly=!0);if(c){c=l.lyric_cont;if(!c){y(1,"+: lyric without music");return}var e=la("vocal");C.deffont!=e&&(C.curfont==C.deffont&&(C.curfont=e),C.deffont=e)}else if(ea("vocal"),l.lyric_restart?(l.lyric_start=c=l.lyric_restart,l.lyric_restart=null,l.lyric_line=0):(l.lyric_line++,c=l.lyric_start),c||(c=l.sym),!c){y(1,"w: without music");return}e=0;for(d=C.curfont;;){for(;" "==
a[e]||"\t"==a[e];)e++;if(!a[e])break;var f=0;var g=v.istart+e+2;switch(a[e]){case "|":for(;c&&c.type!=m.BAR;)c=c.next;if(!c){y(1,"Not enough measure bars for lyric line");return}c=c.next;e++;continue;case "-":case "_":var h=a[e];f="-"==a[e]?2:3;break;case "*":h="";break;default:for(h="";a[e];){switch(a[e]){case "_":case "*":case "|":e--;case " ":case "\t":break;case "~":h+=" ";e++;continue;case "-":f=1;break;case "\\":if(!a[++e])continue;h+=a[e++];continue;case "$":h+=a[e++];var n=a[e];"0"==n?C.curfont=
C.deffont:"1"<=n&&"9">=n&&(C.curfont=la("u"+n));default:h+=a[e++];continue}break}}for(;c&&c.type!=m.NOTE;)c=c.next;if(!c){y(1,"Too many words in lyric line");return}h&&(c.pos.voc&7)!=m.SL_HIDDEN&&(h={t:h,font:d,istart:g,iend:g+h.length},f&&(h.ln=f),c.a_ly||(c.a_ly=[]),c.a_ly[l.lyric_line]=h,d=C.curfont);c=c.next;e++}l.lyric_cont=c}}function Oc(a){var c,d,e,f=a,g=0,h=0,n=0,k=0,l=a.a_ly,p=0;for(e=a.ts_next;e;e=e.ts_next){e.shrink&&(k+=e.shrink,n++);if(e.bar_type){k+=3;break}if(e.a_ly){for(c=e.a_ly.length;0<=
--c&&(!(d=e.a_ly[c])||d.ln&&!(2>d.ln)););if(0<=c)break}}for(c=0;c<l.length;c++)if(d=l[c]){C.curfont=d.font;d.t=Sb(d.t);var r=d.t.replace(/<[^>]*>/g,"");if(2<=d.ln)d.shift=0;else{var q=nb(" ")*d.font.swfac;var t=d.t.wh[0];if(a.type==m.GRACE)var u=a.wl;else if("0"<=r[0]&&"9">=r[0]&&2<r.length||":"==r[1]||"("==r[0]||")"==r[0]){if("("==r[0])var v=q;else v=r.indexOf(" "),ea(d.font),v=0<v?qa(r.slice(0,v))[0]:.2*t;u=.4*(t-v);14<u&&(u=14);u+=v;"0"<=r[0]&&"9">=r[0]&&u>p&&(p=u)}else u=.4*t,14<u&&(u=14);d.shift=
u;u>h&&(h=u);t+=1.5*q;t-=u;t>g&&(g=t)}}for(;!f.seqst;)f=f.ts_prev;f.ts_prev&&f.ts_prev.bar_type&&(h-=4);f.wl<h&&(f.shrink+=h-f.wl,f.wl=h);k-=6;if(k<g)for(k=(g-k)/n,a=a.ts_next;;){a.shrink&&(a.shrink+=k,f.wr+=k,f=a);if(a==e)break;a=a.ts_next}if(0<p)for(c=0;c<l.length;c++)(d=l[c])&&"0"<=d.t[0]&&"9">=d.t[0]&&(d.shift=p)}function qe(a,c,d){var e,f,g;if(a.hy_st&1<<c){var h=!0;a.hy_st&=~(1<<c)}for(e=a.sym;e.type==m.CLEF||e.type==m.KEY||e.type==m.METER;e=e.next);var n=e.prev?e.prev.x:M.x;for(g=0;e;e=e.next)if(f=
e.a_ly?e.a_ly[c]:null){f.font!=C.curfont&&(C.curfont=f.font);var k=f.t;var l=f.ln||0;var p=k.wh[0];var r=f.shift;h&&(3==l?l=2:2>l&&(ee(n,d,e.x-r-n),h=!1,n=e.x+e.wr));if(t&&3!=l){Ub(n+3,d,g-n+3);var t=!1;n=e.x+e.wr}if(2<=l)0==g&&n>e.x-18&&(n=e.x-18),2==l?h=!0:t=!0,g=e.x-r;else{g=e.x-r;l&&(h=!0);if(q.anno_start||q.anno_stop){var v={p_v:e.p_v,st:e.st,istart:f.istart,iend:f.iend,ts_prev:e,ts_next:e.ts_next,x:g,y:d,ymn:d,ymx:d+C.curfont.size,wl:0,wr:p};wa(v,"lyrics")}T(g,d,k);Ab(v,"lyrics");n=g+p}}else switch(e.type){case m.REST:case m.MREST:t&&
(Ub(n+3,d,g-n),t=!1,n=e.x+e.wr)}h&&(g=ia-10,g<n+10&&(g=n+10),ee(n,d,g-n),a.s_next&&a.s_next.fmt.hyphencont&&(a.hy_st|=1<<c));for(a.s_next;e;e=e.next)if(e.type==m.NOTE){if(!e.a_ly)break;(f=e.a_ly[c])&&3==f.ln&&(t=!0,g=ia-15,g<n+12&&(g=n+12));break}t&&Ub(n+3,d,g-n+3)}function re(a,c,d,e,f){var g=w[a.st].staffscale;ea("vocal");if(0<f){e>-M.fmt.vocalspace&&(e=-M.fmt.vocalspace);e*=g;for(f=0;f<c;f++)e-=1.1*d[f],qe(a,f,e+.22*d[f]);return e/g}f=w[a.st].topbar+M.fmt.vocalspace;e<f&&(e=f);e*=g;for(f=c;0<=
--f;)qe(a,f,e+.22*d[f]),e+=1.1*d[f];return e/g}function Re(){var a,c,d,e,f,g=Array(R+1),h=E.length,n=Array(h),k=Array(h),l=Array(h),p=Array(h),r=0,q=0,t=-1;for(c=0;c<h;c++){var u=E[c];if(u.sym){u.st!=t&&(q=r=0,t=u.st);var v=0;if(u.have_ly)for(n[c]||(n[c]=[]),a=u.sym;a;a=a.next){if(e=a.a_ly){var w=a.x;var x=10;for(d=0;d<e.length;d++)if(f=e[d]){w-=f.shift;x=f.t.wh[0];break}d=aa(u.st,1,w,x);r<d&&(r=d);d=aa(u.st,0,w,x);for(q>d&&(q=d);v<e.length;)n[c][v++]=0;for(d=0;d<e.length;d++)(f=e[d])&&(!n[c][d]||
f.t.wh[1]>n[c][d])&&(n[c][d]=f.t.wh[1])}}else d=aa(u.st,1,0,ia),r<d&&(r=d),d=aa(u.st,0,0,ia),q>d&&(q=d);g[t]||(g[t]={});g[t].top=r;g[t].bot=q;k[c]=v;0!=v&&(l[c]=u.pos.voc?(u.pos.voc&7)==m.SL_ABOVE:E[c+1]&&E[c+1].st==t&&E[c+1].have_ly?!0:!1,l[c]?g[t].a=!0:g[t].b=!0)}}for(c=d=0;c<h;c++)u=E[c],u.sym&&u.have_ly&&(l[c]?p[d++]=c:(t=u.st,Da(t,!0),0<k[c]&&(g[t].bot=re(u,k[c],n[c],g[t].bot,1))));for(;0<=--d;)c=p[d],u=E[c],t=u.st,Da(t,!0),g[t].top=re(u,k[c],n[c],g[t].top,-1);for(c=0;c<h;c++)if(u=E[c],u.sym){t=
u.st;if(g[t].a)for(r=g[t].top+2,a=u.sym;a;a=a.next)a.a_ly&&ba(t,1,a.x-2,10,r);if(g[t].b)if(q=g[t].bot-2,0<k[u.v])for(a=u.sym;a;a=a.next)a.a_ly&&ba(t,0,a.x-2,10,q);else ba(t,0,0,ia,q)}}function Zd(a){function c(){for(var a="";;){q=n[d++];if(0>"1234567890.-".indexOf(q))return parseFloat(a);a+=q}}var d,e=la("annotation"),f=e.size;var g=v.line;var h=v.bol+g.index;if(1<a.length){var n=a.slice(1,-1);var k=h+1}else{for(d=++g.index;;){a=g.buffer.indexOf('"',d);if(0>a){y(1,"No end of chord symbol/annotation");
return}if("\\"!=g.buffer[a-1]||"\\"==g.buffer[a-2])break;d=a+1}n=Rb(g.buffer.slice(g.index,a));g.index=a;k=v.bol+g.index+1}e.pad&&(f+=e.pad);d=0;for(a="g";;){var q=n[d];if(!q)break;g={text:"",istart:h,iend:k,font:e};switch(q){case "@":a=q;d++;var p=c();if(","!=q){y(1,"',' lacking in annotation '@x,y'");var r=0}else r=c()," "!=q&&d--;g.x=p;g.y=r;break;case "^":g.pos=m.SL_ABOVE;case "_":"_"==q&&(g.pos=m.SL_BELOW);case "<":case ">":d++;a=q;break;default:switch(a){case "g":g.font=la("gchord");g.pos=l.pos.gch||
m.SL_ABOVE;break;case "^":g.pos=m.SL_ABOVE;break;case "_":g.pos=m.SL_BELOW;break;case "@":g.x=p,r-=f,g.y=r}}for(g.type=a;;){q=n[d];if(!q)break;switch(q){default:g.text+=q;d++;continue;case "&":for(;;){g.text+=q;q=n[++d];switch(q){default:continue;case ";":case void 0:case "\\":}break}if(";"==q){d++;g.text+=q;continue}case "\n":case ";":}d++;break}g.otext=g.text;za||(za=[]);za.push(g)}}function se(a,c){var d,e=a.split("/");c=abc2svg.b40l5[(c+202)%40];for(d=0;d<e.length;d++){a=e[d];var f=a.search(/[A-G]/);
if(!(0>f)){var g=f+1;var h="FCGDAEB".indexOf(a[f])-1;if("#"==a[g]||"\u266f"==a[g])h+=7,g++;else if("b"==a[g]||"\u266d"==a[g])h-=7,g++;h+=c;e[d]=a.slice(0,f)+"FCGDAEB"[(h+22)%7]+(13<=h?"##":6<=h?"#":-9>=h?"bb":-2>=h?"b":"")+a.slice(g)}}return e.join("/")}function pc(a){var c;if(a.type==m.BAR)for(c=0;c<za.length;c++)"g"==za[c].type&&(x(1,a,"There cannot be chord symbols on measure bars"),za.splice(c));if(l.tr_sco)for(c=0;c<za.length;c++){var d=za[c];"g"==d.type&&(d.text=se(d.text,l.tr_sco))}a.a_gch=
a.a_gch?a.a_gch.concat(za):za;za=null}function Ie(){function a(a){var c,d,f;for(d=e;d;d=d.ts_next)if(c=d.a_gch){var g=c.length-a-1;if(c=c[g]){if(c.pos==m.SL_ABOVE){var h=d.x+c.x;(f=c.text.wh[0])&&h+f>ia&&(h=ia-f);f=aa(d.st,1,h,f);"g"==c.type&&f<k[d.st].yup&&(f=k[d.st].yup)}else if(c.pos==m.SL_BELOW||c.pos==m.SL_HIDDEN)continue;else h=d.x+c.x,f=c.y;Q.draw_gchord(g,d,h,f)}}}function c(a){for(var c,d,f,g=e;g;g=g.ts_next)(c=g.a_gch)&&(c=c[a])&&c.pos==m.SL_BELOW&&(d=g.x+c.x,(f=c.text.wh[0])&&d+f>ia&&(d=
ia-f),f=aa(g.st,0,d,f)-2,"g"==c.type&&f>k[g.st].ydn&&(f=k[g.st].ydn),Q.draw_gchord(a,g,d,f))}var d,e,f,g,h,n=0,k=Array(R+1);for(g=0;g<=R;g++)k[g]={ydn:w[g].botbar-3,yup:w[g].topbar+4};for(d=M;d;d=d.ts_next)if(f=d.a_gch)for(e||(e=d),g=f.length,g>n&&(n=g);0<=--g;)if("g"==f[g].type){f=f[g];g=d.x+f.x;(h=f.text.wh[0])&&g+h>ia&&(g=ia-h);f.pos==m.SL_ABOVE?(f=aa(d.st,!0,g,h),f>k[d.st].yup&&(k[d.st].yup=f)):f.pos==m.SL_BELOW&&(f=aa(d.st,!1,g,h)-2,f<k[d.st].ydn&&(k[d.st].ydn=f));break}if(e)for(Da(-1),g=0;g<
n;g++)a(g),c(g)}var m=abc2svg.C,Ca,I={bad_char:"Bad character '$1'",bad_grace:"Bad character in grace note sequence",bad_transp:"Bad transpose value",bad_val:"Bad value in $1",bar_grace:"Cannot have a bar in grace notes",ignored:"$1: inside tune - ignored",misplaced:"Misplaced '$1' in %%score",must_note:"!$1! must be on a note",must_note_rest:"!$1! must be on a note or a rest",nonote_vo:"No note in voice overlay",not_ascii:"Not an ASCII character",not_enough_n:"Not enough notes/rests for %%repeat",
not_enough_m:"Not enough measures for %%repeat",not_enough_p:"Not enough parameters in %%map",not_in_tune:"Cannot have '$1' inside a tune",notransp:"Cannot transpose with a temperament"},Q=this,fa={meter:{type:m.METER,wmeasure:1,a_meter:[]}},N={},v={ctx:{},prefix:"%",state:0,ottava:[],line:new H},Lc=[],le,Pa={},O,Mb,Lb={dot:"0 stc 6 1.5 1",tenuto:"0 emb 6 4 3",slide:"1 sld 3 7 1",arpeggio:"2 arp 12 10 3",roll:"3 roll 5,4 5 6",lowermordent:"3 lmrd 6,5 4 6",uppermordent:"3 umrd 6,5 4 6",trill:"3 trl 14 5 8",
upbow:"3 upb 10,2 3 7",downbow:"3 dnb 9 4 6",gmark:"3 grm 7 4 6",wedge:"0 wedge 8 1.5 1",longphrase:"5 lphr 0 1 16",mediumphrase:"5 mphr 0 1 16",shortphrase:"5 sphr 0 1 16",turnx:"3 turnx 7,2.5 5 6",invertedturn:"3 turn 7,2 5 6",0:"3 fng 5,5 3 3 0",1:"3 fng 5,5 3 3 1",2:"3 fng 5,5 3 3 2",3:"3 fng 5,5 3 3 3",4:"3 fng 5,5 3 3 4",5:"3 fng 5,5 3 3 5",plus:"3 dplus 8,2 2 4","+":"3 dplus 8,2 2 4",">":"5 accent 3.5,3.5 4 4",accent:"5 accent 3.5,3.5 4 4",emphasis:"5 accent 3.5,3.5 4 4",marcato:"3 marcato 9 5 5",
"^":"3 marcato 9 5 5",mordent:"3 lmrd 6,5 4 6",open:"3 opend 8 3 3",snap:"3 snap 10 3 3",thumb:"3 thumb 10 3 3",turn:"3 turn 7,2.5 5 6","trill(":"5 ltr 8 0 0","trill)":"5 ltr 8 0 0","8va(":"5 8va 12 6 6","8va)":"5 8va 12 6 6","8vb(":"4 8vb 10,5 6 6","8vb)":"4 8vb 10,5 6 6","15ma(":"5 15ma 12 9 9","15ma)":"5 15ma 12 9 9","15mb(":"4 15mb 12 9 9","15mb)":"4 15mb 12 9 9",breath:"5 brth 0 1 16",caesura:"5 caes 0 1 20",short:"5 short 0 1 16",tick:"5 tick 0 1 16",coda:"5 coda 22,5 10 10",dacapo:"5 dacs 16 20 20 Da Capo",
dacoda:"5 dacs 16 20 20 Da Coda","D.C.":"5 dcap 16,3 6 6","D.S.":"5 dsgn 16,3 6 6","D.C.alcoda":"5 dacs 16 32 32 D.C. al Coda","D.S.alcoda":"5 dacs 16 32 32 D.S. al Coda","D.C.alfine":"5 dacs 16 32 32 D.C. al Fine","D.S.alfine":"5 dacs 16 32 32 D.S. al Fine",fermata:"5 hld 12 7.5 7.5",fine:"5 dacs 16 12 12 Fine",invertedfermata:"7 hld 12 8 8",segno:"5 sgno 22,2 5 5",f:"6 f 12,5 3 4",ff:"6 ff 12,5 8 5",fff:"6 fff 12,5 11 9",ffff:"6 ffff 12,5 15 12",mf:"6 mf 12,5 8 10",mp:"6 mp 12,5 9 10",p:"6 p 12,5 3 6",
pp:"6 pp 12,5 8 9",ppp:"6 ppp 12,5 14 11",pppp:"6 pppp 12,5 14 17",pralltriller:"3 umrd 6,5 4 6",sfz:"6 sfz 12,5 9 9",ped:"6 ped 9 6 10","ped-up":"6 pedoff 9 4 4","ped(":"7 lped 14 1 1","ped)":"7 lped 14 1 1","crescendo(":"6 cresc 15,2 0 0","crescendo)":"6 cresc 15,2 0 0","<(":"6 cresc 15,2 0 0","<)":"6 cresc 15,2 0 0","diminuendo(":"6 dim 15,2 0 0","diminuendo)":"6 dim 15,2 0 0",">(":"6 dim 15,2 0 0",">)":"6 dim 15,2 0 0","-(":"8 gliss 0 0 0","-)":"8 gliss 0 0 0","~(":"8 glisq 0 0 0","~)":"8 glisq 0 0 0",
invisible:"32 0 0 0 0",beamon:"33 0 0 0 0",trem1:"34 0 0 0 0",trem2:"34 0 0 0 0",trem3:"34 0 0 0 0",trem4:"34 0 0 0 0",xstem:"35 0 0 0 0",beambr1:"36 0 0 0 0",beambr2:"36 0 0 0 0",rbstop:"37 0 0 0 0","/":"38 0 0 6 6","//":"38 0 0 6 6","///":"38 0 0 6 6","beam-accel":"39 0 0 0 0","beam-rall":"39 0 0 0 0",stemless:"40 0 0 0 0",rbend:"41 0 0 0 0",editorial:"42 0 0 0 0","sacc-1":"3 sacc-1 6,4 4 4",sacc3:"3 sacc3 6,5 4 4",sacc1:"3 sacc1 6,4 4 4",courtesy:"43 0 0 0 0","cacc-1":"3 cacc-1 0 0 0",cacc3:"3 cacc3 0 0 0",
cacc1:"3 cacc1 0 0 0","tie(":"44 0 0 0 0","tie)":"44 0 0 0 0",fg:"45 0 0 0 0"},hd=[function(a){var c=a.up,d=a.s,e=a.dd;var f=c?d.ymx:d.ymn;0<f&&24>f&&(f=6*((f+9)/6|0)-6);c?(f+=e.hd,d.ymx=f+e.h):"w"==e.name[0]?(a.inv=!0,f-=e.h,d.ymn=f):(f-=e.h,d.ymn=f-e.hd);a.x-=e.wl;a.y=f;d.type==m.NOTE&&(a.x+=d.notes[0<=d.stem?0:d.nhd].shhd);"d"==e.name[0]&&(d.beam_st&&d.beam_end?c&&0<d.stem&&(f=d.y+.6*(f-d.y),27<=f&&(a.y=f,d.ymx=a.y+e.h)):c?0<d.stem&&(a.x+=3.5):0>d.stem&&(a.x-=3.5))},function(a){var c,d=a.s,e=d.notes[0].pit,
f=5;for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)var g=4+d.notes[c].shac;else switch(g=5-d.notes[c].shhd,d.head){case m.SQUARE:g+=3.5;break;case m.OVALBARS:case m.OVAL:g+=2}d.notes[c].pit<=e+3&&g>f&&(f=g)}a.x-=f;a.y=3*(e-18)},function(a){var c,d=a.s,e=a.dd,f=e.wr;if(d.type==m.NOTE)for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)var g=d.notes[c].shac;else switch(g=1-d.notes[c].shhd,d.head){case m.SQUARE:g+=3.5;break;case m.OVALBARS:case m.OVAL:g+=2}g>f&&(f=g)}g=3*(d.notes[d.nhd].pit-d.notes[0].pit)+4;c=e.h;g<c&&
(g=c);a.has_val=!0;a.val=g;a.x-=f;a.y=3*((d.notes[0].pit+d.notes[d.nhd].pit)/2-18)-g/2-3}],jd=[null,null,null,xb,xb],Bc=[null,null,null,null,null,xb,xb,xb];Abc.prototype.draw_all_deco=function(){if(O.length){var a,c,d=[],e=[];var f=R;for(c=w[f].y;0<=--f;){var g=w[f].y;e[f]=.5*(c+24+g);c=g}for(;;){var h=O.shift();if(!h)break;if((a=h.dd)&&!a.dd_en){var n=h.s;var k=a.glyph;c=k.indexOf("/");0<c&&(k=0<=n.stem?k.slice(0,c):k.slice(c+1));Bc[a.func]?Ea(n.st):Hb(n);f=h.st;if(w[f].topbar){var l=h.x+(a.dx||
0);c=h.y+w[f].y+(a.dy||0);if(void 0!=h.m)f=n.notes[h.m],f.shhd&&(l+=f.shhd*G.scale);else if(6==a.func&&((h.pos&m.SL_ALI_MSK)==m.SL_CENTER||0==(h.pos&m.SL_ALI_MSK)&&!n.fmt.dynalign)&&(h.up&&0<f||!h.up&&f<R)){var p=h.up?e[--f]:e[f++];p-=.5*a.h;if(h.up&&c<p||!h.up&&c>p)if(g=aa(f,!h.up,h.x,h.val)+w[f].y,h.up&&(g-=a.h),h.up&&g>p||!h.up&&g<p)c=p,1!=G.scale&&(c+=G.dy/2)}if(q.deco&&(f=q.deco[k])&&"function"==typeof f){f.call(Q,l,c,h);continue}if(!Q.psdeco(l,c,h)){wa(n,"deco");h.inv&&(c=c+a.h-a.hd,Ob(l,c,
0,1,-1),l=c=0);if(h.has_val)2!=a.func||0>G.st?bd(l,c,k,h.val/G.scale,h.defl):bd(l,c,k,h.val,h.defl),h.cont&&d.push(h.start);else if(void 0==a.str||Nb[a.glyph]||Fb[a.glyph])if(h.lden){var r;a=l;l=h.dd.glyph;k=h.start;if(te[l]){f=h.s.p_v;if(h.defl.noen){for(r=f.s_next;r&&!r.dur;)r=r.next;if(r)for(p=0;p<=r.nhd;p++)if(g=r.notes[p],g.a_dd)for(f=0;f<g.a_dd.length;f++)if(g.a_dd[f].name==h.dd.name){c=3*(g.pit-18)+w[h.s.st].y;break}a+=8}else if(h.defl.nost){for(r=f.s_prev;r&&!r.dur;)r=r.prev;if(r)for(p=0;p<=
r.nhd;p++)if(g=r.notes[p],g.a_dd)for(f=0;f<g.a_dd.length;f++)if(g.a_dd[f].name==k.dd.name){k.y=3*(g.pit-18);break}k.x-=8}te[l](a,c,h)}else x(1,null,"No function for decoration '$1'",l)}else U(l,c,k);else{if(n.fg)a:{f=k=void 0;var t;for(g=n.fg.length;0<=--g&&(f=n.fg[g],f.nm!=a.name););if(!(0>g))if(f.ty)1==f.ty&&Ub(l-19,c,12);else{g=l+7;for(t=0;t<O.length;t++)if(p=O[t],p.s==f.s&&p.dd.name==a.name){for(r=0;r<p.s.fg.length&&(k=p.s.fg[r],k.nm!=f.nm);r++);if(k.nm==f.nm){k.ty=2;Za(g,c+1);F+="l"+(p.x-7-g).toFixed(1)+
" "+(c-p.y-w[n.st].y).toFixed(1)+'" stroke-width=".7"/>\n';break a}}Ub(g,c,12)}}fe(l,c,h)}G.g&&ib();Ab(n,"deco")}}}}O=d}};var Db,Ib=[],zf=[[16,16,14,12,10,10],[14,14,10,9,9,9]];Abc.prototype.calculate_beam=function(a,c){var d,e,f,g,h,n;if(!c.beam_st){var k=ld(c);Nc(k,c);ac(k,c);k.x-=12;k.x>c.prev.x+12&&(k.x=c.prev.x+12);k.beam_st=!0;delete k.beam_end;k.tmp=!0;delete k.sls;c=k}var l=e=0;var p=f=!1;var r=c.st;var q=c.v;var t=c.grace?2.3:3.5;for(d=c;d.type!=m.NOTE||(d.nflags>e&&(e=d.nflags),l++,d.st!=
r&&(p=!0),d.stem!=c.stem&&(f=!0),g||d.invis||d.stemless&&!d.trem2||(g=!0),!d.beam_end);d=d.next)if(!d.next){for(;d.type!=m.NOTE;d=d.prev);k=ld(d);k.next=d.next;k.next&&(k.next.prev=k);d.next=k;k.prev=d;k.ts_next=d.ts_next;k.ts_next&&(k.ts_next.ts_prev=k);d.ts_next=k;k.ts_prev=d;delete k.beam_st;k.beam_end=!0;k.tmp=!0;delete k.sls;k.x+=12;k.x<ia-12&&(k.x=ia-12);d=k;l++;break}if(!g)return!1;a.s2=d;if(0==w[r].y){if(p)return!1}else if(!p)return a.s1=c,a.a=(c.ys-d.ys)/(c.xs-d.xs),a.b=c.ys-c.xs*a.a+w[r].y,
a.nflags=e,!0;var u=c;var v=100;var x=0;for(k=c;k.type!=m.NOTE||(1==(n=k.p_v.scale)&&(n=w[k.st].staffscale),0<=k.stem?(g=t+k.notes[0].shhd,k.notes[k.nhd].midi>x&&(x=k.notes[k.nhd].midi,u=k)):(g=-t+k.notes[k.nhd].shhd,k.notes[0].midi<v&&(v=k.notes[0].midi,u=k)),k.xs=k.x+g*n,k!=d);k=k.next);k.grace&&c.fmt.flatbeams?h=0:!f&&3<=l&&u!=c&&u!=d&&(h=0);g=c.ys+w[r].y;void 0==h&&(f&&c.stem!=d.stem&&c.st==d.st&&(g-=5*c.stem,d.ys-=5*d.stem),h=(d.ys+w[d.st].y-g)/(d.xs-c.xs));0!=h&&(h=c.fmt.beamslope*h/(c.fmt.beamslope+
Math.abs(h)),-.04<h&&.04>h&&(h=0));l=(g+d.ys+w[d.st].y)/2-h*(d.xs+c.xs)/2;t=0;k=c;if(f){for(q=1;;){if(k.stem!=c.stem&&(1==k.nflags||k.beam_br1||k.beam_br2)){q=0;break}if(k==d)break;k=k.next}q=q?(c.nflags+d.nflags)*(c.nflags>=d.nflags?c.stem:d.stem)/4:-(c.nflags*c.stem+d.nflags*d.stem)/2;l+=((c.grace?3.5:5)*q+3.2*c.stem)/2}else if(c.grace)for(;g=h*k.xs+l-w[k.st].y,x=13,x=0<k.stem?x-(g-3*(k.notes[k.nhd].pit-18)):x+(g-3*(k.notes[0].pit-18)),x+=3*(k.nflags-1),x>t&&(t=x),k!=d;k=k.next);else{for(v=3.2+
5*(e-1);k.ts_prev&&k.ts_prev.type==m.NOTE&&k.ts_prev.time==k.time&&k.ts_prev.x>c.xs;)k=k.ts_prev;for(;k&&k.time<=d.time;k=k.ts_next)if(!(k.type!=m.NOTE||k.invis||k.st!=r&&k.v!=q)){g=k.v==q?k.xs:k.x;g=h*g+l-w[k.st].y;if(k.v==q)x=zf[0==k.nhd?0:1][k.nflags],0<k.stem?(26<k.notes[k.nhd].pit&&(x-=2,28<k.notes[k.nhd].pit&&(x-=2)),x-=g-3*(k.notes[k.nhd].pit-18)):(18>k.notes[0].pit&&(x-=2,16>k.notes[0].pit&&(x-=2)),x-=3*(k.notes[0].pit-18)-g),x+=3.2+5*(k.nflags-1);else{if(0<c.stem)if(0<k.stem){if(k.ymn>g+
4||k.ymx<g-v-2)continue;x=k.v>q?k.ymx-g:k.ymn+8-g}else x=k.ymx-g;else if(0>k.stem){if(k.ymx<g-4||k.ymn>g-v-2)continue;x=k.v<q?g-k.ymn:g-k.ymx+8}else x=g-k.ymn;x+=2+v}x>t&&(t=x)}}0<t&&(l+=c.stem*t);if(!p&&!f)for(k=c.next;;k=k.next){switch(k.type){case m.REST:if(!k.multi)break;p=k.ts_next;if(!p||p.st!=r||p.type!=m.NOTE&&p.type!=m.REST)break;if(k.invis)break;case m.CLEF:g=h*k.x+l;0<c.stem?(g=k.ymx-g+3.2+5*(e-1)+2,0<g&&(l+=g)):(g=k.ymn-g-3.2-5*(e-1)-2,0>g&&(l+=g));break;case m.GRACE:for(p=k.extra;p;p=
p.next)g=h*p.x+l,0<c.stem?(g=p.ymx-g+3.2+5*(e-1)+2,0<g&&(l+=g)):(g=p.ymn-g-3.2-5*(e-1)-2,0>g&&(l+=g))}if(k==d)break}0==h&&(l+=Le(c.grace,c.stem,e,l-w[r].y));for(k=c;;k=k.next){switch(k.type){case m.NOTE:k.ys=h*k.xs+l-w[k.st].y;0<k.stem?k.ymx=k.ys+2.5:k.ymn=k.ys-2.5;break;case m.REST:g=h*k.x+l-w[k.st].y;p=3.2+5*(e-1)+(k.head!=m.FULL?4:9);if(0<c.stem){if(g-=p,0==c.multi&&12<g&&(g=12),k.y<=g)break}else if(g+=p,0==c.multi&&12>g&&(g=12),k.y>=g)break;k.head!=m.FULL&&(g=6*((g+3+12)/6|0)-12);k.y=g}if(k==
d)break}if(0==w[r].y)return!1;a.s1=c;a.a=h;a.b=l;a.nflags=e;return!0};var qd={};Abc.prototype.draw_hl=function(a){var c,d,e=[],f=w[a.st];if(f.hll&&!a.invis){for(c=0;c<=a.nhd;c++){var g=a.notes[c];f.hlmap[g.pit-f.hll]||e.push([g.pit-18,g.shhd*G.scale])}if(d=e.length){var h=f.stafflines,n=h.length-1,k=n,l=f.botline/6,m=l,r=a.grace?4:1.3*ue[a.head];g=a.notes[0>a.stem?a.nhd:0];var q=g.shhd;for(c=0;c<e.length;c++){var t=e[c][0];g=(e[c][1]<q?e[c][1]:q)-r;var u=(e[c][1]>q?e[c][1]:q)+r;t<2*l?(t<2*m&&(m=++t>>
1),d--):t>2*n&&(k=t>>1,d--);hb(f,t>>1,a.x,g,u)}g=q-r;for(u=q+r;++m<l;)hb(f,m,a.x,g,u);for(;--k>n;)hb(f,k,a.x,g,u);if(d){c=m;for(d=k;c>l&&"-"==h[c];)c--;for(;d<n&&"-"==h[d];)d++;for(;c<d;c++)"-"==h[c]&&hb(f,c,a.x,g,u)}}}};var ve=new Int8Array([24,9,15,21,6,12,18]),we=new Int8Array([12,18,24,9,15,21,6]),xe=new Int8Array([-9,12,-9,-9,12,-9]),ye=new Int8Array([12,-9,12,-9,12,-9]),ze=new Int8Array([9,-12,9,-12,9,-12]),Ae=new Int8Array([-12,9,-12,9,-12,9]);Abc.prototype.draw_keysig=function(a,c){var d=
c.k_old_sf,e=w[c.st].y,f,g=c.k_y_clef;var h=c.k_a_acc;g&1&&(g+=7);for(g/=2;0>g;)g+=7;g%=7;if(h&&!c.exp){var n=c.k_sf,k;var l=[];var m=[];if(0<n)for(f=0;f<n;f++)l[f]=1,m[f]=[26,23,27,24,21,25,22][f];else for(f=0;f<-n;f++)l[f]=-1,m[f]=[22,25,21,24,20,23,26][f];var r=h.length;for(n=0;n<r;n++){var q=h[n];for(k=0;k<f;k++)if(m[k]==q.pit){l[k]=q.acc;break}k==f&&(l[k]=q.acc,m[k]=q.pit,f++)}for(n=0;n<f;n++)(q=h[n])||(q=h[n]={}),q.acc=l[n],q.pit=m[n]}if(!h){if(c.fmt.cancelkey||0==c.k_sf)if(0==c.k_sf||0>d*c.k_sf){l=
ve[g];h=9<l?xe:ye;for(f=0;f<d;f++)U(a,e+l,"acc3"),l+=h[f],a+=5.5;l=we[g];h=18>l?ze:Ae;for(f=0;f>d;f--)U(a,e+l,"acc3"),l+=h[-f],a+=5.5;0!=c.k_sf&&(a+=3)}if(0<c.k_sf){l=ve[g];h=9<l?xe:ye;for(f=0;f<c.k_sf;f++)U(a,e+l,"acc1"),l+=h[f],a+=5.5;if(c.fmt.cancelkey&&f<d)for(a+=2;f<d;f++)U(a,e+l,"acc3"),l+=h[f],a+=5.5;"p"==c.k_bagpipe&&(U(a,e+27,"acc3"),a+=5.5)}if(0>c.k_sf){l=we[g];h=18>l?ze:Ae;for(f=0;f>c.k_sf;f--)U(a,e+l,"acc-1"),l+=h[-f],a+=5.5;if(c.fmt.cancelkey&&f>d)for(a+=2;f>d;f--)U(a,e+l,"acc3"),l+=
h[-f],a+=5.5}}else if(h.length)for(g=h[0].acc,m=100,n=[{}],f=0;f<h.length;f++){d=h[f];for(l=3*(c.k_y_clef+d.pit-18);-3>l;)l+=21;for(;27<l;)l-=21;0!=f&&(l>m+18||l<m-18)?a-=5.5:d.acc!=g&&(a+=3);g=d.acc;n[0].pit=l/3+18;m=l;Dc(a,e+l,d.acc);a+=5.5}};var Af="r128 r64 r32 r16 r8 r4 r2 r1 r0 r00".split(" ");Abc.prototype.draw_symbols=function(a){var c={},d;for(d=a.sym;d;d=d.next){if(d.invis)switch(d.type){case m.CLEF:d.time>=w[d.st].clef.time&&(w[d.st].clef=d);continue;case m.KEY:a.ckey=d;default:continue;
case m.NOTE:}var e=d.st;var f=d.x;Ta(d.color);switch(d.type){case m.NOTE:Hb(d);d.beam_st&&!d.beam_end&&Q.calculate_beam(c,d)&&md(c);d.invis||(wa(d),Cb(d,!c.s2),Ib.push(d));d==c.s2&&(c.s2=null);break;case m.REST:if(!C.st_print[e])break;var g=d;var h=w[g.st];var l=h.y,k=g.x;g.notes[0].shhd&&(k+=g.notes[0].shhd*G.scale);if(g.rep_nb)Ea(g.st),wa(g),l="|||||"==h.stafflines?l+12:l+(h.topbar+h.botbar)/2,0>g.rep_nb?U(k,l,"srep"):(U(k,l,"mrep"),2<g.rep_nb&&g.v==L.top_voice&&0<g.fmt.measrepnb&&!(g.rep_nb%g.fmt.measrepnb)&&
rd(k,l+h.topbar,g.rep_nb));else{Hb(g);wa(g);g.notes[0].color&&Ta(g.notes[0].color);f=g.y;e=5-g.nflags;7==e&&12==f&&2>=h.stafflines.length&&(f-=6);g.notes[0].invis||U(k,f+l,Af[e]);if(g.dots)for(k+=8,f+=l+3,h=g.dots,e=g.dur_orig/12>>5-g.nflags-h;0<h--;)U(k,f,e&1<<h?"dot":"dot+"),k+=3.5;Ta()}Ib.push(g);break;case m.BAR:break;case m.CLEF:d.time>=w[e].clef.time&&(w[e].clef=d);if(d.second||!w[e].topbar||!C.st_print[e])break;Ta();Ea(e);wa(d);e=w[e].y;d.clef_name?U(f,e+d.y,d.clef_name):d.clef_small?U(f,e+
d.y,"s"+d.clef_type+"clef"):U(f,e+d.y,d.clef_type+"clef");d.clef_octave&&(0<d.clef_octave?(e+=d.ymx-10,d.clef_small&&--e):(e+=d.ymn+6,d.clef_small&&(e+=1)),U(f-2,e,7==d.clef_octave||-7==d.clef_octave?"oct":"oct2"));Ib.push(d);break;case m.METER:a.meter=d;if(d.second||!w[d.st].topbar)break;Ta();Ea(d.st);wa(d);pd(d);Ib.push(d);break;case m.KEY:a.ckey=d;if(d.second||!w[d.st].topbar)break;Ta();Ea(d.st);wa(d);Q.draw_keysig(f,d);Ib.push(d);break;case m.MREST:f=d;k=w[f.st];e=k.y+(k.topbar+k.botbar)/2;g=
f.nmes.toString();if(f.next){Hb(f);for(h=f;!h.seqst;)h=h.ts_prev;for(h=h.ts_prev;!h.seqst;)h=h.ts_prev;l=h.x+20;h=f.next.x-20;f.x=(l+h)/2;wa(f);if(!t.oldmrest||f.nmes>t.oldmrest)P('<path d="mX Y',l+.6,e-2.7),F+="v2.7h-1.4v-10.8h1.4v2.7h"+((h-l-2.8)/G.scale).toFixed(1)+'v-2.7h1.4v10.8h-1.4v-2.7z"/>\n';else{h=f.x;k=k.y+12;l=f.nmes;var q=l>>2;l&3&&(q++,l&1&&q++);for(h-=3*(q-1);4<=l;)U(h,k,"r00"),l-=4,h+=6;2<=l&&(U(h,k,"r0"),l-=2,h+=6);l&&U(h+2,k,"r1")}f.tacet?P('<text x ="X" y="Y" style="font-size:12px;font-weight:700" text-anchor="middle">A</text>\n',
f.x,e+18,f.tacet):P('<text x ="X" y="Y" text-anchor="middle">A</text>\n',f.x,e+22,Bb(g));Ib.push(f)}else x(1,f,"Lack of bar after multi-measure rest");break;case m.GRACE:Hb(d);f=d;g={};for(e=f.extra;;){e.beam_st&&!e.beam_end&&Q.calculate_beam(g,e)&&md(g);wa(e);Cb(e,!g.s2);e==g.s2&&(g.s2=null);Ib.push(f);if(!e.next)break;e=e.next}f.sappo&&(e=f.extra,e.next?(k=.5*(e.next.x-e.x)+4,g=.5*(e.ys+e.next.ys)-e.y,g=0<e.stem?g-1:g+1):(k=9,g=0<e.stem?5:-5),l=e.notes[0>e.stem?0:e.nhd],h=e.x+l.shhd*G.scale,l=w[e.st].y+
3*(l.pit-18),0<e.stem?(--h,l+=4):(h-=5,l-=4),P('<path class="stroke" d="mX YlF G"/>\n',h,l,k,-g));if(e=f.slur)wa(f,"slur"),Za(e.x0,e.y0+w[f.st].y),F+="c"+e.x1.toFixed(1)+" "+e.y1.toFixed(1)+" "+e.x2.toFixed(1)+" "+e.y2.toFixed(1)+" "+e.x3.toFixed(1)+" "+e.y3.toFixed(1)+'"/>\n',Ab(f,"slur");break;case m.SPACE:case m.STBRK:break;case m.CUSTOS:Hb(d);Cb(d,0);break;case m.BLOCK:case m.REMARK:case m.STAVES:case m.TEMPO:break;default:x(2,d,"draw_symbols - Cannot draw symbol "+d.type)}}Hb(a.sym)};var td=
{serif:1,serifBold:1,"sans-serif":1,"sans-serifBold":1,Palatino:1.1,monospace:1},Be={},t={"abc-version":"1",annotationfont:{name:"text,sans-serif",size:12},aligncomposer:1,beamslope:.4,bardef:{"[":"","[]":"","|:":"[|:","|::":"[|::","|:::":"[|:::",":|":":|]","::|":"::|]",":::|":":::|]","::":":][:"},breaklimit:.7,breakoneoln:!0,cancelkey:!0,composerfont:{name:"text,serif",style:"italic",size:14},composerspace:6,decoerr:!0,dynalign:!0,footerfont:{name:"text,serif",size:16},fullsvg:"",gchordfont:{name:"text,sans-serif",
size:12},gracespace:new Float32Array([6,8,11]),graceslurs:!0,headerfont:{name:"text,serif",size:16},historyfont:{name:"text,serif",size:16},hyphencont:!0,indent:0,infofont:{name:"text,serif",style:"italic",size:14},infoname:'R "Rhythm: "\nB "Book: "\nS "Source: "\nD "Discography: "\nN "Notes: "\nZ "Transcription: "\nH "History: "',infospace:0,keywarn:!0,leftmargin:1.4*37.8,lineskipfac:1.1,linewarn:!0,maxshrink:.65,maxstaffsep:2E3,maxsysstaffsep:2E3,measrepnb:1,measurefont:{name:"text,serif",style:"italic",
size:10},measurenb:-1,musicfont:{name:"music",src:'url("data:application/octet-stream;base64,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aUUwOEEHdW5pRTA4Qgd1bmlFMDhDB3VuaUUwOTQHdW5pRTA5NQd1bmlFMEEwB3VuaUUwQTEHdW5pRTBBMgd1bmlFMEEzB3VuaUUwQTQHdW5pRTBBOQd1bmlFMEIzB3VuaUUxMDEHdW5pRTFCOQd1bmlFMUJCB3VuaUUxRTcHdW5pRTFGMgd1bmlFMUY0B3VuaUUxRjcHdW5pRTFGOQd1bmlFMUZDB3VuaUUxRkUHdW5pRTFGRgd1bmlFMjAwB3VuaUUyNDAHdW5pRTI0MQd1bmlFMjQyB3VuaUUyNDMHdW5pRTI0NAd1bmlFMjQ1B3VuaUUyNDYHdW5pRTI0Nwd1bmlFMjQ4B3VuaUUyNDkHdW5pRTI2MAd1bmlFMjYxB3VuaUUyNjIHdW5pRTI2Mwd1bmlFMjY0B3VuaUUyNmEHdW5pRTI2Ygd1bmlFMjgwB3VuaUUyODEHdW5pRTI4Mgd1bmlFMjgzB3VuaUU0QTAHdW5pRTRBMgd1bmlFNEE0B3VuaUU0QTgHdW5pRTRBQwd1bmlFNEMwB3VuaUU0Q0UHdW5pRTREMQd1bmlFNEUxB3VuaUU0RTIHdW5pRTRFMwd1bmlFNEU0B3VuaUU0RTUHdW5pRTRFNgd1bmlFNEU3B3VuaUU0RTgHdW5pRTRFOQd1bmlFNEVBB3VuaUU1MDAHdW5pRTUwMQd1bmlFNTIwB3VuaUU1MjEHdW5pRTUyMgd1bmlFNTIzB3VuaUU1MjQHdW5pRTUyNQd1bmlFNTI5B3VuaUU1MkEHdW5pRTUyQgd1bmlFNTJDB3VuaUU1MkQHdW5pRTUyRgd1bmlFNTMwB3VuaUU1MzEHdW5pRTUzOQd1bmlFNTY2B3VuaUU1NjcHdW5pRTU2OQd1bmlFNTZDB3VuaUU1NkQHdW5pRTU4Mgd1bmlFNUQwB3VuaUU1RTIHdW5pRTYxMAd1bmlFNjEyB3VuaUU2MTQHdW5pRTYxOAd1bmlFNjI0B3VuaUU2MzAHdW5pRTY1MAd1bmlFNjU1B3VuaUU5MTAHdW5pRTkxMQd1bmlFOTEyB3VuaUU5MTQHdW5pRTkxNQd1bmlFOTE4B3VuaUU5MjAHdW5pRTkyNQd1bmlFOTVEB3VuaUVBMDIHdW5pRUFBNAd1bmlFQ0EyB3VuaUVDQTMHdW5pRUNBNQd1bmlFQ0E3B3VuaUVDQTkHdW5pRUNCNwAAAAAAAAH//wACAAEAAAAAAAAADAAUAAQAAAACAAAAAQAAAAEAAAAAAAEAAAAA399K6gAAAADRlyIXAAAAAOBezeg=") format("truetype")',
size:24},musicspace:6,partsfont:{name:"text,serif",size:15},parskipfac:.4,partsspace:8,pagewidth:793.8,"propagate-accidentals":"o",printmargin:0,rightmargin:1.4*37.8,rbmax:4,rbmin:2,repeatfont:{name:"text,serif",size:9},scale:1,slurheight:1,spatab:new Float32Array([10.2,13.3,17.3,22.48,29.2,38,49.4,64.2,83.5,108.5]),staffsep:46,stemheight:21,stretchlast:.25,stretchstaff:!0,subtitlefont:{name:"text,serif",size:16},subtitlespace:3,sysstaffsep:34,systnames:-1,tempofont:{name:"text,serif",weight:"bold",
size:12},textfont:{name:"text,serif",size:16},textspace:14,tieheight:1,titlefont:{name:"text,serif",size:20},titlespace:6,titletrim:!0,topspace:22,tuplets:[0,0,0,0],tupletfont:{name:"text,serif",style:"italic",size:10},vocalfont:{name:"text,serif",weight:"bold",size:13},vocalspace:10,voicefont:{name:"text,serif",weight:"bold",size:13},writefields:"CMOPQsTWw",wordsfont:{name:"text,serif",size:16},wordsspace:5,"writeout-accidentals":"n"},Ce={bardef:!0,barsperstaff:!0,beamslope:!0,breaklimit:!0,bstemdown:!0,
cancelkey:!0,dynalign:!0,flatbeams:!0,gracespace:!0,hyphencont:!0,keywarn:!0,maxshrink:!0,maxstaffsep:!0,measrepnb:!0,rbmax:!0,rbmin:!0,shiftunison:!0,slurheight:!0,squarebreve:!0,staffsep:!0,systnames:1,stemheight:!0,stretchlast:!0,stretchstaff:!0,tieheight:!0,timewarn:!0,trimsvg:1,vocalspace:!0},We={align:"j",center:"c",fill:"f",justify:"j",obeylines:"l",ragged:"f",right:"r",skip:"s",0:"l",1:"j",2:"f",3:"c",4:"s",5:"r"},dd={above:m.SL_ABOVE,auto:0,below:m.SL_BELOW,down:m.SL_BELOW,hidden:m.SL_HIDDEN,
opposite:m.SL_HIDDEN,under:m.SL_BELOW,up:m.SL_ABOVE};Abc.prototype.set_format=function(a,c){var d;if(/.+font(-[\d])?$/.test(a))"soundfont"==a?t.soundfont=c:zb(a,c);else{Ce[a]&&v.ufmt&&(t=Object.create(t));switch(a){case "aligncomposer":case "barsperstaff":case "infoline":case "measurenb":case "rbmax":case "rbmin":case "measrepnb":case "shiftunison":case "systnames":var e=parseInt(c);if(isNaN(e)){y(1,"Bad integer value");break}t[a]=e;break;case "abc-version":case "bgcolor":case "fgcolor":case "propagate-accidentals":case "titleformat":case "writeout-accidentals":t[a]=
c;break;case "beamslope":case "breaklimit":case "lineskipfac":case "maxshrink":case "pagescale":case "parskipfac":case "scale":case "slurheight":case "stemheight":case "tieheight":var f=+c;if(isNaN(f)||!c||0>f){y(1,I.bad_val,"%%"+a);break}switch(a){case "scale":f/=.75;case "pagescale":.1>f&&(f=.1),a="scale",W.chg=!0}t[a]=f;break;case "annotationbox":case "gchordbox":case "measurebox":case "partsbox":zb(a.replace("box","font"),"* * "+(Va(c)?"box":"nobox"));break;case "altchord":case "bstemdown":case "breakoneoln":case "cancelkey":case "checkbars":case "contbarnb":case "custos":case "decoerr":case "flatbeams":case "graceslurs":case "graceword":case "hyphencont":case "keywarn":case "linewarn":case "squarebreve":case "splittune":case "straightflags":case "stretchstaff":case "timewarn":case "titlecaps":case "titleleft":case "trimsvg":t[a]=
Va(c);break;case "dblrepbar":c=":: "+c;case "bardef":e=c.split(/\s+/);2!=e.length?y(1,I.bad_val,"%%bardef"):(v.ufmt&&(t.bardef=Object.create(t.bardef)),t.bardef[e[0]]=e[1]);break;case "chordalias":e=c.split(/\s+/);e.length?abc2svg.ch_alias[e[0]]=e[1]||"":y(1,I.bad_val,"%%chordalias");break;case "composerspace":case "indent":case "infospace":case "maxstaffsep":case "maxsysstaffsep":case "musicspace":case "partsspace":case "staffsep":case "subtitlespace":case "sysstaffsep":case "textspace":case "titlespace":case "topspace":case "vocalspace":case "wordsspace":f=
Ra(c);isNaN(f)||0>f?y(1,I.bad_val,"%%"+a):t[a]=f;break;case "page-format":q.page_format=Va(c);break;case "print-leftmargin":y(0,"$1 is deprecated - use %%printmargin instead","%%"+a),a="printmargin";case "printmargin":case "leftmargin":case "pagewidth":case "rightmargin":f=Ra(c);if(isNaN(f)){y(1,I.bad_val,"%%"+a);break}t[a]=f;W.chg=!0;break;case "concert-score":"play"!=t.sound&&(t.sound="concert");break;case "writefields":e=c.split(/\s+/);if(Va(e[1]))for(d=0;d<e[0].length;d++)f=e[0][d],0>t.writefields.indexOf(f)&&
(t.writefields+=f);else for(d=0;d<e[0].length;d++)f=e[0][d],0<=t.writefields.indexOf(f)&&(t.writefields=t.writefields.replace(f,""));break;case "volume":a="dynamic";case "dynamic":case "gchord":case "gstemdir":case "ornament":case "stemdir":case "vocal":vd(a,c);break;case "font":f=tb(c);1>=f.length||(d=+f[f.length-1],isNaN(d)||.5>=d?y(1,"Bad scale value in %%font"):td[f[0]]=d);break;case "fullsvg":if(0!=v.state){y(1,I.not_in_tune,"%%fullsvg");break}t[a]=c;break;case "gracespace":e=c.split(/\s+/);
for(c=0;3>c;c++)if(isNaN(+e[c])){y(1,I.bad_val,"%%gracespace");break}v.ufmt&&(t[a]=new Float32Array(3));for(c=0;3>c;c++)t[a][c]=+e[c];break;case "tuplets":e=c.split(/\s+/);(f=e[3])&&(f=dd[f]);f&&(e[3]=f);l?l.tup=e:t[a]=e;break;case "infoname":a:{f=c;d=t.infoname.split("\n");e=f[0];for(c=0;c<d.length;c++)if(d[c][0]==e){1==f.length?d.splice(c,1):d[c]=f;t.infoname=d.join("\n");break a}t.infoname+="\n"+f}break;case "notespacingfactor":if(e=c.match(/([.\d]+)[,\s]*(\d+)?/))f=+e[1],isNaN(f)||1>f||2<f?f=
0:e[2]?(d=+e[2],isNaN(f)&&(f=0)):d=t.spatab[5];if(!f){y(1,I.bad_val,"%%"+a);break}t[a]=c;t.spatab=new Float32Array(10);c=5;do t.spatab[c]=d,d/=f;while(0<=--c);c=5;for(d=t.spatab[c];++c<t.spatab.length;)d*=f,t.spatab[c]=d;break;case "play":t.sound="play";break;case "pos":a=c.match(/(\w*)\s+(.*)/);if(!a||!a[2]){y(1,"Error in %%pos");break}if("tup"==a[1].slice(0,3)&&l){l.tup=l.tup?Object.create(l.tup):t.tuplets;e=dd[a[2]];switch(e){case m.SL_ABOVE:l.tup[3]=1;break;case m.SL_BELOW:l.tup[3]=2;break;case m.SL_HIDDEN:l.tup[2]=
1}break}"vol"==a[1].slice(0,3)&&(a[1]="dyn");vd(a[1],a[2]);break;case "sounding-score":"play"!=t.sound&&(t.sound="sounding");break;case "staffwidth":e=Ra(c);if(isNaN(e)){y(1,I.bad_val,"%%"+a);break}if(100>e){y(1,"%%staffwidth too small");break}e=t.pagewidth-e-t.leftmargin;if(2>e){y(1,"%%staffwidth too big");break}t.rightmargin=e;W.chg=!0;break;case "textoption":t[a]=ud(c);break;case "dynalign":case "quiet":case "singleline":case "stretchlast":case "titletrim":e=""==c?1:+c;isNaN(e)&&(e=Va(c)?0:1);
if("t"==a[1]&&(0>e||1<e)){y(1,I.bad_val,"%%"+a);break}t[a]=e;break;case "combinevoices":y(1,"%%combinevoices is deprecated - use %%voicecombine instead");break;case "voicemap":Yb("map",c);break;case "voicescale":Yb("scale",c);break;case "unsizedsvg":Va(c)?q.imagesize="":delete q.imagesize;break;case "rbdbstop":(e=Va(c))&&"2.2"<=t["abc-version"]?t["abc-version"]="1":!e&&"2.2">t["abc-version"]&&(t["abc-version"]="2.2");break;default:v.state||(t[a]=c)}Ce[a]&&v.ufmt&&(v.ufmt=!1)}};Abc.prototype.style_font=
Ic;var Fa={},Ya={},$b={},Ad={},$e={"=D":"\u0110","=H":"\u0126","=T":"\u0166","=d":"\u0111","=h":"\u0127","=t":"\u0167","/O":"\u00d8","/o":"\u00f8","/L":"\u0141","/l":"\u0142",vL:"\u013d",vl:"\u013e",vd:"\u010f",".i":"\u0131",AA:"\u00c5",aa:"\u00e5",AE:"\u00c6",ae:"\u00e6",DH:"\u00d0",dh:"\u00f0",OE:"\u0152",oe:"\u0153",ss:"\u00df",TH:"\u00de",th:"\u00fe"},Ze={1:"\u266f",2:"\u266d",3:"\u266e",4:"&#x1d12a;",5:"&#x1d12b;"},qb=0;Abc.prototype.tosvg=Kc;var C,w,R,sa,ia,mc,wc,Pc,Ed=new Float32Array([10,
10,11,13,15]),ue=new Float32Array([4.7,5,6,7.2,7.5]),nc=new Float32Array([3.5,3.7,5,6,7]);Abc.prototype.set_width=function(a){var c,d,e;if(!a.play)switch(a.type){case m.NOTE:case m.REST:a.wr=e=a.invis?0:ue[a.head];0<a.xmx&&(a.wr+=a.xmx+4);for(c=a.prev;c&&!Ha[c.type];c=c.prev);if(c)switch(c.type){case m.BAR:case m.CLEF:case m.KEY:case m.METER:e+=3;break;case m.STBRK:e+=8}for(d=0;d<=a.nhd;d++){var f=a.notes[d];var g=f.shhd;0>g&&e<-g+5&&(e=-g+5);if(g=f.acc)g=f.shac+("object"==typeof g?5.5:3.5),e<g&&
(e=g);if(f.a_dd){g=e;var h=0;var l=f.a_dd.length;for(e=0;e<l;e++){var k=f.a_dd[e];"<"==k.ty&&(k=k.wl+k.wr+4,k>h&&(h=k))}e=g+h}}if(c)switch(c.type){case m.BAR:case m.CLEF:case m.KEY:case m.METER:e-=3}a.a_dd&&(e=Ac(a,e));a.beam_st&&a.beam_end&&0<a.stem&&0<a.nflags&&a.wr<a.xmx+9&&(a.wr=a.xmx+9);if(a.dots){if(void 0==a.wl)switch(a.head){case m.SQUARE:case m.OVALBARS:a.xmx+=3;break;case m.OVAL:a.xmx+=1}a.wr<a.xmx+8&&(a.wr=a.xmx+8);2<=a.dots&&(a.wr+=3.5*(a.dots-1))}a.trem2&&a.beam_end&&20>e&&(e=20);f=e;
if(c)switch(c.type){case m.NOTE:0>a.stem*c.stem&&(f=0>a.stem?f+5:f-3);(27<a.y&&27<c.y||-3>a.y&&-3>c.y)&&6>f&&(f=6);c.tie&&14>f&&(f=14);break;case m.CLEF:if(c.second||c.clef_small)break;case m.KEY:a.a_gch&&(f+=4);case m.METER:f+=3}a.a_gch&&(f=Id(a,e,f));a.prev&&a.prev.type==m.GRACE?(a.prev.wl+=e-4.5,a.wl=a.prev.wl):a.wl=f;return;case m.SPACE:g=a.width/2;a.wr=g;a.a_gch&&(g=Id(a,g,g));a.a_dd&&(g=Ac(a,g));a.wl=g;return;case m.BAR:d=a.bar_type;switch(d){case "|":g=5;break;case "[":g=0;break;default:for(g=
2+2.8*d.length,c=0;c<d.length;c++)switch(d[c]){case "[":case "]":g+=1;case ":":g+=2}}a.wl=g;a.wr=a.next&&a.next.type!=m.METER?7:5;a.invis&&(a.wl=a.wr=2);(c=a.prev)&&c.type==m.GRACE&&(a.wl-=6);for(;c;c=c.prev)if(Ha[c.type]){c.type==m.STBRK&&(a.wl-=12);break}a.a_dd&&(a.wl=Ac(a,a.wl));a.text&&4>a.text.length&&a.next&&a.next.a_gch&&(ea("repeat"),a.wr+=qa(a.text)[0]+2,0<t.measurenb&a.bar_num&&a.bar_num%t.measurenb&&(a.wr+=4));return;case m.CLEF:if(a.invis){a.wl=a.wr=1;return}if(a.prev&&a.prev.type==m.STBRK){a.wl=
6;a.wr=13;delete a.clef_small;return}a.wl=a.clef_small?11:12;a.wr=a.clef_small?8:13;return;case m.KEY:if(a.invis){a.wl=a.wr=0;return}a.wl=0;h=3;f=a.k_sf;e=a.k_old_sf&&(a.fmt.cancelkey||0==f)?a.k_old_sf:0;0<=f*e?(0>f&&(f=-f),0>e&&(e=-e),e>f&&(f=e)):(f-=e,0>f&&(f=-f),h+=3);"p"==a.k_bagpipe&&f++;if(a.k_a_acc)for(e=a.k_a_acc.length,f=a.exp?e:f+e,e&&(d=a.k_a_acc[0].acc),c=1;c<e;c++)g=a.k_a_acc[c],g.pit>a.k_a_acc[c-1].pit+6||g.pit<a.k_a_acc[c-1].pit-6?f--:g.acc!=d&&(h+=3),d=g.acc;if(!f)break;a.wr=5.5*f+
h;a.prev&&!a.prev.bar_type&&(a.wl+=2);return;case m.METER:a.x_meter=[];if(!a.a_meter.length)break;for(c=f=0;c<a.a_meter.length;c++)switch(e=a.a_meter[c],e.top[0]){case "C":case "c":case "o":a.x_meter[c]=f+6;f+=12;break;case ".":case "|":a.x_meter[c]=a.x_meter[c-1];break;default:g=0;e=!e.bot||e.top.length>e.bot.length?e.top:e.bot;for(d=0;d<e.length;d++)switch(e[d]){case "(":f+=4;case ")":case "1":g+=4;break;default:g+=12}a.x_meter[c]=f+g/2;f+=g}a.wl=1;a.wr=f+7;return;case m.MREST:a.wl=6;a.wr=66;return;
case m.GRACE:if(a.invis)break;g=a.fmt.gracespace[0];d=a.fmt.gracespace[1];c=a.fmt.gracespace[2];f=a.extra;a.prev&&a.prev.type==m.BAR&&(g-=3);for(f.beam_st=!0;;f=f.next){Dd(f);Fd(f.notes,6.5);h=0;for(e=f.nhd;0<=e;e--)f.notes[e].shac-2>h&&(h=f.notes[e].shac-2);g+=h;f.x=g;0>=f.nflags&&(f.beam_st=f.beam_end=!0);e=f.next;if(!e){f.beam_end=!0;break}0>=e.nflags&&(f.beam_end=!0);f.beam_end&&(e.beam_st=!0,g+=d/4);0>=f.nflags&&(g+=d/4);f.y>e.y+8&&(g-=1.5);g+=d}(e=a.next)&&e.type==m.NOTE&&(f.y>=3*(e.notes[e.nhd].pit-
18)?--c:f.beam_st&&f.y<3*(e.notes[e.nhd].pit-18)-4&&(c+=2));a.wl=g+c;a.wr=0;a.a_ly&&Oc(a);return;case m.STBRK:a.wl=a.xmx;a.wr=8;return;case m.CUSTOS:a.wl=a.wr=4;return;case m.TEMPO:ke(a);break;case m.BLOCK:case m.REMARK:case m.STAVES:break;default:x(2,a,"set_width - Cannot set width for symbol $1",a.type)}a.wl=a.wr=0};var ed={t:-4,c:0,b:4,p:-6},De=[[18,18],[12,18],[12,12],[10,12],[10,10],[10,10],[8,4],[9,0],[9,4],[6,8]];Abc.prototype.set_pitch=function(a){var c,d,e=m.BLEN,f=R+1,g=new Int16Array(2*
f);for(c=0;c<=R;c++){var h=w[c].clef;g[c]=ed[h.clef_type]+2*h.clef_line;h.clefpit&&(g[c]+=h.clefpit);t.sound?h.clef_octave&&!h.clef_oct_transp&&(g[c]+=h.clef_octave):h.clef_oct_transp&&(g[c]-=h.clef_octave)}for(h=M;h!=a;h=h.ts_next)switch(c=h.st,h.type){case m.CLEF:g[c]=ed[h.clef_type]+2*h.clef_line;h.clefpit&&(g[c]+=h.clefpit);t.sound?h.clef_octave&&!h.clef_oct_transp&&(g[c]+=h.clef_octave):h.clef_oct_transp&&(g[c]-=h.clef_octave);Qc(h);break;case m.GRACE:for(c=h.extra;c;c=c.next){if((d=g[c.st])&&
!h.p_v.ckey.k_drum)for(f=0;f<=c.nhd;f++){var l=c.notes[f];l.opit=l.pit;l.pit+=d}c.ymn=3*(c.notes[0].pit-18)-2;c.ymx=3*(c.notes[c.nhd].pit-18)+2}Qc(h);break;case m.KEY:h.k_y_clef=g[c];default:Qc(h);break;case m.MREST:if(h.invis)break;h.y=12;h.ymx=39;h.ymn=-2;break;case m.REST:h.y=12;if(1<h.rep_nb||h.bar_mrep){h.ymx=38;h.ymn=0;break}d=h;d.ymx=d.y+De[5-d.nflags][0];d.ymn=d.y-De[5-d.nflags][1];case m.NOTE:if((d=g[c])&&!h.p_v.ckey.k_drum)for(f=h.nhd;0<=f;f--)l=h.notes[f],l.opit=l.pit,l.pit+=d;h.dur<e&&
(e=h.dur)}a||(Pc=e)};Abc.prototype.set_stem_dir=function(){for(var a,c,d,e,f,g,h,l=[],k=M,q=L,p=q.nstaff;k;){for(a=0;a<=p;a++)l[a]=[];h=[];for(c=k;c&&c.type!=m.BAR;c=c.ts_next)if(c.type==m.STAVES){if(c!=k)break;q=k.sy;for(a=p;a<=q.nstaff;a++)l[a]=[];p=q.nstaff}else if(!(c.type!=m.NOTE&&c.type!=m.REST||c.invis)){a=c.st;if(a>p)throw c="*** fatal set_stem_dir(): bad staff number "+a+" max "+p,x(2,null,c),Error(c);d=c.v;e=h[d];e||(e={st1:-1,st2:-1},h[d]=e);0>e.st1?e.st1=a:e.st1!=a&&(a>e.st1?a>e.st2&&
(e.st2=a):(e.st1>e.st2&&(e.st2=e.st1),e.st1=a));f=l[a];e=q.voices[d].range;for(d=f.length;0<=--d&&(g=f[d],g.v!=e););if(0>d){g={v:e,ymx:0,ymn:24};for(d=0;d<f.length;d++)if(e<f[d].v){f.splice(d,0,g);break}d==f.length&&f.push(g)}c.type==m.NOTE&&(c.ymx>g.ymx&&(g.ymx=c.ymx),c.ymn<g.ymn&&(g.ymn=c.ymn),c.xstem&&(c.ts_prev.st!=a-1||c.ts_prev.type!=m.NOTE?(x(1,k,"Bad !xstem!"),c.xstem=!1):(c.ts_prev.multi=1,c.multi=1,c.stemless=!0)))}for(;k!=c;k=k.ts_next)if(!k.multi){switch(k.type){default:continue;case m.REST:if(void 0!=
k.combine&&0>k.combine||!k.ts_next||k.ts_next.type!=m.REST||k.ts_next.st!=k.st||k.time!=k.ts_next.time||k.dur!=k.ts_next.dur||k.a_dd&&k.ts_next.a_dd||k.a_gch&&k.ts_next.a_gch||k.invis)break;k.ts_next.a_dd&&(k.a_dd=k.ts_next.a_dd);k.ts_next.a_gch&&(k.a_gch=k.ts_next.a_gch);gb(k.ts_next);if(!(k.ts_prev.dur&&k.ts_prev.time==k.time&&k.ts_prev.st==k.st||k.ts_next.time==k.time&&k.ts_next.st==k.st))continue;case m.NOTE:case m.GRACE:}a=k.st;d=k.v;e=h[d];f=l[a];if(e&&0<=e.st2)a==e.st1?k.multi=-1:a==e.st2&&
(k.multi=1);else if(1>=f.length)k.floating&&(k.multi=a==E[d].st?-1:1);else{e=q.voices[d].range;for(d=f.length;0<=--d&&f[d].v!=e;);0>d||(d==f.length-1?k.multi=-1:(k.multi=1,d&&d+2==f.length&&(f[d].ymn-k.fmt.stemheight>=f[d+1].ymx&&(k.multi=-1),a=k.ts_next,k.ts_prev&&k.ts_prev.time==k.time&&k.ts_prev.st==k.st&&k.notes[k.nhd].pit==k.ts_prev.notes[0].pit&&k.beam_st&&k.beam_end&&(!a||a.st!=k.st||a.time!=k.time)&&(k.multi=-1))))}}for(;k&&k.type==m.BAR;)k=k.ts_next}};Abc.prototype.set_stems=function(){var a,
c,d,e;for(a=M;a;a=a.ts_next)if(a.type!=m.NOTE){if(a.type==m.GRACE){var f=e=a.mid;for(c=a.extra;c;c=c.next){var g=15;1<c.nflags&&(g+=1.2*(c.nflags-1));var h=3*(c.notes[0].pit-18);var l=3*(c.notes[c.nhd].pit-18);0<=a.stem?(c.y=h,c.ys=l+g,l=Math.round(c.ys)):(c.y=l,c.ys=h-g,h=Math.round(c.ys));l+=4;h-=4;h<f?f=h:l>e&&(e=l);c.ymx=l;c.ymn=h}a.ymx=e;a.ymn=f}}else{Dd(a);c=a.nflags;if(a.beam_st&&!a.beam_end){a.feathered_beam&&(c=++a.nflags);for(g=a.next;g.type!=m.NOTE||(a.feathered_beam&&g.nflags++,!g.beam_end);g=
g.next);g.nflags>c&&(c=g.nflags)}else if(!a.beam_st&&a.beam_end){for(g=a.prev;!g.beam_st;g=g.prev);g.nflags>c&&(c=g.nflags)}g=a.fmt.stemheight;switch(c){case 2:g+=0;break;case 3:g+=4;break;case 4:g+=8;break;case 5:g+=12}1!=(d=a.p_v.scale)&&(g*=.5*(d+1));h=3*(a.notes[0].pit-18);0<a.nhd?(g-=2,l=3*(a.notes[a.nhd].pit-18)):l=h;a.ntrem&&(g+=2*a.ntrem);a.stemless?(0<=a.stem?(a.y=h,a.ys=l):(a.ys=h,a.y=l),a.ymx=l+4,a.ymn=h-4):0<=a.stem?(26<a.notes[a.nhd].pit&&(0>=c||!a.beam_st||!a.beam_end)&&(g-=2,28<a.notes[a.nhd].pit&&
(g-=2)),a.y=h,a.notes[0].tie&&(h-=3),a.ymn=h-4,a.ys=l+g,a.ys<a.mid&&(a.ys=a.mid),a.ymx=a.ys+2.5|0):(18>a.notes[0].pit&&(0>=c||!a.beam_st||!a.beam_end)&&(g-=2,16>a.notes[0].pit&&(g-=2)),a.ys=h-g,a.ys>a.mid&&(a.ys=a.mid),a.ymn=a.ys-2.5|0,a.y=l,a.notes[a.nhd].tie&&(l+=3),a.ymx=l+4)}};var oc=[];Abc.prototype.block_gen=function(a){switch(a.subtype){case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "scale":case "staffwidth":Q.set_format(a.subtype,a.param);break;case "mc_start":if(da){x(1,
a,"No end of the previous %%multicol");break}da={state:v.state,posy:ra,maxy:ra,lm:t.leftmargin,rm:t.rightmargin,w:t.pagewidth,sc:t.scale};break;case "mc_new":if(!da||da.state!=v.state){x(1,a,"%%multicol new without start");break}ra>da.maxy&&(da.maxy=ra);t.leftmargin=da.lm;t.rightmargin=da.rm;t.pagewidth=da.w;t.scale=da.sc;ra=da.posy;W.chg=1;break;case "mc_end":if(!da||da.state!=v.state){x(1,a,"%%multicol end without start");break}ra<da.maxy&&(ra=da.maxy);t.leftmargin=da.lm;t.rightmargin=da.rm;t.pagewidth=
da.w;t.scale=da.sc;da=void 0;Xa();W.chg=1;break;case "ml":Xa();q.img_out(a.text);break;case "newpage":if(!q.page_format)break;Xa();0>xa&&q.img_out("</div>");xa=2;break;case "sep":Wa();ma(a.sk1);F+='<path class="stroke"\n\td="M';Qa((W.width-a.l)/2-W.lm," ",0);F+="h"+a.l.toFixed(1)+'"/>\n';ma(a.sk2);break;case "text":ea(a.font);pb(a.font);Yc(a.text,a.opt);break;case "title":Xc(a.text,!0);break;case "vskip":ma(a.sk)}};Abc.prototype.set_sym_glue=function(a){for(var c,d,e,f=4,g=0,h=0,l=0,k=0,q=!sa||sa.type==
m.BLOCK&&!sa.play||oc.length,p=M,r=0;p;p=p.ts_next)if(p.type!=m.GRACE||d||(d=p),p.seqst){g+=p.shrink;if(g>a){x(1,p,"Line too much shrunk $1 $2 $3",g.toFixed(1),h.toFixed(1),a.toFixed(1));break}p.space?p.space<p.shrink?(k+=p.shrink,h+=p.shrink):(h+=p.space,r+=p.shrink):l+=p.shrink}if(h){p=M;q?(h-r+l)/a>1-p.fmt.stretchlast&&(e=1):p.fmt.stretchstaff&&(e=1);if(g>=a){for(c=0;p;p=p.ts_next)p.seqst&&(c+=p.shrink),p.x=c;wc=.65}else{e?(h==k&&(h+=10),g=(a-l-k)/(h-k)):(g=wc,q&&g<p.fmt.stretchlast&&(g=p.fmt.stretchlast),
g>(a-l)/h&&(g=(a-l)/h));for(;0<=--f;){c=k=h=0;for(p=M;p;p=p.ts_next)p.seqst&&(p.space?p.space*g<=p.shrink?(k+=p.shrink,h+=p.shrink,c+=p.shrink):(h+=p.space,c+=p.space*g):c+=p.shrink),p.x=c;if(!e&&c<a)break;if(.1>Math.abs(c-a))break;h==k&&(h+=10);g=(a-l-k)/(h-k)}wc=g}ia=c;for(p=d;p;p=p.ts_next)if(p.type==m.GRACE)for(c=p.gr_shift?p.prev.x+p.prev.wr:p.x-p.wl,a=p.extra;a;a=a.next)a.x+=c}else ia=0};Abc.prototype.output_music=function(){var a,c,d=E.length,e,f=E.length,g=L,h=g.nstaff;for(mc=0<=t.writefields.indexOf("M");;){g=
g.next;if(!g)break;g.nstaff>h&&(h=g.nstaff)}R=h;for(var l,k=M;k.ts_next;)k=k.ts_next;k.type!=m.BAR&&(l=Cc(k),l.ts_prev=k,k.next=k.ts_next=l);for(e=0;e<f;e++){var q=E[e];mf(q);q.ckey=q.key;for(var p=void 0,r=void 0,v=q.sym;v;)if(v.type!=m.BAR||!v.rbstart||v.norepbra)v=v.next;else for(p=0,r=null,v=v.next;v;v=v.next)if(v.type==m.BAR){if(v.rbstop)break;if(!v.next){v.rbstop=2;break}p++;p==v.fmt.rbmin&&(r=v);if(p==v.fmt.rbmax){r&&(v=r);v.rbstop=1;break}}}if(1<f){var y,u,B;for(y=0;y<E.length;y++){var G=
E[y];var H=!1;var I=G.st;for(u=G.sym;u;u=u.next){if(!u.floating){for(;u&&!u.floating;)u=u.next;if(!u)break;H=!1}if(u.dur)if(19<=u.notes[0].pit)H=!1;else if(12>=u.notes[u.nhd].pit)H=!0,u.st++;else{var J=127;for(B=u.ts_prev;B&&B.st==I&&B.v!=u.v;B=B.ts_prev)B.type==m.NOTE&&B.notes[0].pit<J&&(J=B.notes[0].pit);if(127==J)H&&u.st++;else if(u.notes[u.nhd].pit>J-3)H=!1;else{var N=-127;for(B=u.ts_next;B&&B.st==I+1&&B.v!=u.v;B=B.ts_next)B.type==m.NOTE&&B.notes[B.nhd].pit>N&&(N=B.notes[B.nhd].pit);if(-127==
N)H&&u.st++;else{if(u.notes[0].pit<N+3)H=!0;else if(J-=u.notes[u.nhd].pit,N=u.notes[0].pit-N,!H){if(J<N+3)continue;H=!0}else if(J<N-3){H=!1;continue}u.st++}}}else H&&u.st++}}if(fa.mrest_p){var P;for(P=M;P;P=P.ts_next)if(P.type==m.MREST){if(!P.seqst&&Ha[P.ts_prev.type])var U=P;else for(U=P.ts_next;!U.seqst&&U.type==m.MREST&&U.nmes==P.nmes;)U=U.ts_next;if(U.seqst)P=U.ts_prev;else for(;P.type==m.MREST;){for(var ba,aa,O,Z,ea,T=P,ja=T.nmes,oa=T.dur/ja,ka=T.next;!ka.bar_type;)ka=ka.next;for(ea=ka;!ka.bar_num;)ka=
ka.ts_prev;ba=ka.bar_num-T.nmes;T.type=m.REST;T.notes[0].dur=T.dur=T.dur_orig=oa;T.nflags=-2;T.head=m.FULL;T.fmr=1;aa=T.time+oa;for(Z=T;0<--ja;){ka=z(ea);delete ka.soln;delete ka.a_gch;delete ka.a_dd;delete ka.text;delete ka.rbstart;delete ka.rbstop;Nc(ka,T.next);for(ka.time=aa;Z.time<aa;)Z=Z.ts_next;for(;Z&&Z.v<T.v&&Z.type==m.BAR;)Z=Z.ts_next;if(Z)Z.bar_type&&(Z.seqst=0),ac(ka,Z),Z.type==m.BAR&&delete Z.bar_num;else{for(Z=T;Z.ts_next;)Z=Z.ts_next;Z.ts_next=ka;ka.ts_prev=Z;ka.ts_next=null}ba++;ka.seqst?
(ka.bar_num=ba,O=ka.ts_next):(delete ka.bar_num,O=ka.ts_prev);ka.bar_type=O.bar_type||"|";O.bar_num&&!O.seqst&&delete O.bar_num;O=z(T);delete O.a_dd;delete O.soln;delete O.a_gch;delete O.part;ka.next?(O.next=ka.next,O.next.prev=O):O.next=null;ka.next=O;O.prev=ka;for(O.time=aa;Z&&!Z.dur&&Z.time==aa;)Z=Z.ts_next;for(;Z&&Z.v<T.v&&(!(Z=Z.ts_next)||!Z.seqst););if(Z)Z.dur&&(Z.seqst=0),ac(O,Z);else{for(Z=T;Z.ts_next;)Z=Z.ts_next;Z.ts_next=O;O.ts_prev=Z;O.ts_next=null}aa+=oa;T=Z=O}P=P.ts_next}}}}fa.ottava&&
"play"!=t.sound&&jf();var ca,X,pa,ta,da=Array(R+1),ya=L,qa=[];w=Array(R+1);for(X=0;X<=R;X++)da[X]={autoclef:!0},w[X]={output:"",sc_out:""};for(X=0;X<=ya.nstaff;X++)qa[X]=3*(ya.staves[X].stafflines.length-1);for(ca=M;ca;ca=ca.ts_next){ca.repeat_n&&hf(ca);switch(ca.type){case m.STAVES:ya=ca.sy;for(X=0;X<=R;X++)da[X].autoclef=!0;for(pa=0;pa<E.length;pa++)if(ya.voices[pa]){var ha=E[pa];X=ya.voices[pa].st;ya.voices[pa].second||(ya.staves[X].staffnonote=ha.staffnonote,ha.staffscale&&(ya.staves[X].staffscale=
ha.staffscale),ya.voices[pa].sep&&(ya.staves[X].sep=ya.voices[pa].sep),ya.voices[pa].maxsep&&(ya.staves[X].maxsep=ya.voices[pa].maxsep));var la=ha.clef;la.clef_auto||(da[X].autoclef=!1)}for(X=0;X<=ya.nstaff;X++)qa[X]=3*(ya.staves[X].stafflines.length-1);for(pa=0;pa<E.length;pa++)if(ya.voices[pa]&&!ya.voices[pa].second){ha=E[pa];X=ya.voices[pa].st;la=ha.clef;if(la.clef_auto){var wa=Od(X,ca,da[X].clef?da[X].clef.clef_type:"a");var Aa="t"==wa?2:4}else wa=la.clef_type,Aa=la.clef_line;if(!da[X].clef)la.clef_auto&&
("a"!=la.clef_type&&(ha.clef=z(ha.clef)),ha.clef.clef_type=wa,ha.clef.clef_line=Aa),w[X].clef=da[X].clef=ha.clef;else if(wa!=da[X].clef.clef_type||Aa!=da[X].clef.clef_line){for(ta=ca.ts_prev;ta&&ta.time==ca.time&&(ta.v!=pa||ta.st!=X);)ta=ta.ts_prev;if(!ta||ta.time!=ca.time){for(ta=ca.ts_next;ta&&(ta.v!=pa||ta.st!=X);)ta=ta.ts_next;ta&&ta.time==ca.time||(ta=ca)}ta.type!=m.CLEF&&(ta=Gd(ta,wa,Aa),la.clef_auto&&(ta.clef_auto=!0));da[X].clef=ha.clef=ta}}continue;default:ca.mid=qa[ca.st];continue;case m.CLEF:}"a"==
ca.clef_type&&(ca.clef_type=Od(ca.st,ca.ts_next,da[ca.st].clef.clef_type),ca.clef_line="t"==ca.clef_type?2:4);ha=ca.p_v;ha.clef=ca;if(ca.second)gb(ca);else{X=ca.st;if(da[X].clef){if(ca.clef_type==da[X].clef.clef_type&&ca.clef_line==da[X].clef.clef_line)continue}else w[X].clef=ca;da[X].clef=ca}}ya=L;for(pa=0;pa<E.length;pa++)if(ya.voices[pa]&&(la=E[pa].sym)&&127==la.notes[0].pit){X=ya.voices[pa].st;switch(w[X].clef.clef_type){default:var Oa=22;break;case "c":Oa=16;break;case "b":Oa=10}for(ca=la;ca;ca=
ca.next)ca.notes[0].pit=Oa}Q.set_pitch(null);1<d&&Q.set_stem_dir();for(a=0;a<d;a++){var za,Ca=void 0,Fa=void 0,V,Da=-1;for(V=E[a].sym;V;V=V.next)if(V.type!=m.NOTE){if(V.type==m.GRACE){var na=V.extra;if(2==na.stem)Ca=V;else for(V.stem||(V.stem=V.multi||1);na;na=na.next)na.stem=V.stem,na.multi=V.multi}}else{!V.stem&&V.multi&&(V.stem=V.multi);if(V.stem)V.beam_st&&!V.beam_end&&(Fa=!0);else{var xa=V.mid/3+18;if(Fa)V.stem=Da;else if(V.beam_st&&!V.beam_end){Fa=!0;var Ja=V.notes[V.nhd].pit;var Qa=V.notes[0].pit;
for(na=V.next;na;na=na.next)if(na.type==m.NOTE){if(na.stem||na.multi)V.stem=na.stem||na.multi;na.notes[na.nhd].pit>Ja&&(Ja=na.notes[na.nhd].pit);na.notes[0].pit<Qa&&(Qa=na.notes[0].pit);if(na.beam_end)break}!V.stem&&na.beam_end&&(Ja+Qa<2*xa?V.stem=1:Ja+Qa>2*xa?V.stem=-1:V.fmt.bstemdown&&(V.stem=-1));V.stem||(V.stem=Da)}else{var Ra=(V.notes[V.nhd].pit+V.notes[0].pit)/2;if(Ra==xa&&1<V.nhd){for(za=0;za<V.nhd&&!(V.notes[za].pit>=xa);za++);Ra=2*za<V.nhd?xa-1:xa+1}V.stem=Ra<xa?1:Ra>xa||V.fmt.bstemdown?
-1:Da}}V.beam_end&&(Fa=!1);Da=V.stem;if(Ca){for(na=Ca.extra;na;na=na.next)na.stem=-Da;Ca.stem=-Da;Ca=null}}}Q.set_stems();var Ma,jb,Ua,Va;for(Ma=M;Ma;)if(Ma.type!=m.NOTE||Ma.invis)Ma=Ma.ts_next;else{var ob=Ma.st;var pb=Ma.time;var $a=!1;for(jb=Ma;jb&&jb.time==pb&&jb.type==m.NOTE&&jb.st==ob;jb=jb.ts_next)if(!$a)for(Ua=0;Ua<=jb.nhd;Ua++)if(jb.notes[Ua].acc){$a=!0;break}if($a){var sb=Ed[Ma.head];for(Va=[];Ma!=jb;Ma=Ma.ts_next)Ma.invis||Array.prototype.push.apply(Va,Ma.notes);Va.sort(abc2svg.pitcmp);
Fd(Va,sb)}else Ma=jb}1<d&&(kf(),qf());Ld(1);Pd();if(M){var La=nf();if(t.singleline){a=Md();var Pa=La[0]+a[0]+a[1]+Nd(M,null)[0];a=2==t.singleline?Eb():Pa;a>Pa?Pa=a:W.width=Pa*t.scale+W.lm+W.rm+2}else{var Za=Pa=Eb(),Ba,hb,Fb=t.leftmargin,Gb=t.rightmargin,Mb=t.pagewidth,Ob=t.scale,ib=La[0]-La[1],qb=Md(),ua=M;Za-=La[1];t.indent&&t.indent>La[0]&&(ib+=t.indent);Za-=qb[0];ib+=qb[1];if(hb=ua.fmt.barsperstaff)for(Ba=ua;Ba;Ba=Ba.ts_next)if(Ba.type==m.BAR&&Ba.bar_num&&!(0<--hb)){for(;Ba.ts_next&&Ba.ts_next.type==
m.BAR;)Ba=Ba.ts_next;Ba.ts_next&&(Ba.ts_next.soln=!0);hb=ua.fmt.barsperstaff}for(Ba=ua;ua;ua=ua.ts_next){if(ua.type==m.BLOCK)switch(ua.subtype){case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "scale":case "staffwidth":ua.soln||Q.set_format(ua.subtype,ua.param);break;case "mc_start":var rb={lm:t.leftmargin,rm:t.rightmargin};break;case "mc_new":case "mc_end":rb&&(t.leftmargin=rb.lm,t.rightmargin=rb.rm,W.chg=1)}if(ua.ts_next)if(ua.soln){ua.soln=!1;if(ua.time==Ba.time)continue;
for(;!ua.seqst;)ua=ua.ts_prev}else continue;else ua=null;Wa();Za=Eb()-La[1]-qb[0];a:{var Ya=void 0,ab=void 0,bb=void 0,Jb=void 0,cb=void 0,kb=void 0,vb=void 0,wb=void 0,Ia=void 0,xb=void 0,Lb=void 0,K=Ba,va=ua,zb=Za,nb=ib,Bb=va?va.ts_prev:null,dc=Nd(K,va);K.fmt.keywarn&&va&&va.type==m.KEY&&!Bb.dur&&(dc[0]+=va.wr,dc[1]+=va.wr);if(dc[0]+nb<zb)va&&(va=kc(va)),Ba=va||Bb;else{for(ab=dc[0]+nb;;){Ya=Math.ceil(ab/zb);if(1>=Ya){va&&(va=kc(va));Ba=va||Bb;break a}xb=Lb=K;cb=K.x-K.shrink-nb;bb=cb+zb;Jb=cb+ab/
Ya;cb+=ab/Ya*K.fmt.breaklimit;for(K=K.ts_next;K!=va&&!(K.x&&(K.type==m.BAR&&(xb=K),K.x>=cb));K=K.ts_next);wb=K;if(K==va){K&&(K=kc(K));break}for(Ia=null;K!=va;K=K.ts_next)if(kb=K.x){if(kb>bb)break;if(K.type==m.BAR)if(kb<Jb)Ia=K;else{if(!Ia||kb-Jb<Jb-Ia.x)Ia=K;break}}if(!Ia){K=wb;var Db=0,Yb=xb.time;bb-=8;for(vb=K;K!=va;K=K.ts_next){if(K.seqst){kb=K.x;if(kb+K.wr>=bb)break;Db||K.in_tuplet||!(Jb-vb.x>kb-Jb||0==(K.time-Yb)%(m.BLEN/4))||(Ia=K)}K.beam_st&&(Db|=1<<K.v);K.beam_end&&(Db&=~(1<<K.v));vb=K}if(Ia){do Ia=
Ia.ts_prev;while(!Ia.seqst)}}if(!Ia)for(Ia=K=wb;K!=va;K=K.ts_next)if(kb=K.x){if(kb+K.wr>=bb)break;if(Ia&&kb>=Jb){Jb-Ia.x>kb-Jb&&(Ia=K);break}Ia=K}for(K=Ia;K.ts_next&&(K=K.ts_next,!K.seqst););if(K.nl)for(x(0,K,"Line split problem - adjust maxshrink and/or breaklimit"),Ya=2,K=K.ts_next;K!=va&&!(K.x&&0>=--Ya);K=K.ts_next);K=kc(K);if(!K||va&&K.time>=va.time)break;ab-=K.x-Lb.x;nb=0}Ba=K}}if(!Ba)break;ua=Ba.type==m.BLOCK?Ba.ts_prev:ua;ib=0}t.leftmargin=Fb;t.rightmargin=Gb;t.pagewidth=Mb;t.scale=Ob;W.chg=
1;Wa()}var Zb=M;for(a=d;0<=--a;)E[a].osym=E[a].sym;for(wc=.65;;){rf();var tb,Sb=La,ub=0,Ub=sa?sa.fmt:t;if(Ub.systnames)for(tb=E.length;0<=--tb;){var yb=E[tb];if(L.voices[tb]&&C.st_print[yb.st]){if(yb.nm&&(yb.new_name||2==Ub.systnames)){ub=2;break}yb.snm&&(ub=1)}}C.vnt=ub;var Kb=2==ub?Sb[0]:Sb[1];!c&&t.indent&&Kb<t.indent&&(Kb=t.indent);Q.set_sym_glue(Pa-Kb);if(ia){W.wx<ia&&(W.wx=ia);Kb&&(W.wx+=Kb,Wb+=Kb);Pe();if(c=Te()){Ue(Kb);var Ka=void 0,fc=void 0,gc=void 0,Na=void 0,S=void 0,Nb=void 0,Cb=void 0,
hc=void 0,cc=E.length;for(Cb=0;Cb<cc;Cb++)if(hc=E[Cb],hc.sym&&void 0!=hc.sym.x){Q.draw_symbols(hc);var db=void 0,Sa=void 0,eb=void 0,Pb=void 0,ic=void 0,Ga=void 0,lb=void 0,Qb=0;Ga=hc.sym;for(Ta(Ga.color);Ga;Ga=Ga.next){if(Ga.ti2&&Ga.time!=Qb)for(eb=0;eb<=Ga.nhd;eb++)db=Ga.notes[eb],(Sa=db.tie_s)&&Sa.s.v==Ga.v&&Xb(Sa,db,1);if(Ga.ti1)if(Ga.type==m.GRACE)for(lb=Ga.extra;lb;lb=lb.next)for(eb=0;eb<=Ga.nhd;eb++){if(Sa=lb.notes[eb],db=Sa.tie_e)Xb(Sa,db),Qb=db.s.time}else for(eb=0;eb<=Ga.nhd;eb++)if(Sa=
Ga.notes[eb],db=Sa.tie_e)if(ic=db.s,sa&&ic.time>=sa.time)Xb(Sa,db,2);else{Qb=ic.time;for(lb=Ga.ts_next;lb!=ic;lb=lb.ts_next)if(lb.st==Ga.st&&lb.type==m.CLEF){Pb=!0;break}Pb||Ga.st!=ic.st?(Xb(Sa,db,2),Xb(Sa,db,3),Pb=!1):Xb(Sa,db)}else Sa.tie_ty&&Xb(Sa,Sa,2)}Ta()}Q.draw_all_deco();Tb();for(var Vb=void 0;;){Vb=Ib.shift();if(!Vb)break;switch(Vb.type){case m.CLEF:case m.METER:case m.KEY:case m.REST:if(Vb.type!=m.REST||Vb.rep_nb){Ea(Vb.st);break}case m.GRACE:case m.NOTE:case m.MREST:Hb(Vb)}Ab(Vb)}Ea(-1);
if(C.a_sl)for(;;){Ka=C.a_sl.shift();if(!Ka)break;Nb=Ka[3].indexOf('d="M')+4;F+=Ka[3].slice(0,Nb);S=new Float32Array(Ka[3].slice(Nb).match(/[\d.-]+/g));S[1]-=w[Ka[0].st].y;fc=Ka[0].fmt.sysstaffsep+24;gc=w[Ka[1].st].y-w[Ka[0].st].y;switch(Ka[2]){case "//":case "\\\\":Na=-(Ka[1].prev.prev.y+w[Ka[0].st].y+Ka[1].prev.next.y+w[Ka[1].st].y)-2*(S[1]-ra);S[5]=Na-S[5];S[7]=Na-S[7];8<S.length&&(Na="/"==Ka[2][0]?3:-3,S[8]=-S[8],S[10]=-S[3]+Na,S[12]=-S[5]+Na,S[14]=-S[7]);break;case "/\\":case "\\/":Na="/"==Ka[2][0]?
gc-fc-10:gc+fc+10;S[3]+=Na;S[5]+=Na;8<S.length&&(S[10]+=Na,S[12]+=Na);break;default:Na="/"==Ka[2][0]?gc-fc:-gc-fc,S[5]+=Na,S[7]+=Na,8<S.length&&(S[12]-=Na,S[14]-=Na)}F+=S[0].toFixed(1)+" "+S[1].toFixed(1)+"c"+S[2].toFixed(1)+" "+S[3].toFixed(1)+" "+S[4].toFixed(1)+" "+S[5].toFixed(1)+" "+S[6].toFixed(1)+" "+S[7].toFixed(1);8<S.length&&(F+="v"+S[8].toFixed(1)+"c"+S[9].toFixed(1)+" "+S[10].toFixed(1)+" "+S[11].toFixed(1)+" "+S[12].toFixed(1)+" "+S[13].toFixed(1)+" "+S[14].toFixed(1));F+='"/>\n'}var mb;
for(mb=0;mb<=R;mb++)w[mb].sc_out&&(F+="<g "+w[mb].scale_str+">\n"+w[mb].sc_out+"</g>\n",w[mb].sc_out=""),w[mb].output&&(F+='<g transform="translate(0,'+(-w[mb].y).toFixed(1)+')">\n'+w[mb].output+"</g>\n",w[mb].output="");ma(c)}Kb&&(Wb-=Kb)}for(Xa();oc.length;)Q.block_gen(oc.shift());Rb&&(Rb.ts_next.ts_prev=Rb);if(!sa)break;sa.ts_prev.ts_next=M=sa;Pd();if(!M)break;var Rb=M.ts_prev;M.ts_prev=null;for(var bc,fb,$b=E.length;0<=--$b;)fb=E[$b],fb.sym&&fb.s_prev&&(fb.sym.prev=fb.s_prev,fb.s_prev.next=fb.sym),
bc=fb.s_next,fb.s_next=null,(fb.sym=bc)?(bc.prev&&(bc.prev.next=bc),fb.s_prev=bc.prev,bc.prev=null):fb.s_prev=null;Pa=Eb()}M=Zb;for(a=d;0<=--a;){var ec=E[a];ec.sym&&ec.s_prev&&(ec.sym.prev=ec.s_prev);ec.sym=ec.osym}}};var za,ja=[],da,rb={},vf=new Int8Array([0,1,3,2,3,0,2,0,3,0]),bb="CDEFGABcdefgab";Abc.prototype.set_vp=function(a){for(var c,d,e,f,g,h=0;;){d=a.shift();if(!d)break;if("="==d.slice(-1)&&!a.length){y(1,I.bad_val,d);break}switch(d){case "clef=":c=a.shift();break;case "clefpitch=":if(d=
a.shift())if(f=bb.indexOf(d[0]),0<=f){switch(d[1]){case "'":f+=7;break;case ",":f-=7,","==d[2]&&(f-=7)}g=4-f;break}y(1,I.bad_val,d);break;case "octave=":f=+a.shift();isNaN(f)?y(1,I.bad_val,d):l.octave=f;break;case "cue=":l.scale="on"==a.shift()?.7:1;break;case "instrument=":d=a.shift();f=d.indexOf("/");if(0>f){f=Gb("c"+d);if(void 0==f)break;l.sound=f;h|=2;f=0}else{f=Gb("c"+d.slice(f+1));if(void 0==f)break;l.sound=f;h|=2;f=Gb(d.replace("/",""));if(void 0==f)break}l.score=t.sound?l.sound:f;h|=1;break;
case "map=":l.map=a.shift();break;case "name=":case "nm=":l.nm=a.shift();'"'==l.nm[0]&&(l.nm=Rb(l.nm.slice(1,-1)));l.new_name=!0;break;case "stem=":case "pos=":d="pos="==d?a.shift().slice(1,-1).split(" "):["stm",a.shift()];f=dd[d[1]];if(void 0==f){y(1,I.bad_val,"%%pos");break}switch(d[2]){case "align":f|=m.SL_ALIGN;break;case "center":f|=m.SL_CENTER;break;case "close":f|=m.SL_CLOSE}e||(e={});e[d[0]]=f;break;case "scale=":f=+a.shift();isNaN(f)||.5>f||2<f?y(1,I.bad_val,"%%voicescale"):l.scale=f;break;
case "score=":if(t.nedo){y(1,I.notransp);break}d=a.shift();if(t.sound)break;f=Gb(d,!0);void 0!=f&&(l.score=f,h|=1);break;case "shift=":if(t.nedo){y(1,I.notransp);break}f=Gb(a.shift());void 0!=f&&(l.shift=f,h=3);break;case "sound=":if(t.nedo){y(1,I.notransp);break}f=Gb(a.shift());if(void 0==f)break;l.sound=f;t.sound&&(l.score=f);h|=2;break;case "subname=":case "sname=":case "snm=":l.snm=a.shift();'"'==l.snm[0]&&(l.snm=l.snm.slice(1,-1));break;case "stafflines=":f=sf(a.shift());void 0==f?y(1,"Bad %%stafflines value"):
void 0!=l.st?J.staves[l.st].stafflines=f:l.stafflines=f;break;case "staffnonote=":f=+a.shift();isNaN(f)?y(1,"Bad %%staffnonote value"):l.staffnonote=f;break;case "staffscale=":f=+a.shift();isNaN(f)||.3>f||2<f?y(1,"Bad %%staffscale value"):l.staffscale=f;break;case "tacet=":f=a.shift();l.tacet=f||void 0;break;case "transpose=":if(t.nedo){y(1,I.notransp);break}f=ne(a.shift());void 0==f?y(1,I.bad_transp):(l.sound=f,t.sound&&(l.score=f),h=2);break;default:switch(d.slice(0,4)){case "treb":case "bass":case "alto":case "teno":case "perc":c=
d;break;default:0<="GFC".indexOf(d[0])?c=d:"="==d.slice(-1)&&a.shift()}}}if(e)for(d in l.pos=z(l.pos),e)e.hasOwnProperty(d)&&(l.pos[d]=e[d]);c&&(c=Qd(c))&&(g&&(c.clefpit=g),pe(c));h&2&&((h=(l.sound|0)+(l.shift|0))?l.tr_snd=abc2svg.b40m(h+122)-36:l.tr_snd&&(l.tr_snd=0))};var Vc=/(\d*)(\/*)(\d*)/g;Abc.prototype.new_note=function(a,c){var d=0,e=[],f=v.line,g=ja;ja=[];v.stemless=!1;var h={type:m.NOTE,fname:v.fname,stem:0,multi:0,nhd:0,xmx:0};h.istart=v.bol+f.index;l.color&&(h.color=l.color);if(a)h.grace=
!0;else{if(l.tie_s){var n=l.tie_s;l.tie_s=null}za&&pc(h);v.repeat_n&&(h.repeat_n=v.repeat_n,h.repeat_k=v.repeat_k,v.repeat_n=0)}var k=f.char();switch(k){case "X":h.invis=!0;case "Z":h.type=m.MREST;k=f.next_char();h.nmes="0"<k&&"9">=k?f.get_int():1;if(1==l.wmeasure){x(1,h,"multi-measure rest, but no measure!");return}h.dur=l.wmeasure*h.nmes;1==h.nmes?(h.type=m.REST,h.dur_orig=h.dur,h.fmr=1,h.notes=[{pit:18,dur:h.dur}]):(fa.mrest_p=!0,1==J.voices.length&&(h.tacet=l.tacet,delete h.invis));break;case "y":h.type=
m.SPACE;h.invis=!0;h.dur=0;k=f.next_char();h.width="0"<=k&&"9">=k?f.get_int():10;n&&(l.tie_s=n,n=null);break;case "x":h.invis=!0;case "z":h.type=m.REST;f.index++;var q=qc(f);h.dur_orig=(0>l.ulen?m.BLEN:l.ulen)*q[0]/q[1];h.dur=h.dur_orig*l.dur_fact;h.dur==l.wmeasure&&(h.fmr=1);h.notes=[{pit:18,dur:h.dur_orig}];break;case "[":q=!0,k=f.next_char();default:if(l.acc_tie){var p=l.acc_tie;l.acc_tie=null}for(h.notes=[];;){if(q)for(;k;){k=k.charCodeAt(0);if(128<=k){y(1,I.not_ascii);return}var r=Ja[k];switch(r[0]){case "(":e.push(rc());
k=f.char();continue;case "!":1<r.length?ja.push(r.slice(1,-1)):Xd();k=f.next_char();continue}break}var w=f;r=h.grace?m.BLEN/4:0>l.ulen?m.BLEN:l.ulen;(k=ab(w))?("0"==w.char()&&(v.stemless=!0,w.index++),w=qc(w),k.dur=r*w[0]/w[1],r=k):r=void 0;if(!r)return;l.octave&&(r.pit+=7*l.octave);w=r.pit+19;k=r.acc;k||(k="p"==t["propagate-accidentals"][0]?l.acc[w%7]:l.acc[w])||(k=l.ckey.k_map[w%7]||0);k&&!l.ckey.k_drum&&("p"==t["propagate-accidentals"][0]?l.acc[w%7]=k:"n"!=t["propagate-accidentals"][0]&&(l.acc[w]=
k));p&&p[w]&&(k=p[w]);r.midi||(r.midi=Vd(w,k));if(l.tr_sco&&(Wc(l,r,k,1),!r.notrp)){var z=d=void 0;var u=r;var B=k;"object"==typeof B&&(d=B[0],z=B[1],B=0<d?1:-1);k=abc2svg.pab40(u.pit,B)+l.tr_sco;u.pit=abc2svg.b40p(k);k=abc2svg.b40a(k);if(z){switch(k){case -2:d=0<d?d-2*z:d-z;break;case -1:0<d&&(d-=z);break;case 0:case 3:d=0<d?d-z:d+z;break;case 1:0>d&&(d+=z);break;case 2:d=0>d?d+2*z:d+z}u.acc=[d,z]}else-3!=k&&(B=k,u.acc?B||(B=3):l.ckey.k_none||(B=0),u.acc=B);-3==k&&(x(1,h,"triple sharp/flat"),k=0<
r.acc?1:-1,r.pit+=k,r.acc=k);d=r.pit+19-w}l.tr_snd&&(r.midi+=l.tr_snd);l.map&&Wc(l,r,k);if(k)switch(t["writeout-accidentals"][1]){case "d":u=l.ckey;if(!u.k_a_acc)break;for(z=0;z<u.k_a_acc.length;z++)if(0==(u.k_a_acc[z].pit-r.pit)%7){r.acc=k;break}break;case "l":r.acc=k}if(e.length)for(;;){k=e.shift();if(!k)break;l.sls.push({ty:k,ss:h,nts:r})}ja.length&&(h.time=l.time,zc(h,r));h.notes.push(r);if(!q)break;for(k=f.char();;){switch(k){case ")":Wd(h,r);k=f.next_char();continue;case "-":r.tie_ty=rc();r.s=
h;l.tie_s=h;h.ti1=!0;if(l.acc[w]||p&&p[w])l.acc_tie||(l.acc_tie=[]),k=l.acc[w],p&&p[w]&&(k=p[w]),l.acc_tie[w]=k;k=f.char();continue;case ".":k=f.next_char();switch(k){case "-":case "(":ja.push("dot");continue}y(1,"Misplaced dot")}break}if("]"==k){f.index++;q=qc(f);h.nhd=h.notes.length-1;for(k=0;k<=h.nhd;k++)r=h.notes[k],r.dur=r.dur*q[0]/q[1];break}}if(c.length)for(;;){k=c.shift();if(!k)break;l.sls.push({ty:k,ss:h});a&&(l.sls[l.sls.length-1].grace=a)}h.dur_orig=h.notes[0].dur;h.dur=h.notes[0].dur*
l.dur_fact}if(h.grace&&h.type!=m.NOTE)y(1,I.bad_grace);else{if(h.notes){if(!h.fmr){z=h.dur_orig/12;for(k=0;!(z&1);)z>>=1,k++;z+1&z&&x(0,h,"Non standard note duration $1",z+"/"+(1<<6-k))}if(a){c=l.ckey.k_bagpipe?8:4;for(k=0;k<=h.nhd;k++)h.notes[k].dur/=c;h.dur/=c;h.dur_orig/=c;a.stem&&(h.stem=a.stem)}else{switch(l.pos.stm&7){case m.SL_ABOVE:h.stem=1;break;case m.SL_BELOW:h.stem=-1;break;case m.SL_HIDDEN:h.stemless=!0}if(c=l.brk_rhythm){l.brk_rhythm=0;u=l.last_note;if(0<c){z=2*c-1;h.dur=h.dur*z/c;h.dur_orig=
h.dur_orig*z/c;for(k=0;k<=h.nhd;k++)h.notes[k].dur=h.notes[k].dur*z/c;u.dur/=c;u.dur_orig/=c;for(k=0;k<=u.nhd;k++)u.notes[k].dur/=c}else{c=-c;z=2*c-1;h.dur/=c;h.dur_orig/=c;for(k=0;k<=h.nhd;k++)h.notes[k].dur/=c;u.dur=u.dur*z/c;u.dur_orig=u.dur_orig*z/c;for(k=0;k<=u.nhd;k++)u.notes[k].dur=u.notes[k].dur*z/c}l.time=u.time+u.dur;for(u=u.next;u;u=u.next)u.time=l.time}}l.last_note=h;for(k=f.char();;){switch(k){case ".":if("-"!=f.buffer[f.index+1])break;ja.push("dot");f.index++;case "-":c=rc();for(k=0;k<=
h.nhd;k++)h.notes[k].tie_ty=c,h.notes[k].s=h;l.tie_s=a||h;l.tie_s.ti1=!0;for(k=0;k<=h.nhd;k++)if(r=h.notes[k],w=r.pit+19-d,l.acc[w]||p&&p[w])l.acc_tie||(l.acc_tie=[]),z=l.acc[w],p&&p[w]&&(z=p[w]),l.acc_tie[w]=z;k=f.char();continue}break}if(n){d=0;r=n.time+n.dur==l.time;for(p=0;p<=h.nhd;p++)if(q=h.notes[p],e=q.midi,n.type!=m.GRACE)for(k=0;k<=n.nhd;k++){if(c=n.notes[k],c.tie_ty&&!(c.midi!=e||r&&c.tie_e)){q.tie_s=c;q.s=h;r&&(c.tie_e=q,c.s=n);d++;break}}else for(k=n.extra;k;k=k.next)if(c=k.notes[0],c.tie_ty&&
c.midi==e){k.ti1=!0;q.tie_s=c;q.s=h;c.tie_e=q;c.s=k;d++;break}d?h.ti2=!0:x(1,n,"Bad tie")}}ha(h);a||(l.lyric_restart||(l.lyric_restart=h),l.sym_restart||(l.sym_restart=h));g.length&&(ja=g,yb(h,h.prev));a&&h.ottava&&(a.ottava=h.ottava);v.stemless&&(h.stemless=!0);h.iend=v.bol+f.index;return h}};var Ja='0;0;0;0;0;0;0;0;0; ;\n;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0; ;!;";i;\n;0;&;0;(;);i;0;0;-;!dot!;0;0;0;0;0;0;0;0;0;0;0;|;i;<;n;<;i;i;n;n;n;n;n;n;n;!fermata!;d;d;d;!emphasis!;!lowermordent!;d;!coda!;!uppermordent!;d;d;!segno!;!trill!;d;d;d;n;d;n;[;\\;|;n;n;i;n;n;n;n;n;n;n;d;d;d;d;d;d;d;d;d;d;d;d;d;!upbow!;!downbow!;d;n;n;n;{;|;};!gmark!;0'.split(";"),
xc,Jc="undefined"!=typeof document?function(a){wb+="\n"+a;if(!xc){abc2svg.styles&&abc2svg.styles.remove();var c=document.createElement("style");document.head.appendChild(c);xc=c.sheet;abc2svg.styles=c}for(a=a.match(/[^{]+{[^}]+}/g);;){c=a.shift();if(!c)break;xc.insertRule(c,xc.cssRules.length)}}:function(a){wb+="\n"+a},Ye=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.25,.333,.408,.5,.5,.833,.778,.333,.333,.333,.5,.564,.25,.564,.25,.278,.5,.5,.5,.5,.5,.5,.5,.5,
.5,.5,.278,.278,.564,.564,.564,.444,.921,.722,.667,.667,.722,.611,.556,.722,.722,.333,.389,.722,.611,.889,.722,.722,.556,.722,.667,.556,.611,.722,.722,.944,.722,.722,.611,.333,.278,.333,.469,.5,.333,.444,.5,.444,.5,.444,.333,.5,.5,.278,.278,.5,.278,.778,.5,.5,.5,.5,.333,.389,.278,.5,.5,.722,.5,.5,.444,.48,.2,.48,.541,.5]),yd=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.278,.278,.355,.556,.556,.889,.667,.191,.333,.333,.389,.584,.278,.333,.278,.278,.556,.556,.556,
.556,.556,.556,.556,.556,.556,.556,.278,.278,.584,.584,.584,.556,1.015,.667,.667,.722,.722,.667,.611,.778,.722,.278,.5,.667,.556,.833,.722,.778,.667,.778,.722,.667,.611,.722,.667,.944,.667,.667,.611,.278,.278,.278,.469,.556,.333,.556,.556,.5,.556,.556,.278,.556,.556,.222,.222,.5,.222,.833,.556,.556,.556,.556,.333,.5,.278,.556,.5,.722,.5,.5,.5,.334,.26,.334,.584,.512]),Xe=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,
.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52,.52]),qa;(function(){if("undefined"!=typeof document){var a;qa=function(c){if(c.wh)return c.wh;a||(a=document.createElement("text"),a.style.position="absolute",a.style.top=
"-1000px",a.style.padding="0",a.style.visibility="hidden",document.body.appendChild(a));var d=C.curfont,e=d.size,f=0,g=0,h=0;a.className=ob(d);a.style.lineHeight=1;if("object"==typeof c)return a.innerHTML=c,c.wh=[a.clientWidth,a.clientHeight],c.wh;for(c=c.replace(/<|>|&[^&\s]*?;|&/g,function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;"}return a});;){h=c.indexOf("$",h);if(0<=h){var l=c[h+1];if("0"==l)d=C.deffont;else if("1"<=l&&"9">=l)d=la("u"+l);else{h++;continue}}a.innerHTML=
c.slice(g,0<=h?h:void 0);f+=a.clientWidth;a.clientHeight>e&&(e=a.clientHeight);if(0>h)break;a.style.font=Ic(d).slice(5);g=h+=2}return[f,e]}}else qa=function(a){var c=C.curfont,e=c.swfac,f=c.size,g=0,h,l=a.length;for(h=0;h<l;h++){var k=a[h];switch(k){case "$":k=a[h+1];if("0"==k)c=C.deffont;else if("1"<=k&&"9">=k)c=la("u"+k);else{k="$";break}h++;e=c.swfac;c.size>f&&(f=c.size);continue;case "&":if(" "!=a[h+1]){var m=a.indexOf(";",h);0<m&&10>m-h&&(h=m,k="a")}}g+=nb(k,c)*e}return[g,f]}})();var yf={A:"info",
C:"composer",O:"composer",P:"parts",Q:"tempo",R:"info",T:"title",X:"title"},F="",vb="\n.stroke{stroke:currentColor;fill:none}\n.bW{stroke:currentColor;fill:none;stroke-width:1}\n.bthW{stroke:currentColor;fill:none;stroke-width:3}\n.slW{stroke:currentColor;fill:none;stroke-width:.7}\n.slthW{stroke:currentColor;fill:none;stroke-width:1.5}\n.sW{stroke:currentColor;fill:none;stroke-width:.7}\n.box{outline:1px solid black;outline-offset:1px}",wb="",Wb=t.leftmargin/t.scale,ra=0,W={width:t.pagewidth,lm:t.leftmargin,
rm:t.rightmargin,wx:0,chg:1},Zc={},sc="",$c="",G={scale:1,dy:0,st:-1,v:-1,g:0},xa=0,Nb={"mtr ":{x:0,y:0,c:" "},brace:{x:0,y:0,c:"\ue000"},lphr:{x:0,y:23,c:"\ue030"},mphr:{x:0,y:23,c:"\ue038"},sphr:{x:0,y:25,c:"\ue039"},short:{x:0,y:32,c:"\ue038"},tick:{x:0,y:25,c:"\ue039"},rdots:{x:-1,y:0,c:"\ue043"},dsgn:{x:-12,y:0,c:"\ue045"},dcap:{x:-12,y:0,c:"\ue046"},sgno:{x:-5,y:0,c:"\ue047"},coda:{x:-10,y:0,c:"\ue048"},tclef:{x:-8,y:0,c:"\ue050"},cclef:{x:-8,y:0,c:"\ue05c"},bclef:{x:-8,y:0,c:"\ue062"},pclef:{x:-6,
y:0,c:"\ue069"},spclef:{x:-6,y:0,c:"\ue069"},stclef:{x:-8,y:0,c:"\ue07a"},scclef:{x:-8,y:0,c:"\ue07b"},sbclef:{x:-7,y:0,c:"\ue07c"},oct:{x:0,y:2,c:"\ue07d"},oct2:{x:0,y:2,c:"\ue07e"},mtr0:{x:0,y:0,c:"\ue080"},mtr1:{x:0,y:0,c:"\ue081"},mtr2:{x:0,y:0,c:"\ue082"},mtr3:{x:0,y:0,c:"\ue083"},mtr4:{x:0,y:0,c:"\ue084"},mtr5:{x:0,y:0,c:"\ue085"},mtr6:{x:0,y:0,c:"\ue086"},mtr7:{x:0,y:0,c:"\ue087"},mtr8:{x:0,y:0,c:"\ue088"},mtr9:{x:0,y:0,c:"\ue089"},mtrC:{x:0,y:0,c:"\ue08a"},"mtr+":{x:0,y:0,c:"\ue08c"},"mtr(":{x:0,
y:0,c:"\ue094"},"mtr)":{x:0,y:0,c:"\ue095"},HDD:{x:-7,y:0,c:"\ue0a0"},breve:{x:-7,y:0,c:"\ue0a1"},HD:{x:-5.2,y:0,c:"\ue0a2"},Hd:{x:-3.8,y:0,c:"\ue0a3"},hd:{x:-3.7,y:0,c:"\ue0a4"},ghd:{x:2,y:0,c:"\ue0a4",sc:.66},pshhd:{x:-3.7,y:0,c:"\ue0a9"},pfthd:{x:-3.7,y:0,c:"\ue0b3"},x:{x:-3.7,y:0,c:"\ue0a9"},"circle-x":{x:-3.7,y:0,c:"\ue0b3"},srep:{x:-5,y:0,c:"\ue101"},"dot+":{x:-5,y:0,sc:.7,c:"\ue101"},diamond:{x:-4,y:0,c:"\ue1b9"},triangle:{x:-4,y:0,c:"\ue1bb"},dot:{x:-1,y:0,c:"\ue1e7"},flu1:{x:-.3,y:0,c:"\ue240"},
fld1:{x:-.3,y:0,c:"\ue241"},flu2:{x:-.3,y:0,c:"\ue242"},fld2:{x:-.3,y:0,c:"\ue243"},flu3:{x:-.3,y:3.5,c:"\ue244"},fld3:{x:-.3,y:-4,c:"\ue245"},flu4:{x:-.3,y:8,c:"\ue246"},fld4:{x:-.3,y:-9,c:"\ue247"},flu5:{x:-.3,y:12.5,c:"\ue248"},fld5:{x:-.3,y:-14,c:"\ue249"},"acc-1":{x:-1,y:0,c:"\ue260"},"cacc-1":{x:-18,y:0,c:"\ue26a\ue260\ue26b"},"sacc-1":{x:-1,y:0,sc:.7,c:"\ue260"},acc3:{x:-1,y:0,c:"\ue261"},cacc3:{x:-18,y:0,c:"\ue26a\ue261\ue26b"},sacc3:{x:-1,y:0,sc:.7,c:"\ue261"},acc1:{x:-2,y:0,c:"\ue262"},
cacc1:{x:-18,y:0,c:"\ue26a\ue262\ue26b"},sacc1:{x:-2,y:0,sc:.7,c:"\ue262"},acc2:{x:-3,y:0,c:"\ue263"},"acc-2":{x:-3,y:0,c:"\ue264"},"acc-1_2":{x:-2,y:0,c:"\ue280"},"acc-3_2":{x:-3,y:0,c:"\ue281"},acc1_2:{x:-1,y:0,c:"\ue282"},acc3_2:{x:-3,y:0,c:"\ue283"},accent:{x:-3,y:2,c:"\ue4a0"},stc:{x:0,y:-2,c:"\ue4a2"},emb:{x:0,y:-2,c:"\ue4a4"},wedge:{x:0,y:0,c:"\ue4a8"},marcato:{x:-3,y:-2,c:"\ue4ac"},hld:{x:-7,y:-2,c:"\ue4c0"},brth:{x:0,y:0,c:"\ue4ce"},caes:{x:0,y:8,c:"\ue4d1"},r00:{x:-1.5,y:0,c:"\ue4e1"},r0:{x:-1.5,
y:0,c:"\ue4e2"},r1:{x:-3.5,y:-6,c:"\ue4e3"},r2:{x:-3.2,y:0,c:"\ue4e4"},r4:{x:-3,y:0,c:"\ue4e5"},r8:{x:-3,y:0,c:"\ue4e6"},r16:{x:-4,y:0,c:"\ue4e7"},r32:{x:-4,y:0,c:"\ue4e8"},r64:{x:-4,y:0,c:"\ue4e9"},r128:{x:-4,y:0,c:"\ue4ea"},mrep:{x:-6,y:0,c:"\ue500"},mrep2:{x:-9,y:0,c:"\ue501"},p:{x:-3,y:0,c:"\ue520"},f:{x:-3,y:0,c:"\ue522"},pppp:{x:-15,y:0,c:"\ue529"},ppp:{x:-14,y:0,c:"\ue52a"},pp:{x:-8,y:0,c:"\ue52b"},mp:{x:-8,y:0,c:"\ue52c"},mf:{x:-8,y:0,c:"\ue52d"},ff:{x:-7,y:0,c:"\ue52f"},fff:{x:-10,y:0,c:"\ue530"},
ffff:{x:-14,y:0,c:"\ue531"},sfz:{x:-10,y:0,c:"\ue539"},trl:{x:-5,y:-2,c:"\ue566"},turn:{x:-5,y:0,c:"\ue567"},turnx:{x:-5,y:0,c:"\ue569"},umrd:{x:-6,y:2,c:"\ue56c"},lmrd:{x:-6,y:2,c:"\ue56d"},dplus:{x:-3,y:0,c:"\ue582"},sld:{x:-8,y:12,c:"\ue5d0"},grm:{x:-3,y:-2,c:"\ue5e2"},dnb:{x:-3,y:0,c:"\ue610"},upb:{x:-2,y:0,c:"\ue612"},opend:{x:-2,y:-2,c:"\ue614"},roll:{x:0,y:0,c:"\ue618"},thumb:{x:-2,y:-2,c:"\ue624"},snap:{x:-2,y:-2,c:"\ue630"},ped:{x:-10,y:0,c:"\ue650"},pedoff:{x:-5,y:0,c:"\ue655"},mtro:{x:0,
y:0,c:"\ue911"},mtrc:{x:0,y:0,c:"\ue915"},"mtr.":{x:0,y:0,c:"\ue920"},"mtr|":{x:0,y:0,c:"\ue925"},longa:{x:-4.7,y:0,c:"\ue95d"},custos:{x:-4,y:3,c:"\uea02"},ltr:{x:2,y:6,c:"\ueaa4"}},Fb={},wa=tc,Ab=tc;Abc.prototype.out_svg=function(a){F+=a};Abc.prototype.sx=Ua;Abc.prototype.sy=cb;Abc.prototype.sh=function(a){return 0>G.st?a/G.scale:a};Abc.prototype.ax=function(a){return a+Wb};Abc.prototype.ay=function(a){return 0>G.st?ra-a:ra+(G.dy-a)*G.scale-G.dy};Abc.prototype.ah=function(a){return 0>G.st?a:a*G.scale};
Abc.prototype.out_sxsy=Qa;Abc.prototype.xypath=Za;var Aa=[[],[],"",[],[],[]],uc={crdc:{dx:0,dy:5,style:"font:italic 14px text,serif",anchor:' text-anchor="middle"'},dacs:{dx:0,dy:3,style:"font:bold 15px text,serif",anchor:' text-anchor="middle"'},pf:{dx:0,dy:5,style:"font:italic bold 16px text,serif",anchor:' text-anchor="middle"'}};uc.at=uc.crdc;Abc.prototype.out_lped=function(a,c,d,e){e.nost||U(a,c,"ped");e.noen||U(a+d+6,c,"pedoff")};var ie={arp:ge,cresc:function(a,c,d,e){a+=d*G.scale;d=-d;P('<path class="stroke"\n\td="mX YlF ',
a,c,d);F=e.nost?F+("-2.2m0 -3.6l"+(-d).toFixed(1)+' -2.2"/>\n'):F+("-4l"+(-d).toFixed(1)+' -4"/>\n')},dim:function(a,c,d,e){P('<path class="stroke"\n\td="mX YlF ',a,c,d);F=e.noen?F+("-2.2m0 -3.6l"+(-d).toFixed(1)+' -2.2"/>\n'):F+("-4l"+(-d).toFixed(1)+' -4"/>\n')},ltr:he,lped:function(a,c,d,e){Q.out_lped(a,c,d,e)},"8va":function(a,c,d,e){18>d&&(d=18,a-=4);e.nost||(P('<text x="X" y="Y" style="font:italic bold 12px text,serif">8<tspan dy="-4" style="font-size:10px">va</tspan></text>\n',a-8,c),a+=12,
d-=12);c+=6;P('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||P('<path class="stroke" d="mX Yv6"/>\n',a+d,c)},"8vb":function(a,c,d,e){18>d&&(d=18,a-=4);e.nost||(P('<text x="X" y="Y" style="font:italic bold 12px text,serif">8<tspan dy=".5" style="font-size:10px">vb</tspan></text>\n',a-8,c),a+=10,d-=10);P('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||P('<path class="stroke" d="mX Yv-6"/>\n',a+d,c)},"15ma":function(a,c,d,e){25>d&&(d=25,a-=6);
e.nost||(P('<text x="X" y="Y" style="font:italic bold 12px text,serif">15<tspan dy="-4" style="font-size:10px">ma</tspan></text>\n',a-10,c),a+=20,d-=20);c+=6;P('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||P('<path class="stroke" d="mX Yv6"/>\n',a+d,c)},"15mb":function(a,c,d,e){24>d&&(d=24,a-=5);e.nost||(P('<text x="X" y="Y" style="font:italic bold 12px text,serif">15<tspan dy=".5" style="font-size:10px">mb</tspan></text>\n',a-10,c),a+=18,d-=18);P('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',
a,c,d);e.noen||P('<path class="stroke" d="mX Yv-6"/>\n',a+d,c)}},te={glisq:function(a,c,d){var e=d.start,f=e.x,g=e.y+w[e.st].y;a-=f;c=Q.sh(g-c);G.g||(a/=G.scale);var h=Math.atan2(c,a);c=h/Math.PI*180;d=(a-(e.s.dots?13+e.s.xmx:8)-8-(d.s.notes[0].shac||0))/Math.cos(h);Ob(f,g,c);f=e.s.dots?13+e.s.xmx:8;d=d/6|0;for(1>d&&(d=1);0<=--d;)U(f,0,"ltr"),f+=6;ib()},gliss:function(a,c,d){var e=d.start,f=e.x,g=e.y+w[e.st].y;a-=f;c=Q.sh(g-c);G.g||(a/=G.scale);var h=Math.atan2(c,a);c=h/Math.PI*180;d=(a-(e.s.dots?
13+e.s.xmx:8)-8-(d.s.notes[0].shac||0))/Math.cos(h);Ob(f,g,c);Za(e.s.dots?13+e.s.xmx:8,0);F+="h"+d.toFixed(1)+'" stroke-width="1"/>\n';ib()}};Abc.prototype.blk_flush=Xa;var J,L,E,l,La,oa,M,Ha=new Uint8Array([6,2,8,6,0,3,4,9,9,0,9,5,0,1,0,0,0,0]);Abc.prototype.voice_adj=function(a){function c(){for(var a,c,d=E[J.top_voice];;){a=v.pq_d.shift();if(!a)break;for(c=d.sym;;c=c.next)if(c.time>=a.time&&c.dur){a.next=c;a.prev=c.prev;a.prev.next=c.prev=a;a.v=c.v;a.p_v=d;a.st=c.st;break}}}function d(a){var c;
var d=a.dur;var e=1;for(c=a;c&&!c.beam_end&&c.next;c=c.next)e++;if(1>=e)delete a.feathered_beam;else{var f=c;var g=d/2;var h=d/(e-1);var l=a.time;if(0<a.feathered_beam)for(c=a,a=e-1;c!=f;c=c.next,a--)d=(h*a|0)+g,c.dur=d,c.time=l,l+=d;else for(c=a,a=0;c!=f;c=c.next,a++)d=(h*a|0)+g,c.dur=d,c.time=l,l+=d;c.dur=c.time+c.dur-l;c.time=l}}var e;l&&l.clone&&(v.istart=v.eol,cd());J.one_v&&xf(E[J.top_voice]);v.pq_d&&c();for(e=0;e<E.length;e++){var f=E[e];if(!a)for(delete f.eoln;;){var g=f.sls.shift();if(!g)break;
var h=g.ss;h.sls||(h.sls=[]);g.loc="o";h.sls.push(g)}for(h=f.sym;h&&!(h.time>=La);h=h.next);for(;h;h=h.next)switch(5>Ha[h.type]&&h.type!=m.STAVES&&h.type!=m.CLEF&&h.time&&(!h.prev||h.time>h.prev.time+h.prev.dur)&&(f={type:m.BAR,bar_type:"[]",v:h.v,p_v:h.p_v,st:h.st,time:h.time,dur:0,next:h,prev:h.prev,fmt:h.fmt,invis:1},h.prev?h.prev.next=f:E[h.v].sym=f,h.prev=f),h.type){case m.GRACE:if(!t.graceword)continue;for(f=h.next;f;f=f.next){switch(f.type){case m.SPACE:continue;case m.NOTE:f.a_ly&&(h.a_ly=
f.a_ly,f.a_ly=null)}break}continue;case m.NOTE:h.feathered_beam&&d(h)}}};Abc.prototype.set_bar_num=function(){var a,c,d,e=0,f=C.nbar,g=0,h=0,l=E[L.top_voice].meter.wmeasure;for(a=M;;a=a.ts_next){if(!a)return;switch(a.type){case m.METER:l=a.wmeasure;case m.CLEF:case m.KEY:case m.STBRK:continue;case m.BAR:a.bar_num&&(f=a.bar_num)}break}for(c=a.ts_next;c;c=c.ts_next)if(c.type==m.BAR&&c.time&&!c.invis&&!c.bar_dotted){c.time<l&&(a=c,g=a.time);break}for(;a;a=a.ts_next)switch(a.type){case m.METER:1!=l&&
(f+=(a.time-g)/l);g=a.time;for(l=a.wmeasure;a.ts_next&&a.ts_next.wmeasure;)a=a.ts_next;break;case m.BAR:if(!(a.time<=e)){e=a.time;var k=1;var q="";for(c=a;c&&!(c.time>e);c=c.next)c.bar_type&&("["!=c.bar_type&&(k=0),c.text&&(q=c.text));if(a.bar_num)f=a.bar_num,h=g=e;else if(1==l)a.bar_dotted||(q&&(t.contbarnb||("1"==q[0]?d=f:f=d)),k||(a.bar_num=++f));else{var p=f+(e-g)/l;c=p-(p|0);var r;if(r=t.checkbars&&c)if(e>h+l&&a.prev.type!=m.MREST)r=1;else{for(r=a.next;r&&r.time==a.time;r=r.next);for(;r&&!r.bar_type;r=
r.next);r=r&&(r.time-g)%l}r&&x(0,a,"Bad measure duration");e>h+l&&(p|=0,c=0,g=e,f=p);q?"1"==q[0]?(t.contbarnb||(d=e-g),k||(a.bar_num=p)):(t.contbarnb||(g=e-d),p=f+(e-g)/l,p==(p|0)&&(a.bar_num=p)):p==(p|0)&&(a.bar_num=p);c||(h=e)}}}};Abc.prototype.do_pscom=function(a){var c;if(c=a.match(/[^\s]+/)){c=c[0];if(l&&l.ignore)switch(c){case "staves":case "score":break;default:return}a=a.replace(c,"").trim();if(" lock"==a.slice(-5))Be[c]=!0,a=a.slice(0,-5).trim();else if(Be[c])return;switch(c){case "clef":2<=
v.state&&(c=Qd(a))&&pe(c);return;case "deco":c=a.match(/(\S*)\s+(.*)/);Lb[c[1]]=c[2];return;case "linebreak":for(c=0;128>c;c++)"\n"==Ja[c]&&(Ja[c]="0");a=a.split(/\s+/);for(c=0;c<a.length;c++){var d=a[c];switch(d){case "!":case "$":case "*":case ";":case "?":case "@":break;case "<none>":continue;case "<EOL>":d="\n";break;default:y(1,"Bad value '$1' in %%linebreak - ignored",d);continue}Ja[d.charCodeAt(0)]="\n"}return;case "map":a:if(a){var e="";c=a.split(/\s+/);if(3>c.length)y(1,I.not_enough_p);else{var f=
c[1];if("*"==f[0]||0==f.indexOf("all"))f="all";else{if(0==f.indexOf("octave,")||0==f.indexOf("key,"))e=f[0],f=f.split(",")[1],f=f.replace(/[,']+/,"").toUpperCase(),0==f.indexOf("key,")&&(f=f.replace(/[=^_]+/,""));d=new H;d.buffer=f;d=ab(d);if(!d){y(1,"Bad note in %%map");break a}f=e+Ud(d.pit,d.acc)}(d=rb[c[0]])||(rb[c[0]]=d={});(a=d[f])||(d[f]=a=[]);c.shift();c.shift();if(c.length){c=tb(c.join(" "));f=0;if(0>c[0].indexOf("=")){"*"!=c[0][0]&&(d=new H,d.buffer=c[0],a[1]=ab(d));if(!c[1])break a;f++;
0>c[1].indexOf("=")&&(a[0]=c[1].split(","),f++)}for(;f<c.length;f++)switch(c[f]){case "heads=":if(!c[++f]){y(1,I.not_enough_p);break}a[0]=c[f].split(",");break;case "print=":case "play=":case "print_notrp=":if(!c[++f]){y(1,I.not_enough_p);break}d=new H;d.buffer=c[f];d=ab(d);"_"==c[f-1][5]&&(d.notrp=1);"r"==c[f-1][1]?a[1]=d:a[3]=d;break;case "color=":c[++f]?a[2]=c[f]:y(1,I.not_enough_p)}}}}return;case "maxsysstaffsep":case "sysstaffsep":if(3==v.state){d=Ra(a);if(isNaN(d)){y(1,I.bad_val,"%%"+c);return}J.voices[l.v]["m"==
c[0]?"maxsep":"sep"]=d;return}break;case "multicol":switch(a){case "start":case "new":case "end":break;default:y(1,"Unknown keyword '$1' in %%multicol",a);return}c={type:m.BLOCK,subtype:"mc_"+a,dur:0};if(2<=v.state){l=E[0];l.eoln=1;ha(c);return}sb(c);Q.block_gen(c);return;case "ottava":if(3!=v.state)return;c=parseInt(a);if(isNaN(c)||-2>c||2<c||!c&&!l.ottava){y(1,I.bad_val,"%%ottava");return}(d=c)?l.ottava=c:(c=l.ottava,l.ottava=0);ja.push(["15mb","8vb","","8va","15ma"][c+2]+(d?"(":")"));return;case "repbra":l&&
(l.norepbra=!Va(a));return;case "repeat":if(3!=v.state)return;if(!l.last_sym){y(1,"%%repeat cannot start a tune");return}if(a.length){a=a.split(/\s+/);c=parseInt(a[0]);d=parseInt(a[1]);if(isNaN(c)||1>c||l.last_sym.type==m.BAR&&2<c){y(1,"Incorrect 1st value in %%repeat");return}if(isNaN(d))d=1;else if(1>d){y(1,"Incorrect 2nd value in %%repeat");return}}else d=c=1;v.repeat_n=l.last_sym.type==m.BAR?c:-c;v.repeat_k=d;return;case "sep":Wa();var g=W.width-W.lm-W.rm;d=f=e=0;if(a&&(a=a.split(/\s+/),d=Ra(a[0]),
a[1]&&(f=Ra(a[1]),a[2]&&(e=Ra(a[2]))),isNaN(d)||isNaN(f)||isNaN(e))){y(1,I.bad_val,"%%sep");return}1>d&&(d=14);1>f&&(f=d);1>e&&(e=90);if(2<=v.state){c=$a(c);c.x=(g-e)/2/t.scale;c.l=e/t.scale;c.sk1=d;c.sk2=f;return}ma(d);F+='<path class="stroke"\n\td="M';Qa((g-e)/2/t.scale," ",0);F+="h"+(e/t.scale).toFixed(1)+'"/>\n';ma(f);Xa();return;case "setbarnb":d=parseInt(a);if(isNaN(d)||1>d){y(1,"Bad %%setbarnb value");break}fa.new_nbar=d;return;case "staff":if(3!=v.state)return;d=parseInt(a);if(isNaN(d)){y(1,
"Bad %%staff value '$1'",a);return}c="+"==a[0]||"-"==a[0]?l.cst+d:d-1;if(0>c||c>R){y(1,"Bad %%staff number $1 (cur $2, max $3)",c,l.cst,R);return}delete l.floating;l.cst=c;return;case "staffbreak":if(3!=v.state)return;c={type:m.STBRK,dur:0};"f"==a.slice(-1)&&(c.stbrk_forced=!0,a=a.replace(/\sf$/,""));if(a){d=Ra(a);if(isNaN(d)){y(1,I.bad_val,"%%staffbreak");return}c.xmx=d}else c.xmx=14;ha(c);return;case "tacet":'"'==a[0]&&(a=a.slice(1,-1));case "stafflines":case "staffscale":case "staffnonote":Yb(c,
a);return;case "staves":case "score":if(!v.state)return;v.scores&&0<v.scores.length&&(a=v.scores.shift(),c=a.match(/([^\s]+)\s*(.*)/),a=c[2],c=c[1]);a:{f=a;var h;d=E.length;a=0;if(l&&l.clone){var n=v.eol;v.eol=v.bol;cd();v.eol=n}if(f){b:{g={};n=[];var k=!1;var w=h=0,p=0,r=0,x=0,B=f.match(/[^[\]|{}()*+\s]+|[^\s]/g);if(B){for(;;){var u=B.shift();if(!u)break;switch(u){case "[":if(r||2<=w+p){y(1,I.misplaced,"[");k=!0;break}h|=0==w+p?4:1024;p++;x<<=8;x|=4;break;case "{":if(r||w||2<=p){y(1,I.misplaced,
"{");k=!0;break}h|=p?256:1;w++;x<<=8;x|=1;break;case "(":if(r){y(1,I.misplaced,"(");k=!0;break}h|=16;r++;x<<=8;x|=16;break;case "*":!w||r||h&257||(h|=128);break;case "+":h|=4096;break;case "]":case "}":case ")":y(1,"Bad voice ID in %%score");k=!0;break;default:for(e=u;;){u=B.shift();if(!u)break;switch(u){case "]":if(!(x&4)){y(1,I.misplaced,"]");k=!0;break}p--;h|=0==w+p?8:2048;x>>=8;continue;case "}":if(!(x&1)){y(1,I.misplaced,"}");k=!0;break}w--;h|=p?512:2;h&=-129;x>>=8;continue;case ")":if(!(x&16)){y(1,
I.misplaced,")");k=!0;break}r--;h|=32;x>>=8;continue;case "|":h|=64;continue}break}g[e]?(y(1,"Double voice in %%score"),k=!0):(g[e]=!0,n.push([e,h]));h=0;u&&B.unshift(u)}}0!=x&&(y(1,"'}', ')' or ']' missing in %%score"),k=!0);if(!k&&n.length){e=n;break b}}else y(1,I.bad_val,"%%score");e=void 0}if(!e)break a}else if(0>La){y(1,I.bad_val,"%%"+c);break a}for(k=0;k<d;k++)g=E[k],g.time>a&&(a=g.time);if(a){Q.voice_adj(1);for(k=0;k<J.voices.length;k++)if(J.voices[k]){l=E[k];break}l.time=a;n={type:m.STAVES,
dur:0};ha(n);J.nstaff=R;if(!f){n.sy=z(J,1);J=J.next=n.sy;La=a;for(k=0;k<d;k++)E[k].time=a;l=E[J.top_voice];break a}me();n.sy=J}else J.staves=[],J.voices=[];La=a;for(k=0;k<d;k++)if(g=E[k],delete g.second,delete g.floating,g.ignore){g.ignore=0;if(n=g.sym)for(;n.next;)n=n.next;g.last_sym=n}for(n=d=0;n<e.length;n++)for(f=e[n][0],g=vc(f),g.time=a,k=g.v,e[n][0]=g;;){J.voices[k]={range:d++};g=g.voice_down;if(!g)break;k=g.v}J.top_voice=e[0][0].v;1==e.length&&(J.one_v=1);if("t"==c[1])for(n=0;n<e.length;n++)d=
e[n][1],d&257&&3!=(d&3)&&768!=(d&768)&&0==e[n+1][1]&&!(d&16||e[n+2][1]&16)&&(e[n+2][1]&514?e[n+1][1]|=128:0==e[n+2][1]&&e[n+3][1]&514&&(e[n][1]|=16,e[n+1][1]|=32,e[n+2][1]|=16,e[n+3][1]|=32));f=-1;for(n=0;n<e.length;n++)if(d=e[n][1],48==(d&48)&&(d&=-49,e[n][1]=d),g=e[n][0],d&128?(g.floating=!0,g.second=!0):(f++,J.staves[f]||(J.staves[f]={stafflines:g.stafflines||"|||||",staffscale:1}),J.staves[f].flags=0),k=g.v,g.st=g.cst=J.voices[k].st=f,J.staves[f].flags|=d,d&16){for(h=g;n<e.length-1&&!(g=e[++n][0],
k=g.v,e[n][1]&4096?(h.second=!0,h=g):g.second=!0,g.st=g.cst=J.voices[k].st=f,e[n][1]&32););J.staves[f].flags|=e[n][1]}0>f&&(f=0);J.nstaff=R=f;if("c"==c[1])for(f=0;f<R;f++)J.staves[f].flags^=64;d=E.length;for(k=f=0;k<d;k++){g=E[k];J.voices[k]?f=g.st:g.st=f;if(!a)for(n=g.sym;n;n=n.next)n.st=f;if(J.voices[k]){for(h=g.voice_down;h;)h.second=1,n=h.v,h.st=h.cst=J.voices[n].st=f,h=h.voice_down;J.voices[k].second=g.second;f=g.st;0<f&&void 0==g.norepbra&&!(J.staves[f-1].flags&64)&&(g.norepbra=!0)}}l=2<=v.state?
E[J.top_voice]:null}return;case "center":case "text":d="c"==c[0]?"c":t.textoption;ea("text");if(2<=v.state){c=$a("text");c.text=a;c.opt=d;c.font=t.textfont;return}Yc(a,d);return;case "transpose":if(t.sound)return;d=ne(a);if(void 0==d&&(d=Gb(a),void 0==d))return;switch(v.state){case 0:t.transp=0;case 1:t.transp=(t.transp||0)+d;return}l.shift=d;oe();return;case "tune":return;case "user":Rd(a);return;case "voicecolor":l&&(l.color=a);return;case "vskip":d=Ra(a);if(isNaN(d)){y(1,I.bad_val,"%%vskip");return}if(0>
d){y(1,"%%vskip cannot be negative");return}if(2<=v.state){c=$a(c);c.sk=d;return}ma(d);return;case "newpage":case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "printmargin":case "scale":case "staffwidth":if(2<=v.state){c=$a(c);c.param=a;return}if("newpage"==c){Xa();q.page_format&&(xa=2);return}}Q.set_format(c,a)}};Abc.prototype.do_begin_end=function(a,c,d){switch(a){case "js":Oa(d);break;case "ml":if(t.pageheight){y(1,"Cannot have %%beginml with %%pageheight");break}2<=v.state?
(a=$a(a),a.text=d):(Xa(),q.img_out&&q.img_out(d));break;case "svg":for(c=0;;){a=d.indexOf("<style",c);if(0>a)break;a=d.indexOf(">",a);c=d.indexOf("</style>",a);if(0>c){y(1,"No </style> in %%beginsvg sequence");break}vb+=d.slice(a+1,c).replace(/\s+$/,"")}for(c=0;;){a=d.indexOf("<defs>\n",c);if(0>a)break;c=d.indexOf("</defs>",a);if(0>c){y(1,"No </defs> in %%beginsvg sequence");break}ce(d.slice(a+6,c))}break;case "text":c=ud(c),c||(c=t.textoption),ea("text"),0<=d.indexOf("\\")&&(d=Rb(d)),1<v.state?(a=
$a(a),a.text=d,a.opt=c,a.font=t.textfont):Yc(d,c)}};Abc.prototype.gch_build=function(a){var c,d=0,e=0;for(c=0;c<a.a_gch.length;c++){var f=a.a_gch[c];if("g"==f.type)f.text=f.text.replace(/##|#|=|bb|b/g,function(a){switch(a){case "##":return"&#x1d12a;";case "#":return"\u266f";case "=":return"\u266e";case "b":return"\u266d"}return"&#x1d12b;"});else if("@"==f.type&&!q.anno_start&&!q.anno_stop){ea(f.font);f.text=Sb(f.text);continue}ea(f.font);f.text=Sb(f.text);var g=f.text.wh;switch(f.type){case "@":break;
default:g=.4*g[0];8<g&&(g=8);f.x=-g;break;case "<":f.x=-(g[0]+6);d-=g[1];f.y=d+g[1]/2;break;case ">":f.x=6,e-=g[1],f.y=e+g[1]/2}}d/=2;e/=2;for(c=0;c<a.a_gch.length;c++)switch(f=a.a_gch[c],f.type){case "<":f.y-=d;break;case ">":f.y-=e}};Abc.prototype.draw_gchord=function(a,c,d,e){if(!c.invis||!c.play){var f=c.a_gch[a],g=f.text.wh[1],h=f.font.pad,l=f.text.wh[0]+2*h,k=.22*g;f.font.figb&&(g*=2.4,k+=1.3*f.font.size);switch(f.type){case "_":e-=g+h;break;case "^":e+=h;break;case "<":case ">":"<"==f.type?
(c.notes[0].acc&&(d-=c.notes[0].shac),d-=h):(c.xmx&&(d+=c.xmx),c.dots&&(d+=1.5+3.5*c.dots),d+=h);e+=(c.type==m.NOTE?3*((c.notes[c.nhd].pit+c.notes[0].pit>>1)-18):12)-g/2;break;default:e=0<=e?e+h:e-(g+h);break;case "@":e+=(c.type==m.NOTE?3*((c.notes[c.nhd].pit+c.notes[0].pit>>1)-18):12)-g/2,0<e?(a=e+g+h+2,a>w[c.st].ann_top&&(w[c.st].ann_top=a)):(a=e-2,a<w[c.st].ann_bot&&(w[c.st].ann_bot=a))}"@"!=f.type&&(0<=e?ba(c.st,1,d,l,e+g+h+2):ba(c.st,0,d,l,e-h));pb(f.font);ea(f.font);Da(c.st);q.anno_start&&q.anno_start("annot",
f.istart,f.iend,d-2,e+g+2,l+4,g+4,c);T(d,e+k,f.text);q.anno_stop&&q.anno_stop("annot",f.istart,f.iend,d-2,e+g+2,l+4,g+4,c)}};zd();Abc.prototype.a_de=function(){return O};Abc.prototype.add_style=function(a){vb+=a};Abc.prototype.anno_a=Ib;Abc.prototype.cfmt=function(){return t};Abc.prototype.clone=z;Abc.prototype.deco_put=function(a,c){ja.push(a);yb(c)};Abc.prototype.defs_add=ce;Abc.prototype.dh_put=function(a,c,d){ja.push(a);zc(c,d)};Abc.prototype.draw_meter=pd;Abc.prototype.draw_note=Cb;Abc.prototype.errs=
I;Abc.prototype.font_class=ob;Abc.prototype.gch_tr1=se;Abc.prototype.get_bool=Va;Abc.prototype.get_cur_sy=function(){return L};Abc.prototype.get_curvoice=function(){return l};Abc.prototype.get_delta_tb=function(){return ed};Abc.prototype.get_decos=function(){return Lb};Abc.prototype.get_font=la;Abc.prototype.get_font_style=function(){return wb};Abc.prototype.get_glyphs=function(){return Fb};Abc.prototype.get_img=function(){return W};Abc.prototype.get_maps=function(){return rb};Abc.prototype.get_multi=
function(){return da};Abc.prototype.get_newpage=function(){if(block.newpage)return block.newpage=!1,!0};Abc.prototype.get_posy=function(){return ra};Abc.prototype.get_staff_tb=function(){return w};Abc.prototype.get_top_v=function(){return J.top_voice};Abc.prototype.get_tsfirst=function(){return M};Abc.prototype.get_unit=Ra;Abc.prototype.get_voice_tb=function(){return E};Abc.prototype.glout=Tb;Abc.prototype.info=function(){return N};Abc.prototype.new_block=$a;Abc.prototype.out_arp=ge;Abc.prototype.out_deco_str=
fe;Abc.prototype.out_deco_val=bd;Abc.prototype.out_ltr=he;Abc.prototype.param_set_font=zb;Abc.prototype.parse=v;Abc.prototype.psdeco=tc;Abc.prototype.psxygl=tc;Abc.prototype.set_cur_sy=function(a){L=a};Abc.prototype.set_dscale=Da;Abc.prototype.set_font=ea;Abc.prototype.set_a_gch=function(a,c){za=c;pc(a)};Abc.prototype.set_hl=hb;Abc.prototype.set_map=Wc;Abc.prototype.set_page=Wa;Abc.prototype.set_pagef=function(){xa=1};Abc.prototype.set_realwidth=function(a){ia=a};Abc.prototype.set_scale=Hb;Abc.prototype.set_sscale=
Ea;Abc.prototype.set_tsfirst=function(a){M=a};Abc.prototype.set_v_param=Yb;Abc.prototype.strwh=qa;Abc.prototype.stv_g=function(){return G};Abc.prototype.svg_flush=ub;Abc.prototype.syntax=y;Abc.prototype.tunes=Lc;Abc.prototype.unlksym=gb;Abc.prototype.use_font=pb;Abc.prototype.vskip=ma;Abc.prototype.xy_str=T;Abc.prototype.xygl=U;Abc.prototype.y_get=aa;Abc.prototype.y_set=ba};var Abc=abc2svg.Abc;"object"==typeof module&&"object"==typeof exports&&(exports.abc2svg=abc2svg,exports.Abc=Abc);
abc2svg.loadjs||(abc2svg.loadjs=function(q,z,B){B&&B(q)});
abc2svg.modules={ambitus:{},begingrid:{fn:"grid3"},beginps:{fn:"psvg"},break:{},capo:{},chordnames:{},clip:{},clairnote:{fn:"clair"},voicecombine:{fn:"combine"},diagram:{fn:"diag"},equalbars:{},gamelan:{},grid:{},grid2:{},jazzchord:{},jianpu:{},mdnn:{},MIDI:{},nns:{},pageheight:{fn:"page"},pedline:{},percmap:{fn:"perc"},roman:{},soloffs:{},sth:{},strtab:{},temperament:{fn:"temper"},tropt:{},nreq:0,load:function(q,z,B){function x(){return"object"==typeof user&&user.errmsg?user.errmsg:"function"==typeof abc2svg.printErr?
abc2svg.printErr:"function"==typeof alert?function(q){alert(q)}:"object"==typeof console?console.log:function(){}}function H(){0==--abc2svg.modules.nreq&&abc2svg.modules.cbf()}var y=this.nreq;q=q.match(/(^|\n)(%%|I:).+?\b/g);if(!q)return!0;this.cbf=z||function(){};this.errmsg=B||x();for(B=0;B<q.length;B++){var Oa=q[B].replace(/\n?(%%|I:)/,"");(z=abc2svg.modules[Oa])&&!z.loaded&&(z.loaded=!0,z.fn&&(Oa=z.fn),this.nreq++,abc2svg.loadjs(Oa+"-1.js",H,function(){abc2svg.modules.errmsg("Error loading the module "+
Oa);H()}))}return this.nreq==y}};abc2svg.version="v1.22.14";abc2svg.vdate="2024-04-04";"undefined"==typeof abc2svg&&(abc2svg={});
abc2svg.MIDI={do_midi:function(q){var z,B=q.split(/\s+/);q=this.cfmt();if(z=this.get_curvoice()){if(z.ignore)return;void 0==z.chn&&(z.chn=9>z.v?z.v:z.v+1)}switch(B[1]){case "chordname":q.chord||(q.chord={});q.chord.names||(q.chord.names={});q.chord.names[B[2]]=B.slice(3);break;case "chordprog":q.chord||(q.chord={});q.chord.prog=B[2];B[3]&&"octave="==B[3].slice(0,7)&&(q.chord.trans=Number(B[3].slice(7)));break;case "chordvol":var x=Number(B[2]);if(isNaN(x)||0>x||127<x){this.syntax(1,this.errs.bad_val,
"%%MIDI chordvol");break}q.chord||(q.chord={});q.chord.vol=x/127;break;case "gchordon":case "gchordoff":q.chord||(q.chord={});if(2<=this.parse.state&&z){var H=this.new_block("midigch");H.play=H.invis=1;H.on="n"==B[1][7]}else q.chord.gchon="n"==B[1][7];break;case "channel":x=parseInt(B[2]);if(isNaN(x)||0>=x||16<x){this.syntax(1,this.errs.bad_val,"%%MIDI channel");break}x--;3==this.parse.state?(H=this.new_block("midiprog"),H.play=H.invis=1,z.chn=H.chn=x):this.set_v_param("channel",x);break;case "drummap":x=
Number(B[3]);if(isNaN(x)){this.syntax(1,this.errs.bad_val,"%%MIDI drummap");break}for(z="C ^C D _E E F ^F G ^G A _B B".split(" ")[x%12];60>x;)z+=",",x+=12;for(;72<x;)z+="'",x-=12;this.do_pscom("map MIDIdrum "+B[2]+" play="+z);this.set_v_param("mididrum","MIDIdrum");break;case "program":void 0!=B[3]?(abc2svg.MIDI.do_midi.call(this,"MIDI channel "+B[2]),x=B[3]):x=B[2];x=parseInt(x);if(isNaN(x)||0>x||127<x){this.syntax(1,this.errs.bad_val,"%%MIDI program");break}3==this.parse.state?(H=this.new_block("midiprog"),
H.play=H.invis=1,H.instr=x,H.chn=z.chn):this.set_v_param("instr",x);break;case "control":z=parseInt(B[2]);if(isNaN(z)||0>z||127<z){this.syntax(1,"Bad controller number in %%MIDI");break}x=parseInt(B[3]);if(isNaN(x)||0>x||127<x){this.syntax(1,"Bad controller value in %%MIDI");break}3==this.parse.state?(H=this.new_block("midictl"),H.play=H.invis=1,H.ctrl=z,H.val=x):this.set_v_param("midictl",B[2]+" "+B[3]);break;case "temperamentequal":if(z=parseInt(B[2]),isNaN(z)||5>z||255<z)this.syntax(1,this.errs.bad_val,
"%%MIDI "+B[1]);else{53==z&&(H=this.get_glyphs(),H.acc12_53='<text id="acc12_53" x="-1">&#xe282;</text>',H.acc24_53='<text id="acc24_53" x="-1">&#xe282;\t<tspan x="0" y="-10" style="font-size:8px">2</tspan></text>',H.acc36_53='<text id="acc36_53" x="-1">&#xe262;\t<tspan x="0" y="-10" style="font-size:8px">3</tspan></text>',H.acc48_53='<text id="acc48_53" x="-1">&#xe262;</text>',H.acc60_53='<g id="acc60_53">\n\t<text style="font-size:1.2em" x="-1">&#xe282;</text>\n\t<path class="stroke" stroke-width="1.6" d="M-2 1.5l7 -3"/>\n</g>',
H["acc-60_53"]='<text id="acc-60_53" x="-1">&#xe260;</text>',H["acc-48_53"]='<g id="acc-48_53">\n\t<text x="-1">&#xe260;</text>\n\t<path class="stroke" stroke-width="1" d="M-3 -5.5l5 -2"/>\n</g>',H["acc-36_53"]='<g id="acc-36_53">\n\t<text x="-1">&#xe260;\t\t<tspan x="0" y="-10" style="font-size:8px">3</tspan></text>\n\t<path class="stroke" stroke-width="1" d="M-3 -5.5l5 -2"/>\n</g>',H["acc-24_53"]='<text id="acc-24_53" x="-2">&#xe280;\t<tspan x="0" y="-10" style="font-size:8px">2</tspan></text>',
H["acc-12_53"]='<text id="acc-12_53" x="-2">&#xe280;</text>');q.nedo=z;x=12*(7.019550008653874*z/12+.5|0)/z;(6.85>x||7.2<x)&&this.syntax(0,this.errs.bad_val,"%%MIDI "+B[1]);H=[2,25,8,31,14,37,20,3,26,9,32,15,38,21,4,27,10,33,16,39];z=[0,19,36,13,30,7,24,1,18,35,12,29,6,23,0,17];var y=21-3*x;b=new Float32Array(40);for(B=0;B<H.length;B++)b[H[B]]=(x*B+y)%12;for(B=1;B<=z.length;B++)b[z[B]]=12-(x*B-y)%12;q.temper=b}}},set_vp:function(q,z){var B=this.get_curvoice();q(z.slice(0));for(q=0;q<z.length;q++)switch(z[q]){case "channel=":var x=
this.new_block("midiprog");x.play=x.invis=1;x.chn=B.chn=z[++q];break;case "instr=":x=this.new_block("midiprog");x.play=x.invis=1;x.instr=z[++q];void 0==B.chn&&(B.chn=9>B.v?B.v:B.v+1);x.chn=B.chn;break;case "midictl=":B.midictl||(B.midictl=[]);x=z[++q].split(" ");B.midictl[x[0]]=Number(x[1]);break;case "mididrum=":B.map||(B.map={}),B.map=z[++q]}},do_pscom:function(q,z){"MIDI "==z.slice(0,5)?abc2svg.MIDI.do_midi.call(this,z):q(z)},set_hooks:function(q){q.do_pscom=abc2svg.MIDI.do_pscom.bind(q,q.do_pscom);
q.set_vp=abc2svg.MIDI.set_vp.bind(q,q.set_vp)}};abc2svg.mhooks||(abc2svg.mhooks={});abc2svg.mhooks.MIDI=abc2svg.MIDI.set_hooks;"undefined"==typeof abc2svg&&(abc2svg={});
abc2svg.perc={do_perc:function(q){new Int8Array([0,0,1,2,2,3,3,4,5,5,6,6]);new Int8Array([3,1,3,-1,3,3,1,3,-1,3,-1,3]);var z={"a-b-d":35,"a-s":38,"b-d-1":36,ca:69,cl:75,co:56,"c-c":52,"c-c-1":49,"c-c-2":57,"c-h-h":42,"e-s":40,"h-a":67,"h-b":60,"h-c":39,"h-f-t":43,"h-m-t":48,"h-ti":65,"h-to":50,"h-w-b":76,"l-a":68,"l-b":61,"l-c":64,"l-f-t":41,"l-g":74,"l-m-t":47,"l-ti":66,"l-to":45,"l-w":72,"l-w-b":77,m:70,"m-c":78,"m-h-c":62,"m-t":80,"o-c":79,"o-h-c":63,"o-h-h":46,"o-t":81,"p-h-h":44,"r-b":53,"r-c-1":51,
"r-c-2":59,"s-c":55,"s-g":73,"s-s":37,"s-w":71,t:54,v:58};q=q.split(/\s+/);var B=q[1].replace(/[=_^]/,"");this.do_pscom("map MIDIdrum "+q[1]+" play="+function(q){var x;if(/^[_^]*[A-Ga-g][,']*$/.test(q))return q;var y=Number(q);if(isNaN(y)){q=q.toLowerCase(q);var B=q[0];for(x=0;;){x=q.indexOf("-",x);if(0>x)break;x+=1;B+="-"+q[x]}y=z[B];if(!y){switch(q[0]){case "c":switch(q[1]){case "a":y=z.ca;break;case "l":y=z.cl;break;case "o":y=z.co}break;case "h":case "l":if(x=q.indexOf("-"),"t"==q[x+1])switch(q[x+
2]){case "i":case "o":y=z[B+q[x+2]]}}if(!y)return}}for(q="C ^C D _E E F ^F G ^G A _B B".split(" ")[y%12];60>y;)q+=",",y+=12;for(;72<=y;)q+="'",y-=12;return q}(q[2])+" print="+B+(q[3]?" heads="+q[3]:""));this.set_v_param("perc","MIDIdrum")},set_perc:function(q){var z,B=this.get_curvoice();for(z=0;z<q.length;z++)switch(q[z]){case "perc=":B.map||(B.map={});B.map=q[z+1];var x=this.new_block("midiprog");x.play=x.invis=1;B.chn=x.chn=9}},do_pscom:function(q,z){"percmap "==z.slice(0,8)?abc2svg.perc.do_perc.call(this,
z):q(z)},set_vp:function(q,z){abc2svg.perc.set_perc.call(this,z);q(z)},set_hooks:function(q){q.do_pscom=abc2svg.perc.do_pscom.bind(q,q.do_pscom);q.set_vp=abc2svg.perc.set_vp.bind(q,q.set_vp)}};abc2svg.mhooks||(abc2svg.mhooks={});abc2svg.mhooks.perc=abc2svg.perc.set_hooks;"undefined"==typeof abc2svg&&(abc2svg={});
abc2svg.pedline={draw_all_deco:function(q){var z,B,x=this.a_de();if(x.length){if(this.cfmt().pedline)for(z=0;z<x.length;z++){var H=x[z];if("ped)"==H.dd.name){var y=H.start;(B=H.prev)&&"ped)"==B.dd.name&&B.s.v==y.s.v?(H.defl.nost=B.defl.noen=2,H.x=y.s.x-10,H.val=H.s.x-y.s.x-3,B.val=H.x-B.x,H.y>B.y&&(H.y=B.y),B.y=H.y):(H.x=y.s.x-8,H.defl.noen||(H.val=H.s.x-y.s.x-H.s.wl))}}q()}},out_lped:function(q,z,B,x,H){this.cfmt().pedline?(this.xypath(z,B+8),H.nost?2==H.nost?(this.out_svg("l2.5 6"),x-=2.5):this.out_svg("m0 6"):
this.out_svg("v6"),H.noen?2==H.noen?this.out_svg("h"+(x-2.5).toFixed(1)+"l2.5 -6"):this.out_svg("h"+x.toFixed(1)):this.out_svg("h"+x.toFixed(1)+"v-6"),this.out_svg('"/>\n')):q(z,B,x,H)},set_fmt:function(q,z,B){"pedline"==z?this.cfmt().pedline=this.get_bool(B):q(z,B)},set_hooks:function(q){q.draw_all_deco=abc2svg.pedline.draw_all_deco.bind(q,q.draw_all_deco);q.out_lped=abc2svg.pedline.out_lped.bind(q,q.out_lped);q.set_format=abc2svg.pedline.set_fmt.bind(q,q.set_format)}};
abc2svg.mhooks||(abc2svg.mhooks={});abc2svg.mhooks.pedline=abc2svg.pedline.set_hooks;
